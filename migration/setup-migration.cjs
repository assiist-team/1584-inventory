#!/usr/bin/env node

/**
 * Setup script for migration - helps configure environment variables
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

function question(prompt) {
  return new Promise((resolve) => {
    rl.question(prompt, resolve);
  });
}

async function setupEnvironment() {
  console.log('üîß Firebase Migration Setup');
  console.log('=============================\n');

  console.log('I need to collect your Firebase configuration to create a .env file.');
  console.log('You can find these values in your Firebase project settings.\n');

  const envVars = {
    VITE_FIREBASE_API_KEY: await question('Firebase API Key: '),
    VITE_FIREBASE_AUTH_DOMAIN: await question('Firebase Auth Domain (e.g., your-project.firebaseapp.com): '),
    VITE_FIREBASE_PROJECT_ID: await question('Firebase Project ID (e.g., inventory-management-090999): '),
    VITE_FIREBASE_STORAGE_BUCKET: await question('Firebase Storage Bucket (e.g., your-project.appspot.com): '),
    VITE_FIREBASE_MESSAGING_SENDER_ID: await question('Firebase Messaging Sender ID: '),
    VITE_FIREBASE_APP_ID: await question('Firebase App ID: '),
    VITE_FIREBASE_MEASUREMENT_ID: await question('Firebase Measurement ID (optional, press Enter to skip): ')
  };

  // Create .env file
  const envPath = path.join(__dirname, '..', '.env');
  let envContent = '# Firebase Configuration\n';
  envContent += '# Generated by setup-migration.js\n\n';

  Object.entries(envVars).forEach(([key, value]) => {
    if (value.trim()) {
      envContent += `${key}=${value.trim()}\n`;
    }
  });

  try {
    fs.writeFileSync(envPath, envContent);
    console.log(`\n‚úÖ Created .env file at ${envPath}`);
    console.log('\nüìã Next steps:');
    console.log('1. Deploy updated Firestore rules: firebase deploy --only firestore:rules');
    console.log('2. Test connection: node migration/test-connection.cjs');
    console.log('3. Run migration: node migration/migrate-sandra-dawson-transactions.cjs');
  } catch (error) {
    console.error('‚ùå Failed to create .env file:', error.message);
  }

  rl.close();
}

setupEnvironment().catch(console.error);
