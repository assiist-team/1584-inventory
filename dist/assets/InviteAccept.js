import{j as e,U as w,g as G,a as H,b as z,s as B}from"./index.js";import{r as s}from"./vendor.js";import{c as V,b as D}from"./router.js";import{A as v,M as N,d as L,U as R,E as k,e as C}from"./ui.js";import"./supabase.js";function K(){const{token:l}=V(),h=D(),[S,o]=s.useState(!0),[d,t]=s.useState(null),[x,P]=s.useState(null),[u,b]=s.useState("google"),[c,y]=s.useState(""),[a,E]=s.useState(""),[p,I]=s.useState(""),[g,M]=s.useState(!1),[f,A]=s.useState(!1),[m,j]=s.useState(!1),[U,F]=s.useState(!1);s.useEffect(()=>{(async()=>{if(!l){t("Invalid invitation link"),o(!1);return}const i=setTimeout(()=>{console.error("Invitation check timeout"),t("Request timed out. Please try again."),o(!1)},1e4);try{const n=await G(l);if(clearTimeout(i),!n){t("Invitation not found or has expired"),o(!1);return}localStorage.setItem("pendingInvitationToken",l),P({email:n.email,role:n.role}),y(n.email),o(!1)}catch(n){clearTimeout(i),console.error("Error checking invitation:",n),t("Failed to verify invitation. Please try again."),o(!1)}})()},[l]);const q=async()=>{if(l)try{await H()}catch(r){console.error("Error initiating sign up:",r),t("Failed to start sign up process")}},T=async r=>{if(r.preventDefault(),!!l){if(!c.trim()){t("Email is required");return}if(!a){t("Password is required");return}if(a.length<6){t("Password must be at least 6 characters");return}if(a!==p){t("Passwords do not match");return}try{j(!0),t(null),await z(c.trim(),a);const{data:{session:i}}=await B.auth.getSession();i?h("/auth/callback"):F(!0)}catch(i){console.error("Error signing up:",i),t(i.message||"Failed to create account")}finally{j(!1)}}};return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verifying invitation..."})]})}):d?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx(v,{className:"h-6 w-6 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"Invalid Invitation"}),e.jsx("p",{className:"text-gray-600 text-center mb-6",children:d}),e.jsx("button",{onClick:()=>h("/"),className:"w-full bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700",children:"Go to Home"})]})}):U?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-blue-100 rounded-full mb-4",children:e.jsx(N,{className:"h-6 w-6 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"Check Your Email"}),e.jsxs("p",{className:"text-gray-600 text-center mb-6",children:["We've sent a verification email to ",e.jsx("span",{className:"font-medium",children:c}),". Please click the link in the email to verify your account and complete your invitation acceptance."]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mb-4",children:"The invitation link will be processed automatically after you verify your email."}),e.jsx("button",{onClick:()=>h("/"),className:"w-full bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700",children:"Go to Home"})]})}):x?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-primary-100 rounded-full mb-4",children:e.jsx(N,{className:"h-6 w-6 text-primary-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"You've Been Invited!"}),e.jsxs("p",{className:"text-gray-600 text-center mb-6",children:[e.jsx("span",{className:"font-medium",children:x.email})," has been invited to join the team as"," ",e.jsx("span",{className:"font-medium",children:x.role===w.ADMIN?"an Admin":"a User"})]}),e.jsx("div",{className:"flex items-center justify-center mb-6",children:x.role===w.ADMIN?e.jsx(L,{className:"h-5 w-5 text-blue-500"}):e.jsx(R,{className:"h-5 w-5 text-gray-500"})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{b("google"),t(null)},className:`flex-1 py-2 px-4 text-sm font-medium text-center border-b-2 transition-colors ${u==="google"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Google"}),e.jsx("button",{onClick:()=>{b("email"),t(null)},className:`flex-1 py-2 px-4 text-sm font-medium text-center border-b-2 transition-colors ${u==="email"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Email & Password"})]})}),d&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-4 w-4 text-red-600 mr-2"}),e.jsx("p",{className:"text-sm text-red-600",children:d})]})}),u==="google"&&e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:q,className:"w-full bg-primary-600 text-white py-3 px-4 rounded-md hover:bg-primary-700 font-medium flex items-center justify-center space-x-2",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{children:"Sign up with Google"})]})}),u==="email"&&e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",value:c,onChange:r=>y(r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 border",placeholder:"user@example.com",required:!0,disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:g?"text":"password",value:a,onChange:r=>E(r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 border pr-10",placeholder:"Enter password",required:!0,disabled:m,minLength:6}),e.jsx("button",{type:"button",onClick:()=>M(!g),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:g?e.jsx(k,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Must be at least 6 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"confirmPassword",type:f?"text":"password",value:p,onChange:r=>I(r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 border pr-10",placeholder:"Confirm password",required:!0,disabled:m,minLength:6}),e.jsx("button",{type:"button",onClick:()=>A(!f),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:f?e.jsx(k,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]})]}),e.jsx("button",{type:"submit",disabled:m||!c.trim()||!a||a!==p,className:"w-full bg-primary-600 text-white py-3 px-4 rounded-md hover:bg-primary-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Creating Account...":"Create Account"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"By signing up, you'll be automatically added to the team with the assigned role."})]})}):null}export{K as default};
//# sourceMappingURL=InviteAccept.js.map
