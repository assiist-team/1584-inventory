import{a as A,j as e}from"./index.js";import{r as c}from"./vendor.js";import{I as E}from"./imageService.js";import{I as z}from"./ImagePreview.js";import{b as T,n as U}from"./ui.js";function B({item:r,onSave:F,onCancel:f,isEditing:y=!1,onImageFilesChange:b}){const v=c.useMemo(()=>(r==null?void 0:r.id)||`temp_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,[r==null?void 0:r.id]),[n,j]=c.useState(r||{id:v,description:"",sku:"",price:"",market_value:"",space:"",notes:""}),[p,g]=c.useState((r==null?void 0:r.images)||[]),[m,h]=c.useState((r==null?void 0:r.imageFiles)||[]),[N,k]=c.useState(!1),[a,w]=c.useState({}),{showError:_}=A();c.useEffect(()=>{var s,o;r&&(console.log("TransactionItemForm: Editing item with images:",((s=r.images)==null?void 0:s.length)||0,"imageFiles:",((o=r.imageFiles)==null?void 0:o.length)||0),g(r.images||[]),h(r.imageFiles||[]),j({id:r.id,description:r.description,sku:r.sku||"",price:r.price,market_value:r.market_value||"",space:r.space||"",notes:r.notes||""}))},[r]);const $=async()=>{var s,o;try{k(!0);const t=await E.selectFromGallery();if(t&&t.length>0){console.log("Selected",t.length,"files from gallery");const x=new Set(m.map(i=>`${i.name}_${i.size}`)),u=t.filter(i=>!x.has(`${i.name}_${i.size}`));if(u.length>0){h(l=>[...l,...u]);const i=u.map((l,I)=>({url:`preview_${l.name}_${l.size}_${Date.now()}_${I}`,alt:l.name,isPrimary:p.length===0&&I===0,uploadedAt:new Date,fileName:l.name,size:l.size,mimeType:l.type}));g(l=>[...l,...i]),console.log("Added",i.length,"new preview images")}else console.log("All selected files are already present")}else console.log("No files selected from gallery")}catch(t){if(console.error("Error selecting from gallery:",t),(s=t.message)!=null&&s.includes("timeout")||(o=t.message)!=null&&o.includes("canceled")){console.log("User canceled image selection or selection timed out");return}_("Failed to select images from gallery. Please try again.")}finally{k(!1)}},S=s=>{const o=p.findIndex(t=>t.url===s);o!==-1&&o<m.length&&(g(t=>t.filter(x=>x.url!==s)),h(t=>t.filter((x,u)=>u!==o)))},C=s=>{g(o=>o.map(t=>({...t,isPrimary:t.url===s})))},P=()=>{const s={};return n.description.trim()||(s.description="Description is required"),n.price&&(isNaN(Number(n.price))||Number(n.price)<=0)&&(s.price="Price must be a positive number"),w(s),Object.keys(s).length===0},D=()=>{if(!P())return;const s={...n,images:p,imageFiles:m};b&&m.length>0&&b(v,m),F(s)},d=(s,o)=>{j(t=>({...t,[s]:o})),a[s]&&w(t=>({...t,[s]:void 0}))};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:y?"Edit Item":"Add Item"}),e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-600",type:"button",children:e.jsx(T,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Images"}),e.jsxs("button",{type:"button",onClick:$,disabled:N,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 mb-3",title:"Add images from gallery or camera",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),N?"Uploading...":"Add Images"]}),e.jsx(z,{images:p,onRemoveImage:S,onSetPrimary:C,maxImages:3,size:"md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:n.description,onChange:s=>d("description",s.target.value),placeholder:"Item description",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.description?"border-red-300":"border-gray-300"}`}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:n.sku,onChange:s=>d("sku",s.target.value),placeholder:"Stock keeping unit",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.sku?"border-red-300":"border-gray-300"}`}),a.sku&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.sku})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"price",value:n.price,onChange:s=>d("price",s.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.price?"border-red-300":"border-gray-300"}`})]}),a.price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"market_value",value:n.market_value,onChange:s=>d("market_value",s.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.market_value?"border-red-300":"border-gray-300"}`})]}),a.market_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.market_value})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"space",className:"block text-sm font-medium text-gray-700",children:"Space"}),e.jsx("input",{type:"text",id:"space",value:n.space,onChange:s=>d("space",s.target.value),placeholder:"e.g., Living Room, Master Bedroom, Kitchen",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:2,value:n.notes,onChange:s=>d("notes",s.target.value),placeholder:"Additional notes about this item",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.notes?"border-red-300":"border-gray-300"}`}),a.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.notes})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),f()},className:"px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Cancel"}),e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),D()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:y?"Update Item":"Add Item"})]})]})]})}export{B as T};
//# sourceMappingURL=TransactionItemForm.js.map
