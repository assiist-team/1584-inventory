import{a as A,j as e}from"./index.js";import{r as d}from"./vendor.js";import{I as E}from"./imageService.js";import{I as z}from"./ImagePreview.js";import{b as T,m as U}from"./ui.js";function B({item:s,onSave:I,onCancel:b,isEditing:f=!1,onImageFilesChange:y}){const j=d.useMemo(()=>(s==null?void 0:s.id)||`temp_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,[s==null?void 0:s.id]),[i,v]=d.useState(s||{id:j,description:"",sku:"",purchase_price:"",project_price:"",market_value:"",space:"",notes:""}),[u,g]=d.useState((s==null?void 0:s.images)||[]),[m,x]=d.useState((s==null?void 0:s.imageFiles)||[]),[N,_]=d.useState(!1),[a,k]=d.useState({}),{showError:F}=A();d.useEffect(()=>{var r,o;s&&(console.log("TransactionItemForm: Editing item with images:",((r=s.images)==null?void 0:r.length)||0,"imageFiles:",((o=s.imageFiles)==null?void 0:o.length)||0),g(s.images||[]),x(s.imageFiles||[]),v({id:s.id,description:s.description,sku:s.sku||"",purchase_price:s.purchase_price||"",project_price:s.project_price||"",market_value:s.market_value||"",space:s.space||"",notes:s.notes||""}))},[s]);const $=async()=>{var r,o;try{_(!0);const t=await E.selectFromGallery();if(t&&t.length>0){console.log("Selected",t.length,"files from gallery");const h=new Set(m.map(l=>`${l.name}_${l.size}`)),p=t.filter(l=>!h.has(`${l.name}_${l.size}`));if(p.length>0){x(n=>[...n,...p]);const l=p.map((n,w)=>({url:`preview_${n.name}_${n.size}_${Date.now()}_${w}`,alt:n.name,isPrimary:u.length===0&&w===0,uploadedAt:new Date,fileName:n.name,size:n.size,mimeType:n.type}));g(n=>[...n,...l]),console.log("Added",l.length,"new preview images")}else console.log("All selected files are already present")}else console.log("No files selected from gallery")}catch(t){if(console.error("Error selecting from gallery:",t),(r=t.message)!=null&&r.includes("timeout")||(o=t.message)!=null&&o.includes("canceled")){console.log("User canceled image selection or selection timed out");return}F("Failed to select images from gallery. Please try again.")}finally{_(!1)}},S=r=>{const o=u.findIndex(t=>t.url===r);o!==-1&&o<m.length&&(g(t=>t.filter(h=>h.url!==r)),x(t=>t.filter((h,p)=>p!==o)))},P=r=>{g(o=>o.map(t=>({...t,isPrimary:t.url===r})))},C=()=>{const r={};return i.description.trim()||(r.description="Description is required"),i.purchase_price&&(isNaN(Number(i.purchase_price))||Number(i.purchase_price)<=0)&&(r.purchase_price="Purchase price must be a positive number"),i.project_price&&(isNaN(Number(i.project_price))||Number(i.project_price)<=0)&&(r.project_price="Project price must be a positive number"),k(r),Object.keys(r).length===0},D=()=>{if(!C())return;const r={...i,images:u,imageFiles:m};y&&m.length>0&&y(j,m),I(r)},c=(r,o)=>{(r==="purchase_price"||r==="project_price")&&o!==""&&(isNaN(Number(o))||Number(o)<0)||(v(t=>({...t,[r]:o})),a[r]&&k(t=>({...t,[r]:void 0})))};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:f?"Edit Item":"Add Item"}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600",type:"button",children:e.jsx(T,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Images"}),e.jsxs("button",{type:"button",onClick:$,disabled:N,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 mb-3",title:"Add images from gallery or camera",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),N?"Uploading...":"Add Images"]}),e.jsx(z,{images:u,onRemoveImage:S,onSetPrimary:P,maxImages:3,size:"md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:i.description,onChange:r=>c("description",r.target.value),placeholder:"Item description",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.description?"border-red-300":"border-gray-300"}`}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:i.sku,onChange:r=>c("sku",r.target.value),placeholder:"Stock keeping unit",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.sku?"border-red-300":"border-gray-300"}`}),a.sku&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.sku})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purchase_price",className:"block text-sm font-medium text-gray-700",children:"Purchase Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"purchase_price",value:i.purchase_price||"",onChange:r=>c("purchase_price",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.purchase_price?"border-red-300":"border-gray-300"}`})]}),a.purchase_price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.purchase_price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project_price",className:"block text-sm font-medium text-gray-700",children:"Project Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"project_price",value:i.project_price||"",onChange:r=>c("project_price",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.project_price?"border-red-300":"border-gray-300"}`})]}),a.project_price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.project_price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"market_value",value:i.market_value,onChange:r=>c("market_value",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.market_value?"border-red-300":"border-gray-300"}`})]}),a.market_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.market_value})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"space",className:"block text-sm font-medium text-gray-700",children:"Space"}),e.jsx("input",{type:"text",id:"space",value:i.space,onChange:r=>c("space",r.target.value),placeholder:"e.g., Living Room, Master Bedroom, Kitchen",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:2,value:i.notes,onChange:r=>c("notes",r.target.value),placeholder:"Additional notes about this item",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.notes?"border-red-300":"border-gray-300"}`}),a.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.notes})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),b()},className:"px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Cancel"}),e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),D()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:f?"Update Item":"Add Item"})]})]})]})}export{B as T};
//# sourceMappingURL=TransactionItemForm.js.map
