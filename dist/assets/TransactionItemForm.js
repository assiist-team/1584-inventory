import{a as A,j as e}from"./index.js";import{r as d}from"./vendor.js";import{I as E}from"./imageService.js";import{I as z}from"./ImagePreview.js";import{b as R,l as T}from"./ui.js";function B({item:s,onSave:I,onCancel:b,isEditing:f=!1,onImageFilesChange:y}){const v=d.useMemo(()=>(s==null?void 0:s.id)||`temp_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,[s==null?void 0:s.id]),[l,N]=d.useState(s||{id:v,description:"",sku:"",purchase_price:"",resale_price:"",market_value:"",space:"",notes:""}),[u,g]=d.useState((s==null?void 0:s.images)||[]),[m,x]=d.useState((s==null?void 0:s.imageFiles)||[]),[j,_]=d.useState(!1),[t,k]=d.useState({}),{showError:F}=A();d.useEffect(()=>{var r,o;s&&(console.log("TransactionItemForm: Editing item with images:",((r=s.images)==null?void 0:r.length)||0,"imageFiles:",((o=s.imageFiles)==null?void 0:o.length)||0),g(s.images||[]),x(s.imageFiles||[]),N({id:s.id,description:s.description,sku:s.sku||"",purchase_price:s.purchase_price||"",resale_price:s.resale_price||"",market_value:s.market_value||"",space:s.space||"",notes:s.notes||""}))},[s]);const $=async()=>{var r,o;try{_(!0);const a=await E.selectFromGallery();if(a&&a.length>0){console.log("Selected",a.length,"files from gallery");const h=new Set(m.map(n=>`${n.name}_${n.size}`)),p=a.filter(n=>!h.has(`${n.name}_${n.size}`));if(p.length>0){x(i=>[...i,...p]);const n=p.map((i,w)=>({url:`preview_${i.name}_${i.size}_${Date.now()}_${w}`,alt:i.name,isPrimary:u.length===0&&w===0,uploadedAt:new Date,fileName:i.name,size:i.size,mimeType:i.type}));g(i=>[...i,...n]),console.log("Added",n.length,"new preview images")}else console.log("All selected files are already present")}else console.log("No files selected from gallery")}catch(a){if(console.error("Error selecting from gallery:",a),(r=a.message)!=null&&r.includes("timeout")||(o=a.message)!=null&&o.includes("canceled")){console.log("User canceled image selection or selection timed out");return}F("Failed to select images from gallery. Please try again.")}finally{_(!1)}},S=r=>{const o=u.findIndex(a=>a.url===r);o!==-1&&o<m.length&&(g(a=>a.filter(h=>h.url!==r)),x(a=>a.filter((h,p)=>p!==o)))},P=r=>{g(o=>o.map(a=>({...a,isPrimary:a.url===r})))},C=()=>{const r={};return l.description.trim()||(r.description="Description is required"),l.purchase_price&&(isNaN(Number(l.purchase_price))||Number(l.purchase_price)<=0)&&(r.purchase_price="Purchase price must be a positive number"),l.resale_price&&(isNaN(Number(l.resale_price))||Number(l.resale_price)<=0)&&(r.resale_price="Resale price must be a positive number"),k(r),Object.keys(r).length===0},D=()=>{if(!C())return;const r={...l,images:u,imageFiles:m};y&&m.length>0&&y(v,m),I(r)},c=(r,o)=>{(r==="purchase_price"||r==="resale_price")&&o!==""&&(isNaN(Number(o))||Number(o)<0)||(N(a=>({...a,[r]:o})),t[r]&&k(a=>({...a,[r]:void 0})))};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:f?"Edit Item":"Add Item"}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600",type:"button",children:e.jsx(R,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Images"}),e.jsxs("button",{type:"button",onClick:$,disabled:j,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 mb-3",title:"Add images from gallery or camera",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),j?"Uploading...":"Add Images"]}),e.jsx(z,{images:u,onRemoveImage:S,onSetPrimary:P,maxImages:3,size:"md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:l.description,onChange:r=>c("description",r.target.value),placeholder:"Item description",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.description?"border-red-300":"border-gray-300"}`}),t.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:l.sku,onChange:r=>c("sku",r.target.value),placeholder:"Stock keeping unit",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.sku?"border-red-300":"border-gray-300"}`}),t.sku&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.sku})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purchase_price",className:"block text-sm font-medium text-gray-700",children:"Purchase Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"purchase_price",value:l.purchase_price||"",onChange:r=>c("purchase_price",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.purchase_price?"border-red-300":"border-gray-300"}`})]}),t.purchase_price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.purchase_price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resale_price",className:"block text-sm font-medium text-gray-700",children:"Resale Price (1584 Design Price)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"resale_price",value:l.resale_price||"",onChange:r=>c("resale_price",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.resale_price?"border-red-300":"border-gray-300"}`})]}),t.resale_price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.resale_price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"market_value",value:l.market_value,onChange:r=>c("market_value",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.market_value?"border-red-300":"border-gray-300"}`})]}),t.market_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.market_value})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"space",className:"block text-sm font-medium text-gray-700",children:"Space"}),e.jsx("input",{type:"text",id:"space",value:l.space,onChange:r=>c("space",r.target.value),placeholder:"e.g., Living Room, Master Bedroom, Kitchen",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:2,value:l.notes,onChange:r=>c("notes",r.target.value),placeholder:"Additional notes about this item",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.notes?"border-red-300":"border-gray-300"}`}),t.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.notes})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),b()},className:"px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Cancel"}),e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),D()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:f?"Update Item":"Add Item"})]})]})]})}export{B as T};
//# sourceMappingURL=TransactionItemForm.js.map
