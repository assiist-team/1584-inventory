import{d as B,u as q,j as e,f as g,C as b}from"./index.js";import{r as n}from"./vendor.js";import{C as E}from"./ContextBackLink.js";import{u as M}from"./useStackedNavigate.js";import{p as V,t as Y}from"./inventoryService.js";import{a as U}from"./taxPresetsService.js";import{g as W}from"./vendorDefaultsService.js";import{C as X}from"./CategorySelect.js";import{u as z}from"./router.js";import{g as G,b as H,t as J}from"./ui.js";import"./supabase.js";function ie(){const I=M(),f=z(),{currentAccountId:i}=B(),{user:u}=q(),[j,x]=n.useState(!1),[N,P]=n.useState([]),[s,v]=n.useState({projectId:"",transactionDate:(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`})(),source:"",transactionType:"Purchase",paymentMethod:"",amount:"",categoryId:"",notes:"",status:"pending",reimbursementType:"",triggerEvent:"Manual",receiptEmailed:!1}),[a,m]=n.useState({}),[w,p]=n.useState(!1),[h,k]=n.useState([]),[c,T]=n.useState(void 0),[d,F]=n.useState(""),[y,D]=n.useState([]),[_,C]=n.useState(void 0);n.useEffect(()=>{s.source&&!h.includes(s.source)?p(!0):s.source&&h.includes(s.source)&&p(!1)},[s.source,h]),n.useEffect(()=>{(async()=>{if(i)try{const r=await W(i);k(r)}catch(r){console.error("Error loading vendor defaults:",r),k([])}})()},[i]);const S=n.useMemo(()=>{const r=new URLSearchParams(f.search).get("returnTo");return r||"/business-inventory"},[f.search]);n.useEffect(()=>{(async()=>{if(i)try{const r=await V.getProjects(i);P(r)}catch(r){console.error("Error loading projects:",r)}})()},[i]),n.useEffect(()=>{(async()=>{if(i)try{const r=await U(i);D(r)}catch(r){console.error("Error loading tax presets:",r)}})()},[i]),n.useEffect(()=>{if(c&&c!=="Other"){const t=y.find(r=>r.id===c);C(t==null?void 0:t.rate)}else C(void 0);a.general&&m(t=>({...t,general:""}))},[c,y]),n.useEffect(()=>{a.general&&m(t=>({...t,general:""}))},[d]);const o=(t,r)=>{v(l=>({...l,[t]:r})),a[t]&&m(l=>({...l,[t]:""})),a.general&&m(l=>({...l,general:""}))},R=()=>{var r;const t={};return s.source.trim()||(t.source="Source is required"),(r=s.categoryId)!=null&&r.trim()||(t.categoryId="Budget category is required"),s.amount.trim()?(isNaN(Number(s.amount))||Number(s.amount)<=0)&&(t.amount="Amount must be a positive number"):t.amount="Amount is required",c==="Other"&&(!d.trim()||isNaN(Number(d))||Number(d)<=0?t.general="Subtotal must be provided and greater than 0 when Tax Rate Preset is Other.":Number(s.amount)<Number(d)&&(t.general="Subtotal cannot exceed the total amount.")),m(t),Object.keys(t).length===0},A=async t=>{var r;if(t.preventDefault(),!!R()){x(!0);try{const l=s.projectId==="business-inventory"?null:s.projectId,O=s.projectId==="business-inventory"?null:((r=N.find(L=>L.id===s.projectId))==null?void 0:r.name)||"";if(!(u!=null&&u.id)){m({general:"User must be authenticated to create transactions"}),x(!1);return}if(!i){m({general:"Account ID is required"}),x(!1);return}const $={...s,projectId:l,projectName:O,createdBy:u.id,taxRatePreset:c,subtotal:c==="Other"?d:""};await Y.createTransaction(i,l,$,[]),I("/business-inventory")}catch(l){console.error("Error creating transaction:",l),m({general:"Error creating transaction. Please try again."})}finally{x(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(E,{fallback:S,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Add Transaction"})}),e.jsxs("form",{onSubmit:A,className:"space-y-8 p-8",children:[a.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:a.general})})]})})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"projectId",className:"block text-sm font-medium text-gray-700",children:"Project"}),e.jsxs("select",{id:"projectId",value:s.projectId,onChange:t=>o("projectId",t.target.value),className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.projectId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select a project..."}),e.jsx("option",{value:"business-inventory",children:"Business Inventory (No Project)"}),N.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.clientName]},t.id))]}),a.projectId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.projectId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Source *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:h.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:t,checked:s.source===t,onChange:r=>{o("source",r.target.value),p(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:w,onChange:()=>{p(!0),o("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),w&&e.jsx("input",{type:"text",id:"source_custom_input",value:s.source,onChange:t=>o("source",t.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.source?"border-red-300":"border-gray-300"}`}),a.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.source})]}),e.jsx("div",{children:e.jsx(X,{value:s.categoryId,onChange:t=>{v(r=>({...r,categoryId:t})),a.categoryId&&m(r=>({...r,categoryId:void 0}))},label:"Budget Category",error:a.categoryId,required:!0})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Type"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_purchase",name:"transactionType",value:"Purchase",checked:s.transactionType==="Purchase",onChange:t=>o("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_purchase",className:"ml-2 block text-sm text-gray-900",children:"Purchase"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_return",name:"transactionType",value:"Return",checked:s.transactionType==="Return",onChange:t=>o("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_return",className:"ml-2 block text-sm text-gray-900",children:"Return"})]})]}),a.transactionType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.transactionType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Reimbursement Type"}),e.jsx("p",{className:"mb-3 text-xs text-gray-500",children:"Flags transactions that require reimbursement"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_none",name:"reimbursementType",value:"",checked:!s.reimbursementType,onChange:t=>o("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_none",className:"ml-2 block text-sm text-gray-900",children:"None"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_client_owes",name:"reimbursementType",value:g,checked:s.reimbursementType===g,onChange:t=>o("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_client_owes",className:"ml-2 block text-sm text-gray-900",children:g})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_we_owe",name:"reimbursementType",value:b,checked:s.reimbursementType===b,onChange:t=>o("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_we_owe",className:"ml-2 block text-sm text-gray-900",children:b})]})]}),a.reimbursementType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.reimbursementType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Receipt Email Copy"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_yes",name:"receiptEmailed",checked:s.receiptEmailed===!0,onChange:()=>o("receiptEmailed",!0),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_yes",className:"ml-2 block text-sm text-gray-900",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_no",name:"receiptEmailed",checked:s.receiptEmailed===!1,onChange:()=>o("receiptEmailed",!1),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_no",className:"ml-2 block text-sm text-gray-900",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"amount",value:s.amount,onChange:t=>o("amount",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.amount?"border-red-300":"border-gray-300"}`})]}),a.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tax Rate Preset"}),e.jsxs("div",{className:"space-y-2",children:[y.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`tax_preset_${t.id}`,name:"taxRatePreset",value:t.id,checked:c===t.id,onChange:r=>T(r.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsxs("label",{htmlFor:`tax_preset_${t.id}`,className:"ml-2 block text-sm text-gray-900",children:[t.name," (",t.rate.toFixed(2),"%)"]})]},t.id)),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"tax_preset_other",name:"taxRatePreset",value:"Other",checked:c==="Other",onChange:t=>T(t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"tax_preset_other",className:"ml-2 block text-sm text-gray-900",children:"Other"})]})]}),c&&c!=="Other"&&_!==void 0&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Tax Rate:"})," ",_.toFixed(2),"%"]})})]}),c==="Other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subtotal"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"subtotal",value:d,onChange:t=>F(t.target.value),placeholder:"0.00",className:"block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 border-gray-300"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This will be used to calculate the tax rate."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transactionDate",className:"block text-sm font-medium text-gray-700",children:"Transaction Date"}),e.jsx("input",{type:"date",id:"transactionDate",value:s.transactionDate,onChange:t=>o("transactionDate",t.target.value),className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.transactionDate?"border-red-300":"border-gray-300"}`}),a.transactionDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.transactionDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:s.notes,onChange:t=>o("notes",t.target.value),placeholder:"Additional notes about this transaction...",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.notes?"border-red-300":"border-gray-300"}`}),a.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.notes})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsxs(E,{fallback:S,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:j,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),j?"Creating...":"Create Transaction"]})]})]})]})]})}export{ie as default};
//# sourceMappingURL=AddBusinessInventoryTransaction.js.map
