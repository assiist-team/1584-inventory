import{j as e}from"./index.js";import{r as n}from"./vendor.js";import{L as f}from"./router.js";import{b as k,p as X,t as Y}from"./inventoryService.js";import{I as A}from"./imageService.js";import{a as Z,f as ee}from"./dateUtils.js";import{u as se}from"./useBookmark.js";import{P as te,x as re,d as F,m as P,n as z,Q as ae,l as ne,B as ie,f as le,o as oe,E as ce}from"./ui.js";import"./firebase.js";function be(){const[y,M]=n.useState("inventory"),[S,b]=n.useState([]),[I,T]=n.useState([]),[O,$]=n.useState(!0),[d]=n.useState({status:"",searchQuery:""}),[m,Q]=n.useState(""),[h,D]=n.useState(""),[j,g]=n.useState(!1),[o,v]=n.useState("all"),[R,C]=n.useState(new Set),[u,L]=n.useState("all"),[N,w]=n.useState(!1),[x,_]=n.useState(new Set);n.useEffect(()=>{const s=t=>{if((N||j)&&!t.target)return;const r=t.target;!r.closest(".filter-menu")&&!r.closest(".filter-button")&&!r.closest(".transaction-filter-menu")&&!r.closest(".transaction-filter-button")&&(w(!1),g(!1))};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[N,j]);const p=n.useMemo(()=>S.filter(s=>{var i,l,c;const t=!m||((i=s.description)==null?void 0:i.toLowerCase().includes(m.toLowerCase()))||((l=s.sku)==null?void 0:l.toLowerCase().includes(m.toLowerCase()))||((c=s.business_inventory_location)==null?void 0:c.toLowerCase().includes(m.toLowerCase())),r=!d.status||s.inventory_status===d.status,a=u==="all"||u==="bookmarked"&&s.bookmark;return t&&r&&a}),[S,m,d.status,u]),E=n.useMemo(()=>{let s=I;if(o!=="all"&&(s=s.filter(t=>t.status===o)),h){const t=h.toLowerCase();s=s.filter(r=>{var a,i,l,c;return((a=r.source)==null?void 0:a.toLowerCase().includes(t))||((i=r.transaction_type)==null?void 0:i.toLowerCase().includes(t))||((l=r.project_name)==null?void 0:l.toLowerCase().includes(t))||((c=r.notes)==null?void 0:c.toLowerCase().includes(t))})}return s},[I,o,h]),U=[{id:"inventory",name:"Inventory",icon:te},{id:"transactions",name:"Transactions",icon:re}];n.useEffect(()=>{q(),B()},[]),n.useEffect(()=>k.subscribeToBusinessInventory(t=>{b(t),$(!1)},d),[d]),n.useEffect(()=>{if(y!=="transactions")return;(async()=>{await B()})()},[y]),n.useEffect(()=>()=>{C(new Set)},[]);const q=async()=>{try{const s=await k.getBusinessInventoryItems(d);b(s)}catch(s){console.error("Error loading business inventory:",s),b([])}finally{$(!1)}},B=async()=>{try{const s=await X.getProjects(),t=[];for(const r of s)try{const i=(await Y.getTransactions(r.id)).filter(l=>{var c;return l.reimbursement_type||l.trigger_event==="Inventory allocation"||l.trigger_event==="Inventory return"||l.trigger_event==="Purchase from client"||((c=l.source)==null?void 0:c.toLowerCase().includes("inventory"))});t.push(...i)}catch(a){console.error(`Error loading transactions for project ${r.id}:`,a)}t.sort((r,a)=>new Date(a.created_at).getTime()-new Date(r.created_at).getTime()),T(t)}catch(s){console.error("Error loading business transactions:",s),T([])}},G=s=>{Q(s)},{toggleBookmark:K}=se({items:S,setItems:b,updateItemService:k.updateBusinessInventoryItem}),V=async s=>{var t,r;try{C(i=>new Set(i).add(s));const a=await A.selectFromGallery();if(a.length>0)for(let i=0;i<a.length;i++){const l=a[i];await W(s,l,a)}}catch(a){if(console.error("Error adding image:",a),(t=a.message)!=null&&t.includes("timeout")||(r=a.message)!=null&&r.includes("canceled")){console.log("User canceled image selection or selection timed out");return}alert("Failed to add image. Please try again.")}finally{C(a=>{const i=new Set(a);return i.delete(s),i})}},W=async(s,t,r)=>{const i={url:(await A.uploadItemImage(t,"Business Inventory",s)).url,alt:t.name,isPrimary:!0,uploadedAt:new Date,fileName:t.name,size:t.size,mimeType:t.type};if(await k.updateBusinessInventoryItem(s,{images:[i]}),r&&r.indexOf(t)===r.length-1){const l=r.length>1?`${r.length} images uploaded successfully!`:"Image uploaded successfully!";alert(l)}},H=s=>{_(s?new Set(p.map(t=>t.item_id)):new Set)},J=(s,t)=>{const r=new Set(x);t?r.add(s):r.delete(s),_(r)};return O?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:U.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>M(s.id),className:`py-4 px-1 border-b-2 font-medium text-base flex items-center ${y===s.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(t,{className:"h-4 w-4 mr-2"}),s.name]},s.id)})})}),e.jsxs("div",{className:"px-6 py-6",children:[y==="inventory"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-2",children:e.jsxs(f,{to:"/business-inventory/add",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search items by description, SKU, or location...",value:m||"",onChange:s=>G(s.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 rounded-lg",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4",onChange:s=>H(s.target.checked),checked:x.size===p.length&&p.length>0}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"Select all"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x.size>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[x.size," of ",p.length," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>w(!N),className:`filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${u==="all"?"border-gray-300 text-gray-700 bg-white hover:bg-gray-50":"border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100"}`,title:"Filter items",children:e.jsx(z,{className:"h-4 w-4"})}),N&&e.jsx("div",{className:"filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{L("all"),w(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${u==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Items"}),e.jsx("button",{onClick:()=>{L("bookmarked"),w(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${u==="bookmarked"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Bookmarked Only"})]})})]}),e.jsx("button",{className:"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 transition-colors duration-200",disabled:x.size===0,title:"Generate QR Codes",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx("button",{className:"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",disabled:x.size===0,title:"Delete All",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})]})]})}),p.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ“¦"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No items found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:m||d.status||u==="bookmarked"?"Try adjusting your search or filter criteria.":"No items found."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:p.map(s=>e.jsxs("li",{className:"relative bg-gray-50 transition-colors duration-200 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0 px-4 py-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4 flex-shrink-0",checked:x.has(s.item_id),onChange:t=>J(s.item_id,t.target.checked)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md transition-colors ${s.bookmark?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`,title:s.bookmark?"Remove Bookmark":"Add Bookmark",onClick:t=>{t.preventDefault(),t.stopPropagation(),K(s.item_id)},children:e.jsx(ie,{className:"h-4 w-4",fill:s.bookmark?"currentColor":"none"})}),e.jsx(f,{to:`/business-inventory/${s.item_id}/edit`,onClick:t=>t.stopPropagation(),className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"Edit item",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${s.inventory_status==="available"?"bg-green-100 text-green-800":s.inventory_status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.inventory_status==="available"?"Available":s.inventory_status==="pending"?"Allocated":"Sold"})]})]}),e.jsx(f,{to:`/business-inventory/${s.item_id}`,children:e.jsx("div",{className:"block bg-transparent",children:e.jsxs("div",{className:"px-4 pb-3 sm:px-6",children:[e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[e.jsx("div",{className:"flex-shrink-0",children:s.images&&s.images.length>0?(()=>{const t=s.images.find(r=>r.isPrimary)||s.images[0];return e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:t.url,alt:t.alt||"Item image",className:"w-full h-full object-cover"})})})():e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),V(s.item_id)},disabled:R.has(s.item_id),className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors disabled:opacity-50",title:"Add image (camera or gallery)",children:e.jsx(oe,{className:"h-6 w-6"})})}),e.jsx("div",{className:"flex-1 min-w-0 flex items-center",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900 line-clamp-2 break-words",children:s.description}),s.business_inventory_location&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.business_inventory_location})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500",children:[s.price&&e.jsxs("span",{className:"font-medium text-gray-700",children:["$",s.price]}),s.source&&e.jsxs(e.Fragment,{children:[s.price&&e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:s.source})]}),s.sku&&e.jsxs(e.Fragment,{children:[(s.price||s.source)&&e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:s.sku})]})]}),s.current_project_id&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Allocated to Project:"})," ",s.current_project_id]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.notes})]})]})})})]},s.item_id))})})]}),y==="transactions"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2",children:e.jsxs(f,{to:"/business-inventory/transactions/add",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search transactions by source, type, project, or notes...",value:h||"",onChange:s=>D(s.target.value)})]}),e.jsx("div",{className:"flex items-center justify-end gap-4 p-3 rounded-lg",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>g(!j),className:`transaction-filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${o==="all"?"border-gray-300 text-gray-700 bg-white hover:bg-gray-50":"border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100"}`,title:"Filter transactions",children:e.jsx(z,{className:"h-4 w-4"})}),j&&e.jsx("div",{className:"transaction-filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{v("all"),g(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${o==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Status"}),e.jsx("button",{onClick:()=>{v("pending"),g(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${o==="pending"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Pending"}),e.jsx("button",{onClick:()=>{v("completed"),g(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${o==="completed"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Completed"}),e.jsx("button",{onClick:()=>{v("cancelled"),g(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${o==="cancelled"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Cancelled"})]})})]})})]})}),E.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ§¾"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No transactions found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:h||o!=="all"?"Try adjusting your search or filter criteria.":"No inventory-related transactions found."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:E.map(s=>e.jsx("li",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:s.source}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.status})})]}),e.jsxs("div",{className:"flex items-center gap-x-4 gap-y-1 text-sm text-gray-500 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:Z(s.amount)}),e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:s.transaction_type}),s.project_name&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:s.project_name})]}),e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:ee(s.transaction_date)})]}),s.notes&&e.jsx("p",{className:"mt-1 text-sm text-gray-600 line-clamp-2",children:s.notes}),s.reimbursement_type&&s.reimbursement_type!==""&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${s.reimbursement_type==="Client Owes"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.reimbursement_type==="Client Owes"?"Client Owes":"We Owe"})})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsx(f,{to:`/transactions/${s.transaction_id}`,className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"View transaction details",children:e.jsx(ce,{className:"h-4 w-4"})})})]})},s.transaction_id))})})]})]})]})})}export{be as default};
//# sourceMappingURL=BusinessInventory.js.map
