import{d as Me,e as Fe,j as e,t as ze,h as Re,i as Oe}from"./index.js";import{r as l}from"./vendor.js";import{L as Ue}from"./router.js";import{C as T}from"./ContextLink.js";import{l as qe,u as d,t as A,f as _e,a as Qe,i as Ye,p as Ve}from"./inventoryService.js";import{d as Ge,a as He,n as We}from"./dispositionUtils.js";import{I as ne}from"./imageService.js";import{u as Ke}from"./useBookmark.js";import{u as Je}from"./useDuplication.js";import{u as Xe}from"./useNavigationContext.js";import{P as oe,r as Ze,f as ie,m as le,n as ce,D as et,T as tt,B as st,h as rt,i as at,j as nt,o as ot}from"./ui.js";import"./supabase.js";import"./taxPresetsService.js";function jt(){const{currentAccountId:o,loading:de}=Me(),me=!1,{buildContextUrl:v}=Xe(),[R,ue]=l.useState("inventory"),[p,m]=l.useState([]),[Y,w]=l.useState([]),[V,P]=l.useState(!0),[g]=l.useState({status:"",searchQuery:""}),[y,xe]=l.useState(""),[N,pe]=l.useState(""),[E,f]=l.useState(!1),[u,I]=l.useState("all"),[ge,O]=l.useState(new Set),[j,G]=l.useState("all"),[D,$]=l.useState(!1),[c,k]=l.useState(new Set),[B,L]=l.useState(null),{showSuccess:H,showError:M}=Fe(),[W,K]=l.useState([]),[he,J]=l.useState(!1),[X,U]=l.useState(!1),[h,q]=l.useState({projectId:"",space:""}),[Z,ee]=l.useState(!1);l.useEffect(()=>{const t=s=>{if((D||E)&&!s.target)return;const r=s.target;!r.closest(".filter-menu")&&!r.closest(".filter-button")&&!r.closest(".transaction-filter-menu")&&!r.closest(".transaction-filter-button")&&($(!1),f(!1))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[D,E]),l.useEffect(()=>{const t=s=>{if(B&&!s.target)return;const r=s.target;!r.closest(".disposition-menu")&&!r.closest(".disposition-badge")&&L(null)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[B]);const ye=t=>{L(B===t?null:t)},fe=t=>{const s="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium cursor-pointer transition-colors hover:opacity-80";switch(We(t)){case"keep":return`${s} bg-green-100 text-green-800`;case"to return":return`${s} bg-red-100 text-red-700`;case"returned":return`${s} bg-red-800 text-red-100`;case"inventory":return`${s} bg-primary-100 text-primary-600`;default:return`${s} bg-gray-100 text-gray-800`}},be=async(t,s)=>{try{const r=p.find(a=>a.itemId===t);if(!r){console.error("Item not found for disposition update:",t);return}if(!o)throw new Error("Account ID is required");if(await d.updateItem(o,t,{disposition:s}),s==="inventory")try{await Ye.handleItemDeallocation(o,t,r.projectId||"",s),L(null),H&&H("Item moved to inventory")}catch(a){console.error("Failed to handle deallocation:",a),await d.updateItem(o,t,{disposition:r.disposition}),M&&M("Failed to move item to inventory. Please try again.");return}else m(a=>a.map(n=>n.itemId===t?{...n,disposition:s}:n)),L(null)}catch(r){console.error("Failed to update disposition:",r),M&&M("Failed to update disposition. Please try again.")}},S=l.useMemo(()=>p.filter(t=>{var n,i,x;const s=!y||((n=t.description)==null?void 0:n.toLowerCase().includes(y.toLowerCase()))||((i=t.sku)==null?void 0:i.toLowerCase().includes(y.toLowerCase()))||((x=t.businessInventoryLocation)==null?void 0:x.toLowerCase().includes(y.toLowerCase())),r=!g.status||t.inventoryStatus===g.status,a=j==="all"||j==="bookmarked"&&t.bookmark;return s&&r&&a}),[p,y,g.status,j]),te=l.useMemo(()=>{let t=Y;if(u!=="all"&&(u==="inventory-only"?t=t.filter(s=>s.projectId===null):t=t.filter(s=>s.status===u)),N){const s=N.toLowerCase();t=t.filter(r=>{var a,n,i,x;return((a=r.source)==null?void 0:a.toLowerCase().includes(s))||((n=r.transactionType)==null?void 0:n.toLowerCase().includes(s))||((i=r.projectName)==null?void 0:i.toLowerCase().includes(s))||((x=r.notes)==null?void 0:x.toLowerCase().includes(s))})}return t},[Y,u,N]),je=t=>{var s,r;return(s=t.transactionId)!=null&&s.startsWith("INV_SALE_")?Re:(r=t.transactionId)!=null&&r.startsWith("INV_PURCHASE_")?Oe:t.source},ve=[{id:"inventory",name:"Items",icon:oe},{id:"transactions",name:"Transactions",icon:Ze}];l.useEffect(()=>{let t=null,s=null;return(async()=>{if(!o){P(!1);return}P(!0);try{const[a,n,i,x]=await Promise.all([d.getBusinessInventoryItems(o,g),A.getBusinessInventoryTransactions(o),A.getInventoryRelatedTransactions(o),Ve.getProjects(o)]),_=[...n,...i].filter((b,F,z)=>F===z.findIndex(C=>C.transactionId===b.transactionId));_.sort((b,F)=>new Date(F.createdAt).getTime()-new Date(b.createdAt).getTime()),m(a),w(_),K(x),t=d.subscribeToBusinessInventory(o,b=>m(b),g,a),s=A.subscribeToAllTransactions(o,b=>{const z=[...b].filter((C,Q,Be)=>Q===Be.findIndex(Le=>Le.transactionId===C.transactionId));z.sort((C,Q)=>new Date(Q.createdAt).getTime()-new Date(C.createdAt).getTime()),w(z)},_)}catch(a){console.error("Error loading business inventory data:",a),m([]),w([]),K([])}finally{P(!1)}})(),()=>{t&&t(),s&&s()}},[o,g]),l.useEffect(()=>{if(!o||p.length===0)return;const t=new Map;try{p.forEach(s=>{if(!(s!=null&&s.itemId))return;const r=qe.subscribeToItemLineageForItem(o,s.itemId,async()=>{try{const a=await d.getItemById(o,s.itemId);if(a){a.projectId?m(n=>n.filter(i=>i.itemId!==a.itemId)):m(n=>n.map(i=>i.itemId===a.itemId?a:i));try{await we()}catch(n){console.debug("BusinessInventory - failed to reload transactions after lineage event",n)}}}catch(a){console.debug("BusinessInventory - failed to refetch item on lineage event",a)}});t.set(s.itemId,r)})}catch(s){console.debug("BusinessInventory - failed to setup per-item lineage subscriptions",s)}return()=>{t.forEach(s=>{try{s()}catch{}})}},[p.map(t=>t.itemId).join(","),o]),l.useEffect(()=>()=>{O(new Set)},[]);const se=async()=>{if(o)try{const t=await d.getBusinessInventoryItems(o,g);m(t)}catch(t){console.error("Error loading business inventory:",t),m([])}finally{P(!1)}},we=async()=>{if(o)try{const t=[],s=await A.getBusinessInventoryTransactions(o);t.push(...s);const r=await A.getInventoryRelatedTransactions(o);t.push(...r);const a=t.filter((n,i,x)=>i===x.findIndex(ae=>ae.transactionId===n.transactionId));a.sort((n,i)=>new Date(i.createdAt).getTime()-new Date(n.createdAt).getTime()),w(a)}catch(t){console.error("Error loading business transactions:",t),w([])}},Ne=t=>{xe(t)},{toggleBookmark:Ie}=Ke({items:p,setItems:m,updateItemService:(t,s)=>{if(!o)throw new Error("Account ID is required");return d.updateItem(o,t,s)}}),{duplicateItem:ke}=Je({items:p,setItems:m,duplicationService:async t=>{if(!o)throw new Error("Account ID is required");const s=await d.getItemById(o,t);if(!s)throw new Error("Item not found");const{itemId:r,dateCreated:a,lastUpdated:n,...i}=s;return await d.createItem(o,{...i,inventoryStatus:"available",projectId:null,disposition:i.disposition||"keep"})}}),Se=()=>{J(!0)},re=()=>{J(!1),U(!1),q({projectId:"",space:""})},Ce=()=>{const t=W.find(s=>s.id===h.projectId);return t?`${t.name} - ${t.clientName}`:"Select a project..."},Te=async()=>{if(!(!h.projectId||c.size===0||!o)){ee(!0);try{const t=Array.from(c);await d.batchAllocateItemsToProject(o,t,h.projectId,{space:h.space}),k(new Set),re(),alert(`Successfully allocated ${t.length} items to project!`)}catch(t){console.error("Error batch allocating items:",t),alert("Error allocating items. Please try again.")}finally{ee(!1)}}},Ae=async()=>{if(c.size===0||!o)return;const t=c.size,s=t===1?"Are you sure you want to delete this item? This action cannot be undone.":`Are you sure you want to delete ${t} items? This action cannot be undone.`;if(!window.confirm(s))return;const r=Array.from(c);m(a=>a.filter(n=>!r.includes(n.itemId))),k(new Set);try{let a=0,n=0;for(const i of r)try{await d.deleteItem(o,i),a++}catch(x){console.error(`Error deleting item ${i}:`,x),n++}n===0?alert(`Successfully deleted ${a} item${a!==1?"s":""}.`):(await se(),alert(`Deleted ${a} item${a!==1?"s":""}, but ${n} item${n!==1?"s":""} failed to delete.`))}catch(a){console.error("Error deleting items:",a),await se(),alert("Error deleting items. Please try again.")}},Pe=async t=>{var s,r;try{O(n=>new Set(n).add(t));const a=await ne.selectFromGallery();if(a.length>0)for(let n=0;n<a.length;n++){const i=a[n];await Ee(t,i,a)}}catch(a){if(console.error("Error adding image:",a),(s=a.message)!=null&&s.includes("timeout")||(r=a.message)!=null&&r.includes("canceled")){console.log("User canceled image selection or selection timed out");return}alert("Failed to add image. Please try again.")}finally{O(a=>{const n=new Set(a);return n.delete(t),n})}},Ee=async(t,s,r)=>{const n={url:(await ne.uploadItemImage(s,"Business Inventory",t)).url,alt:s.name,isPrimary:!0,uploadedAt:new Date,fileName:s.name,size:s.size,mimeType:s.type};if(!o)throw new Error("Account ID is required");if(await d.updateItem(o,t,{images:[n]}),r&&r.indexOf(s)===r.length-1){const i=r.length>1?`${r.length} images uploaded successfully!`:"Image uploaded successfully!";alert(i)}},De=t=>{k(t?new Set(S.map(s=>s.itemId)):new Set)},$e=(t,s)=>{const r=new Set(c);s?r.add(t):r.delete(t),k(r)};return!V&&!de&&!o?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Business Inventory"})}),e.jsx("div",{className:"bg-white shadow rounded-lg border border-yellow-200 bg-yellow-50",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"mx-auto h-12 w-12 text-yellow-600"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Account Selected"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Please select or create an account to manage inventory."}),e.jsx("div",{className:"mt-6",children:e.jsx(Ue,{to:"/settings",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Go to Settings"})})]})})})]}):V?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:ze})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:ve.map(t=>{const s=t.icon;return e.jsxs("button",{onClick:()=>ue(t.id),className:`py-4 px-1 border-b-2 font-medium text-base flex items-center ${R===t.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(s,{className:"h-4 w-4 mr-2"}),t.name]},t.id)})})}),e.jsxs("div",{className:"px-6 py-6",children:[R==="inventory"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-2",children:e.jsxs(T,{to:v("/business-inventory/add"),className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search items by description, SKU, or location...",value:y||"",onChange:t=>Ne(t.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 rounded-lg",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4",onChange:t=>De(t.target.checked),checked:c.size===S.length&&S.length>0}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"Select all"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>$(!D),className:"filter-button inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200",title:"Filter items",children:e.jsx(ce,{className:"h-4 w-4"})}),D&&e.jsx("div",{className:"filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{G("all"),$(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${j==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Items"}),e.jsx("button",{onClick:()=>{G("bookmarked"),$(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${j==="bookmarked"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Bookmarked Only"})]})})]}),e.jsx("button",{onClick:Se,className:"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200",disabled:c.size===0,title:"Allocate selected items to project",children:e.jsx(et,{className:"h-4 w-4"})}),me,e.jsx("button",{onClick:Ae,className:"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",disabled:c.size===0,title:"Delete Selected Items",children:e.jsx(tt,{className:"h-4 w-4"})})]})})]})]})}),S.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ“¦"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No items found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:y||g.status||j==="bookmarked"?"Try adjusting your search or filter criteria.":"No items found."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:S.map(t=>e.jsxs("li",{className:"relative bg-gray-50 transition-colors duration-200 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0 px-4 py-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4 flex-shrink-0",checked:c.has(t.itemId),onChange:s=>$e(t.itemId,s.target.checked)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md transition-colors ${t.bookmark?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`,title:t.bookmark?"Remove Bookmark":"Add Bookmark",onClick:s=>{s.preventDefault(),s.stopPropagation(),Ie(t.itemId)},children:e.jsx(st,{className:"h-4 w-4",fill:t.bookmark?"currentColor":"none"})}),e.jsx(T,{to:v(`/business-inventory/${t.itemId}/edit`),onClick:s=>s.stopPropagation(),className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"Edit item",children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),ke(t.itemId)},className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"Duplicate item",children:e.jsx(at,{className:"h-4 w-4"})}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs("span",{onClick:s=>{s.preventDefault(),s.stopPropagation(),ye(t.itemId)},className:`disposition-badge ${fe(t.disposition)}`,children:[Ge(t.disposition)||"Not Set",e.jsx(nt,{className:"h-3 w-3 ml-1"})]}),B===t.itemId&&e.jsx("div",{className:"disposition-menu absolute top-full left-0 mt-1 w-32 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsx("div",{className:"py-1",children:["keep","to return","returned","inventory"].map(s=>e.jsx("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),be(t.itemId,s)},className:`block w-full text-left px-3 py-2 text-xs hover:bg-gray-50 ${He(t.disposition,s)?"bg-gray-100 text-gray-900":"text-gray-700"}`,disabled:!t.disposition,children:s==="to return"?"To Return":s.charAt(0).toUpperCase()+s.slice(1)},s))})})]})]})]}),e.jsx(T,{to:v(`/business-inventory/${t.itemId}`),children:e.jsx("div",{className:"block bg-transparent",children:e.jsxs("div",{className:"px-4 pb-3 sm:px-6",children:[e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[e.jsx("div",{className:"flex-shrink-0",children:t.images&&t.images.length>0?(()=>{const s=t.images.find(r=>r.isPrimary)||t.images[0];return e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:s.url,alt:s.alt||"Item image",className:"w-full h-full object-cover"})})})():e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),Pe(t.itemId)},disabled:ge.has(t.itemId),className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors disabled:opacity-50",title:"Add image (camera or gallery)",children:e.jsx(ot,{className:"h-6 w-6"})})}),e.jsx("div",{className:"flex-1 min-w-0 flex items-center",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900 line-clamp-2 break-words",children:t.description}),t.businessInventoryLocation&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.businessInventoryLocation})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500",children:[(t.projectPrice||t.purchasePrice)&&e.jsxs("span",{className:"font-medium text-gray-700",children:["$",t.projectPrice||t.purchasePrice]}),t.source&&e.jsxs(e.Fragment,{children:[(t.projectPrice||t.purchasePrice)&&e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.source})]}),t.sku&&e.jsxs(e.Fragment,{children:[(t.projectPrice||t.purchasePrice||t.source)&&e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.sku})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.notes})]})]})})})]},t.itemId))})})]}),R==="transactions"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2",children:e.jsxs(T,{to:v("/business-inventory/transaction/add"),className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search transactions by source, type, project, or notes...",value:N||"",onChange:t=>pe(t.target.value)})]}),e.jsx("div",{className:"flex items-center justify-end gap-4 p-3 rounded-lg",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>f(!E),className:`transaction-filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${u==="all"?"border-gray-300 text-gray-700 bg-white hover:bg-gray-50":"border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100"}`,title:"Filter transactions",children:e.jsx(ce,{className:"h-4 w-4"})}),E&&e.jsx("div",{className:"transaction-filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{I("all"),f(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${u==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Status"}),e.jsx("button",{onClick:()=>{I("pending"),f(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${u==="pending"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Pending"}),e.jsx("button",{onClick:()=>{I("completed"),f(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${u==="completed"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Completed"}),e.jsx("button",{onClick:()=>{I("canceled"),f(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${u==="canceled"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Canceled"}),e.jsx("button",{onClick:()=>{I("inventory-only"),f(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${u==="inventory-only"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Inventory Only"})]})})]})})]})}),te.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ§¾"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No transactions found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:N||u!=="all"?"Try adjusting your search or filter criteria.":"No inventory-related transactions found."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:te.map(t=>e.jsx("li",{className:"relative",children:e.jsx(T,{to:v(`/business-inventory/transaction/${t.transactionId}`),children:e.jsx("div",{className:"block bg-gray-50 transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"px-4 py-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h3",{className:"text-base font-medium text-gray-900",children:je(t)})}),e.jsx("div",{className:"flex items-center flex-wrap gap-2",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status==="completed"?"Completed":t.status==="pending"?"Pending":t.status==="canceled"?"Canceled":t.status})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-700",children:_e(t.amount)}),t.projectName&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.projectName})]}),e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:Qe(t.transactionDate)})]}),t.notes&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.notes})]})]})})})},t.transactionId))})})]})]})]}),he&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Allocate ",c.size," Items to Project"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Project"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsxs("button",{type:"button",onClick:()=>U(!X),className:"project-dropdown-button relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[e.jsx("span",{className:`block truncate ${h.projectId?"text-gray-900":"text-gray-500"}`,children:Ce()}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),X&&e.jsx("div",{className:"project-dropdown absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base border border-gray-200 overflow-auto focus:outline-none sm:text-sm",children:W.map(t=>e.jsxs("button",{type:"button",onClick:()=>{q(s=>({...s,projectId:t.id})),U(!1)},className:`w-full text-left px-3 py-2 hover:bg-gray-50 ${h.projectId===t.id?"bg-primary-50 text-primary-600":"text-gray-900"}`,children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.clientName})]},t.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Space (Optional)"}),e.jsx("input",{type:"text",value:h.space,onChange:t=>q(s=>({...s,space:t.target.value})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"e.g. Living Room, Bedroom, etc."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:re,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Te,disabled:!h.projectId||Z,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50",children:Z?"Allocating...":`Allocate ${c.size} Items`})]})]})})})]})}export{jt as default};
//# sourceMappingURL=BusinessInventory.js.map
