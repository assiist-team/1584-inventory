import{j as e}from"./index.js";import{r}from"./vendor.js";import{L as c}from"./router.js";import{b as p,p as B,t as D}from"./inventoryService.js";import{a as w,f as L}from"./dateUtils.js";import{P as Q,K as R,d as y,m as K,E as z,f as M}from"./ui.js";import"./firebase.js";function W(){const[n,_]=r.useState("inventory"),[j,h]=r.useState([]),[u,f]=r.useState([]),[l,S]=r.useState(null),[I,g]=r.useState(!0),[t,T]=r.useState({status:"",searchQuery:""}),[a,C]=r.useState(""),o=r.useMemo(()=>a?u.filter(s=>s.status===a):u,[u,a]),$=[{id:"inventory",name:"Inventory",icon:Q},{id:"transactions",name:"Transactions",icon:R}];r.useEffect(()=>{k(),F(),b()},[]),r.useEffect(()=>p.subscribeToBusinessInventory(i=>{h(i),g(!1)},t),[t]),r.useEffect(()=>{if(n!=="transactions")return;(async()=>{await b()})()},[n]);const k=async()=>{try{const s=await p.getBusinessInventoryItems(t);h(s)}catch(s){console.error("Error loading business inventory:",s),h([])}finally{g(!1)}},F=async()=>{try{const s=await p.getBusinessInventoryStats();S(s)}catch(s){console.error("Error loading stats:",s)}},b=async()=>{try{const s=await B.getProjects(),i=[];for(const m of s)try{const P=(await D.getTransactions(m.id)).filter(d=>{var N;return d.reimbursement_type||d.trigger_event==="Inventory allocation"||d.trigger_event==="Inventory return"||d.trigger_event==="Purchase from client"||((N=d.source)==null?void 0:N.toLowerCase().includes("inventory"))});i.push(...P)}catch(x){console.error(`Error loading transactions for project ${m.id}:`,x)}i.sort((m,x)=>new Date(x.created_at).getTime()-new Date(m.created_at).getTime()),f(i)}catch(s){console.error("Error loading business transactions:",s),f([])}},v=s=>{T(s),g(!0)},A=s=>{v({...t,searchQuery:s})},E=s=>{v({...t,status:s||void 0})};return I?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"space-y-6",children:[n==="inventory"&&l&&e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:l.totalItems})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Items"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.totalItems})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:l.availableItems})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Available"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.availableItems})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:l.pendingItems})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Allocated"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.pendingItems})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-red-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:l.soldItems})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Sold"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.soldItems})]})})]})})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:$.map(s=>{const i=s.icon;return e.jsxs("button",{onClick:()=>_(s.id),className:`py-4 px-1 border-b-2 font-medium text-base flex items-center ${n===s.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(i,{className:"h-4 w-4 mr-2"}),s.name]},s.id)})})}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[n==="inventory"&&e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(c,{to:"/business-inventory/add",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),n==="transactions"&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(c,{to:"/business-inventory/transaction/add",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Add Transaction"]}),e.jsxs("select",{value:a,onChange:s=>C(s.target.value),className:`inline-flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${a?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),a&&n==="transactions"&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",o.length," ",a," transaction",o.length!==1?"s":""]})]})}),e.jsxs("div",{className:"px-6 py-6",children:[n==="inventory"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"search",className:"sr-only",children:"Search items"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(K,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",name:"search",id:"search",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"Search items by description, SKU, or location...",value:t.searchQuery||"",onChange:s=>A(s.target.value)})]})]}),e.jsxs("div",{className:"sm:w-48",children:[e.jsx("label",{htmlFor:"status-filter",className:"sr-only",children:"Filter by status"}),e.jsxs("select",{id:"status-filter",name:"status-filter",className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",value:t.status||"",onChange:s=>E(s.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"pending",children:"Allocated"}),e.jsx("option",{value:"sold",children:"Sold"})]})]})]})}),j.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"üì¶"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No items found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:t.searchQuery||t.status?"Try adjusting your search or filter criteria.":"Get started by adding your first business inventory item."}),!t.searchQuery&&!t.status&&e.jsxs(c,{to:"/business-inventory/add",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:j.map(s=>e.jsx("li",{className:"relative",children:e.jsx(c,{to:`/business-inventory/${s.item_id}`,className:"block bg-gray-50 transition-colors duration-200 hover:bg-gray-100 active:bg-gray-200",children:e.jsxs("div",{className:"px-4 py-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-base font-medium text-gray-900",children:s.description}),s.bookmark&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"‚≠ê Bookmarked"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${s.inventory_status==="available"?"bg-green-100 text-green-800":s.inventory_status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.inventory_status==="available"?"Available":s.inventory_status==="pending"?"Allocated":"Sold"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-700",children:w(s.price)}),e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:s.source}),s.business_inventory_location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:s.business_inventory_location})]})]}),s.current_project_id&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Allocated to Project:"})," ",s.current_project_id]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.notes})]})]})})},s.item_id))})})]}),n==="transactions"&&e.jsx(e.Fragment,{children:o.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"üßæ"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:a?`No ${a} transactions`:"No inventory transactions yet"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:a?`No transactions found with status "${a}".`:"Inventory-related transactions will appear here when items are allocated to projects or when client-purchased items are moved to business inventory."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:o.map(s=>e.jsx("li",{className:"relative",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(c,{to:`/project/${s.project_id}/transaction/${s.transaction_id}`,className:"flex-1 block px-4 py-4 sm:px-6 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h3",{className:"text-base font-medium text-gray-900",children:s.source})}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[s.status==="pending"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Pending"}),s.status==="completed"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Completed"}),s.status==="cancelled"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Cancelled"}),s.reimbursement_type&&e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.reimbursement_type==="Client owes us"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:s.reimbursement_type}),s.budget_category&&e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${s.budget_category==="Design Fee"?"bg-amber-100 text-amber-800":s.budget_category==="Furnishings"?"bg-yellow-100 text-yellow-800":s.budget_category==="Property Management"?"bg-orange-100 text-orange-800":s.budget_category==="Kitchen"?"bg-amber-200 text-amber-900":s.budget_category==="Install"?"bg-yellow-200 text-yellow-900":s.budget_category==="Storage & Receiving"?"bg-orange-200 text-orange-900":s.budget_category==="Fuel"?"bg-amber-300 text-amber-900":"bg-gray-100 text-gray-800"}`,children:s.budget_category}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${s.transaction_type==="Purchase"?"bg-green-100 text-green-800":s.transaction_type==="Return"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.transaction_type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-700",children:w(s.amount)}),e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:s.payment_method}),e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:L(s.transaction_date)})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Project:"})," ",s.project_name]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.notes})]})]}),e.jsxs("div",{className:"px-4 py-4 flex items-center gap-2",children:[e.jsx(c,{to:`/project/${s.project_id}/transaction/${s.transaction_id}`,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",title:"View Transaction",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(c,{to:`/business-inventory/transaction/${s.project_id}/${s.transaction_id}/edit`,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",title:"Edit Transaction",children:e.jsx(M,{className:"h-4 w-4"})})]})]})},s.transaction_id))})})})]})]})]})}export{W as default};
//# sourceMappingURL=BusinessInventory.js.map
