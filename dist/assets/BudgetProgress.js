import{j as e,k as u}from"./index.js";import{r as v}from"./vendor.js";import{b as X,D as C,s as Y,j as J}from"./ui.js";function D({onSubmit:p,onCancel:m,isLoading:h=!1,initialData:n}){var B,_,R,j,L,y,x,H,M,I,O,P,G,V;const F=!!(n!=null&&n.name),S=(()=>{if(n!=null&&n.budgetCategories)return(!n.budgetCategories.designFee||n.budgetCategories.designFee===0)&&(n==null?void 0:n.designFee)!==void 0&&n.designFee>0?{...n.budgetCategories,designFee:n.designFee}:n.budgetCategories;if((n==null?void 0:n.designFee)!==void 0)return{designFee:n.designFee,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0}})(),[s,T]=v.useState({name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",clientName:(n==null?void 0:n.clientName)||"",budget:(n==null?void 0:n.budget)||void 0,designFee:(n==null?void 0:n.designFee)||void 0,budgetCategories:S}),[f,E]=v.useState({}),$=()=>s.budgetCategories?Object.values(s.budgetCategories).reduce((a,o)=>a+(o||0),0):0,b=(a,o)=>{if(a==="budgetCategories"&&typeof o=="object")T(t=>({...t,[a]:o}));else{const t=typeof o=="number"&&o===0?void 0:o;T(r=>({...r,[a]:t}))}f[a]&&E(t=>({...t,[a]:""}))},U=()=>{const a={};return s.name.trim()||(a.name="Project name is required"),s.clientName.trim()||(a.clientName="Client name is required"),E(a),Object.keys(a).length===0},k=async a=>{if(a.preventDefault(),console.debug("ProjectForm: submit clicked",{formData:s}),!U()){console.debug("ProjectForm: validation failed",{formData:s});return}try{const t=(r=>{if(r!=null){if(typeof r=="object"){const l=Object.fromEntries(Object.entries(r).filter(([i,d])=>d!==void 0));return Object.keys(l).length>0?l:void 0}return r}})(s);console.debug("ProjectForm: calling onSubmit with",{cleanedData:t}),await p(t),console.debug("ProjectForm: onSubmit resolved")}catch(o){console.error("Error submitting form:",o)}};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto z-50",children:e.jsx("div",{className:"flex min-h-screen items-start sm:items-center justify-center p-4",children:e.jsx("div",{className:"relative w-full max-w-md mx-auto p-5 border shadow-lg rounded-md bg-white max-h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:F?"Edit":"Create"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx(X,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Project Name *"}),e.jsx("input",{type:"text",id:"name",value:s.name,onChange:a=>b("name",a.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${f.name?"border-red-300":""}`,placeholder:"Enter project name"}),f.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-700",children:"Client Name *"}),e.jsx("input",{type:"text",id:"clientName",value:s.clientName,onChange:a=>b("clientName",a.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${f.clientName?"border-red-300":""}`,placeholder:"Enter client name"}),f.clientName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.clientName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",value:s.description,onChange:a=>b("description",a.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Enter project description"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Budget Categories"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set specific budgets for different project categories. These will be used to track spending by category."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"totalBudget",className:"block text-sm font-medium text-gray-700",children:"Total Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",id:"totalBudget",value:$().toFixed(2),readOnly:!0,className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm bg-gray-50 text-gray-700 sm:text-sm cursor-not-allowed"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Automatically calculated from budget categories"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.designFee",className:"block text-sm font-medium text-gray-700",children:"Design Fee Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.designFee",value:((_=(B=s.budgetCategories)==null?void 0:B.designFee)==null?void 0:_.toString())||"",onChange:a=>{var r,l,i,d,g,c;const o=parseFloat(a.target.value)||0,t={designFee:o>0?o:0,furnishings:((r=s.budgetCategories)==null?void 0:r.furnishings)||0,propertyManagement:((l=s.budgetCategories)==null?void 0:l.propertyManagement)||0,kitchen:((i=s.budgetCategories)==null?void 0:i.kitchen)||0,install:((d=s.budgetCategories)==null?void 0:d.install)||0,storageReceiving:((g=s.budgetCategories)==null?void 0:g.storageReceiving)||0,fuel:((c=s.budgetCategories)==null?void 0:c.fuel)||0};b("budgetCategories",t)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.furnishings",className:"block text-sm font-medium text-gray-700",children:"Furnishings Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.furnishings",value:((j=(R=s.budgetCategories)==null?void 0:R.furnishings)==null?void 0:j.toString())||"",onChange:a=>{var r,l,i,d,g,c;const o=parseFloat(a.target.value)||0,t={designFee:((r=s.budgetCategories)==null?void 0:r.designFee)||0,furnishings:o>0?o:0,propertyManagement:((l=s.budgetCategories)==null?void 0:l.propertyManagement)||0,kitchen:((i=s.budgetCategories)==null?void 0:i.kitchen)||0,install:((d=s.budgetCategories)==null?void 0:d.install)||0,storageReceiving:((g=s.budgetCategories)==null?void 0:g.storageReceiving)||0,fuel:((c=s.budgetCategories)==null?void 0:c.fuel)||0};b("budgetCategories",t)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.propertyManagement",className:"block text-sm font-medium text-gray-700",children:"Property Management Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.propertyManagement",value:((y=(L=s.budgetCategories)==null?void 0:L.propertyManagement)==null?void 0:y.toString())||"",onChange:a=>{var r,l,i,d,g,c;const o=parseFloat(a.target.value)||0,t={designFee:((r=s.budgetCategories)==null?void 0:r.designFee)||0,furnishings:((l=s.budgetCategories)==null?void 0:l.furnishings)||0,propertyManagement:o>0?o:0,kitchen:((i=s.budgetCategories)==null?void 0:i.kitchen)||0,install:((d=s.budgetCategories)==null?void 0:d.install)||0,storageReceiving:((g=s.budgetCategories)==null?void 0:g.storageReceiving)||0,fuel:((c=s.budgetCategories)==null?void 0:c.fuel)||0};b("budgetCategories",t)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.kitchen",className:"block text-sm font-medium text-gray-700",children:"Kitchen Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.kitchen",value:((H=(x=s.budgetCategories)==null?void 0:x.kitchen)==null?void 0:H.toString())||"",onChange:a=>{var r,l,i,d,g,c;const o=parseFloat(a.target.value)||0,t={designFee:((r=s.budgetCategories)==null?void 0:r.designFee)||0,furnishings:((l=s.budgetCategories)==null?void 0:l.furnishings)||0,propertyManagement:((i=s.budgetCategories)==null?void 0:i.propertyManagement)||0,kitchen:o>0?o:0,install:((d=s.budgetCategories)==null?void 0:d.install)||0,storageReceiving:((g=s.budgetCategories)==null?void 0:g.storageReceiving)||0,fuel:((c=s.budgetCategories)==null?void 0:c.fuel)||0};b("budgetCategories",t)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.install",className:"block text-sm font-medium text-gray-700",children:"Install Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.install",value:((I=(M=s.budgetCategories)==null?void 0:M.install)==null?void 0:I.toString())||"",onChange:a=>{var r,l,i,d,g,c;const o=parseFloat(a.target.value)||0,t={designFee:((r=s.budgetCategories)==null?void 0:r.designFee)||0,furnishings:((l=s.budgetCategories)==null?void 0:l.furnishings)||0,propertyManagement:((i=s.budgetCategories)==null?void 0:i.propertyManagement)||0,kitchen:((d=s.budgetCategories)==null?void 0:d.kitchen)||0,install:o>0?o:0,storageReceiving:((g=s.budgetCategories)==null?void 0:g.storageReceiving)||0,fuel:((c=s.budgetCategories)==null?void 0:c.fuel)||0};b("budgetCategories",t)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.storageReceiving",className:"block text-sm font-medium text-gray-700",children:"Storage & Receiving Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.storageReceiving",value:((P=(O=s.budgetCategories)==null?void 0:O.storageReceiving)==null?void 0:P.toString())||"",onChange:a=>{var r,l,i,d,g,c;const o=parseFloat(a.target.value)||0,t={designFee:((r=s.budgetCategories)==null?void 0:r.designFee)||0,furnishings:((l=s.budgetCategories)==null?void 0:l.furnishings)||0,propertyManagement:((i=s.budgetCategories)==null?void 0:i.propertyManagement)||0,kitchen:((d=s.budgetCategories)==null?void 0:d.kitchen)||0,install:((g=s.budgetCategories)==null?void 0:g.install)||0,storageReceiving:o>0?o:0,fuel:((c=s.budgetCategories)==null?void 0:c.fuel)||0};b("budgetCategories",t)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.fuel",className:"block text-sm font-medium text-gray-700",children:"Fuel Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.fuel",value:((V=(G=s.budgetCategories)==null?void 0:G.fuel)==null?void 0:V.toString())||"",onChange:a=>{var r,l,i,d,g,c;const o=parseFloat(a.target.value)||0,t={designFee:((r=s.budgetCategories)==null?void 0:r.designFee)||0,furnishings:((l=s.budgetCategories)==null?void 0:l.furnishings)||0,propertyManagement:((i=s.budgetCategories)==null?void 0:i.propertyManagement)||0,kitchen:((d=s.budgetCategories)==null?void 0:d.kitchen)||0,install:((g=s.budgetCategories)==null?void 0:g.install)||0,storageReceiving:((c=s.budgetCategories)==null?void 0:c.storageReceiving)||0,fuel:o>0?o:0};b("budgetCategories",t)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:h,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:h?F?"Updating...":"Creating...":F?"Update Project":"Create Project"})]})]})]})})})})}function ee({budget:p,designFee:m,budgetCategories:h,transactions:n,previewMode:F=!1}){const[S,s]=v.useState(!1),T=async()=>{let t=0;const r=n.filter(l=>(l.status||"").toLowerCase()!=="canceled"&&l.budgetCategory!==u.DESIGN_FEE);for(const l of r){const i=parseFloat(l.amount||"0"),d=l.transactionType==="Return"?-1:1,g=i*d;t+=g}return t},f=async()=>{if(!h)return[];const t=[],r=[{key:"furnishings",label:u.FURNISHINGS},{key:"install",label:u.INSTALL},{key:"fuel",label:u.FUEL},{key:"storageReceiving",label:u.STORAGE_RECEIVING},{key:"kitchen",label:u.KITCHEN},{key:"propertyManagement",label:u.PROPERTY_MANAGEMENT},{key:"designFee",label:u.DESIGN_FEE}];for(const{key:l,label:i}of r){const d=h[l]||0;if(i===u.DESIGN_FEE?m!=null&&m>0:d>0)if(i===u.DESIGN_FEE){const c=n.filter(w=>w.budgetCategory===u.DESIGN_FEE).reduce((w,N)=>{const q=parseFloat(N.amount||"0"),K=N.transactionType==="Return"?-1:1;return w+q*K},0),A=m&&m>0?c/m*100:0;t.push({category:i,budget:m||0,spent:Math.round(c),percentage:Math.min(A,100)})}else{let c=0;const A=n.filter(N=>(N.status||"").toLowerCase()!=="canceled"&&N.budgetCategory===i);for(const N of A){const q=parseFloat(N.amount||"0"),K=N.transactionType==="Return"?-1:1,z=q*K;c+=z}const w=d>0?c/d*100:0;t.push({category:i,budget:d,spent:Math.round(c),percentage:Math.min(w,100)})}}return t},[E,$]=v.useState(0),[b,U]=v.useState(0),[k,B]=v.useState([]),[_,R]=v.useState(!0),[j,L]=v.useState(p||0);v.useEffect(()=>{(async()=>{R(!0);try{const r=await T(),l=await f(),i=h?Object.entries(h).reduce((c,[A,w])=>A==="designFee"?c:c+(w||0),0):0,d=Math.round(r),g=i>0?d/i*100:0;$(d),U(g),B(l),L(i)}catch(r){console.error("Error calculating budget data:",r),$(0),U(0),B([])}finally{R(!1)}})()},[p,m,h,n]);let y=k,x=null;if(F){const t=k.find(r=>r.category===u.FURNISHINGS);t?y=[t]:j>0&&(x={category:"Overall Budget",budget:j,spent:E,percentage:b})}else y=k.filter(r=>r.category===u.FURNISHINGS||S),x=j>0&&S?{category:"Overall Budget",budget:j,spent:E,percentage:b}:null;const H=(()=>{const t=[...y||[]];return x&&t.push(x),t})(),M=t=>t>=100||t>=75?"bg-red-500":t>=50?"bg-yellow-500":"bg-green-500",I=t=>t>=100||t>=75?"text-red-600":t>=50?"text-yellow-600":"text-green-600",O=t=>t>=100||t>=75?"bg-green-500":t>=50?"bg-yellow-500":"bg-red-500",P=t=>t>=100||t>=75?"text-green-600":t>=50?"text-yellow-600":"text-red-600",G=t=>t===u.DESIGN_FEE||t==="Overall Budget"?t:`${t} Budget`,V=j>0,a=m!=null&&m>0,o=h&&Object.values(h).some(t=>t>0);return _?e.jsx("div",{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded mb-4"})]})}):!V&&!a&&!o?null:F?e.jsxs("div",{children:[(y.length>0||x)&&e.jsx("div",{children:e.jsx("div",{className:"space-y-4",children:[...y,...x?[x]:[]].map(t=>{const r=t.category===u.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:G(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",r?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${r?P(t.percentage):I(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${r?O(t.percentage):M(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})})}),!p&&!m&&(!h||Object.values(h).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]}):e.jsxs("div",{children:[(y.length>0||x)&&e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:H.map(t=>{const r=t.category===u.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:G(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",r?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${r?P(t.percentage):I(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${r?O(t.percentage):M(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})}),(k.some(t=>t.category!==u.FURNISHINGS&&t.category!==u.DESIGN_FEE)||p!=null&&p>0)&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>s(!S),className:"inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Show All Budget Categories"]})})})]}),!p&&!m&&(!h||Object.values(h).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]})}export{ee as B,D as P};
//# sourceMappingURL=BudgetProgress.js.map
