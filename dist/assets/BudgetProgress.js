import{j as e,B as c}from"./index.js";import{r as N}from"./vendor.js";import{b as q,D as v,n as K,h as z}from"./ui.js";function Q({onSubmit:o,onCancel:d,isLoading:g=!1,initialData:a}){var C,y,F,G,S,b,p,k,B,E,R,P,U,T;const w=!!(a!=null&&a.name),[n,M]=N.useState({name:(a==null?void 0:a.name)||"",description:(a==null?void 0:a.description)||"",clientName:(a==null?void 0:a.clientName)||"",budget:(a==null?void 0:a.budget)||void 0,designFee:(a==null?void 0:a.designFee)||void 0,budgetCategories:(a==null?void 0:a.budgetCategories)||void 0}),[u,$]=N.useState({}),m=(r,t)=>{if(r==="budgetCategories"&&typeof t=="object")M(s=>({...s,[r]:t}));else{const s=typeof t=="number"&&t===0?void 0:t;M(l=>({...l,[r]:s}))}u[r]&&$(s=>({...s,[r]:""}))},O=()=>{const r={};return n.name.trim()||(r.name="Project name is required"),n.clientName.trim()||(r.clientName="Client name is required"),n.budget!==void 0&&(isNaN(n.budget)||n.budget<0)&&(r.budget="Budget must be a positive number"),n.designFee!==void 0&&(isNaN(n.designFee)||n.designFee<0)&&(r.designFee="Design fee must be a positive number"),$(r),Object.keys(r).length===0},A=async r=>{if(r.preventDefault(),!!O())try{const s=(l=>{if(l!=null){if(typeof l=="object"){const i=Object.fromEntries(Object.entries(l).filter(([h,I])=>I!==void 0));return Object.keys(i).length>0?i:void 0}return l}})(n);await o(s)}catch(t){console.error("Error submitting form:",t)}};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:w?"Edit":"Create"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Project Name *"}),e.jsx("input",{type:"text",id:"name",value:n.name,onChange:r=>m("name",r.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.name?"border-red-300":""}`,placeholder:"Enter project name"}),u.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-700",children:"Client Name *"}),e.jsx("input",{type:"text",id:"clientName",value:n.clientName,onChange:r=>m("clientName",r.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.clientName?"border-red-300":""}`,placeholder:"Enter client name"}),u.clientName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.clientName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",value:n.description,onChange:r=>m("description",r.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Enter project description"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budget",className:"block text-sm font-medium text-gray-700",children:"Budget (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budget",value:((C=n.budget)==null?void 0:C.toString())||"",onChange:r=>{const t=r.target.value.trim();if(t==="")m("budget",0);else{const s=parseFloat(t);m("budget",isNaN(s)?0:s)}},className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.budget?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),u.budget&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.budget})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"designFee",className:"block text-sm font-medium text-gray-700",children:"Design Fee (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"designFee",value:((y=n.designFee)==null?void 0:y.toString())||"",onChange:r=>{const t=r.target.value.trim();if(t==="")m("designFee",0);else{const s=parseFloat(t);m("designFee",isNaN(s)?0:s)}},className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.designFee?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),u.designFee&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.designFee})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Budget Categories (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set specific budgets for different project categories. These will be used to track spending by category."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.furnishings",className:"block text-sm font-medium text-gray-700",children:"Furnishings Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.furnishings",value:((G=(F=n.budgetCategories)==null?void 0:F.furnishings)==null?void 0:G.toString())||"",onChange:r=>{var l,i,h,I,f,j;const t=parseFloat(r.target.value)||0,s={designFee:((l=n.budgetCategories)==null?void 0:l.designFee)||0,furnishings:t>0?t:0,propertyManagement:((i=n.budgetCategories)==null?void 0:i.propertyManagement)||0,kitchen:((h=n.budgetCategories)==null?void 0:h.kitchen)||0,install:((I=n.budgetCategories)==null?void 0:I.install)||0,storageReceiving:((f=n.budgetCategories)==null?void 0:f.storageReceiving)||0,fuel:((j=n.budgetCategories)==null?void 0:j.fuel)||0};m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.propertyManagement",className:"block text-sm font-medium text-gray-700",children:"Property Management Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.propertyManagement",value:((b=(S=n.budgetCategories)==null?void 0:S.propertyManagement)==null?void 0:b.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.propertyManagement=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.kitchen",className:"block text-sm font-medium text-gray-700",children:"Kitchen Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.kitchen",value:((k=(p=n.budgetCategories)==null?void 0:p.kitchen)==null?void 0:k.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.kitchen=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.install",className:"block text-sm font-medium text-gray-700",children:"Install Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.install",value:((E=(B=n.budgetCategories)==null?void 0:B.install)==null?void 0:E.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.install=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.storageReceiving",className:"block text-sm font-medium text-gray-700",children:"Storage & Receiving Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.storageReceiving",value:((P=(R=n.budgetCategories)==null?void 0:R.storageReceiving)==null?void 0:P.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.storageReceiving=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.fuel",className:"block text-sm font-medium text-gray-700",children:"Fuel Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.fuel",value:((T=(U=n.budgetCategories)==null?void 0:U.fuel)==null?void 0:T.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.fuel=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:g,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:g?w?"Updating...":"Creating...":w?"Update Project":"Create Project"})]})]})]})})})}function W({budget:o,designFee:d,budgetCategories:g,transactions:a,previewMode:w=!1}){const[n,M]=N.useState(!1),u=async()=>{if(!o&&o!==0)return 0;console.log("BudgetProgress - calculateSpent: Starting calculation for",a.length,"transactions");let t=0;for(const s of a)if(console.log("BudgetProgress - Processing transaction:",{id:s.transaction_id,type:s.transaction_type,budget_category:s.budget_category,amount:s.amount}),s.budget_category===c.FURNISHINGS){const l=parseFloat(s.amount||"0");console.log("BudgetProgress - Transaction amount:",l);const i=s.transaction_type==="Return"?-1:1,h=l*i;t+=h,console.log("BudgetProgress - Added",h,"to total. Running total:",t)}else console.log("BudgetProgress - Skipping transaction",s.transaction_id,"- not furnishings category");return console.log("BudgetProgress - Final total amount:",t),t},$=async()=>{if(!g)return console.log("BudgetProgress - No budget categories provided"),[];console.log("BudgetProgress - Available budget categories:",g),console.log("BudgetProgress - Total transactions available:",a.length);const t=[],s=[{key:"furnishings",label:c.FURNISHINGS},{key:"install",label:c.INSTALL},{key:"fuel",label:c.FUEL},{key:"storageReceiving",label:c.STORAGE_RECEIVING},{key:"kitchen",label:c.KITCHEN},{key:"propertyManagement",label:c.PROPERTY_MANAGEMENT},{key:"designFee",label:c.DESIGN_FEE}];for(const{key:l,label:i}of s){const h=g[l]||0;if(i===c.DESIGN_FEE?d!=null&&d>0:h>0)if(i===c.DESIGN_FEE){const f=a.filter(_=>_.budget_category===c.DESIGN_FEE).reduce((_,x)=>{const L=parseFloat(x.amount||"0"),H=x.transaction_type==="Return"?-1:1;return _+L*H},0),j=d&&d>0?f/d*100:0;t.push({category:i,budget:d||0,spent:Math.round(f),percentage:Math.min(j,100)})}else{let f=0;const j=a.filter(x=>x.budget_category===i);console.log(`BudgetProgress - Category ${i}: Found ${j.length} transactions`);for(const x of j){console.log(`BudgetProgress - Category ${i} - Processing transaction:`,{id:x.transaction_id,type:x.transaction_type,budget_category:x.budget_category,amount:x.amount});const L=parseFloat(x.amount||"0");console.log(`BudgetProgress - Category ${i} - Transaction amount:`,L);const H=x.transaction_type==="Return"?-1:1,V=L*H;f+=V,console.log(`BudgetProgress - Category ${i} - Added ${V} to category total. Running total:`,f)}const _=h>0?f/h*100:0;t.push({category:i,budget:h,spent:Math.round(f),percentage:Math.min(_,100)})}}return t},[m,O]=N.useState(0),[A,C]=N.useState(0),[y,F]=N.useState([]),[G,S]=N.useState(!0);N.useEffect(()=>{(async()=>{console.log("BudgetProgress - useEffect triggered with:",{budget:o,designFee:d,budgetCategories:g,transactionCount:a.length}),S(!0);try{const s=await u(),l=await $(),i=Math.round(s),h=o&&o>0?i/o*100:0;console.log("BudgetProgress - Final results:",{spentAmount:s,spentRounded:i,percentageValue:h,categoryDataLength:l.length}),O(i),C(h),F(l)}catch(s){console.error("Error calculating budget data:",s),O(0),C(0),F([])}finally{S(!1)}})()},[o,d,g,a]);let b=y,p=null;if(w){const t=y.find(s=>s.category===c.FURNISHINGS);t?b=[t]:o!=null&&o>0&&(p={category:"Overall Budget",budget:o,spent:m,percentage:A})}else{b=y.filter(l=>l.category===c.FURNISHINGS||n);const t=y.some(l=>l.category===c.FURNISHINGS);p=o!=null&&o>0&&(!t||n)?{category:"Overall Budget",budget:o,spent:m,percentage:A}:null}const k=t=>t>=100||t>=75?"bg-red-500":t>=50?"bg-yellow-500":"bg-green-500",B=t=>t>=100||t>=75?"text-red-600":t>=50?"text-yellow-600":"text-green-600",E=t=>t>=100||t>=75?"bg-green-500":t>=50?"bg-yellow-500":"bg-red-500",R=t=>t>=100||t>=75?"text-green-600":t>=50?"text-yellow-600":"text-red-600",P=t=>t===c.DESIGN_FEE||t==="Overall Budget"?t:`${t} Budget`,U=o!=null&&o>0,T=d!=null&&d>0,r=g&&Object.values(g).some(t=>t>0);return G?e.jsx("div",{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded mb-4"})]})}):!U&&!T&&!r?null:w?e.jsxs("div",{children:[(b.length>0||p)&&e.jsx("div",{children:e.jsx("div",{className:"space-y-4",children:[...b,...p?[p]:[]].map(t=>{const s=t.category===c.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:P(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",s?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${s?R(t.percentage):B(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${s?E(t.percentage):k(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})})}),!o&&!d&&(!g||Object.values(g).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]}):e.jsxs("div",{children:[(b.length>0||p)&&e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:[...b,...p?[p]:[]].map(t=>{const s=t.category===c.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:P(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",s?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${s?R(t.percentage):B(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${s?E(t.percentage):k(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})}),(y.some(t=>t.category!==c.FURNISHINGS&&t.category!==c.DESIGN_FEE)||o!=null&&o>0)&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>M(!n),className:"inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Show All Budget Categories"]})})})]}),!o&&!d&&(!g||Object.values(g).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]})}export{W as B,Q as P};
//# sourceMappingURL=BudgetProgress.js.map
