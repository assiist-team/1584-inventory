import{j as e,B as i}from"./index.js";import{r as O}from"./vendor.js";import{b as A,D as v,p as H,m as L}from"./ui.js";function V({onSubmit:o,onCancel:d,isLoading:u=!1,initialData:l}){var b,p,w,F,S,k,E,I,G,P,s,g,h,f;const j=!!(l!=null&&l.name),[r,B]=O.useState({name:(l==null?void 0:l.name)||"",description:(l==null?void 0:l.description)||"",clientName:(l==null?void 0:l.clientName)||"",budget:(l==null?void 0:l.budget)||void 0,designFee:(l==null?void 0:l.designFee)||void 0,budgetCategories:(l==null?void 0:l.budgetCategories)||void 0}),[c,R]=O.useState({}),m=(t,a)=>{if(t==="budgetCategories"&&typeof a=="object")B(n=>({...n,[t]:a}));else{const n=typeof a=="number"&&a===0?void 0:a;B(y=>({...y,[t]:n}))}c[t]&&R(n=>({...n,[t]:""}))},M=()=>{const t={};return r.name.trim()||(t.name="Project name is required"),r.clientName.trim()||(t.clientName="Client name is required"),r.budget!==void 0&&(isNaN(r.budget)||r.budget<0)&&(t.budget="Budget must be a positive number"),r.designFee!==void 0&&(isNaN(r.designFee)||r.designFee<0)&&(t.designFee="Design fee must be a positive number"),R(t),Object.keys(t).length===0},N=async t=>{if(t.preventDefault(),!!M())try{await o(r)}catch(a){console.error("Error submitting form:",a)}};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:j?"Edit":"Create"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:e.jsx(A,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Project Name *"}),e.jsx("input",{type:"text",id:"name",value:r.name,onChange:t=>m("name",t.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${c.name?"border-red-300":""}`,placeholder:"Enter project name"}),c.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-700",children:"Client Name *"}),e.jsx("input",{type:"text",id:"clientName",value:r.clientName,onChange:t=>m("clientName",t.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${c.clientName?"border-red-300":""}`,placeholder:"Enter client name"}),c.clientName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.clientName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",value:r.description,onChange:t=>m("description",t.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Enter project description"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budget",className:"block text-sm font-medium text-gray-700",children:"Budget (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budget",value:((b=r.budget)==null?void 0:b.toString())||"",onChange:t=>m("budget",parseFloat(t.target.value)||0),className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${c.budget?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),c.budget&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.budget})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"designFee",className:"block text-sm font-medium text-gray-700",children:"Design Fee (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"designFee",value:((p=r.designFee)==null?void 0:p.toString())||"",onChange:t=>m("designFee",parseFloat(t.target.value)||0),className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${c.designFee?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),c.designFee&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.designFee})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Budget Categories (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set specific budgets for different project categories. These will be used to track spending by category."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.furnishings",className:"block text-sm font-medium text-gray-700",children:"Furnishings Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.furnishings",value:((F=(w=r.budgetCategories)==null?void 0:w.furnishings)==null?void 0:F.toString())||"",onChange:t=>{var y,x,C,_,$,U;const a=parseFloat(t.target.value)||0,n={designFee:((y=r.budgetCategories)==null?void 0:y.designFee)||0,furnishings:a>0?a:0,propertyManagement:((x=r.budgetCategories)==null?void 0:x.propertyManagement)||0,kitchen:((C=r.budgetCategories)==null?void 0:C.kitchen)||0,install:((_=r.budgetCategories)==null?void 0:_.install)||0,storageReceiving:(($=r.budgetCategories)==null?void 0:$.storageReceiving)||0,fuel:((U=r.budgetCategories)==null?void 0:U.fuel)||0};m("budgetCategories",n)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.propertyManagement",className:"block text-sm font-medium text-gray-700",children:"Property Management Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.propertyManagement",value:((k=(S=r.budgetCategories)==null?void 0:S.propertyManagement)==null?void 0:k.toString())||"",onChange:t=>{const a=parseFloat(t.target.value)||0,n={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};n.propertyManagement=a>0?a:0,m("budgetCategories",n)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.kitchen",className:"block text-sm font-medium text-gray-700",children:"Kitchen Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.kitchen",value:((I=(E=r.budgetCategories)==null?void 0:E.kitchen)==null?void 0:I.toString())||"",onChange:t=>{const a=parseFloat(t.target.value)||0,n={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};n.kitchen=a>0?a:0,m("budgetCategories",n)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.install",className:"block text-sm font-medium text-gray-700",children:"Install Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.install",value:((P=(G=r.budgetCategories)==null?void 0:G.install)==null?void 0:P.toString())||"",onChange:t=>{const a=parseFloat(t.target.value)||0,n={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};n.install=a>0?a:0,m("budgetCategories",n)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.storageReceiving",className:"block text-sm font-medium text-gray-700",children:"Storage & Receiving Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.storageReceiving",value:((g=(s=r.budgetCategories)==null?void 0:s.storageReceiving)==null?void 0:g.toString())||"",onChange:t=>{const a=parseFloat(t.target.value)||0,n={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};n.storageReceiving=a>0?a:0,m("budgetCategories",n)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.fuel",className:"block text-sm font-medium text-gray-700",children:"Fuel Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.fuel",value:((f=(h=r.budgetCategories)==null?void 0:h.fuel)==null?void 0:f.toString())||"",onChange:t=>{const a=parseFloat(t.target.value)||0,n={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};n.fuel=a>0?a:0,m("budgetCategories",n)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:u?j?"Updating...":"Creating...":j?"Update Project":"Create Project"})]})]})]})})})}function z({budget:o,designFee:d,budgetCategories:u,transactions:l,previewMode:j=!1}){const[r,B]=O.useState(!1),c=()=>!o&&o!==0?0:l.filter(h=>h.transaction_type==="Purchase").reduce((h,f)=>h+parseFloat(f.amount||"0"),0)+(d||0),R=()=>{if(!u)return[];const s=[];return[{key:"furnishings",label:i.FURNISHINGS},{key:"install",label:i.INSTALL},{key:"fuel",label:i.FUEL},{key:"storageReceiving",label:i.STORAGE_RECEIVING},{key:"kitchen",label:i.KITCHEN},{key:"propertyManagement",label:i.PROPERTY_MANAGEMENT},{key:"designFee",label:i.DESIGN_FEE}].forEach(({key:h,label:f})=>{const t=u[h]||0;if(f===i.DESIGN_FEE?d!=null&&d>0:t>0)if(f===i.DESIGN_FEE){const n=l.filter(x=>x.transaction_type==="Purchase"&&x.budget_category===i.DESIGN_FEE).reduce((x,C)=>x+parseFloat(C.amount||"0"),0),y=d&&d>0?n/d*100:0;s.push({category:f,budget:d||0,spent:Math.round(n),percentage:Math.min(y,100)})}else{const n=l.filter(x=>x.transaction_type==="Purchase"&&x.budget_category===f).reduce((x,C)=>x+parseFloat(C.amount||"0"),0),y=t>0?n/t*100:0;s.push({category:f,budget:t,spent:Math.round(n),percentage:Math.min(y,100)})}}),s},m=Math.round(c()),M=o&&o>0?m/o*100:0,N=R();let b=N,p=null;if(j){const s=N.find(g=>g.category===i.FURNISHINGS);s?b=[s]:o!=null&&o>0&&(p={category:"Overall Budget",budget:o,spent:m,percentage:M})}else{b=N.filter(h=>h.category===i.FURNISHINGS||r);const s=N.some(h=>h.category===i.FURNISHINGS);p=o!=null&&o>0&&(!s||r)?{category:"Overall Budget",budget:o,spent:m,percentage:M}:null}const w=s=>s>=100||s>=75?"bg-red-500":s>=50?"bg-yellow-500":"bg-green-500",F=s=>s>=100||s>=75?"text-red-600":s>=50?"text-yellow-600":"text-green-600",S=s=>s>=100||s>=75?"bg-green-500":s>=50?"bg-yellow-500":"bg-red-500",k=s=>s>=100||s>=75?"text-green-600":s>=50?"text-yellow-600":"text-red-600",E=s=>s===i.DESIGN_FEE||s==="Overall Budget"?s:`${s} Budget`,I=o!=null&&o>0,G=d!=null&&d>0,P=u&&Object.values(u).some(s=>s>0);return!I&&!G&&!P?null:j?e.jsxs("div",{className:"mb-6",children:[(b.length>0||p)&&e.jsx("div",{children:e.jsx("div",{className:"space-y-4",children:[...b,...p?[p]:[]].map(s=>{const g=s.category===i.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:E(s.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(s.spent).toLocaleString("en-US")," ",g?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${g?k(s.percentage):F(s.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((s.budget||0)-s.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${g?S(s.percentage):w(s.percentage)}`,style:{width:`${Math.min(s.percentage,100)}%`}})})})]},s.category)})})}),!o&&!d&&(!u||Object.values(u).every(s=>s===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]}):e.jsxs("div",{className:"mb-6",children:[(b.length>0||p)&&e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:[...b,...p?[p]:[]].map(s=>{const g=s.category===i.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:E(s.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(s.spent).toLocaleString("en-US")," ",g?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${g?k(s.percentage):F(s.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((s.budget||0)-s.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${g?S(s.percentage):w(s.percentage)}`,style:{width:`${Math.min(s.percentage,100)}%`}})})})]},s.category)})}),(N.some(s=>s.category!==i.FURNISHINGS&&s.category!==i.DESIGN_FEE)||o!=null&&o>0)&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>B(!r),className:"inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Show All Budget Categories"]})})})]}),!o&&!d&&(!u||Object.values(u).every(s=>s===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]})}export{z as B,V as P};
//# sourceMappingURL=BudgetProgress.js.map
