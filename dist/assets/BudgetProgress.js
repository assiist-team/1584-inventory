import{j as e,B as d}from"./index.js";import{r as j}from"./vendor.js";import{b as X,D as C,n as Y,h as J}from"./ui.js";function D({onSubmit:y,onCancel:g,isLoading:m=!1,initialData:o}){var R,F,P,T,_,w,V,N,f,H,M,I,O,$;const B=!!(o!=null&&o.name),[r,A]=j.useState({name:(o==null?void 0:o.name)||"",description:(o==null?void 0:o.description)||"",clientName:(o==null?void 0:o.clientName)||"",budget:(o==null?void 0:o.budget)||void 0,designFee:(o==null?void 0:o.designFee)||void 0,budgetCategories:(o==null?void 0:o.budgetCategories)||void 0}),[h,G]=j.useState({}),u=(s,n)=>{if(s==="budgetCategories"&&typeof n=="object")A(a=>({...a,[s]:n}));else{const a=typeof n=="number"&&n===0?void 0:n;A(x=>({...x,[s]:a}))}h[s]&&G(a=>({...a,[s]:""}))},U=()=>{const s={};return r.name.trim()||(s.name="Project name is required"),r.clientName.trim()||(s.clientName="Client name is required"),r.budget!==void 0&&(isNaN(r.budget)||r.budget<0)&&(s.budget="Budget must be a positive number"),r.designFee!==void 0&&(isNaN(r.designFee)||r.designFee<0)&&(s.designFee="Design fee must be a positive number"),G(s),Object.keys(s).length===0},L=async s=>{if(s.preventDefault(),!!U())try{const a=(x=>{if(x!=null){if(typeof x=="object"){const t=Object.fromEntries(Object.entries(x).filter(([l,c])=>c!==void 0));return Object.keys(t).length>0?t:void 0}return x}})(r);await y(a)}catch(n){console.error("Error submitting form:",n)}};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:B?"Edit":"Create"}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600",children:e.jsx(X,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Project Name *"}),e.jsx("input",{type:"text",id:"name",value:r.name,onChange:s=>u("name",s.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${h.name?"border-red-300":""}`,placeholder:"Enter project name"}),h.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-700",children:"Client Name *"}),e.jsx("input",{type:"text",id:"clientName",value:r.clientName,onChange:s=>u("clientName",s.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${h.clientName?"border-red-300":""}`,placeholder:"Enter client name"}),h.clientName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.clientName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",value:r.description,onChange:s=>u("description",s.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Enter project description"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budget",className:"block text-sm font-medium text-gray-700",children:"Budget (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budget",value:((R=r.budget)==null?void 0:R.toString())||"",onChange:s=>{const n=s.target.value.trim();if(n==="")u("budget",0);else{const a=parseFloat(n);u("budget",isNaN(a)?0:a)}},className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${h.budget?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),h.budget&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.budget})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"designFee",className:"block text-sm font-medium text-gray-700",children:"Design Fee (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"designFee",value:((F=r.designFee)==null?void 0:F.toString())||"",onChange:s=>{const n=s.target.value.trim();if(n==="")u("designFee",0);else{const a=parseFloat(n);u("designFee",isNaN(a)?0:a)}},className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${h.designFee?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),h.designFee&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.designFee})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Budget Categories (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set specific budgets for different project categories. These will be used to track spending by category."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.furnishings",className:"block text-sm font-medium text-gray-700",children:"Furnishings Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.furnishings",value:((T=(P=r.budgetCategories)==null?void 0:P.furnishings)==null?void 0:T.toString())||"",onChange:s=>{var x,t,l,c,i,p;const n=parseFloat(s.target.value)||0,a={designFee:((x=r.budgetCategories)==null?void 0:x.designFee)||0,furnishings:n>0?n:0,propertyManagement:((t=r.budgetCategories)==null?void 0:t.propertyManagement)||0,kitchen:((l=r.budgetCategories)==null?void 0:l.kitchen)||0,install:((c=r.budgetCategories)==null?void 0:c.install)||0,storageReceiving:((i=r.budgetCategories)==null?void 0:i.storageReceiving)||0,fuel:((p=r.budgetCategories)==null?void 0:p.fuel)||0};u("budgetCategories",a)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.propertyManagement",className:"block text-sm font-medium text-gray-700",children:"Property Management Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.propertyManagement",value:((w=(_=r.budgetCategories)==null?void 0:_.propertyManagement)==null?void 0:w.toString())||"",onChange:s=>{const n=parseFloat(s.target.value)||0,a={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};a.propertyManagement=n>0?n:0,u("budgetCategories",a)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.kitchen",className:"block text-sm font-medium text-gray-700",children:"Kitchen Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.kitchen",value:((N=(V=r.budgetCategories)==null?void 0:V.kitchen)==null?void 0:N.toString())||"",onChange:s=>{const n=parseFloat(s.target.value)||0,a={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};a.kitchen=n>0?n:0,u("budgetCategories",a)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.install",className:"block text-sm font-medium text-gray-700",children:"Install Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.install",value:((H=(f=r.budgetCategories)==null?void 0:f.install)==null?void 0:H.toString())||"",onChange:s=>{const n=parseFloat(s.target.value)||0,a={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};a.install=n>0?n:0,u("budgetCategories",a)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.storageReceiving",className:"block text-sm font-medium text-gray-700",children:"Storage & Receiving Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.storageReceiving",value:((I=(M=r.budgetCategories)==null?void 0:M.storageReceiving)==null?void 0:I.toString())||"",onChange:s=>{const n=parseFloat(s.target.value)||0,a={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};a.storageReceiving=n>0?n:0,u("budgetCategories",a)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.fuel",className:"block text-sm font-medium text-gray-700",children:"Fuel Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.fuel",value:(($=(O=r.budgetCategories)==null?void 0:O.fuel)==null?void 0:$.toString())||"",onChange:s=>{const n=parseFloat(s.target.value)||0,a={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...r.budgetCategories||{}};a.fuel=n>0?n:0,u("budgetCategories",a)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:m?B?"Updating...":"Creating...":B?"Update Project":"Create Project"})]})]})]})})})}function ee({budget:y,designFee:g,budgetCategories:m,transactions:o,previewMode:B=!1}){const[r,A]=j.useState(!1),h=async()=>{console.log("BudgetProgress - calculateSpent: Starting calculation for",o.length,"transactions");let t=0;const l=o.filter(c=>(c.status||"").toLowerCase()!=="canceled"&&c.budget_category!==d.DESIGN_FEE);for(const c of l){console.log("BudgetProgress - Processing transaction:",{id:c.transaction_id,type:c.transaction_type,budget_category:c.budget_category,amount:c.amount});const i=parseFloat(c.amount||"0");console.log("BudgetProgress - Transaction amount:",i);const p=c.transaction_type==="Return"?-1:1,E=i*p;t+=E,console.log("BudgetProgress - Added",E,"to total. Running total:",t)}return console.log("BudgetProgress - Final total amount (excluding design fee):",t),t},G=async()=>{if(!m)return console.log("BudgetProgress - No budget categories provided"),[];console.log("BudgetProgress - Available budget categories:",m),console.log("BudgetProgress - Total transactions available:",o.length);const t=[],l=[{key:"furnishings",label:d.FURNISHINGS},{key:"install",label:d.INSTALL},{key:"fuel",label:d.FUEL},{key:"storageReceiving",label:d.STORAGE_RECEIVING},{key:"kitchen",label:d.KITCHEN},{key:"propertyManagement",label:d.PROPERTY_MANAGEMENT},{key:"designFee",label:d.DESIGN_FEE}];for(const{key:c,label:i}of l){const p=m[c]||0;if(i===d.DESIGN_FEE?g!=null&&g>0:p>0)if(i===d.DESIGN_FEE){const v=o.filter(S=>S.budget_category===d.DESIGN_FEE).reduce((S,b)=>{const q=parseFloat(b.amount||"0"),K=b.transaction_type==="Return"?-1:1;return S+q*K},0),k=g&&g>0?v/g*100:0;t.push({category:i,budget:g||0,spent:Math.round(v),percentage:Math.min(k,100)})}else{let v=0;const k=o.filter(b=>(b.status||"").toLowerCase()!=="canceled"&&b.budget_category===i);console.log(`BudgetProgress - Category ${i}: Found ${k.length} transactions`);for(const b of k){console.log(`BudgetProgress - Category ${i} - Processing transaction:`,{id:b.transaction_id,type:b.transaction_type,budget_category:b.budget_category,amount:b.amount});const q=parseFloat(b.amount||"0");console.log(`BudgetProgress - Category ${i} - Transaction amount:`,q);const K=b.transaction_type==="Return"?-1:1,z=q*K;v+=z,console.log(`BudgetProgress - Category ${i} - Added ${z} to category total. Running total:`,v)}const S=p>0?v/p*100:0;t.push({category:i,budget:p,spent:Math.round(v),percentage:Math.min(S,100)})}}return t},[u,U]=j.useState(0),[L,R]=j.useState(0),[F,P]=j.useState([]),[T,_]=j.useState(!0),[w,V]=j.useState(y||0);j.useEffect(()=>{(async()=>{console.log("BudgetProgress - useEffect triggered with:",{budget:y,designFee:g,budgetCategories:m,transactionCount:o.length}),_(!0);try{const l=await h(),c=await G(),i=m?Object.entries(m).reduce((v,[k,S])=>k==="designFee"?v:v+(S||0),0):0,p=Math.round(l),E=i>0?p/i*100:0;console.log("BudgetProgress - Final results:",{spentAmount:l,spentRounded:p,percentageValue:E,overallFromCategories:i,categoryDataLength:c.length}),U(p),R(E),P(c),V(i)}catch(l){console.error("Error calculating budget data:",l),U(0),R(0),P([])}finally{_(!1)}})()},[y,g,m,o]);let N=F,f=null;if(B){const t=F.find(l=>l.category===d.FURNISHINGS);t?N=[t]:w>0&&(f={category:"Overall Budget",budget:w,spent:u,percentage:L})}else N=F.filter(l=>l.category===d.FURNISHINGS||r),f=w>0&&r?{category:"Overall Budget",budget:w,spent:u,percentage:L}:null;const H=(()=>{const t=[...N||[]];return f&&t.push(f),t})(),M=t=>t>=100||t>=75?"bg-red-500":t>=50?"bg-yellow-500":"bg-green-500",I=t=>t>=100||t>=75?"text-red-600":t>=50?"text-yellow-600":"text-green-600",O=t=>t>=100||t>=75?"bg-green-500":t>=50?"bg-yellow-500":"bg-red-500",$=t=>t>=100||t>=75?"text-green-600":t>=50?"text-yellow-600":"text-red-600",s=t=>t===d.DESIGN_FEE||t==="Overall Budget"?t:`${t} Budget`,n=w>0,a=g!=null&&g>0,x=m&&Object.values(m).some(t=>t>0);return T?e.jsx("div",{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded mb-4"})]})}):!n&&!a&&!x?null:B?e.jsxs("div",{children:[(N.length>0||f)&&e.jsx("div",{children:e.jsx("div",{className:"space-y-4",children:[...N,...f?[f]:[]].map(t=>{const l=t.category===d.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:s(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",l?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${l?$(t.percentage):I(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${l?O(t.percentage):M(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})})}),!y&&!g&&(!m||Object.values(m).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]}):e.jsxs("div",{children:[(N.length>0||f)&&e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:H.map(t=>{const l=t.category===d.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:s(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",l?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${l?$(t.percentage):I(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${l?O(t.percentage):M(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})}),(F.some(t=>t.category!==d.FURNISHINGS&&t.category!==d.DESIGN_FEE)||y!=null&&y>0)&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>A(!r),className:"inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Show All Budget Categories"]})})})]}),!y&&!g&&(!m||Object.values(m).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]})}export{ee as B,D as P};
//# sourceMappingURL=BudgetProgress.js.map
