import{j as e,B as u}from"./index.js";import{r as I}from"./vendor.js";import{b as A,D as v,n as L,o as T}from"./ui.js";function V({onSubmit:o,onCancel:g,isLoading:d=!1,initialData:a}){var k,F,p,S,E,B,M,s,f,b,h,j,P,y;const x=!!(a!=null&&a.name),[t,w]=I.useState({name:(a==null?void 0:a.name)||"",description:(a==null?void 0:a.description)||"",clientName:(a==null?void 0:a.clientName)||"",budget:(a==null?void 0:a.budget)||void 0,designFee:(a==null?void 0:a.designFee)||void 0,budgetCategories:(a==null?void 0:a.budgetCategories)||void 0}),[i,c]=I.useState({}),m=(r,n)=>{if(r==="budgetCategories"&&typeof n=="object")w(l=>({...l,[r]:n}));else{const l=typeof n=="number"&&n===0?void 0:n;w(R=>({...R,[r]:l}))}i[r]&&c(l=>({...l,[r]:""}))},C=()=>{const r={};return t.name.trim()||(r.name="Project name is required"),t.clientName.trim()||(r.clientName="Client name is required"),t.budget!==void 0&&(isNaN(t.budget)||t.budget<0)&&(r.budget="Budget must be a positive number"),t.designFee!==void 0&&(isNaN(t.designFee)||t.designFee<0)&&(r.designFee="Design fee must be a positive number"),c(r),Object.keys(r).length===0},N=async r=>{if(r.preventDefault(),!!C())try{await o(t)}catch(n){console.error("Error submitting form:",n)}};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:x?"Edit":"Create"}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600",children:e.jsx(A,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Project Name *"}),e.jsx("input",{type:"text",id:"name",value:t.name,onChange:r=>m("name",r.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${i.name?"border-red-300":""}`,placeholder:"Enter project name"}),i.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-700",children:"Client Name *"}),e.jsx("input",{type:"text",id:"clientName",value:t.clientName,onChange:r=>m("clientName",r.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${i.clientName?"border-red-300":""}`,placeholder:"Enter client name"}),i.clientName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.clientName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",value:t.description,onChange:r=>m("description",r.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Enter project description"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budget",className:"block text-sm font-medium text-gray-700",children:"Budget (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budget",value:((k=t.budget)==null?void 0:k.toString())||"",onChange:r=>m("budget",parseFloat(r.target.value)||0),className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${i.budget?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),i.budget&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.budget})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"designFee",className:"block text-sm font-medium text-gray-700",children:"Design Fee (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"designFee",value:((F=t.designFee)==null?void 0:F.toString())||"",onChange:r=>m("designFee",parseFloat(r.target.value)||0),className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${i.designFee?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),i.designFee&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.designFee})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Budget Categories (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set specific budgets for different project categories. These will be used to track spending by category."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.furnishings",className:"block text-sm font-medium text-gray-700",children:"Furnishings Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.furnishings",value:((S=(p=t.budgetCategories)==null?void 0:p.furnishings)==null?void 0:S.toString())||"",onChange:r=>{var R,$,_,O,G,U;const n=parseFloat(r.target.value)||0,l={designFee:((R=t.budgetCategories)==null?void 0:R.designFee)||0,furnishings:n>0?n:0,propertyManagement:(($=t.budgetCategories)==null?void 0:$.propertyManagement)||0,kitchen:((_=t.budgetCategories)==null?void 0:_.kitchen)||0,install:((O=t.budgetCategories)==null?void 0:O.install)||0,storageReceiving:((G=t.budgetCategories)==null?void 0:G.storageReceiving)||0,fuel:((U=t.budgetCategories)==null?void 0:U.fuel)||0};m("budgetCategories",l)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.propertyManagement",className:"block text-sm font-medium text-gray-700",children:"Property Management Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.propertyManagement",value:((B=(E=t.budgetCategories)==null?void 0:E.propertyManagement)==null?void 0:B.toString())||"",onChange:r=>{const n=parseFloat(r.target.value)||0,l={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...t.budgetCategories||{}};l.propertyManagement=n>0?n:0,m("budgetCategories",l)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.kitchen",className:"block text-sm font-medium text-gray-700",children:"Kitchen Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.kitchen",value:((s=(M=t.budgetCategories)==null?void 0:M.kitchen)==null?void 0:s.toString())||"",onChange:r=>{const n=parseFloat(r.target.value)||0,l={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...t.budgetCategories||{}};l.kitchen=n>0?n:0,m("budgetCategories",l)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.install",className:"block text-sm font-medium text-gray-700",children:"Install Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.install",value:((b=(f=t.budgetCategories)==null?void 0:f.install)==null?void 0:b.toString())||"",onChange:r=>{const n=parseFloat(r.target.value)||0,l={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...t.budgetCategories||{}};l.install=n>0?n:0,m("budgetCategories",l)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.storageReceiving",className:"block text-sm font-medium text-gray-700",children:"Storage & Receiving Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.storageReceiving",value:((j=(h=t.budgetCategories)==null?void 0:h.storageReceiving)==null?void 0:j.toString())||"",onChange:r=>{const n=parseFloat(r.target.value)||0,l={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...t.budgetCategories||{}};l.storageReceiving=n>0?n:0,m("budgetCategories",l)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.fuel",className:"block text-sm font-medium text-gray-700",children:"Fuel Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.fuel",value:((y=(P=t.budgetCategories)==null?void 0:P.fuel)==null?void 0:y.toString())||"",onChange:r=>{const n=parseFloat(r.target.value)||0,l={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...t.budgetCategories||{}};l.fuel=n>0?n:0,m("budgetCategories",l)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:d?x?"Updating...":"Creating...":x?"Update Project":"Create Project"})]})]})]})})})}function z({budget:o,designFee:g,budgetCategories:d,transactions:a}){const[x,t]=I.useState(!1),w=()=>!o&&o!==0?0:a.filter(b=>b.transaction_type==="Purchase").reduce((b,h)=>b+parseFloat(h.amount||"0"),0)+(g||0),i=()=>{if(!d)return[];const s=[];return[{key:"furnishings",label:u.FURNISHINGS},{key:"install",label:u.INSTALL},{key:"fuel",label:u.FUEL},{key:"storageReceiving",label:u.STORAGE_RECEIVING},{key:"kitchen",label:u.KITCHEN},{key:"propertyManagement",label:u.PROPERTY_MANAGEMENT},{key:"designFee",label:u.DESIGN_FEE}].forEach(({key:b,label:h})=>{const j=d[b]||0;if(h===u.DESIGN_FEE?g!=null&&g>0:j>0)if(h===u.DESIGN_FEE){const y=a.filter(n=>n.transaction_type==="Purchase"&&n.budget_category===u.DESIGN_FEE).reduce((n,l)=>n+parseFloat(l.amount||"0"),0),r=g&&g>0?y/g*100:0;s.push({category:h,budget:g||0,spent:Math.round(y),percentage:Math.min(r,100)})}else{const y=a.filter(n=>n.transaction_type==="Purchase"&&n.budget_category===h).reduce((n,l)=>n+parseFloat(l.amount||"0"),0),r=j>0?y/j*100:0;s.push({category:h,budget:j,spent:Math.round(y),percentage:Math.min(r,100)})}}),s},c=Math.round(w()),m=o&&o>0?c/o*100:0,C=i(),N=C.filter(s=>s.category===u.FURNISHINGS||x),F=o!=null&&o>0&&x?{category:"Overall Budget",budget:o,spent:c,percentage:m}:null,p=s=>s>=100?"bg-red-500":s>=80?"bg-yellow-500":"bg-green-500",S=s=>s>=100?"text-red-600":s>=80?"text-yellow-600":"text-green-600",E=s=>s>=100?"bg-green-500":s>=80?"bg-yellow-500":"bg-red-500",B=s=>s>=100?"text-green-600":s>=80?"text-yellow-600":"text-red-600",M=s=>s===u.DESIGN_FEE||s==="Overall Budget"?s:`${s} Budget`;return o==null&&(!d||Object.values(d).every(s=>s===0))?null:e.jsxs("div",{className:"mb-6",children:[N.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:[...N,...F?[F]:[]].map(s=>{const f=s.category===u.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:M(s.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(s.spent).toLocaleString("en-US")," ",f?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${f?B(s.percentage):S(s.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((s.budget||0)-s.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${f?E(s.percentage):p(s.percentage)}`,style:{width:`${Math.min(s.percentage,100)}%`}})})})]},s.category)})}),(C.some(s=>s.category!==u.FURNISHINGS)||o!=null&&o>0)&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>t(!x),className:"inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Show All Budget Categories"]})})})]}),!o&&!g&&(!d||Object.values(d).every(s=>s===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]})}function X({budget:o,designFee:g,budgetCategories:d,transactions:a}){const x=N=>N==null?0:a.filter(p=>p.transaction_type==="Purchase").reduce((p,S)=>p+parseFloat(S.amount||"0"),0)+(g||0),t=(d==null?void 0:d.furnishings)||o,w=d!=null&&d.furnishings?"furnishings":"overall";if(t==null||t===0)return e.jsx("div",{className:"text-center py-2",children:e.jsx("div",{className:"text-xs text-gray-500",children:"No budget set"})});const i=x(t),c=t>0?i/t*100:0,m=()=>c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-green-500",C=()=>c>=100?"text-red-600":c>=80?"text-yellow-600":"text-green-600";return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:w==="furnishings"?"Furnishings":"Budget"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["$",i.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("div",{className:`text-xs ${C()}`,children:[c.toFixed(0),"%"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${m()}`,style:{width:`${Math.min(c,100)}%`}})})}),e.jsxs("div",{className:"mt-1 flex justify-between items-center text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["$",t.toLocaleString("en-US")]}),e.jsx("div",{className:"flex items-center",children:c>=100?e.jsx("span",{className:"text-red-600",children:"⚠️ Over budget"}):c>=80?e.jsxs("span",{className:"text-yellow-600",children:["⚠️ ",(100-c).toFixed(0),"% left"]}):e.jsxs("span",{className:"text-green-600",children:["✅ $",(t-i).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," left"]})})]})]})}export{z as B,X as C,V as P};
//# sourceMappingURL=BudgetProgress.js.map
