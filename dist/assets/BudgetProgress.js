import{j as e,B as c}from"./index.js";import{r as j}from"./vendor.js";import{b as q,D as N,n as K,h as z}from"./ui.js";function Q({onSubmit:l,onCancel:d,isLoading:g=!1,initialData:a}){var F,y,S,G,k,b,x,B,E,R,P,M,U,L;const C=!!(a!=null&&a.name),[n,_]=j.useState({name:(a==null?void 0:a.name)||"",description:(a==null?void 0:a.description)||"",clientName:(a==null?void 0:a.clientName)||"",budget:(a==null?void 0:a.budget)||void 0,designFee:(a==null?void 0:a.designFee)||void 0,budgetCategories:(a==null?void 0:a.budgetCategories)||void 0}),[u,$]=j.useState({}),m=(r,t)=>{if(r==="budgetCategories"&&typeof t=="object")_(s=>({...s,[r]:t}));else{const s=typeof t=="number"&&t===0?void 0:t;_(o=>({...o,[r]:s}))}u[r]&&$(s=>({...s,[r]:""}))},O=()=>{const r={};return n.name.trim()||(r.name="Project name is required"),n.clientName.trim()||(r.clientName="Client name is required"),n.budget!==void 0&&(isNaN(n.budget)||n.budget<0)&&(r.budget="Budget must be a positive number"),n.designFee!==void 0&&(isNaN(n.designFee)||n.designFee<0)&&(r.designFee="Design fee must be a positive number"),$(r),Object.keys(r).length===0},A=async r=>{if(r.preventDefault(),!!O())try{const s=(o=>{if(o!=null){if(typeof o=="object"){const i=Object.fromEntries(Object.entries(o).filter(([h,v])=>v!==void 0));return Object.keys(i).length>0?i:void 0}return o}})(n);await l(s)}catch(t){console.error("Error submitting form:",t)}};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:C?"Edit":"Create"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Project Name *"}),e.jsx("input",{type:"text",id:"name",value:n.name,onChange:r=>m("name",r.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.name?"border-red-300":""}`,placeholder:"Enter project name"}),u.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-700",children:"Client Name *"}),e.jsx("input",{type:"text",id:"clientName",value:n.clientName,onChange:r=>m("clientName",r.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.clientName?"border-red-300":""}`,placeholder:"Enter client name"}),u.clientName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.clientName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",value:n.description,onChange:r=>m("description",r.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Enter project description"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budget",className:"block text-sm font-medium text-gray-700",children:"Budget (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budget",value:((F=n.budget)==null?void 0:F.toString())||"",onChange:r=>{const t=r.target.value.trim();if(t==="")m("budget",0);else{const s=parseFloat(t);m("budget",isNaN(s)?0:s)}},className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.budget?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),u.budget&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.budget})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"designFee",className:"block text-sm font-medium text-gray-700",children:"Design Fee (Optional)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"designFee",value:((y=n.designFee)==null?void 0:y.toString())||"",onChange:r=>{const t=r.target.value.trim();if(t==="")m("designFee",0);else{const s=parseFloat(t);m("designFee",isNaN(s)?0:s)}},className:`block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${u.designFee?"border-red-300":""}`,placeholder:"0.00",min:"0",step:"0.01"})]}),u.designFee&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.designFee})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Budget Categories (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set specific budgets for different project categories. These will be used to track spending by category."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.furnishings",className:"block text-sm font-medium text-gray-700",children:"Furnishings Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.furnishings",value:((G=(S=n.budgetCategories)==null?void 0:S.furnishings)==null?void 0:G.toString())||"",onChange:r=>{var o,i,h,v,f,w;const t=parseFloat(r.target.value)||0,s={designFee:((o=n.budgetCategories)==null?void 0:o.designFee)||0,furnishings:t>0?t:0,propertyManagement:((i=n.budgetCategories)==null?void 0:i.propertyManagement)||0,kitchen:((h=n.budgetCategories)==null?void 0:h.kitchen)||0,install:((v=n.budgetCategories)==null?void 0:v.install)||0,storageReceiving:((f=n.budgetCategories)==null?void 0:f.storageReceiving)||0,fuel:((w=n.budgetCategories)==null?void 0:w.fuel)||0};m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.propertyManagement",className:"block text-sm font-medium text-gray-700",children:"Property Management Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.propertyManagement",value:((b=(k=n.budgetCategories)==null?void 0:k.propertyManagement)==null?void 0:b.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.propertyManagement=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.kitchen",className:"block text-sm font-medium text-gray-700",children:"Kitchen Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.kitchen",value:((B=(x=n.budgetCategories)==null?void 0:x.kitchen)==null?void 0:B.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.kitchen=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.install",className:"block text-sm font-medium text-gray-700",children:"Install Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.install",value:((R=(E=n.budgetCategories)==null?void 0:E.install)==null?void 0:R.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.install=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.storageReceiving",className:"block text-sm font-medium text-gray-700",children:"Storage & Receiving Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.storageReceiving",value:((M=(P=n.budgetCategories)==null?void 0:P.storageReceiving)==null?void 0:M.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.storageReceiving=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"budgetCategories.fuel",className:"block text-sm font-medium text-gray-700",children:"Fuel Budget"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"number",id:"budgetCategories.fuel",value:((L=(U=n.budgetCategories)==null?void 0:U.fuel)==null?void 0:L.toString())||"",onChange:r=>{const t=parseFloat(r.target.value)||0,s={designFee:0,furnishings:0,propertyManagement:0,kitchen:0,install:0,storageReceiving:0,fuel:0,...n.budgetCategories||{}};s.fuel=t>0?t:0,m("budgetCategories",s)},className:"block w-full pl-10 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:g,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:g?C?"Updating...":"Creating...":C?"Update Project":"Create Project"})]})]})]})})})}function W({budget:l,designFee:d,budgetCategories:g,transactions:a,previewMode:C=!1}){const[n,_]=j.useState(!1),u=async()=>{if(!l&&l!==0)return 0;console.log("BudgetProgress - calculateSpent: Starting calculation for",a.length,"transactions");let t=0;const s=a.filter(o=>(o.status||"").toLowerCase()!=="canceled");for(const o of s){console.log("BudgetProgress - Processing transaction:",{id:o.transaction_id,type:o.transaction_type,budget_category:o.budget_category,amount:o.amount});const i=parseFloat(o.amount||"0");console.log("BudgetProgress - Transaction amount:",i);const h=o.transaction_type==="Return"?-1:1,v=i*h;t+=v,console.log("BudgetProgress - Added",v,"to total. Running total:",t)}return console.log("BudgetProgress - Final total amount:",t),t},$=async()=>{if(!g)return console.log("BudgetProgress - No budget categories provided"),[];console.log("BudgetProgress - Available budget categories:",g),console.log("BudgetProgress - Total transactions available:",a.length);const t=[],s=[{key:"furnishings",label:c.FURNISHINGS},{key:"install",label:c.INSTALL},{key:"fuel",label:c.FUEL},{key:"storageReceiving",label:c.STORAGE_RECEIVING},{key:"kitchen",label:c.KITCHEN},{key:"propertyManagement",label:c.PROPERTY_MANAGEMENT},{key:"designFee",label:c.DESIGN_FEE}];for(const{key:o,label:i}of s){const h=g[o]||0;if(i===c.DESIGN_FEE?d!=null&&d>0:h>0)if(i===c.DESIGN_FEE){const f=a.filter(I=>I.budget_category===c.DESIGN_FEE).reduce((I,p)=>{const T=parseFloat(p.amount||"0"),V=p.transaction_type==="Return"?-1:1;return I+T*V},0),w=d&&d>0?f/d*100:0;t.push({category:i,budget:d||0,spent:Math.round(f),percentage:Math.min(w,100)})}else{let f=0;const w=a.filter(p=>(p.status||"").toLowerCase()!=="canceled"&&p.budget_category===i);console.log(`BudgetProgress - Category ${i}: Found ${w.length} transactions`);for(const p of w){console.log(`BudgetProgress - Category ${i} - Processing transaction:`,{id:p.transaction_id,type:p.transaction_type,budget_category:p.budget_category,amount:p.amount});const T=parseFloat(p.amount||"0");console.log(`BudgetProgress - Category ${i} - Transaction amount:`,T);const V=p.transaction_type==="Return"?-1:1,H=T*V;f+=H,console.log(`BudgetProgress - Category ${i} - Added ${H} to category total. Running total:`,f)}const I=h>0?f/h*100:0;t.push({category:i,budget:h,spent:Math.round(f),percentage:Math.min(I,100)})}}return t},[m,O]=j.useState(0),[A,F]=j.useState(0),[y,S]=j.useState([]),[G,k]=j.useState(!0);j.useEffect(()=>{(async()=>{console.log("BudgetProgress - useEffect triggered with:",{budget:l,designFee:d,budgetCategories:g,transactionCount:a.length}),k(!0);try{const s=await u(),o=await $(),i=Math.round(s),h=l&&l>0?i/l*100:0;console.log("BudgetProgress - Final results:",{spentAmount:s,spentRounded:i,percentageValue:h,categoryDataLength:o.length}),O(i),F(h),S(o)}catch(s){console.error("Error calculating budget data:",s),O(0),F(0),S([])}finally{k(!1)}})()},[l,d,g,a]);let b=y,x=null;if(C){const t=y.find(s=>s.category===c.FURNISHINGS);t?b=[t]:l!=null&&l>0&&(x={category:"Overall Budget",budget:l,spent:m,percentage:A})}else{b=y.filter(o=>o.category===c.FURNISHINGS||n);const t=y.some(o=>o.category===c.FURNISHINGS);x=l!=null&&l>0&&(!t||n)?{category:"Overall Budget",budget:l,spent:m,percentage:A}:null}const B=t=>t>=100||t>=75?"bg-red-500":t>=50?"bg-yellow-500":"bg-green-500",E=t=>t>=100||t>=75?"text-red-600":t>=50?"text-yellow-600":"text-green-600",R=t=>t>=100||t>=75?"bg-green-500":t>=50?"bg-yellow-500":"bg-red-500",P=t=>t>=100||t>=75?"text-green-600":t>=50?"text-yellow-600":"text-red-600",M=t=>t===c.DESIGN_FEE||t==="Overall Budget"?t:`${t} Budget`,U=l!=null&&l>0,L=d!=null&&d>0,r=g&&Object.values(g).some(t=>t>0);return G?e.jsx("div",{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded mb-4"})]})}):!U&&!L&&!r?null:C?e.jsxs("div",{children:[(b.length>0||x)&&e.jsx("div",{children:e.jsx("div",{className:"space-y-4",children:[...b,...x?[x]:[]].map(t=>{const s=t.category===c.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:M(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",s?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${s?P(t.percentage):E(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${s?R(t.percentage):B(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})})}),!l&&!d&&(!g||Object.values(g).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]}):e.jsxs("div",{children:[(b.length>0||x)&&e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:[...b,...x?[x]:[]].map(t=>{const s=t.category===c.DESIGN_FEE;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-base font-medium text-gray-900",children:M(t.category)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["$",Math.round(t.spent).toLocaleString("en-US")," ",s?"received":"spent"]}),e.jsxs("span",{className:`text-sm ${s?P(t.percentage):E(t.percentage)}`,children:[e.jsxs("span",{className:"font-bold",children:["$",Math.round((t.budget||0)-t.spent).toLocaleString("en-US")]})," remaining"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${s?R(t.percentage):B(t.percentage)}`,style:{width:`${Math.min(t.percentage,100)}%`}})})})]},t.category)})}),(y.some(t=>t.category!==c.FURNISHINGS&&t.category!==c.DESIGN_FEE)||l!=null&&l>0)&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>_(!n),className:"inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Show All Budget Categories"]})})})]}),!l&&!d&&(!g||Object.values(g).every(t=>t===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No budgets configured for this project."})})]})}export{W as B,Q as P};
//# sourceMappingURL=BudgetProgress.js.map
