import{u as L,d as E,j as e}from"./index.js";import{r as i}from"./vendor.js";import{L as A}from"./router.js";import{u as D}from"./useNavigationContext.js";import{p as j,t as k}from"./inventoryService.js";import{B,P as T}from"./BudgetProgress.js";import{C as O}from"./ContextLink.js";import{F as u,f as N}from"./ui.js";import"./supabase.js";import"./taxPresetsService.js";import"./CategorySelect.js";function W(){const{buildContextUrl:w}=D(),{user:l}=L(),{currentAccountId:t,loading:a}=E(),[p,d]=i.useState([]),[v,c]=i.useState({}),[P,f]=i.useState(!1),[C,g]=i.useState(!1),h=a||P;i.useEffect(()=>{console.log("ðŸ” Projects - useEffect triggered. accountLoading:",a,"currentAccountId:",t,"isLoading:",h);let s;const m=r=>{t&&(s=j.subscribeToProjects(t,n=>{d(n),b(n)},r))},b=async r=>{if(!t||r.length===0){c({});return}try{const n=r.map(o=>o.id),F=await k.getTransactionsForProjects(t,n,r),x={};F.forEach(o=>{o.projectId&&(x[o.projectId]||(x[o.projectId]=[]),x[o.projectId].push(o))}),c(x)}catch(n){console.error("Error loading transactions for projects:",n),c({})}};return(async()=>{if(console.log("ðŸ” Projects - loadInitialData called. accountLoading:",a,"currentAccountId:",t),a){console.log("ðŸ” Projects - Account still loading, waiting...");return}if(t){console.log("ðŸ” Projects - Loading projects for account:",t),f(!0);try{const r=await j.getProjects(t);console.log("ðŸ” Projects - Loaded",r.length,"projects"),d(r),await b(r),m(r)}catch(r){console.error("Error loading initial projects data:",r),d([]),c({})}finally{f(!1)}}else console.log("ðŸ” Projects - No account ID, clearing data"),f(!1),d([]),c({})})(),()=>{s&&s()}},[t,a]);const I=async s=>{if(!(l!=null&&l.email))throw new Error("User must be authenticated to create projects");if(!t)throw new Error("Account ID is required to create projects");try{await j.createProject(t,{...s,createdBy:l.id}),g(!1)}catch(m){throw console.error("Error creating project:",m),m}},y=()=>{g(!0)},S=()=>{g(!1)};return!h&&!a&&!t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Projects"})}),e.jsx("div",{className:"bg-white shadow rounded-lg border border-yellow-200 bg-yellow-50",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"mx-auto h-12 w-12 text-yellow-600"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Account Selected"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Please select or create an account to view projects."}),e.jsx("div",{className:"mt-6",children:e.jsx(A,{to:"/settings",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Go to Settings"})})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Projects"})}),e.jsx("div",{className:"flex space-x-3",children:e.jsxs("button",{onClick:y,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"New"]})})]}),h?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading projects..."})]})}):p.length===0?e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No projects yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Create your first project to start organizing your inventory."}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:y,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Create Project"]})})]})})}):e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:p.map(s=>e.jsx("div",{className:"bg-white shadow rounded-lg border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"h-8 w-8 text-primary-600 mr-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name})]})}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"text-sm font-normal text-gray-900 ml-11",children:s.clientName})}),e.jsx("div",{className:"mb-4",children:e.jsx(B,{budget:s.budget,designFee:s.designFee,budgetCategories:s.budgetCategories,transactions:v[s.id]||[],previewMode:!0})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(O,{to:w(`/project/${s.id}`),className:"flex-1 inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Open Project"]})})]})},s.id))}),C&&e.jsx(T,{onSubmit:I,onCancel:S})]})}export{W as default};
//# sourceMappingURL=Projects.js.map
