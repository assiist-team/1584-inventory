import{v as l,s as m,w as h,x as f,d as N,j as i}from"./index.js";import{r as u}from"./vendor.js";const S={async getCategories(s,a=!1){await l();let e=m.from("budget_categories").select("*").eq("account_id",s).order("name",{ascending:!0});a||(e=e.eq("is_archived",!1));const{data:c,error:r}=await e;return h(r),(c||[]).map(t=>{const o=f(t);return{id:o.id,accountId:o.account_id,name:o.name,slug:o.slug,isArchived:o.is_archived||!1,metadata:o.metadata||null,createdAt:o.created_at,updatedAt:o.updated_at}})},async getCategory(s,a){await l();const{data:e,error:c}=await m.from("budget_categories").select("*").eq("id",a).eq("account_id",s).single();if(h(c,{returnNullOnNotFound:!0}),!e)return null;const r=f(e);return{id:r.id,accountId:r.account_id,name:r.name,slug:r.slug,isArchived:r.is_archived||!1,metadata:r.metadata||null,createdAt:r.created_at,updatedAt:r.updated_at}},async createCategory(s,a,e){if(await l(),!a||a.trim().length===0)throw new Error("Category name is required");const c=(a||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),{data:r,error:t}=await m.from("budget_categories").insert({account_id:s,name:a.trim(),slug:c,metadata:e||null,is_archived:!1}).select().single();h(t);const o=f(r);return{id:o.id,accountId:o.account_id,name:o.name,slug:o.slug,isArchived:o.is_archived||!1,metadata:o.metadata||null,createdAt:o.created_at,updatedAt:o.updated_at}},async updateCategory(s,a,e){if(await l(),!await this.getCategory(s,a))throw new Error("Category not found or does not belong to this account");const r={updated_at:new Date().toISOString()};if(e.name!==void 0){if(!e.name||e.name.trim().length===0)throw new Error("Category name cannot be empty");r.name=e.name.trim()}if(e.slug!==void 0){if(!e.slug||e.slug.trim().length===0)throw new Error("Category slug cannot be empty");r.slug=e.slug.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}e.metadata!==void 0&&(r.metadata=e.metadata);const{data:t,error:o}=await m.from("budget_categories").update(r).eq("id",a).eq("account_id",s).select().single();h(o);const n=f(t);return{id:n.id,accountId:n.account_id,name:n.name,slug:n.slug,isArchived:n.is_archived||!1,metadata:n.metadata||null,createdAt:n.created_at,updatedAt:n.updated_at}},async archiveCategory(s,a){if(await l(),!await this.getCategory(s,a))throw new Error("Category not found or does not belong to this account");const{data:c,error:r}=await m.from("budget_categories").update({is_archived:!0,updated_at:new Date().toISOString()}).eq("id",a).eq("account_id",s).select().single();h(r);const t=f(c);return{id:t.id,accountId:t.account_id,name:t.name,slug:t.slug,isArchived:t.is_archived||!1,metadata:t.metadata||null,createdAt:t.created_at,updatedAt:t.updated_at}},async unarchiveCategory(s,a){if(await l(),!await this.getCategory(s,a))throw new Error("Category not found or does not belong to this account");const{data:c,error:r}=await m.from("budget_categories").update({is_archived:!1,updated_at:new Date().toISOString()}).eq("id",a).eq("account_id",s).select().single();h(r);const t=f(c);return{id:t.id,accountId:t.account_id,name:t.name,slug:t.slug,isArchived:t.is_archived||!1,metadata:t.metadata||null,createdAt:t.created_at,updatedAt:t.updated_at}},async deleteCategory(s,a){await this.archiveCategory(s,a)},async getTransactionCount(s,a){await l();const{count:e,error:c}=await m.from("transactions").select("*",{count:"exact",head:!0}).eq("account_id",s).eq("category_id",a);return h(c),e||0},async getTransactionCounts(s,a){await l();const e=new Map,{data:c,error:r}=await m.from("transactions").select("category_id").eq("account_id",s).in("category_id",a);return h(r),a.forEach(t=>e.set(t,0)),c&&c.forEach(t=>{if(t.category_id){const o=e.get(t.category_id)||0;e.set(t.category_id,o+1)}}),e},async bulkArchiveCategories(s,a){await l();const e=[],c=[];for(const r of a)try{await this.archiveCategory(s,r),e.push(r)}catch(t){c.push({categoryId:r,reason:t instanceof Error?t.message:"Failed to archive category"})}return{successful:e,failed:c}}};function D({value:s,onChange:a,label:e="Budget Category",error:c,helperText:r,disabled:t=!1,includeArchived:o=!1,id:n,className:y,required:p=!1,asDropdown:_=!1}){const{currentAccountId:g,loading:b}=N(),[x,q]=u.useState([]),[L,w]=u.useState(!0),[F,j]=u.useState(null),A=u.useCallback(async()=>{if(g)try{w(!0),j(null);const d=await S.getCategories(g,o);q(d)}catch(d){console.error("Error loading budget categories:",d),j("Failed to load categories")}finally{w(!1)}},[g,o]);u.useEffect(()=>{b||(g?A():w(!1))},[g,b,A]);const E=d=>{const C=d.target.value;a&&a(C)},I=d=>{const C=d.target.value;a&&a(C)},v=c||F;return i.jsxs("div",{className:"space-y-1",children:[e&&i.jsx("label",{htmlFor:n,className:"block text-sm font-medium text-gray-700",style:{color:"#374151"},children:e}),i.jsx("div",{className:y,children:L?i.jsx("p",{className:"text-sm text-gray-500",children:"Loading categories..."}):x.length===0?i.jsx("p",{className:"text-sm text-gray-500",children:"No categories available"}):i.jsx(i.Fragment,{children:_?i.jsx("div",{children:i.jsxs("select",{id:n,value:s||"",onChange:I,disabled:t,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm",children:[!p&&i.jsx("option",{value:"",children:"None"}),x.map(d=>i.jsx("option",{value:d.id,children:d.name},d.id))]})}):i.jsx("fieldset",{id:n,children:i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:[p?null:i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{id:n?`${n}-none`:"category-none",name:n||"category",type:"radio",value:"",checked:!s,onChange:E,disabled:t,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),i.jsx("label",{htmlFor:n?`${n}-none`:"category-none",className:"ml-2 block text-sm text-gray-900",children:"None"})]}),x.map(d=>i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{id:n?`${n}-${d.id}`:`category-${d.id}`,name:n||"category",type:"radio",value:d.id,checked:s===d.id,onChange:E,disabled:t,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),i.jsx("label",{htmlFor:n?`${n}-${d.id}`:`category-${d.id}`,className:"ml-2 block text-sm text-gray-900",children:d.name})]},d.id))]})})})}),v&&i.jsx("p",{className:"text-sm text-red-600",style:{color:"#dc2626"},children:v}),r&&!v&&i.jsx("p",{className:"text-sm text-gray-500",style:{color:"#6b7280"},children:r})]})}function O(s=!1){const{currentAccountId:a,loading:e}=N(),[c,r]=u.useState([]),[t,o]=u.useState(!0),[n,y]=u.useState(null);return u.useEffect(()=>{if(e||!a){!e&&!a&&(o(!1),y("No account found"));return}(async()=>{try{o(!0),y(null);const _=await S.getCategories(a,s);r(_.map(g=>({id:g.id,name:g.name})))}catch(_){console.error("Error loading budget categories:",_),y("Failed to load categories")}finally{o(!1)}})()},[a,e,s]),{categories:c,isLoading:t,error:n}}export{D as C,S as b,O as u};
//# sourceMappingURL=CategorySelect.js.map
