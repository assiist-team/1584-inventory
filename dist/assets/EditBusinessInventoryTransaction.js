import{d as z,j as e,f as N,C as v}from"./index.js";import{r as o}from"./vendor.js";import{c as V,b as X,u as G,L as E}from"./router.js";import{p as H,t as I,b as J}from"./inventoryService.js";import{T as D}from"./transactionSources.js";import{g as Q}from"./taxPresetsService.js";import{g as Z,b as R,t as O}from"./ui.js";import"./supabase.js";function le(){const{projectId:g,transactionId:u}=V(),C=X(),w=G(),{currentAccountId:c}=z(),[A,L]=o.useState(!0),[x,h]=o.useState(!1),[M,$]=o.useState([]),[B,q]=o.useState(null),[r,k]=o.useState({projectId:"",transactionDate:"",source:"",transactionType:"Purchase",paymentMethod:"Pending",amount:"",budgetCategory:"Furnishings",notes:"",status:"pending",reimbursementType:"",triggerEvent:"Manual",receiptEmailed:!1}),[n,m]=o.useState({}),[_,p]=o.useState(!1),[l,y]=o.useState(void 0),[d,T]=o.useState(""),[b,U]=o.useState([]),[S,F]=o.useState(void 0),f=o.useMemo(()=>{const s=new URLSearchParams(w.search).get("returnTo");return s||"/business-inventory"},[w.search]);o.useEffect(()=>{(async()=>{if(c)try{const s=await Q(c);U(s)}catch(s){console.error("Error loading tax presets:",s)}})()},[c]),o.useEffect(()=>{if(l&&l!=="Other"){const t=b.find(s=>s.id===l);F(t==null?void 0:t.rate)}else F(void 0);n.general&&m(t=>({...t,general:""}))},[l,b]),o.useEffect(()=>{n.general&&m(t=>({...t,general:""}))},[d]),o.useEffect(()=>{(async()=>{if(!(!c||!u))try{const[s,a]=await Promise.all([H.getProjects(c),I.getTransaction(c,g||"",u)]);if($(s),a){q(a);const j=a.source||"",W=!!(j&&!D.includes(j));k({projectId:a.projectId||"",transactionDate:J(a.transactionDate)||"",source:j,transactionType:a.transactionType||"Purchase",paymentMethod:a.paymentMethod||"Pending",amount:a.amount,budgetCategory:a.budgetCategory||"Furnishings",notes:a.notes||"",status:a.status||"pending",reimbursementType:a.reimbursementType||"",triggerEvent:a.triggerEvent||"Manual",receiptEmailed:a.receiptEmailed||!1}),a.taxRatePreset&&y(a.taxRatePreset),T(a.subtotal||""),p(W)}}catch(s){console.error("Error loading data:",s)}finally{L(!1)}})()},[g,u,c]);const i=(t,s)=>{k(a=>({...a,[t]:s})),n[t]&&m(a=>({...a,[t]:""})),n.general&&m(a=>({...a,general:""}))},K=()=>{var s;const t={};return r.source.trim()||(t.source="Source is required"),(s=r.budgetCategory)!=null&&s.trim()||(t.budgetCategory="Budget category is required"),r.amount.trim()?(isNaN(Number(r.amount))||Number(r.amount)<=0)&&(t.amount="Amount must be a positive number"):t.amount="Amount is required",l==="Other"&&(!d.trim()||isNaN(Number(d))||Number(d)<=0?t.general="Subtotal must be provided and greater than 0 when Tax Rate Preset is Other.":Number(r.amount)<Number(d)&&(t.general="Subtotal cannot exceed the total amount.")),m(t),Object.keys(t).length===0},Y=async t=>{if(t.preventDefault(),!(!g||!u||!K())){h(!0);try{const s=r.projectId==="business-inventory"?null:r.projectId,a={...r,projectId:s,...l?{taxRatePreset:l,subtotal:l==="Other"?d:""}:{subtotal:""}};if(!c){m({general:"Account ID is required"}),h(!1);return}await I.updateTransaction(c,s||"",u,a),C("/business-inventory")}catch(s){console.error("Error updating transaction:",s),m({general:"Error updating transaction. Please try again."})}finally{h(!1)}}},P=()=>{C(f)};return A?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):B?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(E,{to:f,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Transaction"})}),e.jsxs("form",{onSubmit:Y,className:"space-y-6 p-6",children:[n.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:n.general})})]})})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"projectId",className:"block text-sm font-medium text-gray-700",children:"Project"}),e.jsxs("select",{id:"projectId",value:r.projectId,onChange:t=>i("projectId",t.target.value),className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${n.projectId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select a project..."}),e.jsx("option",{value:"business-inventory",children:"Business Inventory (No Project)"}),M.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.clientName]},t.id))]}),n.projectId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.projectId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Source/Vendor *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:D.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:t,checked:r.source===t,onChange:s=>{i("source",s.target.value),p(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:_,onChange:()=>{p(!0),i("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),_&&e.jsx("input",{type:"text",id:"source_custom_input",value:r.source,onChange:t=>i("source",t.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${n.source?"border-red-300":"border-gray-300"}`}),n.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.source})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Budget Category *"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_design_fee",name:"budgetCategory",value:"Design Fee",checked:r.budgetCategory==="Design Fee",onChange:t=>i("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_design_fee",className:"ml-2 block text-sm text-gray-900",children:"Design Fee"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_furnishings",name:"budgetCategory",value:"Furnishings",checked:r.budgetCategory==="Furnishings",onChange:t=>i("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_furnishings",className:"ml-2 block text-sm text-gray-900",children:"Furnishings"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_property_management",name:"budgetCategory",value:"Property Management",checked:r.budgetCategory==="Property Management",onChange:t=>i("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_property_management",className:"ml-2 block text-sm text-gray-900",children:"Property Management"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_kitchen",name:"budgetCategory",value:"Kitchen",checked:r.budgetCategory==="Kitchen",onChange:t=>i("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_kitchen",className:"ml-2 block text-sm text-gray-900",children:"Kitchen"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_install",name:"budgetCategory",value:"Install",checked:r.budgetCategory==="Install",onChange:t=>i("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_install",className:"ml-2 block text-sm text-gray-900",children:"Install"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_storage_receiving",name:"budgetCategory",value:"Storage & Receiving",checked:r.budgetCategory==="Storage & Receiving",onChange:t=>i("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_storage_receiving",className:"ml-2 block text-sm text-gray-900",children:"Storage & Receiving"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_fuel",name:"budgetCategory",value:"Fuel",checked:r.budgetCategory==="Fuel",onChange:t=>i("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_fuel",className:"ml-2 block text-sm text-gray-900",children:"Fuel"})]})]}),n.budgetCategory&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.budgetCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Type"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_purchase",name:"transactionType",value:"Purchase",checked:r.transactionType==="Purchase",onChange:t=>i("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_purchase",className:"ml-2 block text-sm text-gray-900",children:"Purchase"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_return",name:"transactionType",value:"Return",checked:r.transactionType==="Return",onChange:t=>i("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_return",className:"ml-2 block text-sm text-gray-900",children:"Return"})]})]}),n.transactionType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.transactionType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Reimbursement Type"}),e.jsx("p",{className:"mb-3 text-xs text-gray-500",children:"Flags transactions that require reimbursement"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_none",name:"reimbursementType",value:"",checked:!r.reimbursementType,onChange:t=>i("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_none",className:"ml-2 block text-sm text-gray-900",children:"None"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_client_owes",name:"reimbursementType",value:N,checked:r.reimbursementType===N,onChange:t=>i("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_client_owes",className:"ml-2 block text-sm text-gray-900",children:N})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_we_owe",name:"reimbursementType",value:v,checked:r.reimbursementType===v,onChange:t=>i("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_we_owe",className:"ml-2 block text-sm text-gray-900",children:v})]})]}),n.reimbursementType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.reimbursementType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Receipt Email Copy"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_yes",name:"receiptEmailed",checked:r.receiptEmailed===!0,onChange:()=>i("receiptEmailed",!0),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_yes",className:"ml-2 block text-sm text-gray-900",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_no",name:"receiptEmailed",checked:r.receiptEmailed===!1,onChange:()=>i("receiptEmailed",!1),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_no",className:"ml-2 block text-sm text-gray-900",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"amount",value:r.amount,onChange:t=>i("amount",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${n.amount?"border-red-300":"border-gray-300"}`})]}),n.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tax Rate Preset"}),e.jsxs("div",{className:"space-y-2",children:[b.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`tax_preset_${t.id}`,name:"taxRatePreset",value:t.id,checked:l===t.id,onChange:s=>y(s.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsxs("label",{htmlFor:`tax_preset_${t.id}`,className:"ml-2 block text-sm text-gray-900",children:[t.name," (",t.rate.toFixed(2),"%)"]})]},t.id)),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"tax_preset_other",name:"taxRatePreset",value:"Other",checked:l==="Other",onChange:t=>y(t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"tax_preset_other",className:"ml-2 block text-sm text-gray-900",children:"Other"})]})]}),l&&l!=="Other"&&S!==void 0&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Tax Rate:"})," ",S.toFixed(2),"%"]})})]}),l==="Other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subtotal"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"subtotal",value:d,onChange:t=>T(t.target.value),placeholder:"0.00",className:"block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 border-gray-300"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This will be used to calculate the tax rate."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transactionDate",className:"block text-sm font-medium text-gray-700",children:"Transaction Date"}),e.jsx("input",{type:"date",id:"transactionDate",value:r.transactionDate,onChange:t=>i("transactionDate",t.target.value),className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${n.transactionDate?"border-red-300":"border-gray-300"}`}),n.transactionDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.transactionDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:r.notes,onChange:t=>i("notes",t.target.value),placeholder:"Additional notes about this transaction...",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${n.notes?"border-red-300":"border-gray-300"}`}),n.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.notes})]}),e.jsxs("div",{className:"hidden sm:flex justify-end sm:space-x-3 pt-4",children:[e.jsxs("button",{onClick:P,className:"inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:x,className:"inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),x?"Updating...":"Update"]})]})]})]}),e.jsx("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:P,className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:x,onClick:t=>{var a;const s=(a=t.currentTarget.closest(".space-y-6"))==null?void 0:a.querySelector("form");s&&s.requestSubmit()},className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),x?"Updating...":"Update"]})]})}),e.jsx("div",{className:"sm:hidden h-20"})]}):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ§¾"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Transaction not found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"The transaction you're looking for doesn't exist or has been deleted."}),e.jsx(E,{to:f,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Business Inventory"})]})}export{le as default};
//# sourceMappingURL=EditBusinessInventoryTransaction.js.map
