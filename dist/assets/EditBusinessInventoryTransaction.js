import{j as e}from"./index.js";import{r as i}from"./vendor.js";import{b as P,c as I,u as T,L as b}from"./router.js";import{p as D,t as u,b as E}from"./inventoryService.js";import{e as B,b as L,p as R}from"./ui.js";import"./firebase.js";function K(){const{projectId:l,transactionId:c}=P(),x=I(),h=T(),[j,f]=i.useState(!0),[p,g]=i.useState(!1),[v,N]=i.useState([]),[_,w]=i.useState(null),[s,y]=i.useState({project_id:"",transaction_date:"",source:"",transaction_type:"Reimbursement",payment_method:"Pending",amount:"",budget_category:"Furnishings",notes:"",status:"pending",reimbursement_type:"Client Owes",trigger_event:"Manual",receipt_emailed:!1}),[a,d]=i.useState({}),m=i.useMemo(()=>{const n=new URLSearchParams(h.search).get("returnTo");return n||"/business-inventory"},[h.search]);i.useEffect(()=>{(async()=>{try{const[n,r]=await Promise.all([D.getProjects(),l&&c?u.getTransaction(l,c):c?u.getTransactionById(c).then(F=>F.transaction):null]);N(n),r&&(w(r),y({project_id:r.project_id||"",transaction_date:E(r.transaction_date)||"",source:r.source,transaction_type:r.transaction_type,payment_method:r.payment_method,amount:r.amount,budget_category:r.budget_category||"Furnishings",notes:r.notes||"",status:r.status||"pending",reimbursement_type:r.reimbursement_type||"Client Owes",trigger_event:r.trigger_event||"Manual",receipt_emailed:r.receipt_emailed}))}catch(n){console.error("Error loading data:",n)}finally{f(!1)}})()},[l,c]);const o=(t,n)=>{y(r=>({...r,[t]:n})),a[t]&&d(r=>({...r,[t]:""}))},k=()=>{const t={};return s.project_id||(t.project_id="Project selection is required"),s.source.trim()||(t.source="Source is required"),s.amount.trim()||(t.amount="Amount is required"),d(t),Object.keys(t).length===0},C=async t=>{if(t.preventDefault(),!(!l||!c||!k())){g(!0);try{const n=s.project_id==="business-inventory"?null:s.project_id,r={...s,project_id:n};await u.updateTransaction(n||"",c,r),x("/business-inventory")}catch(n){console.error("Error updating transaction:",n),d({general:"Error updating transaction. Please try again."})}finally{g(!1)}}},S=()=>{x(m)};return j?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):_?e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{to:m,className:"mr-4 p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(B,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Business Inventory Transaction"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update transaction details and information"})]})]})}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Project Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project_id",className:"block text-sm font-medium text-gray-700",children:"Project *"}),e.jsxs("select",{id:"project_id",value:s.project_id,onChange:t=>o("project_id",t.target.value),className:`mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm ${a.project_id?"border-red-300":""}`,children:[e.jsx("option",{value:"",children:"Select a project..."}),e.jsx("option",{value:"business-inventory",children:"Business Inventory (No Project)"}),v.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.clientName]},t.id))]}),a.project_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.project_id})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transaction_date",className:"block text-sm font-medium text-gray-700",children:"Transaction Date"}),e.jsx("input",{type:"date",id:"transaction_date",value:s.transaction_date,onChange:t=>o("transaction_date",t.target.value),className:`mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm ${a.transaction_date?"border-red-300":""}`}),a.transaction_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.transaction_date})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Transaction Details"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700",children:"Source *"}),e.jsx("input",{type:"text",id:"source",value:s.source,onChange:t=>o("source",t.target.value),className:`mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm ${a.source?"border-red-300":""}`,placeholder:"e.g., Inventory Allocation, Client Purchase"}),a.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsx("input",{type:"number",step:"0.01",id:"amount",value:s.amount,onChange:t=>o("amount",t.target.value),className:`mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm ${a.amount?"border-red-300":""}`,placeholder:"0.00"}),a.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.amount})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budget_category",className:"block text-sm font-medium text-gray-700",children:"Budget Category"}),e.jsxs("select",{id:"budget_category",value:s.budget_category,onChange:t=>o("budget_category",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[e.jsx("option",{value:"Furnishings",children:"Furnishings"}),e.jsx("option",{value:"Design Fee",children:"Design Fee"}),e.jsx("option",{value:"Property Management",children:"Property Management"}),e.jsx("option",{value:"Kitchen",children:"Kitchen"}),e.jsx("option",{value:"Install",children:"Install"}),e.jsx("option",{value:"Storage & Receiving",children:"Storage & Receiving"}),e.jsx("option",{value:"Fuel",children:"Fuel"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reimbursement_type",className:"block text-sm font-medium text-gray-700",children:"Reimbursement Type"}),e.jsxs("select",{id:"reimbursement_type",value:s.reimbursement_type,onChange:t=>o("reimbursement_type",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[e.jsx("option",{value:"Client owes us",children:"Client owes us"}),e.jsx("option",{value:"We owe client",children:"We owe client"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{id:"status",value:s.status,onChange:t=>o("status",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"canceled",children:"Canceled"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Additional Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:s.notes,onChange:t=>o("notes",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"Additional notes about this transaction..."})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"receipt_emailed",checked:s.receipt_emailed,onChange:t=>o("receipt_emailed",t.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"receipt_emailed",className:"ml-2 block text-sm text-gray-700",children:"Receipt emailed to client"})]})]})]}),a.general&&e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsx("div",{className:"text-sm text-red-800",children:a.general})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:S,className:"inline-flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors duration-200",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:p,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 disabled:opacity-50",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),p?"Updating Transaction...":"Update Transaction"]})]})]})]})})}):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ§¾"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Transaction not found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"The transaction you're looking for doesn't exist or has been deleted."}),e.jsx(b,{to:m,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Business Inventory"})]})}export{K as default};
//# sourceMappingURL=EditBusinessInventoryTransaction.js.map
