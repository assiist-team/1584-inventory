import{j as e}from"./index.js";import{r as n}from"./vendor.js";import{b as _,K as H,N as Q,Z as V,O as q,R as J,Q as ee,z as te,j as I,V as P,W as se,T,f as Z}from"./ui.js";function $({images:r,initialIndex:f=0,onClose:g}){const[p,b]=n.useState(f),[M,w]=n.useState(!1),[c,y]=n.useState(1),[C,h]=n.useState(0),[v,d]=n.useState(0),[N,j]=n.useState(!1),[k,D]=n.useState({x:0,y:0}),o=n.useRef(null),u=n.useRef(null);n.useEffect(()=>{y(1),h(0),d(0)},[p]);const l=n.useCallback(()=>{y(t=>Math.min(t+.5,5))},[]),i=n.useCallback(()=>{y(t=>{const s=Math.max(t-.5,1);return s===1&&(h(0),d(0)),s})},[]),m=n.useCallback(()=>{y(1),h(0),d(0)},[]);n.useEffect(()=>{const t=s=>{if(c>1)switch(s.key){case"ArrowLeft":s.preventDefault(),h(a=>Math.min(0,a+50));return;case"ArrowRight":s.preventDefault(),h(a=>Math.max(0,a-50));return;case"ArrowUp":s.preventDefault(),d(a=>Math.min(0,a+50));return;case"ArrowDown":s.preventDefault(),d(a=>Math.max(0,a-50));return}switch(s.key){case"Escape":c>1?m():g();break;case"ArrowLeft":s.preventDefault(),b(a=>a>0?a-1:r.length-1);break;case"ArrowRight":s.preventDefault(),b(a=>a<r.length-1?a+1:0);break;case"+":case"=":s.preventDefault(),l();break;case"-":case"_":s.preventDefault(),i();break;case"0":s.preventDefault(),m();break}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[g,r.length,c,l,i,m]),n.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const x=r[p],X=()=>{b(t=>t>0?t-1:r.length-1),w(!1)},G=()=>{b(t=>t<r.length-1?t+1:0),w(!1)},A=t=>{t.preventDefault();const s=t.deltaY>0?-.2:.2,a=Math.max(1,Math.min(5,c+s));y(a),a===1&&(h(0),d(0))},O=t=>{c>1&&(j(!0),D({x:t.clientX-C,y:t.clientY-v}))},F=t=>{N&&c>1&&(h(t.clientX-k.x),d(t.clientY-k.y))},L=()=>{j(!1)},S=n.useRef(null),Y=t=>{const s=t[0],a=t[1];return Math.hypot(a.clientX-s.clientX,a.clientY-s.clientY)},B=t=>{const s=t[0],a=t[1];return{x:(s.clientX+a.clientX)/2,y:(s.clientY+a.clientY)/2}},R=t=>{if(t.touches.length===2){const s=Y(t.touches),a=B(t.touches);S.current={distance:s,centerX:a.x,centerY:a.y}}else t.touches.length===1&&c>1&&(j(!0),D({x:t.touches[0].clientX-C,y:t.touches[0].clientY-v}))},U=t=>{if(t.touches.length===2&&S.current){t.preventDefault();const s=Y(t.touches),a=S.current.distance,E=s/a,z=Math.max(1,Math.min(5,c*E));y(z),z===1&&(h(0),d(0))}else t.touches.length===1&&N&&c>1&&(t.preventDefault(),h(t.touches[0].clientX-k.x),d(t.touches[0].clientY-k.y))},K=()=>{S.current=null,j(!1)},W=t=>{if(t===0)return"0 Bytes";const s=1024,a=["Bytes","KB","MB","GB"],E=Math.floor(Math.log(t)/Math.log(s));return(t/Math.pow(s,E)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+" "+a[E]};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center p-4",children:[e.jsx("button",{onClick:g,className:"absolute top-4 right-4 z-10 p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Close gallery",children:e.jsx(_,{className:"h-6 w-6"})}),r.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:X,className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10 p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Previous image",children:e.jsx(H,{className:"h-8 w-8"})}),e.jsx("button",{onClick:G,className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Next image",children:e.jsx(Q,{className:"h-8 w-8"})})]}),e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("button",{onClick:l,className:"p-2 bg-black bg-opacity-50 text-white hover:bg-opacity-70 transition-colors rounded","aria-label":"Zoom in",title:"Zoom in (+)",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx("button",{onClick:i,disabled:c<=1,className:"p-2 bg-black bg-opacity-50 text-white hover:bg-opacity-70 transition-colors rounded disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Zoom out",title:"Zoom out (-)",children:e.jsx(q,{className:"h-5 w-5"})}),c>1&&e.jsx("button",{onClick:m,className:"p-2 bg-black bg-opacity-50 text-white hover:bg-opacity-70 transition-colors rounded","aria-label":"Reset zoom",title:"Reset zoom (0)",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsxs("div",{ref:o,className:"relative w-full h-full flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing",onWheel:A,onMouseDown:O,onMouseMove:F,onMouseUp:L,onMouseLeave:L,onTouchStart:R,onTouchMove:U,onTouchEnd:K,children:[e.jsx("img",{ref:u,src:x.url,alt:x.alt||x.fileName,className:"max-w-full max-h-full object-contain select-none",onLoad:()=>w(!0),style:{opacity:M?1:0,transition:c===1?"opacity 0.3s ease":"none",transform:`scale(${c}) translate(${C/c}px, ${v/c}px)`,cursor:c>1?"grab":"default"},draggable:!1}),!M&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium truncate",children:x.alt||x.fileName}),x.caption&&e.jsx("p",{className:"text-xs text-gray-300 mt-1",children:x.caption}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-400",children:[e.jsxs("span",{children:[p+1," of ",r.length]}),e.jsx("span",{children:W(x.size)}),e.jsx("span",{children:(()=>{try{return new Date(x.uploadedAt).toLocaleDateString()}catch(t){return console.warn("Invalid date for image:",x.uploadedAt,t),"Unknown date"}})()})]})]}),e.jsx("button",{onClick:()=>window.open(x.url,"_blank"),className:"p-2 text-white hover:text-gray-300 transition-colors ml-4","aria-label":"Download image",children:e.jsx(ee,{className:"h-4 w-4"})})]})}),r.length>1&&e.jsx("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 flex space-x-2",children:r.map((t,s)=>e.jsx("button",{onClick:()=>{b(s),w(!1)},className:`w-2 h-2 rounded-full transition-colors ${s===p?"bg-white":"bg-white bg-opacity-50"}`,"aria-label":`Go to image ${s+1}`},s))})]})}function ne({images:r,onAddImage:f,onRemoveImage:g,onSetPrimary:p,maxImages:b=5,showControls:M=!0,size:w="md",className:c=""}){const[y,C]=n.useState(!1),[h,v]=n.useState(0),[d,N]=n.useState(null),j={sm:"w-20 h-20 sm:w-16 sm:h-16",md:"w-24 h-24 sm:w-20 sm:h-20",lg:"w-28 h-28 sm:w-24 sm:h-24"},k=l=>{v(l),C(!0)},D=()=>{C(!1)},o=(l,i)=>{l.stopPropagation(),N(d===i?null:i)},u=(l,i,m,x)=>{switch(l.stopPropagation(),N(null),i){case"open":k(x);break;case"setPrimary":p==null||p(m);break;case"delete":g==null||g(m);break}};return n.useEffect(()=>{const l=i=>{d!==null&&!i.target.closest(".image-menu-container")&&N(null)};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[d]),r.length===0&&!f?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`space-y-3 ${c}`,children:[r.length>0&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4 md:gap-6",style:{width:"fit-content"},children:[r.map((l,i)=>e.jsxs("div",{className:`${j[w]} relative group cursor-pointer rounded-lg overflow-visible border-2 ${l.isPrimary?"border-primary-500 ring-2 ring-primary-200":"border-gray-200"}`,onClick:()=>k(i),children:[e.jsx("img",{src:l.url,alt:l.alt||l.fileName,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}),l.isPrimary&&e.jsx("div",{className:"absolute top-1 left-1 bg-primary-500 bg-opacity-40 text-white text-xs p-1 rounded flex items-center justify-center border border-white",children:e.jsx(te,{className:"h-3 w-3 fill-current"})}),M&&e.jsx("div",{className:"absolute inset-0 bg-transparent transition-all duration-200",children:e.jsxs("div",{className:"absolute top-1 right-1 image-menu-container",children:[e.jsx("button",{onClick:m=>o(m,i),className:"p-1.5 bg-primary-500 bg-opacity-40 rounded-full text-white border border-white hover:bg-primary-500 hover:bg-opacity-50 hover:text-white transition-colors",title:"Image options",children:e.jsx(I,{className:"h-3 w-3"})}),d===i&&e.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 py-1 z-50",style:{transform:"translateY(0)",maxHeight:"calc(100vh - 100px)",overflowY:"auto"},children:[e.jsxs("button",{onClick:m=>u(m,"open",l.url,i),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Open"})]}),!l.isPrimary&&p&&e.jsxs("button",{onClick:m=>u(m,"setPrimary",l.url,i),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Primary"})]}),g&&e.jsxs("button",{onClick:m=>u(m,"delete",l.url,i),className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center transition-colors",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Delete"})]})]})]})})]},l.url)),f&&r.length<b&&e.jsx("button",{onClick:f,className:`${j[w]} border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors`,title:"Add image",children:e.jsx(Z,{className:"h-5 w-5"})})]}),!r.length&&f&&e.jsx("button",{onClick:f,className:`${j[w]} border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors w-full`,title:"Add image",children:e.jsx(Z,{className:"h-5 w-5"})}),r.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:[r.length," image",r.length!==1?"s":"",b&&` (max ${b})`]})]}),y&&e.jsx($,{images:r,initialIndex:h,onClose:D})]})}function oe({images:r,onRemoveImage:f,showControls:g=!0,size:p="md",className:b="",onImageClick:M}){const[w,c]=n.useState(!1),[y,C]=n.useState(0),[h,v]=n.useState(null),d={sm:"w-20 h-20 sm:w-16 sm:h-16",md:"w-24 h-24 sm:w-20 sm:h-20",lg:"w-28 h-28 sm:w-24 sm:h-24"},N=o=>{M?M(o):(C(o),c(!0))},j=()=>{c(!1)},k=(o,u)=>{o.stopPropagation(),v(h===u?null:u)},D=(o,u,l,i)=>{switch(o.stopPropagation(),v(null),u){case"open":N(i);break;case"delete":f==null||f(l);break}};return n.useEffect(()=>{const o=u=>{h!==null&&!u.target.closest(".image-menu-container")&&v(null)};return document.addEventListener("click",o),()=>document.removeEventListener("click",o)},[h]),r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`space-y-3 ${b}`,children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4 md:gap-6",style:{width:"fit-content"},children:r.map((o,u)=>e.jsxs("div",{className:`${d[p]} relative group cursor-pointer rounded-lg overflow-visible border-2 border-gray-200`,onClick:()=>N(u),children:[e.jsx("img",{src:o.url,alt:o.fileName,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}),g&&e.jsx("div",{className:"absolute inset-0 bg-transparent transition-all duration-200",children:e.jsxs("div",{className:"absolute top-1 right-1 image-menu-container",children:[e.jsx("button",{onClick:l=>k(l,u),className:"p-1.5 bg-primary-500 bg-opacity-40 rounded-full text-white border border-white hover:bg-primary-500 hover:bg-opacity-50 hover:text-white transition-colors",title:"Image options",children:e.jsx(I,{className:"h-3 w-3"})}),h===u&&e.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 py-1 z-50",style:{transform:"translateY(0)",maxHeight:"calc(100vh - 100px)",overflowY:"auto"},children:[e.jsxs("button",{onClick:l=>D(l,"open",o.url,u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Open"})]}),f&&e.jsxs("button",{onClick:l=>D(l,"delete",o.url,u),className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center transition-colors",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Delete"})]})]})]})})]},o.url))})}),w&&e.jsx($,{images:r.map(o=>({url:o.url,alt:o.fileName,isPrimary:!1,uploadedAt:new Date,fileName:o.fileName,size:0,mimeType:"image/jpeg"})),initialIndex:y,onClose:j})]})}export{ne as I,oe as T,$ as a};
//# sourceMappingURL=ImagePreview.js.map
