import{u as P,j as e}from"./index-CX_-pvtV.js";import{r as i}from"./vendor-Gm9i_4Ku.js";import{I as S}from"./ImageGallery-BxbMiqD9.js";import{u as A,b as D,L as c}from"./router-Bad1IJif.js";import{t as h,p as L}from"./inventoryService-DVKkbR7H.js";import{a as $,f as u}from"./dateUtils-BvsVwtCK.js";import{b as f,d as G,T as R,h as q,n as z,f as B,m as F}from"./ui-eaT6kZG0.js";import"./firebase-DTZupgGV.js";const l=()=>{document.querySelectorAll(".no-icon").forEach(n=>{Array.from(n.childNodes).forEach(t=>{t.nodeType!==Node.TEXT_NODE&&t.parentNode&&t.parentNode.removeChild(t)})})};function Q(){var x;const{id:r,transactionId:n}=A(),d=D(),[t,p]=i.useState(null),[o,y]=i.useState(null),[j,N]=i.useState(!0),[b,m]=i.useState(!1),[v,w]=i.useState(0),{showError:T}=P();i.useEffect(()=>{(async()=>{if(!(!r||!n))try{const[a,k]=await Promise.all([h.getTransaction(r,n),L.getProject(r)]),g={...a,transaction_images:Array.isArray(a==null?void 0:a.transaction_images)?a.transaction_images:[]};console.log("TransactionDetail - loaded transactionData:",a),console.log("TransactionDetail - convertedTransaction:",g),p(g),y(k)}catch(a){console.error("Error loading transaction:",a)}finally{N(!1)}})()},[r,n]),i.useEffect(()=>{},[r,n]),i.useEffect(()=>{if(t){l();const s=setTimeout(l,100),a=setTimeout(l,500);return()=>{clearTimeout(s),clearTimeout(a)}}},[t]);const _=async()=>{if(!(!r||!n||!t)&&window.confirm("Are you sure you want to delete this transaction? This action cannot be undone."))try{await h.deleteTransaction(r,n),d(`/project/${r}?tab=transactions`)}catch(s){console.error("Error deleting transaction:",s),T("Failed to delete transaction. Please try again.")}},I=s=>{w(s),m(!0)},E=()=>{m(!1)},C=((x=t==null?void 0:t.transaction_images)==null?void 0:x.map((s,a)=>({url:s.url,alt:s.fileName,fileName:s.fileName,uploadedAt:s.uploadedAt,size:s.size,mimeType:s.mimeType,isPrimary:a===0})))||[];return j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading transaction..."})]})}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(c,{to:`/project/${r}?tab=transactions`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(c,{to:`/project/${r}/transaction/${n}/edit`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs("button",{onClick:_,className:"inline-flex items-center px-4 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-6 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-tight",children:t.source})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Amount"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 font-medium",children:$(t.amount)})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Payment Method"]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.payment_method})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Transaction Date"]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.transaction_date?u(t.transaction_date):"No date"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Transaction Type"}),e.jsx("dd",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium no-icon ${t.transaction_type==="Purchase"?"bg-green-100 text-green-800":t.transaction_type==="Return"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.transaction_type})})]}),t.receipt_emailed&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Receipt Emailed"}),e.jsx("dd",{className:"mt-1",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Yes"})})]}),t.notes&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Notes"]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 whitespace-pre-wrap",children:t.notes})]})]})}),t.transaction_images&&t.transaction_images.length>0&&e.jsxs("div",{className:"px-6 py-6 border-t border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Transaction Images"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4 md:gap-6",style:{width:"fit-content"},children:t.transaction_images.map((s,a)=>e.jsxs("div",{className:"w-24 h-24 sm:w-20 sm:h-20 relative group cursor-pointer rounded-lg overflow-hidden border-2 border-gray-200 hover:border-primary-300 transition-colors",onClick:()=>I(a),children:[e.jsx("img",{src:s.url,alt:s.fileName,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}),t.transaction_images&&t.transaction_images.length>1&&e.jsx("div",{className:"absolute bottom-1 right-1 bg-black bg-opacity-70 text-white text-xs px-1 py-0.5 rounded",children:a+1})]},a))}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[t.transaction_images.length," image",t.transaction_images.length!==1?"s":""]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Project"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:(o==null?void 0:o.name)||t.project_name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:u(t.created_at)})]})]})})]}),b&&e.jsx(S,{images:C,initialIndex:v,onClose:E})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"ðŸ“„"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Transaction not found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"The transaction you're looking for doesn't exist."}),e.jsx("div",{className:"mt-6",children:e.jsxs(c,{to:`/project/${r}?tab=transactions`,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Back"]})})]})}export{Q as default};
//# sourceMappingURL=TransactionDetail-CTbqPBwa.js.map
