{"version":3,"file":"BusinessInventoryItemDetail.js","sources":["../../src/pages/BusinessInventoryItemDetail.tsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { useParams } from 'react-router-dom'\nimport ContextBackLink from '@/components/ContextBackLink'\nimport ContextLink from '@/components/ContextLink'\nimport { useStackedNavigate } from '@/hooks/useStackedNavigate'\nimport { Edit, Trash2, ArrowLeft, Package, DollarSign, ImagePlus, FileText, Copy } from 'lucide-react'\nimport { Item, Project } from '@/types'\nimport { unifiedItemsService, projectService } from '@/services/inventoryService'\nimport { formatDate } from '@/utils/dateUtils'\nimport ImagePreview from '@/components/ui/ImagePreview'\nimport { ImageUploadService } from '@/services/imageService'\nimport { useDuplication } from '@/hooks/useDuplication'\nimport { useAccount } from '@/contexts/AccountContext'\nimport ItemLineageBreadcrumb from '@/components/ui/ItemLineageBreadcrumb'\nimport { lineageService } from '@/services/lineageService'\nimport { useNavigationContext } from '@/hooks/useNavigationContext'\n\nexport default function BusinessInventoryItemDetail() {\n  const { id } = useParams<{ id: string }>()\n  const navigate = useStackedNavigate()\n  const { currentAccountId } = useAccount()\n  const { buildContextUrl } = useNavigationContext()\n  const [item, setItem] = useState<Item | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [isUpdating, setIsUpdating] = useState(false)\n  const [projects, setProjects] = useState<Project[]>([])\n  const [showAllocationModal, setShowAllocationModal] = useState(false)\n  const [showProjectDropdown, setShowProjectDropdown] = useState(false)\n  const [allocationForm, setAllocationForm] = useState({\n    projectId: '',\n    space: ''\n  })\n\n  // Image upload state\n  const [isUploadingImage, setIsUploadingImage] = useState(false)\n  const [uploadProgress, setUploadProgress] = useState<number>(0)\n\n  // Navigation context logic for basic back navigation\n  const backDestination = '/business-inventory' // Always go back to main inventory list\n\n  // Use duplication hook for business inventory items\n  const { duplicateItem } = useDuplication({\n    items: item ? [item] : [],\n    setItems: (items) => {\n      if (typeof items === 'function') {\n        setItem(prev => items([prev!])[0] || prev)\n      } else if (items.length > 0) {\n        setItem(items[0])\n      }\n    },\n    duplicationService: async (itemId: string) => {\n      if (!currentAccountId) throw new Error('Account ID is required')\n      // Since we're using the unified service, we need to create a duplicate item\n      const originalItem = await unifiedItemsService.getItemById(currentAccountId, itemId)\n      if (!originalItem) throw new Error('Item not found')\n\n      // Create a new item with similar data but new ID\n      const { itemId: originalItemId, dateCreated, lastUpdated, ...itemData } = originalItem\n      return await unifiedItemsService.createItem(currentAccountId, {\n        ...itemData,\n        inventoryStatus: 'available',\n        projectId: null,\n        disposition: itemData.disposition || 'keep' // Preserve existing disposition or default to 'keep'\n      })\n    }\n  })\n\n  // Helper functions\n  const formatLinkedProjectText = (projectId: string): string => {\n    const project = projects.find(p => p.id === projectId)\n    return project ? `${project.name} - ${project.clientName}` : projectId\n  }\n\n  useEffect(() => {\n    if (id && currentAccountId) {\n      loadItem()\n      loadProjects()\n    }\n  }, [id, currentAccountId])\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (showProjectDropdown && !event.target) return\n\n      const target = event.target as Element\n      if (!target.closest('.project-dropdown') && !target.closest('.project-dropdown-button')) {\n        setShowProjectDropdown(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [showProjectDropdown])\n\n  const loadProjects = async () => {\n    if (!currentAccountId) return\n    try {\n      const projectsData = await projectService.getProjects(currentAccountId)\n      setProjects(projectsData)\n    } catch (error) {\n      console.error('Error loading projects:', error)\n    }\n  }\n\n  // Subscribe to real-time updates\n  useEffect(() => {\n    if (!id || !currentAccountId) return\n\n    const unsubscribe = unifiedItemsService.subscribeToBusinessInventory(\n      currentAccountId,\n      (items) => {\n        const updatedItem = items.find(i => i.itemId === id)\n        if (updatedItem) {\n          setItem(updatedItem)\n        }\n      },\n      {}\n    )\n\n    return unsubscribe\n  }, [id, currentAccountId])\n\n  // Subscribe to lineage edges for this specific business-inventory item and refetch on new edges\n  useEffect(() => {\n    if (!id || !currentAccountId) return\n\n    const unsubscribe = lineageService.subscribeToItemLineageForItem(currentAccountId, id, async () => {\n      try {\n        const updated = await unifiedItemsService.getItemById(currentAccountId, id)\n        if (updated) setItem(updated)\n      } catch (err) {\n        console.debug('BusinessInventoryItemDetail - failed to refetch item on lineage event', err)\n      }\n    })\n\n    return () => {\n      try { unsubscribe() } catch (e) { /* noop */ }\n    }\n  }, [id, currentAccountId])\n\n  const loadItem = async () => {\n    if (!id || !currentAccountId) return\n\n    try {\n      const itemData = await unifiedItemsService.getItemById(currentAccountId, id)\n      setItem(itemData)\n    } catch (error) {\n      console.error('Error loading item:', error)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n\n  const handleDelete = async () => {\n    if (!id || !item || !currentAccountId) return\n\n    if (window.confirm('Are you sure you want to delete this item? This action cannot be undone.')) {\n      try {\n        await unifiedItemsService.deleteItem(currentAccountId, id)\n        navigate('/business-inventory')\n      } catch (error) {\n        console.error('Error deleting item:', error)\n        alert('Error deleting item. Please try again.')\n      }\n    }\n  }\n\n\n\n  const openAllocationModal = () => {\n    setShowAllocationModal(true)\n  }\n\n  const closeAllocationModal = () => {\n    setShowAllocationModal(false)\n    setShowProjectDropdown(false)\n    setAllocationForm({\n      projectId: '',\n      space: ''\n    })\n  }\n\n  const getSelectedProjectName = () => {\n    const selectedProject = projects.find(p => p.id === allocationForm.projectId)\n    return selectedProject ? `${selectedProject.name} - ${selectedProject.clientName}` : 'Select a project...'\n  }\n\n  const handleAllocationSubmit = async () => {\n    if (!id || !allocationForm.projectId || !currentAccountId) return\n\n    setIsUpdating(true)\n    try {\n      await unifiedItemsService.allocateItemToProject(\n        currentAccountId,\n        id!,\n        allocationForm.projectId,\n        undefined,\n        undefined,\n        allocationForm.space\n      )\n      closeAllocationModal()\n\n      // Navigate to the item detail in the project after successful allocation\n      navigate(`/project/${allocationForm.projectId}/item/${id}`)\n\n      // Item will be updated via real-time subscription\n    } catch (error) {\n      console.error('Error allocating item:', error)\n      alert('Error allocating item. Please try again.')\n    } finally {\n      setIsUpdating(false)\n    }\n  }\n\n  // Image handling functions\n  const handleSelectFromGallery = async () => {\n    if (!item || !item.itemId) return\n\n    try {\n      setIsUploadingImage(true)\n      setUploadProgress(0)\n\n      const files = await ImageUploadService.selectFromGallery()\n\n      if (files && files.length > 0) {\n        console.log('Selected', files.length, 'files from gallery')\n\n        // Process all selected files sequentially\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i]\n          await processImageUpload(file, files)\n        }\n      } else {\n        console.log('No files selected from gallery')\n      }\n    } catch (error: any) {\n      console.error('Error selecting from gallery:', error)\n\n      // Handle cancel/timeout gracefully - don't show error for user cancellation\n      if (error.message?.includes('timeout') || error.message?.includes('canceled')) {\n        console.log('User canceled image selection or selection timed out')\n        return\n      }\n\n      alert('Failed to add images. Please try again.')\n    } finally {\n      setIsUploadingImage(false)\n      setUploadProgress(0)\n    }\n  }\n\n  const processImageUpload = async (file: File, allFiles?: File[]) => {\n    if (!item?.itemId) return\n\n    const uploadResult = await ImageUploadService.uploadItemImage(\n      file,\n      'Business Inventory',\n      item.itemId\n    )\n\n    const newImage = {\n      url: uploadResult.url,\n      alt: file.name,\n      isPrimary: item.images?.length === 0, // First image is always primary when added from detail view\n      uploadedAt: new Date(),\n      fileName: file.name,\n      size: file.size,\n      mimeType: file.type\n    }\n\n    // Update the item with the new image\n    if (!currentAccountId) return\n    const currentImages = item.images || []\n    const updatedImages = [...currentImages, newImage]\n\n    await unifiedItemsService.updateItem(currentAccountId, item.itemId, { images: updatedImages })\n\n  }\n\n  const handleRemoveImage = async (imageUrl: string) => {\n    if (!item?.itemId || !currentAccountId) return\n\n    try {\n      // Update in database\n      const updatedImages = item.images?.filter(img => img.url !== imageUrl) || []\n      await unifiedItemsService.updateItem(currentAccountId, item.itemId, { images: updatedImages })\n\n      // Update local state\n      setItem({ ...item, images: updatedImages })\n    } catch (error) {\n      console.error('Error removing image:', error)\n      alert('Error removing image. Please try again.')\n    }\n  }\n\n  const handleSetPrimaryImage = async (imageUrl: string) => {\n    if (!item?.itemId || !currentAccountId) return\n\n    try {\n      // Update in database\n      const updatedImages = item.images?.map(img => ({\n        ...img,\n        isPrimary: img.url === imageUrl\n      })) || []\n      await unifiedItemsService.updateItem(currentAccountId, item.itemId, { images: updatedImages })\n\n      // Update local state\n      setItem({ ...item, images: updatedImages })\n    } catch (error) {\n      console.error('Error setting primary image:', error)\n      alert('Error setting primary image. Please try again.')\n    }\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-32\">\n        <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\"></div>\n      </div>\n    )\n  }\n\n  if (!item) {\n    return (\n      <div className=\"text-center py-12 px-4\">\n        <Package className=\"mx-auto h-16 w-16 text-gray-400 -mb-1\" />\n        <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n          Item not found\n        </h3>\n        <p className=\"text-sm text-gray-500 mb-4\">\n          The item you're looking for doesn't exist or has been deleted.\n        </p>\n            <ContextBackLink\n              fallback={backDestination}\n              className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Inventory\n            </ContextBackLink>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Sticky Header Controls */}\n      <div className=\"sticky top-0 bg-gray-50 z-10 px-4 py-2 border-b border-gray-200\">\n        {/* Back button and controls row */}\n        <div className=\"flex items-center justify-between gap-4\">\n          <ContextBackLink\n            fallback={backDestination}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </ContextBackLink>\n\n          <div className=\"flex flex-wrap gap-2 sm:space-x-2\">\n            {item.inventoryStatus === 'available' && (\n              <button\n                onClick={openAllocationModal}\n                disabled={isUpdating}\n                className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n                title=\"Allocate to Project\"\n              >\n                <DollarSign className=\"h-4 w-4\" />\n              </button>\n            )}\n            <ContextLink\n              to={buildContextUrl(`/business-inventory/${id}/edit`)}\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              title=\"Edit Item\"\n            >\n              <Edit className=\"h-4 w-4\" />\n            </ContextLink>\n            <button\n              onClick={() => item && duplicateItem(item.itemId)}\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              title=\"Duplicate Item\"\n            >\n              <Copy className=\"h-4 w-4\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"space-y-4\">\n\n        {/* Item information */}\n        <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n          <div className=\"px-6 py-4\">\n            <h1 className=\"text-xl font-semibold text-gray-900\">{item.description}</h1>\n          </div>\n\n          {/* Item Images */}\n          <div className=\"px-6 py-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n                <ImagePlus className=\"h-5 w-5 mr-2\" />\n                Item Images\n              </h3>\n              <button\n                onClick={handleSelectFromGallery}\n                disabled={isUploadingImage}\n                className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n                title=\"Add images from gallery or camera\"\n              >\n                <ImagePlus className=\"h-3 w-3 mr-1\" />\n                {isUploadingImage\n                  ? uploadProgress > 0 && uploadProgress < 100\n                    ? `Uploading... ${Math.round(uploadProgress)}%`\n                    : 'Uploading...'\n                  : 'Add Images'\n                }\n              </button>\n            </div>\n\n            {item.images && item.images.length > 0 ? (\n              <ImagePreview\n                images={item.images}\n                onRemoveImage={handleRemoveImage}\n                onSetPrimary={handleSetPrimaryImage}\n                maxImages={5}\n                size=\"md\"\n                showControls={true}\n              />\n            ) : (\n              <div className=\"text-center py-8\">\n                <ImagePlus className=\"mx-auto h-8 w-8 text-gray-400\" />\n                <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No images uploaded</h3>\n              </div>\n            )}\n          </div>\n\n          {/* Item Details */}\n          <div className=\"px-6 py-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4 flex items-center\">\n              <FileText className=\"h-5 w-5 mr-2\" />\n              Item Details\n            </h3>\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\n              {item.source && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Source</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900 capitalize\">{item.source}</dd>\n                </div>\n              )}\n\n              {item.sku && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">SKU</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{item.sku}</dd>\n                </div>\n              )}\n\n              {item.purchasePrice && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Purchase Price</dt>\n                  <p className=\"text-xs text-gray-500 mt-1\">What the item was purchased for</p>\n                  <dd className=\"mt-1 text-sm text-gray-900 font-medium\">${item.purchasePrice}</dd>\n                </div>\n              )}\n\n              {item.projectPrice && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Project Price</dt>\n                  <p className=\"text-xs text-gray-500 mt-1\">What the client is charged</p>\n                  <dd className=\"mt-1 text-sm text-gray-900 font-medium\">${item.projectPrice}</dd>\n                </div>\n              )}\n\n              {item.marketValue && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Market Value</dt>\n                  <p className=\"text-xs text-gray-500 mt-1\">The fair market value of the item</p>\n                  <dd className=\"mt-1 text-sm text-gray-900 font-medium\">${item.marketValue}</dd>\n                </div>\n              )}\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">Status</dt>\n                <dd className=\"mt-1\">\n                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                    item.inventoryStatus === 'available'\n                      ? 'bg-green-100 text-green-800'\n                      : item.inventoryStatus === 'allocated'\n                      ? 'bg-yellow-100 text-yellow-800'\n                      : 'bg-red-100 text-red-800'\n                  }`}>\n                    {item.inventoryStatus === 'available' ? 'Available' :\n                     item.inventoryStatus === 'allocated' ? 'Allocated' : 'Sold'}\n                  </span>\n                </dd>\n              </div>\n\n              {item.businessInventoryLocation && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Location</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{item.businessInventoryLocation}</dd>\n                </div>\n              )}\n\n              {item.notes && item.notes !== 'No notes' && (\n                <div className=\"sm:col-span-2\">\n                  <dt className=\"text-sm font-medium text-gray-500\">Notes</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">{item.notes}</dd>\n                </div>\n              )}\n            </dl>\n          </div>\n\n\n          {/* Metadata */}\n          <div className=\"px-6 py-4 bg-gray-50\">\n            <div className=\"relative\">\n              <dl className=\"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2 lg:grid-cols-3\">\n                <div>\n                  <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Date Added</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(item.dateCreated)}</dd>\n                </div>\n                <div>\n                  <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Last Updated</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(item.lastUpdated)}</dd>\n                </div>\n\n                {item.projectId && (\n                  <div>\n                    <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Project</dt>\n                    <dd className=\"mt-1 text-sm text-gray-900\">\n                      <ContextLink\n                        to={buildContextUrl(`/project/${item.projectId}`, { from: 'business-inventory-item' })}\n                        className=\"text-primary-600 hover:text-primary-800 font-medium\"\n                      >\n                        {formatLinkedProjectText(item.projectId)}\n                      </ContextLink>\n                    </dd>\n                  </div>\n                )}\n\n                {item.transactionId && (\n                  <div>\n                    <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">TRANSACTION</dt>\n                    <dd className=\"mt-1 text-sm text-gray-900\">\n                      <ContextLink\n                        to={buildContextUrl(`/project/${item.projectId}/transaction/${item.transactionId}`, { from: 'business-inventory-item' })}\n                        className=\"text-primary-600 hover:text-primary-800 font-medium\"\n                      >\n                        {item.transactionId}\n                      </ContextLink>\n                    </dd>\n                  </div>\n                )}\n\n                {/* Lineage breadcrumb (compact) */}\n                {item.itemId && (\n                  <div className=\"sm:col-span-3 mt-2\">\n                    <ItemLineageBreadcrumb itemId={item.itemId} />\n                  </div>\n                )}\n\n                {item.previousProjectTransactionId && (\n                  <div>\n                    <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Original Transaction</dt>\n                    <dd className=\"mt-1 text-sm text-gray-900\">\n                      {item.previousProjectId ? (\n                        <ContextLink\n                          to={buildContextUrl(`/project/${item.previousProjectId}/transaction/${item.previousProjectTransactionId}`, { from: 'business-inventory-item' })}\n                          className=\"text-primary-600 hover:text-primary-800 font-medium\"\n                        >\n                          {item.previousProjectTransactionId}\n                        </ContextLink>\n                      ) : (\n                        <span>{item.previousProjectTransactionId}</span>\n                      )}\n                    </dd>\n                  </div>\n                )}\n              </dl>\n\n              {/* Delete button in lower right corner */}\n              <div className=\"absolute bottom-0 right-0\">\n                <button\n                  onClick={handleDelete}\n                  className=\"inline-flex items-center justify-center p-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                  title=\"Delete Item\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n\n      {/* Allocation Modal */}\n      {showAllocationModal && (\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n          <div className=\"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white\">\n            <div className=\"mt-3\">\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Allocate Item to Project</h3>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Select Project\n                  </label>\n                  <div className=\"relative mt-1\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowProjectDropdown(!showProjectDropdown)}\n                      className=\"project-dropdown-button relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    >\n                      <span className={`block truncate ${!allocationForm.projectId ? 'text-gray-500' : 'text-gray-900'}`}>\n                        {getSelectedProjectName()}\n                      </span>\n                      <span className=\"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none\">\n                        <svg className=\"h-5 w-5 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                          <path fillRule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n                        </svg>\n                      </span>\n                    </button>\n\n                    {showProjectDropdown && (\n                      <div className=\"project-dropdown absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base border border-gray-200 overflow-auto focus:outline-none sm:text-sm\">\n                        {projects.map((project) => (\n                          <button\n                            key={project.id}\n                            type=\"button\"\n                            onClick={() => {\n                              setAllocationForm(prev => ({ ...prev, projectId: project.id }))\n                              setShowProjectDropdown(false)\n                            }}\n                            className={`w-full text-left px-3 py-2 hover:bg-gray-50 ${\n                              allocationForm.projectId === project.id ? 'bg-primary-50 text-primary-600' : 'text-gray-900'\n                            }`}\n                          >\n                            <div className=\"font-medium\">{project.name}</div>\n                            <div className=\"text-sm text-gray-500\">{project.clientName}</div>\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">Space (optional)</label>\n                  <input\n                    type=\"text\"\n                    value={allocationForm.space}\n                    onChange={(e) => setAllocationForm(prev => ({ ...prev, space: e.target.value }))}\n                    placeholder=\"e.g. Living Room, Bedroom\"\n                    className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm\"\n                  />\n                </div>\n\n              </div>\n\n                <div className=\"flex justify-end gap-3 mt-6\">\n                <button\n                  type=\"button\"\n                  onClick={closeAllocationModal}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"button\"\n                    onClick={handleAllocationSubmit}\n                    disabled={!allocationForm.projectId || isUpdating}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50\"\n                >\n                  {isUpdating ? 'Allocating...' : 'Allocate Item'}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":["BusinessInventoryItemDetail","id","useParams","navigate","useStackedNavigate","currentAccountId","useAccount","buildContextUrl","useNavigationContext","item","setItem","useState","isLoading","setIsLoading","isUpdating","setIsUpdating","projects","setProjects","showAllocationModal","setShowAllocationModal","showProjectDropdown","setShowProjectDropdown","allocationForm","setAllocationForm","isUploadingImage","setIsUploadingImage","uploadProgress","setUploadProgress","backDestination","duplicateItem","useDuplication","items","prev","itemId","originalItem","unifiedItemsService","originalItemId","dateCreated","lastUpdated","itemData","formatLinkedProjectText","projectId","project","p","useEffect","loadItem","loadProjects","handleClickOutside","event","target","projectsData","projectService","error","updatedItem","i","unsubscribe","lineageService","updated","err","handleDelete","openAllocationModal","closeAllocationModal","getSelectedProjectName","selectedProject","handleAllocationSubmit","handleSelectFromGallery","files","ImageUploadService","file","processImageUpload","_a","_b","allFiles","newImage","updatedImages","handleRemoveImage","imageUrl","img","handleSetPrimaryImage","jsx","jsxs","ContextBackLink","ArrowLeft","DollarSign","ContextLink","Edit","Copy","ImagePlus","ImagePreview","FileText","formatDate","ItemLineageBreadcrumb","Trash2","e","Package"],"mappings":"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"}