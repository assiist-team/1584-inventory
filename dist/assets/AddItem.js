import{u as W,a as X,U as Y,j as e}from"./index.js";import{u as H,b as J,L as N}from"./router.js";import{r as l}from"./vendor.js";import{p as Q,t as Z,i as ee}from"./inventoryService.js";import{I as M,g as F,a as A}from"./imageService.js";import{T as _}from"./transactionSources.js";import{S as te}from"./Select.js";import{I as se}from"./ImagePreview.js";import{q as re,d as ae,b as oe,r as ne}from"./ui.js";import"./firebase.js";import"./ImageGallery.js";function fe(){const{id:c}=H(),D=J(),{hasRole:U}=W(),{showError:w}=X(),[y,L]=l.useState("");if(!U(Y.DESIGNER))return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-red-100",children:e.jsx(re,{className:"h-6 w-6 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to add items. Please contact an administrator if you need access."}),e.jsx(N,{to:`/project/${c}`,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Project"})]})});const[a,k]=l.useState({description:"",source:"",sku:"",price:"",resale_price:"",market_value:"",payment_method:"",disposition:"",notes:"",selectedTransactionId:""}),[S,d]=l.useState(!1),[C,m]=l.useState(!1),[f,R]=l.useState([]),[b,I]=l.useState(!1),[u,P]=l.useState([]),[$,h]=l.useState(!1),[j,p]=l.useState(0),v=!!a.selectedTransactionId;l.useEffect(()=>{(async()=>{if(c){I(!0);try{const s=await Q.getProject(c);s&&L(s.name);const r=await Z.getTransactions(c);R(r)}catch(s){console.error("Error fetching project and transactions:",s)}finally{I(!1)}}})()},[c]),l.useEffect(()=>{const t=_;a.source&&!t.includes(a.source)?d(!0):a.source&&t.includes(a.source)&&d(!1)},[a.source]),l.useEffect(()=>{const t=["Client Card","1584 Card","Split","Store Credit"];a.payment_method&&!t.includes(a.payment_method)?m(!0):a.payment_method&&t.includes(a.payment_method)&&m(!1)},[a.payment_method]);const[o,g]=l.useState({}),[E,T]=l.useState(!1),O=()=>{const t={};return a.description.trim()||(t.description="Description is required"),a.market_value.trim()&&(isNaN(Number(a.market_value))||Number(a.market_value)<=0)&&(t.market_value="Market value must be a positive number"),g(t),Object.keys(t).length===0},q=async t=>{if(t.preventDefault(),!(!O()||!c)){T(!0);try{const s={...a,project_id:c,qr_key:`qr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,bookmark:!1,transaction_id:a.selectedTransactionId||"",date_created:new Date().toISOString(),last_updated:new Date().toISOString(),images:u.length>0?u:void 0};await ee.createItem(c,s),D(`/project/${c}?tab=inventory`)}catch(s){console.error("Error creating item:",s),g({submit:"Failed to create item. Please try again."})}finally{T(!1)}}},i=(t,s)=>{k(r=>({...r,[t]:s})),o[t]&&g(r=>({...r,[t]:""}))},z=t=>{const s=f.find(r=>r.transaction_id===t);if(k(r=>({...r,selectedTransactionId:t,source:(s==null?void 0:s.source)||"",payment_method:(s==null?void 0:s.payment_method)||""})),s!=null&&s.source){const r=_.includes(s.source);d(!r)}if(s!=null&&s.payment_method){const n=["Client Card","1584 Card","Split","Store Credit"].includes(s.payment_method);m(!n)}o.selectedTransactionId&&g(r=>({...r,selectedTransactionId:""}))},B=async t=>{if(y)try{h(!0),p(0),console.log("Starting multiple image upload for",t.length,"files");const s=await M.uploadMultipleItemImages(t,y,"new-item",(n,x)=>{const V=Math.round((n+x.percentage/100)/t.length*100);p(V)});console.log("All uploads completed successfully:",s.length,"images");const r=s.map((n,x)=>({url:n.url,alt:n.fileName,isPrimary:u.length===0&&x===0,uploadedAt:new Date,fileName:n.fileName,size:n.size,mimeType:n.mimeType}));console.log("New image objects created:",r.length),P(n=>[...n,...r]),p(100),console.log("Multiple image upload completed successfully")}catch(s){console.error("Error uploading multiple images:",s);const r=F(s),n=A(s);w(`${r} Suggestion: ${n}`)}finally{h(!1),p(0)}},G=async()=>{var t,s;if(y)try{h(!0);const r=await M.selectFromGallery();r&&r.length>0?(console.log("Selected",r.length,"files from gallery"),await B(r)):console.log("No files selected from gallery")}catch(r){if(console.error("Error selecting from gallery:",r),(t=r.message)!=null&&t.includes("timeout")||(s=r.message)!=null&&s.includes("canceled")){console.log("User canceled image selection or selection timed out");return}const n=F(r),x=A(r);w(`${n} Suggestion: ${x}`)}finally{h(!1),p(0)}},K=async t=>{P(s=>s.filter(r=>r.url!==t))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(N,{to:`/project/${c}?tab=inventory`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Add Item"})}),e.jsxs("form",{onSubmit:q,className:"space-y-8 p-8",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:a.description,onChange:t=>i("description",t.target.value),placeholder:"e.g., Wooden dining table, 6 chairs",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.description?"border-red-300":"border-gray-300"}`}),o.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.description})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Item Images"})}),u.length>0?e.jsx(se,{images:u,onRemoveImage:K,maxImages:5,size:"md",showControls:!0}):e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"No images for this item yet"}),e.jsx("button",{onClick:G,disabled:$,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:$?j>0&&j<100?`Uploading... ${Math.round(j)}%`:"Uploading...":"Add Images"})]})]}),e.jsxs(te,{label:"Associate with Transaction",id:"selectedTransactionId",value:a.selectedTransactionId,onChange:t=>z(t.target.value),error:o.selectedTransactionId,disabled:b,children:[e.jsx("option",{value:"",children:"Select a transaction"}),b?e.jsx("option",{disabled:!0,children:"Loading transactions..."}):f.map(t=>e.jsxs("option",{value:t.transaction_id,children:[new Date(t.transaction_date).toLocaleDateString()," - ",t.source," - $",t.amount]},t.transaction_id))]}),!b&&f.length===0&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No transactions available for this project"}),v&&e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Source:"})," ",a.source," |",e.jsx("strong",{children:" Payment Method:"})," ",a.payment_method]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"These values are automatically filled from the selected transaction"})]}),!v&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Source"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:_.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:t,checked:a.source===t,onChange:s=>{i("source",s.target.value),d(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:S,onChange:()=>{d(!0),i("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),S&&e.jsx("input",{type:"text",id:"source_custom_input",value:a.source,onChange:t=>i("source",t.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.source?"border-red-300":"border-gray-300"}`}),o.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:a.sku,onChange:t=>i("sku",t.target.value),placeholder:"Product SKU or model number",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Purchase Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"price",value:a.price,onChange:t=>i("price",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.price?"border-red-300":"border-gray-300"}`})]}),o.price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"market_value",value:a.market_value,onChange:t=>i("market_value",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.market_value?"border-red-300":"border-gray-300"}`})]}),o.market_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.market_value})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resale_price",className:"block text-sm font-medium text-gray-700",children:"1584 Resale Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"resale_price",value:a.resale_price,onChange:t=>i("resale_price",t.target.value),placeholder:"0.00",className:"block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]})]}),!v&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Payment Method"}),e.jsx("div",{className:"flex items-center space-x-6 mb-3",children:["Client Card","1584 Card","Split","Store Credit"].map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`payment_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"payment_method",value:t,checked:a.payment_method===t,onChange:s=>{i("payment_method",s.target.value),m(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`payment_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"payment_custom",name:"payment_method",value:"custom",checked:C,onChange:()=>{m(!0),i("payment_method","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"payment_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),C&&e.jsx("input",{type:"text",id:"payment_custom_input",value:a.payment_method,onChange:t=>i("payment_method",t.target.value),placeholder:"Enter custom payment method...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.payment_method?"border-red-300":"border-gray-300"}`}),o.payment_method&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.payment_method})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Disposition"}),e.jsx("div",{className:"flex items-center space-x-6",children:["keep","return","inventory"].map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`disposition_${t.toLowerCase()}`,name:"disposition",value:t,checked:a.disposition===t,onChange:s=>i("disposition",s.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`disposition_${t.toLowerCase()}`,className:"ml-2 block text-sm text-gray-900",children:t.charAt(0).toUpperCase()+t.slice(1)})]},t))}),o.disposition&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.disposition})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:a.notes,onChange:t=>i("notes",t.target.value),placeholder:"Additional notes about this item...",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),o.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:o.submit})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsxs(N,{to:`/project/${c}?tab=inventory`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:E,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),E?"Creating...":"Create Item"]})]})]})]})]})}export{fe as default};
//# sourceMappingURL=AddItem.js.map
