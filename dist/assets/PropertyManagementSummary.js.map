{"version":3,"file":"PropertyManagementSummary.js","sources":["../../src/pages/PropertyManagementSummary.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { useStackedNavigate } from '@/hooks/useStackedNavigate'\nimport { Button } from '@/components/ui/Button'\nimport type { Item, Project } from '@/types'\nimport { projectService, unifiedItemsService } from '@/services/inventoryService'\nimport { useAccount } from '@/contexts/AccountContext'\nimport { useBusinessProfile } from '@/contexts/BusinessProfileContext'\n\nconst usd = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' })\n\nfunction toNumber(value: string | number | null | undefined): number {\n  if (typeof value === 'number') return isNaN(value) ? 0 : value\n  if (typeof value === 'string') {\n    const n = parseFloat(value || '0')\n    return isNaN(n) ? 0 : n\n  }\n  return 0\n}\n\nexport default function PropertyManagementSummary() {\n  const { id: projectId } = useParams<{ id: string }>()\n  const navigate = useStackedNavigate()\n  const { currentAccountId } = useAccount()\n  const { businessName, businessLogoUrl } = useBusinessProfile()\n\n  const [project, setProject] = useState<Project | null>(null)\n  const [items, setItems] = useState<Item[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const today = useMemo(() => new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }), [])\n\n  useEffect(() => {\n    const load = async () => {\n      if (!projectId || !currentAccountId) {\n        if (!currentAccountId) return // Wait for account to load\n        navigate('/projects')\n        return\n      }\n\n      setIsLoading(true)\n      setError(null)\n      try {\n        const [proj, projectItems] = await Promise.all([\n          projectService.getProject(currentAccountId, projectId),\n          unifiedItemsService.getItemsByProject(currentAccountId, projectId)\n        ])\n\n        if (!proj) {\n          navigate('/projects')\n          return\n        }\n\n        setProject(proj)\n        setItems(projectItems)\n      } catch (e: any) {\n        console.error('Failed to load property management summary:', e)\n        setError('Failed to load property management summary. Please try again.')\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    load()\n  }, [projectId, currentAccountId, navigate])\n\n  const totalMarketValue = useMemo(() => {\n    return items.reduce((sum, item) => {\n      const marketValue = toNumber(item.marketValue)\n      return sum + marketValue\n    }, 0)\n  }, [items])\n\n  const handlePrint = () => window.print()\n  const handleBack = () => {\n    if (!projectId) return navigate('/projects')\n    navigate(`/project/${projectId}?tab=inventory`)\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto\"></div>\n          <p className=\"mt-2 text-sm text-gray-600\">Loading property management summary...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"mx-auto h-12 w-12 text-red-400\">‚ö†Ô∏è</div>\n        <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Error</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">{error}</p>\n        <div className=\"mt-6\">\n          <Button onClick={handleBack}>Back</Button>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto bg-white shadow rounded-lg p-8 print:shadow-none print:p-0\">\n      {/* Action bar */}\n      <div className=\"flex justify-end space-x-3 mb-6 print:hidden\">\n        <Button variant=\"secondary\" onClick={handleBack}>Back</Button>\n        <Button onClick={handlePrint}>Print</Button>\n      </div>\n\n      {/* Header */}\n      <div className=\"border-b pb-4 mb-6\">\n        <div className=\"flex items-start gap-4\">\n          {businessLogoUrl && (\n            <img\n              src={businessLogoUrl}\n              alt={businessName}\n              className=\"h-24 w-auto object-contain\"\n            />\n          )}\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">Property Management Summary</h1>\n            <div className=\"mt-1 text-sm text-gray-600\">\n              <div className=\"font-medium text-gray-800\">{project?.name || 'Project'}</div>\n              {project?.clientName && <div>Client: {project.clientName}</div>}\n              <div>Date: {today}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {items.length === 0 && (\n        <div className=\"text-center py-12\">\n          <div className=\"mx-auto h-12 w-12 text-gray-400\">üì¶</div>\n          <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No items found</h3>\n          <p className=\"mt-1 text-sm text-gray-500\">There are no items associated with this project.</p>\n        </div>\n      )}\n\n      {items.length > 0 && (\n        <div className=\"space-y-6\">\n          {/* Summary */}\n          <section>\n            <div className=\"rounded-lg border border-gray-100 overflow-hidden\">\n              <div className=\"px-4 py-3 bg-gray-50 border-b border-gray-100\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Summary</h2>\n              </div>\n              <div className=\"px-4 py-4\">\n                <div className=\"flex flex-col sm:flex-row sm:items-center sm:gap-4\">\n                  <div className=\"flex items-center sm:flex-initial\">\n                    <span className=\"text-base font-medium text-gray-700\">Total Items:</span>\n                    <span className=\"ml-2 text-base font-semibold text-gray-900\">{items.length}</span>\n                  </div>\n                  <div className=\"flex items-center sm:flex-1 sm:border-l sm:border-gray-100 sm:pl-4\">\n                    <span className=\"text-base font-medium text-gray-700\">Total Market Value:</span>\n                    <span className=\"ml-2 text-base font-semibold text-gray-900\">{usd.format(totalMarketValue)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          {/* Items List */}\n          <section>\n            <div className=\"flex items-baseline justify-between mb-3\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">Items</h2>\n            </div>\n\n            <div className=\"rounded-lg border border-gray-100 overflow-hidden\">\n              <div className=\"divide-y\">\n                {items.map((item) => {\n                  const marketValue = toNumber(item.marketValue)\n                  \n                  return (\n                    <div key={item.itemId} className=\"py-2 px-4\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"text-sm text-gray-900 font-medium\">\n                            {item.description || 'Item'}\n                          </div>\n                          <div className=\"flex items-center gap-2 flex-wrap mt-0.5\">\n                            {item.source && (\n                              <span className=\"text-xs text-gray-500\">Source: {item.source}</span>\n                            )}\n                            {item.sku && (\n                              <>\n                                {item.source && <span className=\"text-xs text-gray-400\">‚Ä¢</span>}\n                                <span className=\"text-xs text-gray-500\">SKU: {item.sku}</span>\n                              </>\n                            )}\n                          </div>\n                          {item.space && (\n                            <div className=\"text-xs text-gray-500 mt-0.5\">Space: {item.space}</div>\n                          )}\n                        </div>\n                        <div className=\"text-right ml-4\">\n                          <div className=\"text-sm text-gray-700 font-medium\">\n                            {usd.format(marketValue)}\n                          </div>\n                          {marketValue === 0 && (\n                            <div className=\"text-xs text-gray-400 mt-0.5\">No market value set</div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  )\n                })}\n              </div>\n            </div>\n          </section>\n        </div>\n      )}\n    </div>\n  )\n}\n\n"],"names":["usd","toNumber","value","n","PropertyManagementSummary","projectId","useParams","navigate","useStackedNavigate","currentAccountId","useAccount","businessName","businessLogoUrl","useBusinessProfile","project","setProject","useState","items","setItems","isLoading","setIsLoading","error","setError","today","useMemo","useEffect","proj","projectItems","projectService","unifiedItemsService","e","totalMarketValue","sum","item","marketValue","handlePrint","handleBack","jsxs","jsx","Button","Fragment"],"mappings":"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"}