{"version":3,"file":"ImagePreview.js","sources":["../../src/components/ui/ImagePreview.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { Plus, ChevronDown, Trash2, Star, ExternalLink, Crown } from 'lucide-react'\nimport { ItemImage } from '@/types'\nimport ImageGallery from './ImageGallery'\n\ninterface ImagePreviewProps {\n  images: ItemImage[]\n  onAddImage?: () => void\n  onRemoveImage?: (imageUrl: string) => void\n  onSetPrimary?: (imageUrl: string) => void\n  maxImages?: number\n  showControls?: boolean\n  size?: 'sm' | 'md' | 'lg'\n  className?: string\n}\n\nexport default function ImagePreview({\n  images,\n  onAddImage,\n  onRemoveImage,\n  onSetPrimary,\n  maxImages = 5,\n  showControls = true,\n  size = 'md',\n  className = ''\n}: ImagePreviewProps) {\n  const [showGallery, setShowGallery] = useState(false)\n  const [galleryInitialIndex, setGalleryInitialIndex] = useState(0)\n  const [openMenuIndex, setOpenMenuIndex] = useState<number | null>(null)\n\n  const sizeClasses = {\n    sm: 'w-20 h-20 sm:w-16 sm:h-16',\n    md: 'w-24 h-24 sm:w-20 sm:h-20',\n    lg: 'w-28 h-28 sm:w-24 sm:h-24'\n  }\n\n  const handleImageClick = (index: number) => {\n    setGalleryInitialIndex(index)\n    setShowGallery(true)\n  }\n\n  const handleGalleryClose = () => {\n    setShowGallery(false)\n  }\n\n\n  const toggleMenu = (e: React.MouseEvent, index: number) => {\n    e.stopPropagation()\n    setOpenMenuIndex(openMenuIndex === index ? null : index)\n  }\n\n  const handleMenuAction = (e: React.MouseEvent, action: string, imageUrl: string, index: number) => {\n    e.stopPropagation()\n    setOpenMenuIndex(null)\n\n    switch (action) {\n      case 'open':\n        handleImageClick(index)\n        break\n      case 'setPrimary':\n        onSetPrimary?.(imageUrl)\n        break\n      case 'delete':\n        onRemoveImage?.(imageUrl)\n        break\n    }\n  }\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (openMenuIndex !== null && !(e.target as Element).closest('.image-menu-container')) {\n        setOpenMenuIndex(null)\n      }\n    }\n\n    document.addEventListener('click', handleClickOutside)\n    return () => document.removeEventListener('click', handleClickOutside)\n  }, [openMenuIndex])\n\n  if (images.length === 0 && !onAddImage) {\n    return null\n  }\n\n  return (\n    <>\n      <div className={`space-y-3 ${className}`}>\n        {/* Images grid */}\n        {images.length > 0 && (\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4 md:gap-6\" style={{width: 'fit-content'}}>\n            {images.map((image, index) => (\n              <div\n                key={image.url}\n                className={`${sizeClasses[size]} relative group cursor-pointer rounded-lg overflow-visible border-2 ${\n                  image.isPrimary ? 'border-primary-500 ring-2 ring-primary-200' : 'border-gray-200'\n                }`}\n                onClick={() => handleImageClick(index)}\n              >\n                <img\n                  src={image.url}\n                  alt={image.alt || image.fileName}\n                  className=\"w-full h-full object-cover transition-transform group-hover:scale-105\"\n                />\n\n                {/* Primary indicator */}\n                {image.isPrimary && (\n                  <div className=\"absolute top-1 left-1 bg-yellow-500 text-white text-xs p-1 rounded flex items-center justify-center\">\n                    <Crown className=\"h-3 w-3 fill-current\" />\n                  </div>\n                )}\n\n                {/* Controls overlay - Mobile-first design with chevron menu */}\n                {showControls && (\n                  <div className=\"absolute inset-0 bg-transparent transition-all duration-200\">\n                    {/* Chevron menu button - Upper right corner */}\n                    <div className=\"absolute top-1 right-1 image-menu-container\">\n                      <button\n                        onClick={(e) => toggleMenu(e, index)}\n                        className=\"p-1.5 bg-primary-500 bg-opacity-90 rounded-full text-white hover:bg-primary-600 transition-colors\"\n                        title=\"Image options\"\n                      >\n                        <ChevronDown className=\"h-3 w-3\" />\n                      </button>\n\n                      {/* Dropdown menu */}\n                      {openMenuIndex === index && (\n                        <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 py-1 z-50\" style={{\n                          transform: 'translateY(0)',\n                          maxHeight: 'calc(100vh - 100px)',\n                          overflowY: 'auto'\n                        }}>\n                          <button\n                            onClick={(e) => handleMenuAction(e, 'open', image.url, index)}\n                            className=\"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors\"\n                          >\n                            <ExternalLink className=\"h-4 w-4 mr-2\" />\n                            <span>Open</span>\n                          </button>\n                          {!image.isPrimary && onSetPrimary && (\n                            <button\n                              onClick={(e) => handleMenuAction(e, 'setPrimary', image.url, index)}\n                              className=\"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors\"\n                            >\n                              <Star className=\"h-4 w-4 mr-2\" />\n                              <span>Primary</span>\n                            </button>\n                          )}\n                          {onRemoveImage && (\n                            <button\n                              onClick={(e) => handleMenuAction(e, 'delete', image.url, index)}\n                              className=\"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center transition-colors\"\n                            >\n                              <Trash2 className=\"h-4 w-4 mr-2\" />\n                              <span>Delete</span>\n                            </button>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n              </div>\n            ))}\n\n            {/* Add image button */}\n            {onAddImage && images.length < maxImages && (\n              <button\n                onClick={onAddImage}\n                className={`${sizeClasses[size]} border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors`}\n                title=\"Add image\"\n              >\n                <Plus className=\"h-5 w-5\" />\n              </button>\n            )}\n          </div>\n        )}\n\n        {/* Add image button when no images exist */}\n        {!images.length && onAddImage && (\n          <button\n            onClick={onAddImage}\n            className={`${sizeClasses[size]} border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors w-full`}\n            title=\"Add image\"\n          >\n            <Plus className=\"h-5 w-5\" />\n          </button>\n        )}\n\n        {/* Image count */}\n        {images.length > 0 && (\n          <p className=\"text-xs text-gray-500\">\n            {images.length} image{images.length !== 1 ? 's' : ''}\n            {maxImages && ` (max ${maxImages})`}\n          </p>\n        )}\n      </div>\n\n      {/* Image gallery modal */}\n      {showGallery && (\n        <ImageGallery\n          images={images}\n          initialIndex={galleryInitialIndex}\n          onClose={handleGalleryClose}\n        />\n      )}\n    </>\n  )\n}\n"],"names":["ImagePreview","images","onAddImage","onRemoveImage","onSetPrimary","maxImages","showControls","size","className","showGallery","setShowGallery","useState","galleryInitialIndex","setGalleryInitialIndex","openMenuIndex","setOpenMenuIndex","sizeClasses","handleImageClick","index","handleGalleryClose","toggleMenu","e","handleMenuAction","action","imageUrl","useEffect","handleClickOutside","jsxs","Fragment","image","jsx","Crown","ChevronDown","ExternalLink","Star","Trash2","Plus","ImageGallery"],"mappings":"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"}