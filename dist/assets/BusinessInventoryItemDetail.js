import{j as e}from"./index.js";import{r as i}from"./vendor.js";import{b as L,c as M,L as m}from"./router.js";import{p as B,b as d}from"./inventoryService.js";import{a as p,f as x}from"./dateUtils.js";import{P as T,e as j,f as b,l as U,z as $,d as z}from"./ui.js";import"./firebase.js";function G(){const{id:a}=L(),f=M(),[t,u]=i.useState(null),[v,N]=i.useState(!0),[o,l]=i.useState(!1),[w,_]=i.useState([]),[I,h]=i.useState(!1),[n,c]=i.useState({projectId:"",amount:"",notes:""});i.useEffect(()=>{a&&(A(),k())},[a]);const k=async()=>{try{const s=await B.getProjects();_(s)}catch(s){console.error("Error loading projects:",s)}};i.useEffect(()=>a?d.subscribeToBusinessInventory(r=>{const y=r.find(F=>F.item_id===a);y&&u(y)}):void 0,[a]);const A=async()=>{if(a)try{const s=await d.getBusinessInventoryItem(a);u(s)}catch(s){console.error("Error loading item:",s)}finally{N(!1)}},S=async()=>{if(!(!a||!t)&&window.confirm("Are you sure you want to delete this item? This action cannot be undone."))try{await d.deleteBusinessInventoryItem(a),f("/business-inventory")}catch(s){console.error("Error deleting item:",s),alert("Error deleting item. Please try again.")}},P=async()=>{if(!(!a||!(t!=null&&t.pending_transaction_id))){l(!0);try{await d.returnItemFromProject(a,t.pending_transaction_id,t.current_project_id)}catch(s){console.error("Error returning item:",s),alert("Error returning item. Please try again.")}finally{l(!1)}}},C=async s=>{if(!(!a||!(t!=null&&t.pending_transaction_id))){l(!0);try{await d.markItemAsSold(a,t.pending_transaction_id,t.current_project_id,s)}catch(r){console.error("Error marking item as sold:",r),alert("Error marking item as sold. Please try again.")}finally{l(!1)}}},E=()=>{h(!0)},g=()=>{h(!1),c({projectId:"",amount:"",notes:""})},D=async()=>{if(!(!a||!n.projectId||!n.amount)){l(!0);try{await d.allocateItemToProject(a,n.projectId,n.amount,n.notes),g()}catch(s){console.error("Error allocating item:",s),alert("Error allocating item. Please try again.")}finally{l(!1)}}};return v?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):t?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{to:"/business-inventory",className:"mr-4 p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(j,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.description}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",t.sku]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{to:`/business-inventory/${a}/edit`,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs("button",{onClick:S,className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-red-50 transition-colors",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Item Details"}),e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Price"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:p(t.price)})]}),t.market_value&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Market Value"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:p(t.market_value)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Source"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 capitalize",children:t.source})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("dd",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.inventory_status==="available"?"bg-green-100 text-green-800":t.inventory_status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.inventory_status==="available"?"Available":t.inventory_status==="pending"?"Allocated":"Sold"})})]}),t.business_inventory_location&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.business_inventory_location})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Date Added"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:x(t.date_created)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Last Updated"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:x(t.last_updated)})]})]}),t.notes&&e.jsxs("div",{className:"mt-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Notes"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.notes})]})]})}),t.current_project_id&&e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Project Assignment"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Currently allocated to project: ",e.jsx("span",{className:"font-medium",children:t.current_project_id})]}),t.pending_transaction_id&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Pending transaction: ",t.pending_transaction_id]})]}),e.jsx("div",{className:"flex gap-2",children:t.inventory_status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:P,disabled:o,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Return to Inventory"}),e.jsxs("button",{onClick:()=>C("Client Card"),disabled:o,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 transition-colors disabled:opacity-50",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Mark as Sold"]})]})})]})]})}),t.images&&t.images.length>0&&e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:t.images.map((s,r)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.url,alt:s.alt||`Image ${r+1}`,className:"w-full h-32 object-cover rounded-lg"}),s.caption&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:s.caption})]},r))})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[t.inventory_status==="available"&&e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:E,disabled:o,className:"w-full inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors disabled:opacity-50",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Allocate to Project"]})}),e.jsxs(m,{to:`/business-inventory/${a}/edit`,className:"w-full inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Edit Item"]})]})]})}),e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Status History"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Current Status:"}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.inventory_status==="available"?"bg-green-100 text-green-800":t.inventory_status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.inventory_status==="available"?"Available":t.inventory_status==="pending"?"Allocated":"Sold"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Date Created:"}),e.jsx("span",{className:"text-gray-900",children:x(t.date_created)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Last Updated:"}),e.jsx("span",{className:"text-gray-900",children:x(t.last_updated)})]})]})]})})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Allocate Item to Project"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project-select",className:"block text-sm font-medium text-gray-700",children:"Select Project"}),e.jsxs("select",{id:"project-select",value:n.projectId,onChange:s=>c(r=>({...r,projectId:s.target.value})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Select a project..."}),w.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.clientName]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"allocation-amount",className:"block text-sm font-medium text-gray-700",children:"Amount to Bill Client"}),e.jsx("input",{type:"number",step:"0.01",id:"allocation-amount",value:n.amount,onChange:s=>c(r=>({...r,amount:s.target.value})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"allocation-notes",className:"block text-sm font-medium text-gray-700",children:"Notes (Optional)"}),e.jsx("textarea",{id:"allocation-notes",rows:3,value:n.notes,onChange:s=>c(r=>({...r,notes:s.target.value})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"Additional notes about this allocation..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:g,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:D,disabled:!n.projectId||!n.amount||o,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50",children:o?"Allocating...":"Allocate Item"})]})]})})})]}):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(T,{className:"mx-auto h-16 w-16 text-gray-400 -mb-1"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Item not found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"The item you're looking for doesn't exist or has been deleted."}),e.jsxs(m,{to:"/business-inventory",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Back to Inventory"]})]})}export{G as default};
//# sourceMappingURL=BusinessInventoryItemDetail.js.map
