{"version":3,"file":"ProjectDetail.js","sources":["../../src/pages/InventoryList.tsx","../../src/pages/TransactionsList.tsx","../../src/pages/ProjectDetail.tsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { Plus, Search, Bookmark, RotateCcw, Camera, ChevronDown, Edit, Trash2, QrCode, Filter, Copy } from 'lucide-react'\nimport { Link } from 'react-router-dom'\nimport { unifiedItemsService, integrationService } from '@/services/inventoryService'\nimport { lineageService } from '@/services/lineageService'\nimport { ImageUploadService } from '@/services/imageService'\nimport { Item, ItemImage } from '@/types'\nimport { useToast } from '@/components/ui/ToastContext'\nimport { useBookmark } from '@/hooks/useBookmark'\nimport { useDuplication } from '@/hooks/useDuplication'\nimport { useNavigationContext } from '@/hooks/useNavigationContext'\nimport { useAccount } from '@/contexts/AccountContext'\n\ninterface InventoryListProps {\n  projectId: string\n  projectName: string\n  items: Item[]\n}\n\nexport default function InventoryList({ projectId, projectName, items: propItems }: InventoryListProps) {\n  const { currentAccountId, loading: accountLoading } = useAccount()\n  const [searchQuery, setSearchQuery] = useState('')\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set())\n  const [items, setItems] = useState<Item[]>(propItems || [])\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  \n  // Show loading spinner only if account is loading - items come from props (parent handles that loading)\n  const isLoading = accountLoading\n  const [uploadingImages, setUploadingImages] = useState<Set<string>>(new Set())\n  const [openDispositionMenu, setOpenDispositionMenu] = useState<string | null>(null)\n  const [filterMode, setFilterMode] = useState<'all' | 'bookmarked' | 'to-inventory' | 'from-inventory'>('all')\n  const [showFilterMenu, setShowFilterMenu] = useState(false)\n  const { showSuccess, showError } = useToast()\n\n  // Debug logging\n  useEffect(() => {\n    console.log('üîç InventoryList - accountLoading:', accountLoading, 'propItems length:', propItems?.length || 0, 'isLoading:', isLoading)\n  }, [accountLoading, propItems, isLoading])\n\n  useEffect(() => {\n    console.log('üîç InventoryList - propItems changed:', propItems?.length || 0)\n    setItems(propItems || [])\n  }, [propItems])\n\n  // Per-visible-item lineage subscriptions: when an item has a lineage edge, refetch that item and update/remove as needed\n  useEffect(() => {\n    if (!currentAccountId || items.length === 0) return\n\n    const unsubMap = new Map<string, () => void>()\n    try {\n      items.forEach(item => {\n        if (!item?.itemId) return\n        const unsub = lineageService.subscribeToItemLineageForItem(currentAccountId, item.itemId, async () => {\n          try {\n            const updated = await unifiedItemsService.getItemById(currentAccountId, item.itemId)\n            if (updated) {\n              // If updated item still belongs to this project, update it; otherwise remove it from the list\n              if (updated.projectId === projectId) {\n                setItems(prev => prev.map(i => i.itemId === updated.itemId ? updated : i))\n              } else {\n                setItems(prev => prev.filter(i => i.itemId !== updated.itemId))\n              }\n            }\n          } catch (err) {\n            console.debug('InventoryList - failed to refetch item on lineage event', err)\n          }\n        })\n        unsubMap.set(item.itemId, unsub)\n      })\n    } catch (err) {\n      console.debug('InventoryList - failed to setup per-item lineage subscriptions', err)\n    }\n\n    return () => {\n      unsubMap.forEach(u => {\n        try { u() } catch (e) { /* noop */ }\n      })\n    }\n  }, [items.map(i => i.itemId).join(','), currentAccountId, projectId])\n\n \n\n  // Reset uploading state on unmount to prevent hanging state\n  useEffect(() => {\n    return () => {\n      setUploadingImages(new Set())\n    }\n  }, [])\n\n  // Close disposition menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (openDispositionMenu && !event.target) return\n\n      const target = event.target as Element\n      if (!target.closest('.disposition-menu') && !target.closest('.disposition-badge')) {\n        setOpenDispositionMenu(null)\n      }\n      if (showFilterMenu && !target.closest('.filter-menu') && !target.closest('.filter-button')) {\n        setShowFilterMenu(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [openDispositionMenu, showFilterMenu])\n\n  const handleSelectAll = (checked: boolean) => {\n    if (checked) {\n      setSelectedItems(new Set(items.map(item => item.itemId)))\n    } else {\n      setSelectedItems(new Set())\n    }\n  }\n\n  const handleSelectItem = (itemId: string, checked: boolean) => {\n    const newSelected = new Set(selectedItems)\n    if (checked) {\n      newSelected.add(itemId)\n    } else {\n      newSelected.delete(itemId)\n    }\n    setSelectedItems(newSelected)\n  }\n\n  // Use centralized bookmark hook\n  const { toggleBookmark } = useBookmark<Item>({\n    items,\n    setItems,\n    updateItemService: (itemId, updates) => {\n      if (!currentAccountId) throw new Error('Account ID is required')\n      return unifiedItemsService.updateItem(currentAccountId, itemId, updates)\n    },\n    projectId\n  })\n\n  // Use centralized duplication hook\n  const { duplicateItem } = useDuplication({\n    items,\n    setItems,\n    projectId\n  })\n\n  // Use navigation context for proper back navigation\n  const { buildContextUrl } = useNavigationContext()\n\n  const updateDisposition = async (itemId: string, newDisposition: string) => {\n    console.log('üéØ InventoryList updateDisposition called:', itemId, newDisposition)\n\n    try {\n      const item = items.find((item: Item) => item.itemId === itemId)\n      if (!item) {\n        console.error('‚ùå Item not found for disposition update:', itemId)\n        return\n      }\n\n      console.log('üìù Updating disposition from', item.disposition, 'to', newDisposition)\n\n      // Update in Supabase\n      if (!currentAccountId) throw new Error('Account ID is required')\n      await unifiedItemsService.updateItem(currentAccountId, itemId, { disposition: newDisposition })\n      console.log('üíæ Database updated successfully')\n\n      // If disposition is set to 'inventory', trigger deallocation process\n      if (newDisposition === 'inventory') {\n        console.log('üöÄ Starting deallocation process for item:', itemId)\n        try {\n          await integrationService.handleItemDeallocation(\n            currentAccountId,\n            itemId,\n            item.projectId || '',\n            newDisposition\n          )\n          console.log('‚úÖ Deallocation completed successfully')\n          // Close the disposition menu - real-time subscription will handle state update\n          setOpenDispositionMenu(null)\n        } catch (deallocationError) {\n          console.error('‚ùå Failed to handle deallocation:', deallocationError)\n          // Revert the disposition change if deallocation fails\n          await unifiedItemsService.updateItem(currentAccountId, itemId, {\n            disposition: item.disposition // Revert to previous disposition\n          })\n          setError('Failed to move item to inventory. Please try again.')\n          return\n        }\n      } else {\n        // For non-inventory dispositions, update local state optimistically\n        setItems(items.map(item =>\n          item.itemId === itemId\n            ? { ...item, disposition: newDisposition }\n            : item\n        ))\n\n        // Close the disposition menu\n        setOpenDispositionMenu(null)\n      }\n    } catch (error) {\n      console.error('‚ùå Failed to update disposition:', error)\n      setError('Failed to update item disposition. Please try again.')\n    }\n  }\n\n  const toggleDispositionMenu = (itemId: string) => {\n    setOpenDispositionMenu(openDispositionMenu === itemId ? null : itemId)\n  }\n\n  const getDispositionBadgeClasses = (disposition?: string) => {\n    const baseClasses = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium cursor-pointer transition-colors hover:opacity-80'\n\n    switch (disposition) {\n      case 'keep':\n        return `${baseClasses} bg-green-100 text-green-800`\n      case 'to return':\n      case 'return': // Backward compatibility for old disposition\n        return `${baseClasses} bg-red-100 text-red-700`\n      case 'returned':\n        return `${baseClasses} bg-red-800 text-red-100`\n      case 'inventory':\n        return `${baseClasses} bg-primary-100 text-primary-600`\n      default:\n        return `${baseClasses} bg-gray-100 text-gray-800`\n    }\n  }\n\n\n  const handleAddImage = async (itemId: string) => {\n    try {\n      setUploadingImages(prev => new Set(prev).add(itemId))\n\n      const files = await ImageUploadService.selectFromGallery()\n\n      if (files.length > 0) {\n        // Process all selected files sequentially\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i]\n          await processImageUpload(itemId, file, files)\n        }\n      }\n    } catch (error: any) {\n      console.error('Error adding image:', error)\n\n      // Handle cancel/timeout gracefully - don't show error for user cancellation\n      if (error.message?.includes('timeout') || error.message?.includes('canceled')) {\n        console.log('User canceled image selection or selection timed out')\n        return\n      }\n\n      // Show error for actual failures\n      showError('Failed to add image. Please try again.')\n    } finally {\n      setUploadingImages(prev => {\n        const newSet = new Set(prev)\n        newSet.delete(itemId)\n        return newSet\n      })\n    }\n  }\n\n  const processImageUpload = async (itemId: string, file: File, allFiles?: File[]) => {\n    const uploadResult = await ImageUploadService.uploadItemImage(\n      file,\n      projectName,\n      itemId\n    )\n\n    const newImage: ItemImage = {\n      url: uploadResult.url,\n      alt: file.name,\n      isPrimary: true, // First image is always primary when added from list\n      uploadedAt: new Date(),\n      fileName: file.name,\n      size: file.size,\n      mimeType: file.type\n    }\n\n    // Update the item with the new image\n    if (!currentAccountId) throw new Error('Account ID is required')\n    await unifiedItemsService.updateItem(currentAccountId, itemId, { images: [newImage] })\n    // The real-time listener will handle the UI update\n\n    // Show success notification on the last file\n    if (allFiles && allFiles.indexOf(file) === allFiles.length - 1) {\n      const message = allFiles.length > 1 ? `${allFiles.length} images uploaded successfully!` : 'Image uploaded successfully!'\n      showSuccess(message)\n    }\n  }\n\n  const handleBulkDelete = async () => {\n    if (selectedItems.size === 0) return\n\n    const confirmMessage = `Are you sure you want to delete ${selectedItems.size} item(s)? This action cannot be undone.`\n\n    if (!confirm(confirmMessage)) {\n      return\n    }\n\n    if (!currentAccountId) {\n      setError('Account ID is required')\n      return\n    }\n    try {\n      const deletePromises = Array.from(selectedItems).map(itemId =>\n        unifiedItemsService.deleteItem(currentAccountId, itemId)\n      )\n\n      await Promise.all(deletePromises)\n      setSelectedItems(new Set())\n      setError(null)\n    } catch (error) {\n      console.error('Failed to delete items:', error)\n      setError('Failed to delete some items. Please try again.')\n    }\n  }\n\n  const filteredItems = items.filter(item => {\n    // Apply search filter\n    const matchesSearch = item.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.source.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.sku?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.paymentMethod?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      (item.space && item.space.toLowerCase().includes(searchQuery.toLowerCase()))\n\n    // Apply filter based on filterMode\n    let matchesFilter = false\n    switch (filterMode) {\n      case 'all':\n        matchesFilter = true\n        break\n      case 'bookmarked':\n        matchesFilter = item.bookmark\n        break\n      case 'to-inventory':\n        matchesFilter = item.disposition === 'inventory'\n        break\n      case 'from-inventory':\n        matchesFilter = item.source === 'Inventory'\n        break\n      default:\n        matchesFilter = true\n    }\n\n    return matchesSearch && matchesFilter\n  })\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-2\">\n        <Link\n          to={`/project/${projectId}/item/add`}\n          className=\"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Item\n        </Link>\n      </div>\n\n      {/* Search and Controls - Sticky Container */}\n      <div className=\"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2\">\n        <div className=\"space-y-0\">\n          {/* Search Bar */}\n          <div className=\"relative pt-2\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <Search className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              type=\"text\"\n              className=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base\"\n              placeholder=\"Search items...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n            />\n          </div>\n\n          {/* Select All and Bulk Actions */}\n          <div className=\"flex items-center justify-between gap-4 p-3 rounded-lg\">\n          {/* Select All */}\n          <label className=\"flex items-center cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              className=\"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4\"\n              onChange={(e) => handleSelectAll(e.target.checked)}\n              checked={selectedItems.size === items.length && items.length > 0}\n            />\n            <span className=\"ml-3 text-sm font-medium text-gray-700\">Select all</span>\n          </label>\n\n          {/* Right section - counter and buttons */}\n          <div className=\"flex items-center gap-3\">\n            {/* Counter (when visible) */}\n            {selectedItems.size > 0 && (\n              <span className=\"text-sm text-gray-500\">\n                {selectedItems.size} of {items.length} selected\n              </span>\n            )}\n\n            {/* Bulk action buttons */}\n            <div className=\"flex items-center space-x-2\">\n              {/* Filter Button */}\n              <div className=\"relative\">\n                <button\n                  onClick={() => setShowFilterMenu(!showFilterMenu)}\n                  className={`filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${\n                    filterMode === 'all'\n                      ? 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                      : 'border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100'\n                  }`}\n                  title=\"Filter items\"\n                >\n                  <Filter className=\"h-4 w-4\" />\n                </button>\n\n                {/* Filter Dropdown Menu */}\n                {showFilterMenu && (\n                  <div className=\"filter-menu absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                    <div className=\"py-1\">\n                      <button\n                        onClick={() => {\n                          setFilterMode('all')\n                          setShowFilterMenu(false)\n                        }}\n                        className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                          filterMode === 'all' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                        }`}\n                      >\n                        All Items\n                      </button>\n                      <button\n                        onClick={() => {\n                          setFilterMode('bookmarked')\n                          setShowFilterMenu(false)\n                        }}\n                        className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                          filterMode === 'bookmarked' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                        }`}\n                      >\n                        Bookmarked\n                      </button>\n                      <button\n                        onClick={() => {\n                          setFilterMode('to-inventory')\n                          setShowFilterMenu(false)\n                        }}\n                        className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                          filterMode === 'to-inventory' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                        }`}\n                      >\n                        To Inventory\n                      </button>\n                      <button\n                        onClick={() => {\n                          setFilterMode('from-inventory')\n                          setShowFilterMenu(false)\n                        }}\n                        className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                          filterMode === 'from-inventory' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                        }`}\n                      >\n                        From Inventory\n                      </button>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              <button\n                className=\"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 transition-colors duration-200\"\n                disabled={selectedItems.size === 0}\n                title=\"Generate QR Codes\"\n              >\n                <QrCode className=\"h-4 w-4\" />\n              </button>\n\n              <button\n                onClick={handleBulkDelete}\n                className=\"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200\"\n                disabled={selectedItems.size === 0}\n                title=\"Delete All\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      </div>\n\n      {/* Loading State */}\n      {isLoading && (\n        <div className=\"text-center py-12 px-4\">\n          <div className=\"mx-auto h-16 w-16 text-gray-400 animate-spin mb-4\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\">\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Loading inventory...</h3>\n          <p className=\"text-sm text-gray-500\">Fetching your project items.</p>\n        </div>\n      )}\n\n      {/* Error State */}\n      {error && (\n        <div className=\"text-center py-12 px-4\">\n          <div className=\"mx-auto h-16 w-16 text-red-400 mb-4\">‚ö†Ô∏è</div>\n          <h3 className=\"text-lg font-medium text-red-900 mb-2\">Error loading inventory</h3>\n          <p className=\"text-sm text-red-500 mb-6 max-w-sm mx-auto\">{error}</p>\n          <button\n            onClick={() => window.location.reload()}\n            className=\"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 transition-colors duration-200 w-full sm:w-auto max-w-xs\"\n          >\n            <RotateCcw className=\"h-5 w-5 mr-2\" />\n            Retry\n          </button>\n        </div>\n      )}\n\n      {/* Items List */}\n      {!isLoading && !error && filteredItems.length === 0 ? (\n        <div className=\"text-center py-12 px-4\">\n          <div className=\"mx-auto h-16 w-16 text-gray-400 -mb-1\">üì¶</div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n            No items yet\n          </h3>\n        </div>\n      ) : (\n        !isLoading && !error && (\n          <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n            <ul className=\"divide-y divide-gray-200\">\n              {filteredItems.map((item) => (\n                <li key={item.itemId} className=\"relative bg-gray-50 transition-colors duration-200 hover:bg-gray-100\">\n                  {/* Top row: Controls - stays outside Link */}\n                  <div className=\"flex items-center justify-between mb-0 px-4 py-3\">\n                    <div className=\"flex items-center\">\n                      <input\n                        type=\"checkbox\"\n                        className=\"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4 flex-shrink-0\"\n                        checked={selectedItems.has(item.itemId)}\n                        onChange={(e) => handleSelectItem(item.itemId, e.target.checked)}\n                      />\n                    </div>\n\n                    {/* Action buttons */}\n                    <div className=\"flex items-center gap-2\">\n                      <button\n                        onClick={(e) => {\n                          e.preventDefault()\n                          e.stopPropagation()\n                          toggleBookmark(item.itemId)\n                        }}\n                        className={`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md transition-colors ${\n                          item.bookmark\n                            ? 'border-red-300 text-red-700 bg-red-50 hover:bg-red-100'\n                            : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                        } focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`}\n                        title={item.bookmark ? 'Remove Bookmark' : 'Add Bookmark'}\n                      >\n                        <Bookmark className=\"h-4 w-4\" fill={item.bookmark ? 'currentColor' : 'none'} />\n                      </button>\n                      <Link\n                        to={`/project/${projectId}/edit-item/${item.itemId}?project=${projectId}&returnTo=${encodeURIComponent(window.location.pathname + window.location.search)}`}\n                        onClick={(e) => e.stopPropagation()}\n                        className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors\"\n                        title=\"Edit item\"\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Link>\n                      <button\n                        onClick={(e) => {\n                          e.preventDefault()\n                          e.stopPropagation()\n                          duplicateItem(item.itemId)\n                        }}\n                        className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors\"\n                        title=\"Duplicate item\"\n                      >\n                        <Copy className=\"h-4 w-4\" />\n                      </button>\n                        <div className=\"relative ml-1\">\n                          <span\n                            onClick={(e) => {\n                              e.preventDefault()\n                              e.stopPropagation()\n                              toggleDispositionMenu(item.itemId)\n                            }}\n                          className={`disposition-badge ${getDispositionBadgeClasses(item.disposition)}`}\n                        >\n                          {item.disposition === 'to return' ? 'To Return' : item.disposition ? item.disposition.charAt(0).toUpperCase() + item.disposition.slice(1) : 'Not Set'}\n                            <ChevronDown className=\"h-3 w-3 ml-1\" />\n                          </span>\n\n                          {/* Dropdown menu */}\n                          {openDispositionMenu === item.itemId && (\n                            <div className=\"disposition-menu absolute top-full left-0 mt-1 w-32 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                              <div className=\"py-1\">\n                                {['keep', 'to return', 'returned', 'inventory'].map((disposition) => (\n                                  <button\n                                    key={disposition}\n                                    onClick={(e) => {\n                                      e.preventDefault()\n                                      e.stopPropagation()\n                                      updateDisposition(item.itemId, disposition)\n                                    }}\n                                    className={`block w-full text-left px-3 py-2 text-xs hover:bg-gray-50 ${\n                                      (item.disposition === disposition) || (disposition === 'to return' && item.disposition === 'return')\n                                        ? 'bg-gray-100 text-gray-900'\n                                        : 'text-gray-700'\n                                    }`}\n                                    disabled={!item.disposition}\n                                  >\n                                    {disposition === 'to return' ? 'To Return' : disposition.charAt(0).toUpperCase() + disposition.slice(1)}\n                                  </button>\n                                ))}\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                    </div>\n                  </div>\n\n                  {/* Main tappable content - wrapped in Link */}\n                  <Link to={buildContextUrl(`/item/${item.itemId}`, { project: projectId })}>\n                    <div className=\"block bg-transparent\">\n                      <div className=\"px-4 pb-3 sm:px-6\">\n                        {/* Middle row: Thumbnail and Description - now tappable */}\n                        <div className=\"flex items-center gap-3 py-3\">\n                          <div className=\"flex-shrink-0\">\n                            {item.images && item.images.length > 0 ? (\n                              // Show primary image thumbnail or first image if no primary\n                              (() => {\n                                const primaryImage = item.images.find(img => img.isPrimary) || item.images[0]\n                                return (\n                                  <div className=\"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200\">\n                                    <img\n                                      src={primaryImage.url}\n                                      alt={primaryImage.alt || 'Item image'}\n                                      className=\"w-full h-full object-cover\"\n                                    />\n                                  </div>\n                                )\n                              })()\n                            ) : (\n                              // Show camera placeholder when no images\n                              <button\n                                onClick={(e) => {\n                                  e.preventDefault()\n                                  e.stopPropagation()\n                                  handleAddImage(item.itemId)\n                                }}\n                                disabled={uploadingImages.has(item.itemId)}\n                                className=\"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors disabled:opacity-50\"\n                                title=\"Add image (camera or gallery)\"\n                              >\n                                <Camera className=\"h-6 w-6\" />\n                              </button>\n                            )}\n                          </div>\n\n                          {/* Item description - now tappable */}\n                          <div className=\"flex-1 min-w-0 flex items-center\">\n                            <div>\n                              <h3 className=\"text-base font-medium text-gray-900 line-clamp-2 break-words\">\n                                {item.description}\n                              </h3>\n                              {/* Space field */}\n                              {item.space && (\n                                <p className=\"text-sm text-gray-600 mt-1\">\n                                  {item.space}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Bottom row: Content - now tappable */}\n                        <div className=\"space-y-2\">\n                          {/* Project Price (or Purchase Price if project price not set), Source, SKU on same row */}\n                          <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500\">\n                            {(item.projectPrice || item.purchasePrice) && (\n                              <span className=\"font-medium text-gray-700\">${item.projectPrice || item.purchasePrice}</span>\n                            )}\n                            {item.source && (\n                              <>\n                                {(item.projectPrice || item.purchasePrice) && <span className=\"hidden sm:inline\">‚Ä¢</span>}\n                                <span className=\"font-medium text-gray-700\">{item.source}</span>\n                              </>\n                            )}\n                            {item.sku && (\n                              <>\n                                {(item.projectPrice || item.purchasePrice || item.source) && <span className=\"hidden sm:inline\">‚Ä¢</span>}\n                                <span className=\"font-medium text-gray-700\">{item.sku}</span>\n                              </>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </Link>\n                </li>\n              ))}\n            </ul>\n            \n          </div>\n        )\n      )}\n    </div>\n  )\n}\n\n","import { Plus, Search, Filter } from 'lucide-react'\nimport { Link, useParams } from 'react-router-dom'\nimport { useState, useEffect, useMemo } from 'react'\nimport { Transaction, TransactionCompleteness } from '@/types'\nimport { transactionService } from '@/services/inventoryService'\nimport type { Transaction as TransactionType } from '@/types'\nimport { COMPANY_INVENTORY_SALE, COMPANY_INVENTORY_PURCHASE, CLIENT_OWES_COMPANY, COMPANY_OWES_CLIENT } from '@/constants/company'\nimport { useAccount } from '@/contexts/AccountContext'\n\n// Canonical transaction title for display only\nconst getCanonicalTransactionTitle = (transaction: TransactionType): string => {\n  if (transaction.transactionId?.startsWith('INV_SALE_')) return COMPANY_INVENTORY_SALE\n  if (transaction.transactionId?.startsWith('INV_PURCHASE_')) return COMPANY_INVENTORY_PURCHASE\n  return transaction.source\n}\nimport { formatDate, formatCurrency } from '@/utils/dateUtils'\n\n// Remove any unwanted icons from transaction type badges\nconst removeUnwantedIcons = () => {\n  const badges = document.querySelectorAll('.no-icon')\n  badges.forEach(badge => {\n    // Remove any child elements that aren't text nodes\n    const children = Array.from(badge.childNodes)\n    children.forEach(child => {\n      if (child.nodeType !== Node.TEXT_NODE) {\n        badge.removeChild(child)\n      }\n    })\n  })\n}\n\ninterface TransactionsListProps {\n  projectId?: string\n  transactions?: Transaction[]\n}\n\nexport default function TransactionsList({ projectId: propProjectId, transactions: propTransactions }: TransactionsListProps) {\n  const { id: routeProjectId } = useParams<{ id: string }>()\n  const { currentAccountId } = useAccount()\n  // Use prop if provided, otherwise fall back to route param\n  const projectId = propProjectId || routeProjectId\n  const [transactions, setTransactions] = useState<Transaction[]>(propTransactions || [])\n  const [isLoading, setIsLoading] = useState(!propTransactions)\n  const [completenessById, setCompletenessById] = useState<Record<string, TransactionCompleteness | null>>({})\n\n  // Search and filter state\n  const [searchQuery, setSearchQuery] = useState<string>('')\n  const [showFilterMenu, setShowFilterMenu] = useState(false)\n  const [filterMode, setFilterMode] = useState<'all' | 'we-owe' | 'client-owes'>('all')\n\n  useEffect(() => {\n    // If transactions are passed as a prop, just update the state\n    if (propTransactions) {\n      setTransactions(propTransactions)\n      return\n    }\n\n    // If no transactions prop, fetch them\n    let unsubscribe: (() => void) | undefined\n\n    const setupSubscription = (initialTransactions: Transaction[]) => {\n      if (!projectId || !currentAccountId) return\n      unsubscribe = transactionService.subscribeToTransactions(\n        currentAccountId,\n        projectId,\n        (updatedTransactions) => {\n          setTransactions(updatedTransactions)\n        },\n        initialTransactions\n      )\n    }\n\n    const loadTransactions = async () => {\n      if (!projectId || !currentAccountId) {\n        setIsLoading(false)\n        return\n      }\n\n      // Only load if transactions were not passed in props\n      if (!propTransactions) {\n        try {\n          const data = await transactionService.getTransactions(currentAccountId, projectId)\n          setTransactions(data)\n          setupSubscription(data)\n        } catch (error) {\n          console.error('Error loading transactions:', error)\n          setTransactions([])\n        } finally {\n          setIsLoading(false)\n        }\n      }\n    }\n\n    loadTransactions()\n\n    return () => {\n      if (unsubscribe) {\n        unsubscribe()\n      }\n    }\n  }, [projectId, currentAccountId, propTransactions])\n\n  // Load completeness metrics for each transaction to show \"Missing items\" badge\n  useEffect(() => {\n    let mounted = true\n    const loadCompletenessForTransactions = async () => {\n      if (!projectId || !currentAccountId || transactions.length === 0) return\n      try {\n        // If the backend surfaces `needsReview` on the transaction, we can skip\n        // the per-transaction completeness fetch for the list view to improve perf.\n        const txsToFetch = transactions.filter(t => t.needsReview === undefined)\n        const promises = txsToFetch.map(t =>\n          transactionService.getTransactionCompleteness(currentAccountId, projectId, t.transactionId)\n            .catch(err => {\n              console.debug('Failed to load completeness for', t.transactionId, err)\n              return null\n            })\n        )\n        const results = await Promise.all(promises)\n        if (!mounted) return\n        const map: Record<string, TransactionCompleteness | null> = {}\n        // Populate map only for transactions we fetched\n        txsToFetch.forEach((t, idx) => {\n          map[t.transactionId] = results[idx]\n        })\n        setCompletenessById(map)\n      } catch (err) {\n        console.error('Error loading transaction completeness:', err)\n      }\n    }\n\n    loadCompletenessForTransactions()\n    return () => { mounted = false }\n  }, [transactions, projectId, currentAccountId])\n\n  // Filter transactions based on search and filter mode\n  const filteredTransactions = useMemo(() => {\n    let filtered = transactions\n\n    // Apply reimbursement type filter based on filter mode\n    if (filterMode !== 'all') {\n      if (filterMode === 'we-owe') {\n        filtered = filtered.filter(t => t.reimbursementType === COMPANY_OWES_CLIENT)\n      } else if (filterMode === 'client-owes') {\n        filtered = filtered.filter(t => t.reimbursementType === CLIENT_OWES_COMPANY)\n      }\n    }\n\n    // Apply search filter\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase()\n      filtered = filtered.filter(t =>\n        t.source?.toLowerCase().includes(query) ||\n        t.transactionType?.toLowerCase().includes(query) ||\n        t.notes?.toLowerCase().includes(query)\n      )\n    }\n\n    return filtered\n  }, [transactions, filterMode, searchQuery])\n\n  // Close filter menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (!event.target) return\n\n      const target = event.target as Element\n      if (!target.closest('.filter-menu') && !target.closest('.filter-button')) {\n        setShowFilterMenu(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [])\n\n  // Clean up any unwanted icons from transaction type badges\n  useEffect(() => {\n    removeUnwantedIcons()\n    // Also run after a short delay to catch any dynamically added icons\n    const timer = setTimeout(removeUnwantedIcons, 100)\n    const timer2 = setTimeout(removeUnwantedIcons, 500)\n    return () => {\n      clearTimeout(timer)\n      clearTimeout(timer2)\n    }\n  }, [transactions])\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-32\">\n        <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header - Add Transaction button */}\n      <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2\">\n        <Link\n          to={`/project/${projectId}/transaction/add`}\n          className=\"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Transaction\n        </Link>\n      </div>\n\n      {/* Search and Controls - Sticky Container */}\n      <div className=\"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2\">\n        <div className=\"space-y-0\">\n          {/* Search Bar */}\n          <div className=\"relative pt-2\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <Search className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              type=\"text\"\n              className=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base\"\n              placeholder=\"Search transactions by source, type, or notes...\"\n              value={searchQuery || ''}\n              onChange={(e) => setSearchQuery(e.target.value)}\n            />\n          </div>\n\n          {/* Filter Controls */}\n          <div className=\"flex items-center justify-end gap-4 p-3 rounded-lg\">\n            {/* Filter Button */}\n            <div className=\"relative\">\n              <button\n                onClick={() => setShowFilterMenu(!showFilterMenu)}\n                className={`filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${\n                  filterMode === 'all'\n                    ? 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                    : 'border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100'\n                }`}\n                title=\"Filter transactions\"\n              >\n                <Filter className=\"h-4 w-4\" />\n              </button>\n\n              {/* Filter Dropdown Menu */}\n              {showFilterMenu && (\n                <div className=\"filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                  <div className=\"py-1\">\n                    <button\n                      onClick={() => {\n                        setFilterMode('all')\n                        setShowFilterMenu(false)\n                      }}\n                      className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                        filterMode === 'all' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                      }`}\n                    >\n                      All Transactions\n                    </button>\n                    <button\n                      onClick={() => {\n                        setFilterMode('we-owe')\n                        setShowFilterMenu(false)\n                      }}\n                      className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                        filterMode === 'we-owe' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                      }`}\n                    >\n                      We Owe\n                    </button>\n                    <button\n                      onClick={() => {\n                        setFilterMode('client-owes')\n                        setShowFilterMenu(false)\n                      }}\n                      className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                        filterMode === 'client-owes' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                      }`}\n                    >\n                      Client Owes\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Transactions List */}\n      {filteredTransactions.length === 0 ? (\n        <div className=\"text-center py-12 px-4\">\n          <div className=\"mx-auto h-16 w-16 text-gray-400 -mb-1\">üßæ</div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n            No transactions found\n          </h3>\n          <p className=\"text-sm text-gray-500 mb-4\">\n            {searchQuery || filterMode !== 'all'\n              ? 'Try adjusting your search or filter criteria.'\n              : 'No transactions found.'\n            }\n          </p>\n        </div>\n      ) : (\n        <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n          <ul className=\"divide-y divide-gray-200\">\n            {filteredTransactions.map((transaction) => (\n              <li key={transaction.transactionId} className=\"relative\">\n                <Link\n                  to={`/project/${projectId}/transaction/${transaction.transactionId}`}\n                  className=\"block bg-gray-50 transition-colors duration-200 hover:bg-gray-100\"\n                >\n                  <div className=\"px-4 py-4 sm:px-6\">\n                    {/* Top row: Header with canonical title and type */}\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex items-center\">\n                        <h3 className=\"text-base font-medium text-gray-900\">\n                          {getCanonicalTransactionTitle(transaction)}\n                        </h3>\n                      </div>\n                    </div>\n\n                    {/* Bottom row: Details */}\n                    <div className=\"space-y-2\">\n                      {/* Details row - Price, payment method, date */}\n                      <div className=\"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500\">\n                        <span className=\"font-medium text-gray-700\">{formatCurrency(transaction.amount)}</span>\n                        <span className=\"hidden sm:inline\">‚Ä¢</span>\n                        <span className=\"font-medium text-gray-700 capitalize\">{transaction.paymentMethod}</span>\n                        <span className=\"hidden sm:inline\">‚Ä¢</span>\n                        <span className=\"font-medium text-gray-700\">{formatDate(transaction.transactionDate)}</span>\n                      </div>\n\n                      {/* Notes */}\n                      {transaction.notes && (\n                        <p className=\"text-sm text-gray-600 line-clamp-2\">\n                          {transaction.notes}\n                        </p>\n                      )}\n                    </div>\n                    {/* Badges moved to bottom of preview container */}\n                    <div className=\"mt-3 flex items-center flex-wrap gap-2\">\n                      {transaction.budgetCategory && (\n                        <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${\n                          transaction.budgetCategory === 'Design Fee'\n                            ? 'bg-amber-100 text-amber-800'\n                            : transaction.budgetCategory === 'Furnishings'\n                            ? 'bg-yellow-100 text-yellow-800'\n                            : transaction.budgetCategory === 'Property Management'\n                            ? 'bg-orange-100 text-orange-800'\n                            : transaction.budgetCategory === 'Kitchen'\n                            ? 'bg-amber-200 text-amber-900'\n                            : transaction.budgetCategory === 'Install'\n                            ? 'bg-yellow-200 text-yellow-900'\n                            : transaction.budgetCategory === 'Storage & Receiving'\n                            ? 'bg-orange-200 text-orange-900'\n                            : transaction.budgetCategory === 'Fuel'\n                            ? 'bg-amber-300 text-amber-900'\n                            : 'bg-gray-100 text-gray-800'\n                        }`}>\n                          {transaction.budgetCategory}\n                        </span>\n                      )}\n                      <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium no-icon ${\n                        transaction.transactionType === 'Purchase'\n                          ? 'bg-green-100 text-green-800'\n                          : transaction.transactionType === 'Return'\n                          ? 'bg-red-100 text-red-800'\n                          : transaction.transactionType === 'To Inventory'\n                          ? 'bg-primary-100 text-primary-800'\n                          : 'bg-gray-100 text-gray-800'\n                      }`}>\n                        {transaction.transactionType}\n                      </span>\n                      {transaction.needsReview === true ? (\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\n                          Needs Review\n                        </span>\n                      ) : (\n                        completenessById[transaction.transactionId] && completenessById[transaction.transactionId]?.completenessStatus !== 'complete' && (\n                          <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\n                            Missing Items\n                          </span>\n                        )\n                      )}\n                    </div>\n\n                  </div>\n                </Link>\n              </li>\n            ))}\n          </ul>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { ArrowLeft, Package, FileText, Edit, Trash2, DollarSign, Building2, User, Receipt } from 'lucide-react'\nimport { useMemo } from 'react'\nimport { Link, useParams, useNavigate, useSearchParams, useLocation } from 'react-router-dom'\nimport { useState, useEffect } from 'react'\nimport { Project, Transaction, Item } from '@/types'\nimport { projectService, transactionService, unifiedItemsService } from '@/services/inventoryService'\nimport { lineageService } from '@/services/lineageService'\nimport { useAccount } from '@/contexts/AccountContext'\nimport InventoryList from './InventoryList'\nimport TransactionsList from './TransactionsList'\nimport ProjectForm from '@/components/ProjectForm'\nimport BudgetProgress from '@/components/ui/BudgetProgress'\nimport { useToast } from '@/components/ui/ToastContext'\nimport { Button } from '@/components/ui/Button'\nimport { CLIENT_OWES_COMPANY, COMPANY_OWES_CLIENT } from '@/constants/company'\n\nexport default function ProjectDetail() {\n  const { id } = useParams<{ id: string }>()\n  const navigate = useNavigate()\n  const location = useLocation()\n  const { currentAccountId } = useAccount()\n  const [searchParams, setSearchParams] = useSearchParams()\n  const budgetTabParam = searchParams.get('budgetTab')\n  const [project, setProject] = useState<Project | null>(null)\n  const [transactions, setTransactions] = useState<Transaction[]>([])\n  const [items, setItems] = useState<Item[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)\n  const [isDeleting, setIsDeleting] = useState(false)\n  const { showError } = useToast()\n\n  // Get active tab from URL parameters, default to 'transactions'\n  const activeTab = searchParams.get('tab') || 'transactions'\n\n  // Budget tabs state, default to 'budget'\n  const [activeBudgetTab, setActiveBudgetTab] = useState<string>(() => (budgetTabParam === 'accounting' ? 'accounting' : 'budget'))\n\n  // Navigation context logic\n  const currentSearchParams = new URLSearchParams(location.search)\n  const fromBusinessInventoryItem = currentSearchParams.get('from') === 'business-inventory-item'\n\n  const backDestination = useMemo(() => {\n    // Check if we have a returnTo parameter (highest priority)\n    const returnTo = currentSearchParams.get('returnTo')\n    if (returnTo) return returnTo\n\n    // If we came from business inventory item, go back there\n    if (fromBusinessInventoryItem) {\n      // Extract the item ID from the returnTo URL if available, otherwise go to main inventory\n      const returnToUrl = currentSearchParams.get('returnTo')\n      if (returnToUrl && returnToUrl.includes('/business-inventory/')) {\n        return returnToUrl\n      }\n      return '/business-inventory' // Fallback to main inventory\n    }\n\n    return '/projects' // Default to projects list\n  }, [fromBusinessInventoryItem, currentSearchParams])\n\n  // Update URL when tab changes\n  const handleTabChange = (tabId: string) => {\n    const newSearchParams = new URLSearchParams(searchParams)\n    newSearchParams.set('tab', tabId)\n    setSearchParams(newSearchParams)\n  }\n\n  // Handle budget tab changes\n  const handleBudgetTabChange = (tabId: string) => {\n    setActiveBudgetTab(tabId)\n    const newSearchParams = new URLSearchParams(searchParams)\n    newSearchParams.set('budgetTab', tabId)\n    setSearchParams(newSearchParams)\n  }\n\n  // Calculate amounts owed - simple sum of transaction amounts by reimbursement type\n  const owedTo1584 = useMemo(() => {\n    return transactions\n      .filter(t => t.status !== 'canceled')\n      .filter(t => t.reimbursementType === CLIENT_OWES_COMPANY)\n      .reduce((sum, t) => sum + parseFloat(t.amount || '0'), 0)\n  }, [transactions])\n\n  const owedToClient = useMemo(() => {\n    return transactions\n      .filter(t => t.status !== 'canceled')\n      .filter(t => t.reimbursementType === COMPANY_OWES_CLIENT)\n      .reduce((sum, t) => sum + parseFloat(t.amount || '0'), 0)\n  }, [transactions])\n\n  useEffect(() => {\n    console.log('üîç ProjectDetail - useEffect triggered. id:', id, 'currentAccountId:', currentAccountId, 'isLoading:', isLoading)\n    \n    let transactionUnsubscribe: (() => void) | undefined\n    let itemsUnsubscribe: (() => void) | undefined\n\n    const setupTransactionSubscription = (initialTransactions: Transaction[]) => {\n      if (!id || !currentAccountId) return\n      transactionUnsubscribe = transactionService.subscribeToTransactions(\n        currentAccountId,\n        id,\n        (updatedTransactions) => {\n          setTransactions(updatedTransactions)\n        },\n        initialTransactions\n      )\n    }\n\n    const setupItemsSubscription = (initialItems: Item[]) => {\n      if (!id || !currentAccountId) return\n      itemsUnsubscribe = unifiedItemsService.subscribeToProjectItems(\n        currentAccountId,\n        id,\n        (updatedItems) => {\n          setItems(updatedItems)\n        },\n        initialItems\n      )\n    }\n\n    const loadData = async () => {\n      console.log('üîç ProjectDetail - loadData called. id:', id, 'currentAccountId:', currentAccountId)\n      \n      if (!id) {\n        console.warn('No project ID provided, redirecting to projects')\n        navigate('/projects')\n        return\n      }\n      if (!currentAccountId) {\n        console.log('üîç ProjectDetail - No account ID yet, waiting...')\n        return\n      }\n\n      setIsLoading(true)\n      try {\n        console.log('üîç ProjectDetail - Loading project data for ID:', id)\n        const projectData = await projectService.getProject(currentAccountId, id)\n        if (projectData) {\n          console.log('üîç ProjectDetail - Project loaded successfully:', projectData.name)\n          setProject(projectData)\n\n          const [transactionsData, itemsData] = await Promise.all([\n            transactionService.getTransactions(currentAccountId, id),\n            unifiedItemsService.getItemsByProject(currentAccountId, id)\n          ])\n\n          console.log('üîç ProjectDetail - Loaded', transactionsData.length, 'transactions and', itemsData.length, 'items')\n          setTransactions(transactionsData)\n          setItems(itemsData)\n          setupTransactionSubscription(transactionsData)\n          setupItemsSubscription(itemsData)\n        } else {\n          console.warn('Project not found:', id)\n          navigate('/projects')\n        }\n      } catch (error) {\n        console.error('Error loading project:', error)\n        setError('Failed to load project. Please try again.')\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    loadData()\n\n    return () => {\n      if (transactionUnsubscribe) transactionUnsubscribe()\n      if (itemsUnsubscribe) itemsUnsubscribe()\n    }\n  }, [id, currentAccountId, navigate])\n\n  // Subscribe to edges-from-transaction for each transaction so we can refresh items\n  useEffect(() => {\n    if (!currentAccountId || !id || transactions.length === 0) return\n\n    const unsubs: (() => void)[] = []\n    try {\n      transactions.forEach(tx => {\n        if (!tx.transactionId) return\n        const unsub = lineageService.subscribeToEdgesFromTransaction(currentAccountId, tx.transactionId, async () => {\n          try {\n            const updatedItems = await unifiedItemsService.getItemsByProject(currentAccountId, id)\n            setItems(updatedItems)\n          } catch (err) {\n            console.debug('ProjectDetail - failed to refresh items on lineage event', err)\n          }\n\n          // Also refresh transactions for the project to reflect any deletions/changes\n          try {\n            const updatedTransactions = await transactionService.getTransactions(currentAccountId, id)\n            setTransactions(updatedTransactions)\n          } catch (tErr) {\n            console.debug('ProjectDetail - failed to refresh transactions on lineage event', tErr)\n          }\n        })\n        unsubs.push(unsub)\n      })\n    } catch (err) {\n      console.debug('ProjectDetail - failed to subscribe to edges from transactions', err)\n    }\n\n    return () => {\n      unsubs.forEach(u => {\n        try { u() } catch (e) { /* noop */ }\n      })\n    }\n  }, [transactions.map(t => t.transactionId).join(','), currentAccountId, id])\n\n  // Retry function for failed loads\n  const retryLoadProject = () => {\n    setError(null)\n    // We need to reload the data, not just call the old function\n    if (id && currentAccountId) {\n      // Re-trigger the useEffect\n      navigate(0); \n    }\n  };\n\n  const handleEditProject = async (projectData: any) => {\n    if (!project || !id || !currentAccountId) return\n\n    try {\n      await projectService.updateProject(currentAccountId, id, projectData)\n      // Reload project data\n      const updatedProject = await projectService.getProject(currentAccountId, id)\n      setProject(updatedProject)\n      setIsEditing(false)\n    } catch (error) {\n      console.error('Error updating project:', error)\n      throw error // Let the form handle the error\n    }\n  }\n\n  const handleStartEdit = () => {\n    setIsEditing(true)\n  }\n\n  const handleCancelEdit = () => {\n    setIsEditing(false)\n  }\n\n  const handleShowDeleteConfirm = () => {\n    setShowDeleteConfirm(true)\n  }\n\n  const handleCancelDelete = () => {\n    setShowDeleteConfirm(false)\n  }\n\n  const handleDeleteProject = async () => {\n    if (!id || !currentAccountId) return\n\n    setIsDeleting(true)\n    try {\n      await projectService.deleteProject(currentAccountId, id)\n      // Redirect to projects list after successful deletion\n      navigate('/projects')\n    } catch (error) {\n      console.error('Error deleting project:', error)\n      setIsDeleting(false)\n      setShowDeleteConfirm(false)\n      // Show error message to user\n      showError('Failed to delete project. Please try again.')\n    }\n  }\n\n  const tabs = [\n    { id: 'inventory', name: 'Items', icon: Package },\n    { id: 'transactions', name: 'Transactions', icon: FileText }\n  ]\n\n  const budgetTabs = [\n    { id: 'budget', name: 'Budget', icon: FileText },\n    { id: 'accounting', name: 'Accounting', icon: DollarSign }\n  ]\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto\"></div>\n          <p className=\"mt-2 text-sm text-gray-600\">Loading project...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"mx-auto h-12 w-12 text-red-400\">‚ö†Ô∏è</div>\n        <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Error Loading Project</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">{error}</p>\n        <div className=\"mt-6 flex justify-center space-x-3\">\n          <button\n            onClick={retryLoadProject}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n          >\n            Try Again\n          </button>\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Projects\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  if (!project) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"mx-auto h-12 w-12 text-gray-400\">üìÅ</div>\n        <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Project not found</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">The project you're looking for doesn't exist.</p>\n        <div className=\"mt-6\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Projects\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-4\">\n        {/* Back button row */}\n        <div className=\"flex items-center justify-between\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Link>\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={handleStartEdit}\n              className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n            >\n              <Edit className=\"h-4 w-4 mr-2\" />\n              Edit\n            </button>\n            <button\n              onClick={handleShowDeleteConfirm}\n              className=\"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Delete\n            </button>\n          </div>\n        </div>\n\n        {/* Project information and Budget/Accounting Tabs */}\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          {/* Project information */}\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-1\">{project.name}</h1>\n            {project.clientName && (\n              <p className=\"text-lg text-gray-600 mb-6\">{project.clientName}</p>\n            )}\n          </div>\n\n          {/* Tab Navigation */}\n          <div className=\"border-b border-gray-200\">\n            <nav className=\"-mb-px flex space-x-8\">\n              {budgetTabs.map((tab) => {\n                const Icon = tab.icon\n                return (\n                  <button\n                    key={tab.id}\n                    onClick={() => handleBudgetTabChange(tab.id)}\n                    className={`py-4 px-1 border-b-2 font-medium text-base flex items-center ${\n                      activeBudgetTab === tab.id\n                        ? 'border-primary-500 text-primary-600'\n                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                    }`}\n                  >\n                    <Icon className=\"h-4 w-4 mr-2\" />\n                    {tab.name}\n                  </button>\n                )\n              })}\n            </nav>\n          </div>\n\n          {/* Tab Content */}\n          <div className=\"pt-6\">\n            {activeBudgetTab === 'budget' && project && (\n              <BudgetProgress\n                budget={project.budget}\n                designFee={project.designFee}\n                budgetCategories={project.budgetCategories}\n                transactions={transactions}\n              />\n            )}\n            {activeBudgetTab === 'accounting' && (\n              <div className=\"space-y-6\">\n                {/* Dashboard Section */}\n                <section>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    {/* Owed to Design Business */}\n                    <div className=\"bg-gray-50 rounded-lg p-3\">\n                      <div className=\"text-sm font-medium text-gray-600 mb-0.5\">Owed to Design Business</div>\n                      <div className=\"text-xl font-bold text-gray-900\">\n                        ${owedTo1584.toFixed(2)}\n                      </div>\n                    </div>\n\n                    {/* Owed to Client */}\n                    <div className=\"bg-gray-50 rounded-lg p-3\">\n                      <div className=\"text-sm font-medium text-gray-600 mb-0.5\">Owed to Client</div>\n                      <div className=\"text-xl font-bold text-gray-900\">\n                        ${owedToClient.toFixed(2)}\n                      </div>\n                    </div>\n                  </div>\n                </section>\n\n                {/* Reports Section */}\n                <section>\n                  <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Reports</h2>\n                  <div className=\"flex flex-wrap gap-3\">\n                    <Button variant=\"secondary\" onClick={() => navigate(`/project/${project.id}/property-management-summary`)}>\n                      <Building2 className=\"h-4 w-4 mr-2\" />\n                      Generate Property Management Summary\n                    </Button>\n                    <Button variant=\"secondary\" onClick={() => navigate(`/project/${project.id}/client-summary`)}>\n                      <User className=\"h-4 w-4 mr-2\" />\n                      Generate Client Summary\n                    </Button>\n                    <Button variant=\"secondary\" onClick={() => navigate(`/project/${project.id}/invoice`)}>\n                      <Receipt className=\"h-4 w-4 mr-2\" />\n                      Generate Invoice\n                    </Button>\n                  </div>\n                </section>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"bg-white shadow rounded-lg\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"-mb-px flex space-x-8 px-6\">\n            {tabs.map((tab) => {\n              const Icon = tab.icon\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => handleTabChange(tab.id)}\n                  className={`py-4 px-1 border-b-2 font-medium text-base flex items-center ${\n                    activeTab === tab.id\n                      ? 'border-primary-500 text-primary-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  <Icon className=\"h-4 w-4 mr-2\" />\n                  {tab.name}\n                </button>\n              )\n            })}\n          </nav>\n        </div>\n\n        {/* Tab Content */}\n        <div className=\"px-6 py-6\">\n          {activeTab === 'inventory' && project && (\n            <>\n              {console.log('üîç ProjectDetail - Rendering InventoryList with', items.length, 'items')}\n              <InventoryList projectId={project.id} projectName={project.name} items={items} />\n            </>\n          )}\n          {activeTab === 'transactions' && project && (\n            <TransactionsList projectId={project.id} transactions={transactions} />\n          )}\n        </div>\n      </div>\n\n        {/* Project Edit Form */}\n        {isEditing && project && (\n          <ProjectForm\n            initialData={{\n              name: project.name,\n              description: project.description,\n              clientName: project.clientName,\n              budget: project.budget,\n              designFee: project.designFee,\n              budgetCategories: project.budgetCategories,\n            }}\n            onSubmit={handleEditProject}\n            onCancel={handleCancelEdit}\n          />\n        )}\n\n      {/* Delete Confirmation Dialog */}\n      {showDeleteConfirm && (\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n          <div className=\"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white\">\n            <div className=\"mt-3\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-medium text-gray-900\">\n                  Delete\n                </h3>\n                <button\n                  onClick={handleCancelDelete}\n                  className=\"text-gray-400 hover:text-gray-600\"\n                >\n                  <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n\n              {/* Content */}\n              <div className=\"mt-2\">\n                <p className=\"text-sm text-gray-500 mb-4\">\n                  Are you sure you want to delete the project <strong>\"{project?.name}\"</strong>?\n                  This action cannot be undone and will permanently delete the project and all associated data.\n                </p>\n\n                {/* Warning about items and transactions */}\n                {project && project.metadata?.totalItems && project.metadata.totalItems > 0 && (\n                  <div className=\"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4\">\n                    <div className=\"flex\">\n                      <div className=\"ml-3\">\n                        <h4 className=\"text-sm font-medium text-yellow-800\">\n                          Warning\n                        </h4>\n                        <div className=\"mt-1 text-sm text-yellow-700\">\n                          <p>This project contains {project.metadata.totalItems} item(s). Deleting the project will permanently remove all associated data.</p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Buttons */}\n                <div className=\"flex justify-end space-x-3\">\n                  <button\n                    onClick={handleCancelDelete}\n                    disabled={isDeleting}\n                    className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    onClick={handleDeleteProject}\n                    disabled={isDeleting}\n                    className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50\"\n                  >\n                    {isDeleting ? 'Deleting...' : 'Delete'}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":["InventoryList","projectId","projectName","propItems","currentAccountId","accountLoading","useAccount","searchQuery","setSearchQuery","useState","selectedItems","setSelectedItems","items","setItems","loading","setLoading","error","setError","isLoading","uploadingImages","setUploadingImages","openDispositionMenu","setOpenDispositionMenu","filterMode","setFilterMode","showFilterMenu","setShowFilterMenu","showSuccess","showError","useToast","useEffect","unsubMap","item","unsub","lineageService","updated","unifiedItemsService","prev","i","err","u","handleClickOutside","event","target","handleSelectAll","checked","handleSelectItem","itemId","newSelected","toggleBookmark","useBookmark","updates","duplicateItem","useDuplication","buildContextUrl","useNavigationContext","updateDisposition","newDisposition","integrationService","deallocationError","toggleDispositionMenu","getDispositionBadgeClasses","disposition","baseClasses","handleAddImage","files","ImageUploadService","file","processImageUpload","newSet","allFiles","newImage","message","handleBulkDelete","confirmMessage","deletePromises","filteredItems","matchesSearch","_a","_b","matchesFilter","jsxs","jsx","Link","Plus","Search","e","Filter","QrCode","Trash2","RotateCcw","Bookmark","Edit","Copy","ChevronDown","primaryImage","img","Camera","Fragment","getCanonicalTransactionTitle","transaction","COMPANY_INVENTORY_SALE","COMPANY_INVENTORY_PURCHASE","removeUnwantedIcons","badge","child","TransactionsList","propProjectId","propTransactions","routeProjectId","useParams","transactions","setTransactions","setIsLoading","completenessById","setCompletenessById","unsubscribe","setupSubscription","initialTransactions","transactionService","updatedTransactions","data","mounted","txsToFetch","t","promises","results","map","idx","filteredTransactions","useMemo","filtered","COMPANY_OWES_CLIENT","CLIENT_OWES_COMPANY","query","_c","timer","timer2","formatCurrency","formatDate","ProjectDetail","id","navigate","useNavigate","location","useLocation","searchParams","setSearchParams","useSearchParams","budgetTabParam","project","setProject","isEditing","setIsEditing","showDeleteConfirm","setShowDeleteConfirm","isDeleting","setIsDeleting","activeTab","activeBudgetTab","setActiveBudgetTab","currentSearchParams","fromBusinessInventoryItem","backDestination","returnTo","returnToUrl","handleTabChange","tabId","newSearchParams","handleBudgetTabChange","owedTo1584","sum","owedToClient","transactionUnsubscribe","itemsUnsubscribe","setupTransactionSubscription","setupItemsSubscription","initialItems","updatedItems","projectData","projectService","transactionsData","itemsData","unsubs","tx","tErr","retryLoadProject","handleEditProject","updatedProject","handleStartEdit","handleCancelEdit","handleShowDeleteConfirm","handleCancelDelete","handleDeleteProject","tabs","Package","FileText","budgetTabs","DollarSign","ArrowLeft","tab","Icon","BudgetProgress","Button","Building2","User","Receipt","ProjectForm"],"mappings":"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"}