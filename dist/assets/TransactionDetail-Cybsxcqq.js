import{u as E,j as e}from"./index-DRwKqTma.js";import{u as D,b as k,L as g}from"./router-Bad1IJif.js";import{r as i}from"./vendor-Gm9i_4Ku.js";import{t as l,p as P}from"./inventoryService-CSqmAljY.js";import{f as j,a as S}from"./dateUtils-BvsVwtCK.js";import{b as y,d as C,T as R,q as I,h as $,f as L,p as A}from"./ui-DKDhksGx.js";import"./firebase-DTZupgGV.js";const u=()=>{document.querySelectorAll(".no-icon").forEach(r=>{Array.from(r.childNodes).forEach(t=>{t.nodeType!==Node.TEXT_NODE&&t.parentNode&&t.parentNode.removeChild(t)})})};function Y(){const{id:a,transactionId:r}=D(),h=k(),[t,d]=i.useState(null),[m,b]=i.useState(null),[N,v]=i.useState(!0),[f,x]=i.useState(""),{showError:w}=E();i.useEffect(()=>{(async()=>{var s;if(!(!a||!r))try{const[o,c]=await Promise.all([l.getTransaction(a,r),P.getProject(a)]),p={...o};d(p),b(c),console.log("Transaction loaded:",o),console.log("Transaction keys:",Object.keys(o||{})),console.log("Transaction images count:",((s=p.transaction_images)==null?void 0:s.length)||0),console.log("Project loaded:",c)}catch(o){console.error("Error loading transaction:",o)}finally{v(!1)}})()},[a,r]),i.useEffect(()=>{if(!a||!r)return;const n=l.subscribeToTransaction(a,r,s=>{var o;if(s){const c={...s};console.log("Real-time transaction update received:",s.transaction_id),console.log("Updated transaction images count:",((o=c.transaction_images)==null?void 0:o.length)||0),d(c)}else console.warn("Transaction not found:",r),d(null)});return()=>{n()}},[a,r]);const T=async()=>{var n;if(!(!a||!r))try{x("Refreshing transaction data...");const s=await l.getTransaction(a,r),o={...s};console.log("Manual refresh - transaction data:",s),console.log("Manual refresh - transaction images count:",((n=o.transaction_images)==null?void 0:n.length)||0),console.log("Manual refresh - transaction images data:",o.transaction_images),d(o),x(`Refreshed at ${new Date().toLocaleTimeString()}`)}catch(s){console.error("Error refreshing transaction:",s),x("Error refreshing: "+(s instanceof Error?s.message:String(s)))}};i.useEffect(()=>{if(t){u();const n=setTimeout(u,100),s=setTimeout(u,500);return()=>{clearTimeout(n),clearTimeout(s)}}},[t]);const _=async()=>{if(!(!a||!r||!t)&&window.confirm("Are you sure you want to delete this transaction? This action cannot be undone."))try{await l.deleteTransaction(a,r),h(`/project/${a}?tab=transactions`)}catch(n){console.error("Error deleting transaction:",n),w("Failed to delete transaction. Please try again.")}};return N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading transaction..."})]})}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{to:`/project/${a}?tab=transactions`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(g,{to:`/project/${a}/transaction/${r}/edit`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx("button",{onClick:T,className:"inline-flex items-center px-4 py-2 border border-blue-300 shadow-sm text-sm font-medium rounded-md text-blue-700 bg-white hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Debug: Refresh transaction data",children:"ðŸ”„ Refresh"}),e.jsxs("button",{onClick:_,className:"inline-flex items-center px-4 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),f&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:["Debug: ",f]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-6 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-tight",children:t.source})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Transaction Date"]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.transaction_date?j(t.transaction_date):"No date"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Transaction Type"}),e.jsx("dd",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium no-icon ${t.transaction_type==="Purchase"?"bg-green-100 text-green-800":t.transaction_type==="Return"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.transaction_type})})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Payment Method"]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.payment_method})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Amount"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 font-medium",children:S(t.amount)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Receipt Emailed"}),e.jsx("dd",{className:"mt-1",children:t.receipt_emailed!==void 0?e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.receipt_emailed?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.receipt_emailed?"Yes":"No"}):e.jsx("span",{className:"text-sm text-gray-500",children:"Not specified"})})]}),t.notes&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Notes"]}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 whitespace-pre-wrap",children:t.notes})]})]})}),t.transaction_images&&t.transaction_images.length>0&&e.jsxs("div",{className:"px-6 py-6 border-t border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),"Transaction Images"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:t.transaction_images.map((n,s)=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm",children:e.jsx("img",{src:n.url,alt:n.fileName,className:"w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(n.url,"_blank")})},s))})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Project"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:(m==null?void 0:m.name)||t.project_name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:j(t.created_at)})]})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"ðŸ“„"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Transaction not found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"The transaction you're looking for doesn't exist."}),e.jsx("div",{className:"mt-6",children:e.jsxs(g,{to:`/project/${a}?tab=transactions`,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Back"]})})]})}export{Y as default};
//# sourceMappingURL=TransactionDetail-Cybsxcqq.js.map
