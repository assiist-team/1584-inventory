{"version":3,"file":"TransactionDetail.js","sources":["../../src/pages/TransactionDetail.tsx"],"sourcesContent":["import { ArrowLeft, Edit, Trash2, Image as ImageIcon, Package } from 'lucide-react'\nimport { useState } from 'react'\nimport ImageGallery from '@/components/ui/ImageGallery'\nimport { TransactionImagePreview } from '@/components/ui/ImagePreview'\nimport { useMemo } from 'react'\nimport { Link, useParams, useNavigate } from 'react-router-dom'\nimport { useEffect } from 'react'\nimport { Transaction, Project, Item, TransactionItemFormData } from '@/types'\nimport { transactionService, projectService, unifiedItemsService } from '@/services/inventoryService'\nimport { ImageUploadService } from '@/services/imageService'\nimport { formatDate, formatCurrency } from '@/utils/dateUtils'\nimport { useToast } from '@/components/ui/ToastContext'\nimport TransactionItemForm from '@/components/TransactionItemForm'\nimport { useNavigationContext } from '@/hooks/useNavigationContext'\n\n// Remove any unwanted icons from transaction type badges\nconst removeUnwantedIcons = () => {\n  const badges = document.querySelectorAll('.no-icon')\n  badges.forEach(badge => {\n    // Remove any child elements that aren't text nodes\n    const children = Array.from(badge.childNodes)\n    children.forEach(child => {\n      if (child.nodeType !== Node.TEXT_NODE) {\n        if (child.parentNode) {\n          child.parentNode.removeChild(child)\n        }\n      }\n    })\n  })\n}\n\n// Get canonical transaction title for display\nconst getCanonicalTransactionTitle = (transaction: Transaction): string => {\n  // Check if this is a canonical inventory transaction\n  if (transaction.transaction_id?.startsWith('INV_SALE_')) {\n    return '1584 Inventory Sale'\n  }\n  if (transaction.transaction_id?.startsWith('INV_PURCHASE_')) {\n    return '1584 Inventory Purchase'\n  }\n  // Return the original source for non-canonical transactions\n  return transaction.source\n}\n\n\nexport default function TransactionDetail() {\n  const { id: projectId, transactionId } = useParams<{ id?: string; transactionId: string }>()\n  const navigate = useNavigate()\n  const [transaction, setTransaction] = useState<Transaction | null>(null)\n  const [project, setProject] = useState<Project | null>(null)\n  const [transactionItems, setTransactionItems] = useState<Item[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [isLoadingItems, setIsLoadingItems] = useState(true)\n  const [showGallery, setShowGallery] = useState(false)\n  const [galleryInitialIndex, setGalleryInitialIndex] = useState(0)\n  const [isUploadingReceiptImages, setIsUploadingReceiptImages] = useState(false)\n  const [isUploadingOtherImages, setIsUploadingOtherImages] = useState(false)\n  const [isAddingItem, setIsAddingItem] = useState(false)\n  const [imageFilesMap, setImageFilesMap] = useState<Map<string, File[]>>(new Map())\n  const { showError, showSuccess } = useToast()\n  const { buildContextUrl, getBackDestination } = useNavigationContext()\n\n  // Navigation context logic\n\n  const backDestination = useMemo(() => {\n    // Use navigation context's getBackDestination function\n    return getBackDestination(`/project/${projectId}?tab=transactions`)\n  }, [getBackDestination, projectId])\n\n\n  useEffect(() => {\n    const loadTransaction = async () => {\n      if (!transactionId) return\n\n      try {\n        let actualProjectId = projectId\n        let transactionData: any\n        let projectData: Project | null = null\n\n        if (!actualProjectId) {\n          // For business inventory transactions, we need to find the transaction across all projects\n          console.log('TransactionDetail - No projectId provided, searching across all projects for business inventory transaction')\n          const result = await transactionService.getTransactionById(transactionId)\n\n          if (!result.transaction || !result.projectId) {\n            console.error('TransactionDetail - Transaction not found in any project')\n            setIsLoading(false)\n            setIsLoadingItems(false)\n            return\n          }\n\n          transactionData = result.transaction\n          actualProjectId = result.projectId\n\n          // Get project data for the found project\n          projectData = await projectService.getProject(actualProjectId)\n        } else {\n          // Fetch transaction, project data, and transaction items for regular project transactions\n          const [fetchedTransactionData, fetchedProjectData, transactionItems] = await Promise.all([\n            transactionService.getTransaction(actualProjectId, transactionId),\n            projectService.getProject(actualProjectId),\n            unifiedItemsService.getItemsForTransaction(actualProjectId, transactionId)\n          ])\n\n          transactionData = fetchedTransactionData\n          projectData = fetchedProjectData\n\n          // Fetch the actual item details for regular project transactions\n          if (transactionItems.length > 0 && actualProjectId) {\n            const itemIds = transactionItems.map(item => item.item_id)\n            const itemsPromises = itemIds.map(itemId => unifiedItemsService.getItemById(itemId))\n            const items = await Promise.all(itemsPromises)\n            const validItems = items.filter(item => item !== null) as Item[]\n            console.log('TransactionDetail - fetched items:', validItems.length)\n            setTransactionItems(validItems)\n          } else {\n            setTransactionItems([])\n          }\n        }\n\n        const convertedTransaction: Transaction = {\n          ...transactionData,\n          transaction_images: Array.isArray(transactionData?.transaction_images) ? transactionData.transaction_images : []\n        } as Transaction\n\n        console.log('TransactionDetail - loaded transactionData:', transactionData)\n        console.log('TransactionDetail - convertedTransaction:', convertedTransaction)\n        console.log('TransactionDetail - actualProjectId:', actualProjectId)\n        setTransaction(convertedTransaction)\n        setProject(projectData)\n\n        // Fetch transaction items for business inventory transactions\n        if (!projectId && actualProjectId) {\n          // For business inventory transactions, fetch items after we have the project ID\n          const transactionItems = await unifiedItemsService.getItemsForTransaction(actualProjectId!, transactionId)\n          if (transactionItems.length > 0) {\n            const itemIds = transactionItems.map(item => item.item_id)\n            const itemsPromises = itemIds.map(itemId => unifiedItemsService.getItemById(itemId))\n            const items = await Promise.all(itemsPromises)\n            const validItems = items.filter(item => item !== null) as Item[]\n            console.log('TransactionDetail - fetched items for business inventory transaction:', validItems.length)\n            setTransactionItems(validItems)\n          } else {\n            setTransactionItems([])\n          }\n        }\n\n      } catch (error) {\n        console.error('Error loading transaction:', error)\n        setTransactionItems([])\n      } finally {\n        setIsLoading(false)\n        setIsLoadingItems(false)\n      }\n    }\n\n    loadTransaction()\n  }, [projectId, transactionId])\n\n  // Set up real-time subscription for transaction updates\n  useEffect(() => {\n    if (!transactionId || !transaction) return\n\n    // Use the actual project ID (whether from URL params or discovered from transaction lookup)\n    const actualProjectId = projectId || transaction.project_id\n\n    if (!actualProjectId) return\n\n    // Temporarily disable real-time subscription to debug\n    // const unsubscribe = transactionService.subscribeToTransaction(\n    //   actualProjectId,\n    //   transactionId,\n    //   (updatedTransaction) => {\n    //     if (updatedTransaction) {\n    //       console.log('TransactionDetail - real-time updatedTransaction:', updatedTransaction)\n    //       console.log('TransactionDetail - real-time updatedTransaction.transaction_images:', updatedTransaction.transaction_images)\n    //       console.log('TransactionDetail - real-time updatedTransaction.transaction_images length:', updatedTransaction.transaction_images?.length)\n\n    //       const convertedTransaction: Transaction = {\n    //         ...updatedTransaction,\n    //         transaction_images: Array.isArray(updatedTransaction.transaction_images) ? updatedTransaction.transaction_images : []\n    //       } as Transaction\n\n    //       console.log('TransactionDetail - real-time convertedTransaction:', convertedTransaction)\n    //       setTransaction(convertedTransaction)\n    //     } else {\n    //       setTransaction(null)\n    //     }\n    //   }\n    // )\n\n    // return () => {\n    //   unsubscribe()\n    // }\n  }, [projectId, transactionId, transaction])\n\n\n  // Clean up any unwanted icons from transaction type badges\n  useEffect(() => {\n    if (transaction) {\n      removeUnwantedIcons()\n      // Also run after a short delay to catch any dynamically added icons\n      const timer = setTimeout(removeUnwantedIcons, 100)\n      const timer2 = setTimeout(removeUnwantedIcons, 500)\n      return () => {\n        clearTimeout(timer)\n        clearTimeout(timer2)\n      }\n    }\n  }, [transaction])\n\n  const handleDelete = async () => {\n    if (!projectId || !transactionId || !transaction) return\n\n    if (window.confirm('Are you sure you want to delete this transaction? This action cannot be undone.')) {\n      try {\n        await transactionService.deleteTransaction(projectId, transactionId)\n        navigate(`/project/${projectId}?tab=transactions`)\n      } catch (error) {\n        console.error('Error deleting transaction:', error)\n        showError('Failed to delete transaction. Please try again.')\n      }\n    }\n  }\n\n  const handleImageClick = (index: number) => {\n    setGalleryInitialIndex(index)\n    setShowGallery(true)\n  }\n\n  const handleGalleryClose = () => {\n    setShowGallery(false)\n  }\n\n  const handleReceiptImagesUpload = async (files: File[]) => {\n    if (!projectId || !transactionId || !project || files.length === 0) return\n\n    setIsUploadingReceiptImages(true)\n\n    try {\n      // Upload receipt images\n      const uploadResults = await ImageUploadService.uploadMultipleReceiptImages(\n        files,\n        project.name,\n        transactionId\n      )\n\n      // Convert to TransactionImage format\n      const newReceiptImages = ImageUploadService.convertFilesToReceiptImages(uploadResults)\n\n      // Update transaction with new receipt images\n      const currentReceiptImages = transaction?.receipt_images || []\n      const updatedReceiptImages = [...currentReceiptImages, ...newReceiptImages]\n\n      const updateProjectId = transaction?.project_id || projectId\n      await transactionService.updateTransaction(updateProjectId || '', transactionId, {\n        receipt_images: updatedReceiptImages,\n        transaction_images: updatedReceiptImages // Also update legacy field for compatibility\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.project_id || projectId\n      const updatedTransaction = await transactionService.getTransaction(refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Receipt images uploaded successfully')\n    } catch (error) {\n      console.error('Error uploading receipt images:', error)\n      showError('Failed to upload receipt images. Please try again.')\n    } finally {\n      setIsUploadingReceiptImages(false)\n    }\n  }\n\n  const handleOtherImagesUpload = async (files: File[]) => {\n    if (!projectId || !transactionId || !project || files.length === 0) return\n\n    setIsUploadingOtherImages(true)\n\n    try {\n      // Upload other images\n      const uploadResults = await ImageUploadService.uploadMultipleOtherImages(\n        files,\n        project.name,\n        transactionId\n      )\n\n      // Convert to TransactionImage format\n      const newOtherImages = ImageUploadService.convertFilesToOtherImages(uploadResults)\n\n      // Update transaction with new other images\n      const currentOtherImages = transaction?.other_images || []\n      const updatedOtherImages = [...currentOtherImages, ...newOtherImages]\n\n      const updateProjectId = transaction?.project_id || projectId\n      await transactionService.updateTransaction(updateProjectId || '', transactionId, {\n        other_images: updatedOtherImages\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.project_id || projectId\n      const updatedTransaction = await transactionService.getTransaction(refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Other images uploaded successfully')\n    } catch (error) {\n      console.error('Error uploading other images:', error)\n      showError('Failed to upload other images. Please try again.')\n    } finally {\n      setIsUploadingOtherImages(false)\n    }\n  }\n\n  const handleDeleteReceiptImage = async (imageUrl: string) => {\n    if (!projectId || !transactionId || !transaction) return\n\n    try {\n      // Filter out the image to be deleted\n      const currentReceiptImages = transaction.receipt_images || []\n      const updatedReceiptImages = currentReceiptImages.filter(img => img.url !== imageUrl)\n\n      const updateProjectId = transaction?.project_id || projectId\n      await transactionService.updateTransaction(updateProjectId || '', transactionId, {\n        receipt_images: updatedReceiptImages,\n        transaction_images: updatedReceiptImages // Also update legacy field for compatibility\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.project_id || projectId\n      const updatedTransaction = await transactionService.getTransaction(refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Receipt image deleted successfully')\n    } catch (error) {\n      console.error('Error deleting receipt image:', error)\n      showError('Failed to delete receipt image. Please try again.')\n    }\n  }\n\n  const handleDeleteOtherImage = async (imageUrl: string) => {\n    if (!projectId || !transactionId || !transaction) return\n\n    try {\n      // Filter out the image to be deleted\n      const currentOtherImages = transaction.other_images || []\n      const updatedOtherImages = currentOtherImages.filter(img => img.url !== imageUrl)\n\n      const updateProjectId = transaction?.project_id || projectId\n      await transactionService.updateTransaction(updateProjectId || '', transactionId, {\n        other_images: updatedOtherImages\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.project_id || projectId\n      const updatedTransaction = await transactionService.getTransaction(refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Other image deleted successfully')\n    } catch (error) {\n      console.error('Error deleting other image:', error)\n      showError('Failed to delete other image. Please try again.')\n    }\n  }\n\n  const handleImageFilesChange = (itemId: string, imageFiles: File[]) => {\n    setImageFilesMap(prev => {\n      const newMap = new Map(prev)\n      newMap.set(itemId, imageFiles)\n      return newMap\n    })\n  }\n\n  const handleSaveItem = async (item: TransactionItemFormData) => {\n    if (!projectId || !transactionId || !transaction) return\n\n    try {\n      // Create the item linked to the existing transaction\n      const itemData = {\n        ...item,\n        project_id: projectId,\n        transaction_id: transactionId,\n        date_created: transaction.transaction_date || new Date().toISOString(),\n        source: transaction.source,\n        inventory_status: 'available' as const,\n        payment_method: 'Unknown',\n        qr_key: `QR-${Date.now()}-${Math.random().toString(36).substr(2, 4)}`,\n        bookmark: false,\n        sku: item.sku || '',\n        purchase_price: item.purchase_price || '',\n        project_price: item.project_price || '',\n        market_value: item.market_value || '',\n        notes: item.notes || '',\n        space: item.space || '',\n        disposition: 'keep'\n      }\n      const itemId = await unifiedItemsService.createItem(itemData)\n\n      // Upload item images if any\n      // Try to get files from the map first, then fall back to item.imageFiles\n      let imageFiles = imageFilesMap.get(item.id)\n      if (!imageFiles && item.imageFiles) {\n        imageFiles = item.imageFiles\n      }\n\n      if (imageFiles && imageFiles.length > 0) {\n        try {\n          const uploadedImages = await Promise.all(\n            imageFiles.map(async (file, index) => {\n              try {\n                const uploadResult = await ImageUploadService.uploadItemImage(\n                  file,\n                  project ? project.name : 'Unknown Project',\n                  itemId\n                )\n\n                return {\n                  url: uploadResult.url,\n                  alt: file.name,\n                  isPrimary: index === 0, // First image is primary\n                  uploadedAt: new Date(),\n                  fileName: file.name,\n                  size: file.size,\n                  mimeType: file.type\n                }\n              } catch (uploadError) {\n                console.error(`Failed to upload ${file.name}:`, uploadError)\n                // Return a placeholder for failed uploads so the process continues\n                return {\n                  url: '',\n                  alt: file.name,\n                  isPrimary: false,\n                  uploadedAt: new Date(),\n                  fileName: file.name,\n                  size: file.size,\n                  mimeType: file.type\n                }\n              }\n            })\n          )\n\n          // Filter out failed uploads (empty URLs)\n          const validImages = uploadedImages.filter(img => img.url && img.url.trim() !== '')\n\n          // Update the item with uploaded images\n          if (validImages.length > 0) {\n            await unifiedItemsService.updateItem(itemId, { images: validImages })\n          }\n        } catch (error) {\n          console.error('Error in image upload process:', error)\n        }\n      }\n\n      // Refresh the transaction items list\n      const transactionItems = await unifiedItemsService.getItemsForTransaction(projectId, transactionId)\n      const itemIds = transactionItems.map(item => item.item_id)\n      const itemsPromises = itemIds.map(id => unifiedItemsService.getItemById(id))\n      const items = await Promise.all(itemsPromises)\n      const validItems = items.filter(item => item !== null) as Item[]\n      setTransactionItems(validItems)\n\n      // Reset state\n      setIsAddingItem(false)\n      setImageFilesMap(new Map())\n\n      showSuccess('Item added successfully')\n    } catch (error) {\n      console.error('Error adding item:', error)\n      showError('Failed to add item. Please try again.')\n    }\n  }\n\n  const handleCancelAddItem = () => {\n    setIsAddingItem(false)\n    setImageFilesMap(new Map())\n  }\n\n  // Convert all transaction images (receipt and other) to ItemImage format for the gallery\n  const allTransactionImages = [\n    ...(transaction?.receipt_images || []),\n    ...(transaction?.other_images || [])\n  ]\n\n  const itemImages = allTransactionImages.map((img, index) => ({\n    url: img.url,\n    alt: img.fileName,\n    fileName: img.fileName,\n    uploadedAt: img.uploadedAt,\n    size: img.size,\n    mimeType: img.mimeType,\n    isPrimary: index === 0 // First image is primary\n  })) || []\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto\"></div>\n          <p className=\"mt-2 text-sm text-gray-600\">Loading transaction...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!transaction) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"mx-auto h-12 w-12 text-gray-400\">📄</div>\n        <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Transaction not found</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">The transaction you're looking for doesn't exist.</p>\n        <div className=\"mt-6\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-4\">\n        {/* Back button row */}\n        <div className=\"flex items-center justify-between\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Link>\n          <div className=\"flex space-x-3\">\n            <Link\n              to={`/project/${projectId}/transaction/${transactionId}/edit`}\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              title=\"Edit Transaction\"\n            >\n              <Edit className=\"h-4 w-4\" />\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Transaction Details */}\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"px-6 py-6 border-b border-gray-200\">\n          <h1 className=\"text-2xl font-bold text-gray-900 leading-tight\">\n            {getCanonicalTransactionTitle(transaction)} - {formatCurrency(transaction.amount)}\n          </h1>\n        </div>\n\n\n        <div className=\"px-6 py-4 border-t border-gray-200\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n            Transaction Details\n          </h3>\n          <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Source</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{transaction.source}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Budget Category</dt>\n              <dd className=\"mt-1\">\n                <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n                  transaction.budget_category === 'Design Fee'\n                    ? 'bg-amber-100 text-amber-800'\n                    : transaction.budget_category === 'Furnishings'\n                    ? 'bg-yellow-100 text-yellow-800'\n                    : transaction.budget_category === 'Property Management'\n                    ? 'bg-orange-100 text-orange-800'\n                    : transaction.budget_category === 'Kitchen'\n                    ? 'bg-amber-200 text-amber-900'\n                    : transaction.budget_category === 'Install'\n                    ? 'bg-yellow-200 text-yellow-900'\n                    : transaction.budget_category === 'Storage & Receiving'\n                    ? 'bg-orange-200 text-orange-900'\n                    : transaction.budget_category === 'Fuel'\n                    ? 'bg-amber-300 text-amber-900'\n                    : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {transaction.budget_category || 'Not specified'}\n                </span>\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Transaction Type</dt>\n              <dd className=\"mt-1\">\n                <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${\n                  transaction.transaction_type === 'Purchase'\n                    ? 'bg-green-100 text-green-800'\n                    : transaction.transaction_type === 'Return'\n                    ? 'bg-red-100 text-red-800'\n                    : transaction.transaction_type === 'To Inventory'\n                    ? 'bg-primary-100 text-primary-800'\n                    : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {transaction.transaction_type}\n                </span>\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Amount</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{formatCurrency(transaction.amount)}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Transaction Date</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">\n                {transaction.transaction_date ? formatDate(transaction.transaction_date) : 'No date'}\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Payment Method</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{transaction.payment_method}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Status</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">\n                {(transaction.status || 'pending').charAt(0).toUpperCase() + (transaction.status || 'pending').slice(1)}\n              </dd>\n            </div>\n\n            {transaction.reimbursement_type && (transaction.reimbursement_type as string) !== '' && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">Reimbursement Type</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {transaction.reimbursement_type === 'Client Owes' ? 'Client Owes' : 'We Owe'}\n                </dd>\n              </div>\n            )}\n\n            {transaction.receipt_emailed && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">\n                  Receipt Emailed\n                </dt>\n                <dd className=\"mt-1\">\n                  <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                    Yes\n                  </span>\n                </dd>\n              </div>\n            )}\n\n            {transaction.notes && (\n              <div className=\"sm:col-span-2\">\n                <dt className=\"text-sm font-medium text-gray-500\">Notes</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 whitespace-pre-wrap\">{transaction.notes}</dd>\n              </div>\n            )}\n          </dl>\n        </div>\n\n        {/* Receipt Images */}\n        <div className=\"px-6 py-6 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <ImageIcon className=\"h-5 w-5 mr-2\" />\n              Receipt Images\n            </h3>\n            {transaction.receipt_images && transaction.receipt_images.length > 0 && (\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleReceiptImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingReceiptImages}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingReceiptImages ? 'Uploading...' : 'Add Images'}\n              </button>\n            )}\n          </div>\n          {transaction.receipt_images && transaction.receipt_images.length > 0 ? (\n            <TransactionImagePreview\n              images={transaction.receipt_images}\n              onRemoveImage={handleDeleteReceiptImage}\n              onImageClick={handleImageClick}\n              maxImages={5}\n              showControls={true}\n              size=\"md\"\n              className=\"mb-4\"\n            />\n          ) : (\n            <div className=\"text-center py-8\">\n              <ImageIcon className=\"mx-auto h-8 w-8 text-gray-400\" />\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No receipt images uploaded</h3>\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleReceiptImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingReceiptImages}\n                className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 mt-3 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingReceiptImages ? 'Uploading...' : 'Add Receipt Images'}\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Other Images - Only show if there are other images */}\n        {transaction.other_images && transaction.other_images.length > 0 && (\n          <div className=\"px-6 py-6 border-t border-gray-200\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n                <ImageIcon className=\"h-5 w-5 mr-2\" />\n                Other Images\n              </h3>\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleOtherImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingOtherImages}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingOtherImages ? 'Uploading...' : 'Add Images'}\n              </button>\n            </div>\n            <TransactionImagePreview\n              images={transaction.other_images}\n              onRemoveImage={handleDeleteOtherImage}\n              onImageClick={(index) => {\n                // Find the correct index in the combined array for gallery navigation\n                const receiptCount = transaction.receipt_images?.length || 0\n                const legacyCount = transaction.transaction_images?.length || 0\n                const galleryIndex = receiptCount + legacyCount + index\n                handleImageClick(galleryIndex)\n              }}\n              maxImages={5}\n              showControls={true}\n              size=\"md\"\n              className=\"mb-4\"\n            />\n\n          </div>\n        )}\n\n        {/* Transaction Items */}\n        <div className=\"px-6 py-6 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <Package className=\"h-5 w-5 mr-2\" />\n              Transaction Items\n            </h3>\n            {/* Add Item Button - Only show when items exist (like Receipt Images section) */}\n            {(!isLoadingItems && !isAddingItem && transactionItems.length > 0) && (\n              <button\n                onClick={() => setIsAddingItem(true)}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                title=\"Add new item\"\n              >\n                <Package className=\"h-3 w-3 mr-1\" />\n                Add Item\n              </button>\n            )}\n          </div>\n\n          {isLoadingItems ? (\n            <div className=\"flex justify-center items-center h-16\">\n              <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\"></div>\n              <span className=\"ml-2 text-sm text-gray-600\">Loading items...</span>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {/* Existing Items Display */}\n              {transactionItems.length > 0 && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {transactionItems.map((item) => {\n                    // Check if item has been deallocated to inventory (project_id is null)\n                    const isDeallocated = item.project_id === null\n                    const itemLink = isDeallocated\n                      ? buildContextUrl(`/business-inventory/${item.item_id}`, { from: 'business-inventory-item' })\n                      : buildContextUrl(`/project/${projectId}/item/${item.item_id}`, { from: 'transaction' })\n\n                    return (\n                      <Link\n                        key={item.item_id}\n                        to={itemLink}\n                        className=\"block p-4 border border-gray-200 rounded-lg bg-white hover:border-primary-300 hover:shadow-sm transition-all duration-200 group relative\"\n                      >\n                      {/* Disposition badge in upper right corner */}\n                      {item.disposition && (\n                        <div className=\"absolute top-1 right-1 z-10\">\n                          <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${\n                            item.disposition === 'keep'\n                              ? 'bg-green-100 text-green-800'\n                              : item.disposition === 'to return'\n                              ? 'bg-red-100 text-red-700'\n                              : item.disposition === 'return' // Backward compatibility\n                              ? 'bg-red-100 text-red-700'\n                              : item.disposition === 'returned'\n                              ? 'bg-red-800 text-red-100'\n                              : item.disposition === 'inventory'\n                              ? 'bg-primary-100 text-primary-600'\n                              : 'bg-gray-100 text-gray-800'\n                          }`}>\n                            {item.disposition === 'to return' ? 'To Return' : item.disposition ? item.disposition.charAt(0).toUpperCase() + item.disposition.slice(1) : 'Not Set'}\n                          </span>\n                        </div>\n                      )}\n\n                      {/* Image and Description row - side by side like inventory list */}\n                      <div className=\"flex items-center gap-3 py-3\">\n                        <div className=\"flex-shrink-0\">\n                          {item.images && item.images.length > 0 ? (\n                            // Show primary image thumbnail or first image if no primary\n                            (() => {\n                              const primaryImage = item.images.find(img => img.isPrimary) || item.images[0]\n                              return (\n                                <div className=\"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200\">\n                                  <img\n                                    src={primaryImage.url}\n                                    alt={primaryImage.alt || 'Item image'}\n                                    className=\"w-full h-full object-cover\"\n                                  />\n                                </div>\n                              )\n                            })()\n                          ) : (\n                            // Show placeholder when no images\n                            <div className=\"w-16 h-16 rounded-lg border-2 border-gray-200 flex items-center justify-center text-gray-400 bg-gray-100\">\n                              <Package className=\"h-6 w-6\" />\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Item description - matching inventory list styling */}\n                        <div className=\"flex-1 min-w-0 flex items-center\">\n                          <div>\n                            <h3 className=\"text-base font-medium text-gray-900 line-clamp-2 break-words\">\n                              {item.description}\n                            </h3>\n                            {/* Space field - if available */}\n                            {item.space && (\n                              <p className=\"text-sm text-gray-600 mt-1\">\n                                {item.space}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Bottom row: Price, Source, SKU - exactly like inventory list */}\n                      <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500\">\n                        {(item.project_price || item.purchase_price) && (\n                          <span className=\"font-medium text-gray-700\">{formatCurrency(item.project_price || item.purchase_price || '0')}</span>\n                        )}\n                        {item.source && (\n                          <>\n                            {(item.project_price || item.purchase_price) && <span className=\"hidden sm:inline\">•</span>}\n                            <span className=\"font-medium text-gray-700\">{item.source}</span>\n                          </>\n                        )}\n                        {item.sku && (\n                          <>\n                            {(item.project_price || item.purchase_price || item.source) && <span className=\"hidden sm:inline\">•</span>}\n                            <span className=\"font-medium text-gray-700\">{item.sku}</span>\n                          </>\n                        )}\n                      </div>\n                      </Link>\n                    )\n                  })}\n                </div>\n              )}\n\n              {/* In-line Item Addition */}\n              {isAddingItem && (\n                <TransactionItemForm\n                  onSave={handleSaveItem}\n                  onCancel={handleCancelAddItem}\n                  projectId={projectId}\n                  projectName={project ? project.name : ''}\n                  onImageFilesChange={handleImageFilesChange}\n                />\n              )}\n\n              {/* Empty State - Only show when no items exist and not adding */}\n              {transactionItems.length === 0 && !isAddingItem && (\n                <div className=\"text-center py-8\">\n                  <Package className=\"mx-auto h-8 w-8 text-gray-400\" />\n                  <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No items added</h3>\n                  <button\n                    onClick={() => setIsAddingItem(true)}\n                    className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 mt-3\"\n                    title=\"Add new item\"\n                  >\n                    <Package className=\"h-3 w-3 mr-1\" />\n                    Add Item\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Metadata */}\n        <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200\">\n          <div className=\"relative\">\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-3\">\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Project</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{project?.name || transaction.project_name}</dd>\n              </div>\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Created</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {formatDate(transaction.created_at)}\n                </dd>\n              </div>\n            </dl>\n\n            {/* Delete button in lower right corner */}\n            <div className=\"absolute bottom-0 right-0\">\n              <button\n                onClick={handleDelete}\n                className=\"inline-flex items-center justify-center p-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                title=\"Delete Transaction\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Image gallery modal */}\n      {showGallery && (\n        <ImageGallery\n          images={itemImages}\n          initialIndex={galleryInitialIndex}\n          onClose={handleGalleryClose}\n        />\n      )}\n    </div>\n  )\n}\n"],"names":["removeUnwantedIcons","badge","child","getCanonicalTransactionTitle","transaction","_a","_b","TransactionDetail","projectId","transactionId","useParams","navigate","useNavigate","setTransaction","useState","project","setProject","transactionItems","setTransactionItems","isLoading","setIsLoading","isLoadingItems","setIsLoadingItems","showGallery","setShowGallery","galleryInitialIndex","setGalleryInitialIndex","isUploadingReceiptImages","setIsUploadingReceiptImages","isUploadingOtherImages","setIsUploadingOtherImages","isAddingItem","setIsAddingItem","imageFilesMap","setImageFilesMap","showError","showSuccess","useToast","buildContextUrl","getBackDestination","useNavigationContext","backDestination","useMemo","useEffect","actualProjectId","transactionData","projectData","fetchedTransactionData","fetchedProjectData","transactionService","projectService","unifiedItemsService","itemsPromises","item","itemId","validItems","result","convertedTransaction","error","timer","timer2","handleDelete","handleImageClick","index","handleGalleryClose","handleReceiptImagesUpload","files","uploadResults","ImageUploadService","newReceiptImages","updatedReceiptImages","updateProjectId","refreshProjectId","updatedTransaction","handleOtherImagesUpload","newOtherImages","updatedOtherImages","handleDeleteReceiptImage","imageUrl","img","handleDeleteOtherImage","handleImageFilesChange","imageFiles","prev","newMap","handleSaveItem","itemData","validImages","file","uploadError","id","handleCancelAddItem","itemImages","jsxs","jsx","Link","ArrowLeft","Edit","formatCurrency","formatDate","ImageIcon","input","e","TransactionImagePreview","receiptCount","legacyCount","galleryIndex","Package","itemLink","primaryImage","Fragment","TransactionItemForm","Trash2","ImageGallery"],"mappings":"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"}