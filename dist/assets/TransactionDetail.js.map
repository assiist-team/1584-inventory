{"version":3,"file":"TransactionDetail.js","sources":["../../src/pages/TransactionDetail.tsx"],"sourcesContent":["import { ArrowLeft, Edit, Trash2, Image as ImageIcon, Package } from 'lucide-react'\nimport { useState, useEffect, useMemo } from 'react'\nimport ImageGallery from '@/components/ui/ImageGallery'\nimport { TransactionImagePreview } from '@/components/ui/ImagePreview'\nimport { Link, useParams, useNavigate } from 'react-router-dom'\nimport { Transaction, Project, Item, TransactionItemFormData, TaxPreset } from '@/types'\nimport { transactionService, projectService, unifiedItemsService } from '@/services/inventoryService'\nimport { ImageUploadService } from '@/services/imageService'\nimport { formatDate, formatCurrency } from '@/utils/dateUtils'\nimport { useToast } from '@/components/ui/ToastContext'\nimport TransactionItemForm from '@/components/TransactionItemForm'\nimport { useNavigationContext } from '@/hooks/useNavigationContext'\nimport { getTaxPresets } from '@/services/taxPresetsService'\nimport { useAccount } from '@/contexts/AccountContext'\nimport { COMPANY_INVENTORY_SALE, COMPANY_INVENTORY_PURCHASE, CLIENT_OWES_COMPANY, COMPANY_OWES_CLIENT } from '@/constants/company'\n\n// Remove any unwanted icons from transaction type badges\nconst removeUnwantedIcons = () => {\n  const badges = document.querySelectorAll('.no-icon')\n  badges.forEach(badge => {\n    // Remove any child elements that aren't text nodes\n    const children = Array.from(badge.childNodes)\n    children.forEach(child => {\n      if (child.nodeType !== Node.TEXT_NODE) {\n        if (child.parentNode) {\n          child.parentNode.removeChild(child)\n        }\n      }\n    })\n  })\n}\n\n// Get canonical transaction title for display\nconst getCanonicalTransactionTitle = (transaction: Transaction): string => {\n  // Check if this is a canonical inventory transaction\n  if (transaction.transactionId?.startsWith('INV_SALE_')) {\n    return COMPANY_INVENTORY_SALE\n  }\n  if (transaction.transactionId?.startsWith('INV_PURCHASE_')) {\n    return COMPANY_INVENTORY_PURCHASE\n  }\n  // Return the original source for non-canonical transactions\n  return transaction.source\n}\n\n\nexport default function TransactionDetail() {\n  const { id: projectId, transactionId } = useParams<{ id?: string; transactionId: string }>()\n  const navigate = useNavigate()\n  const { currentAccountId } = useAccount()\n  const [transaction, setTransaction] = useState<Transaction | null>(null)\n  const [project, setProject] = useState<Project | null>(null)\n  const [taxPresets, setTaxPresets] = useState<TaxPreset[]>([])\n\n  // Load tax presets on mount\n  useEffect(() => {\n    const loadPresets = async () => {\n      if (!currentAccountId) return\n      try {\n        const presets = await getTaxPresets(currentAccountId)\n        setTaxPresets(presets)\n      } catch (error) {\n        console.error('Error loading tax presets:', error)\n      }\n    }\n    loadPresets()\n  }, [currentAccountId])\n  const [transactionItems, setTransactionItems] = useState<Item[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [isLoadingItems, setIsLoadingItems] = useState(true)\n  const [showGallery, setShowGallery] = useState(false)\n  const [galleryInitialIndex, setGalleryInitialIndex] = useState(0)\n  const [isUploadingReceiptImages, setIsUploadingReceiptImages] = useState(false)\n  const [isUploadingOtherImages, setIsUploadingOtherImages] = useState(false)\n  const [isAddingItem, setIsAddingItem] = useState(false)\n  const [imageFilesMap, setImageFilesMap] = useState<Map<string, File[]>>(new Map())\n  const { showError, showSuccess } = useToast()\n  const { buildContextUrl, getBackDestination } = useNavigationContext()\n\n  // Navigation context logic\n\n  const backDestination = useMemo(() => {\n    // Use navigation context's getBackDestination function\n    return getBackDestination(`/project/${projectId}?tab=transactions`)\n  }, [getBackDestination, projectId])\n\n\n  useEffect(() => {\n    const loadTransaction = async () => {\n      if (!transactionId || !currentAccountId) return\n\n      try {\n        let actualProjectId = projectId\n        let transactionData: any\n        let projectData: Project | null = null\n\n        if (!actualProjectId) {\n          // For business inventory transactions, we need to find the transaction across all projects\n          console.log('TransactionDetail - No projectId provided, searching across all projects for business inventory transaction')\n          const result = await transactionService.getTransactionById(currentAccountId, transactionId)\n\n          if (!result.transaction || !result.projectId) {\n            console.error('TransactionDetail - Transaction not found in any project')\n            setIsLoading(false)\n            setIsLoadingItems(false)\n            return\n          }\n\n          transactionData = result.transaction\n          actualProjectId = result.projectId\n\n          // Get project data for the found project\n          projectData = await projectService.getProject(currentAccountId, actualProjectId)\n        } else {\n          // Fetch transaction, project data, and transaction items for regular project transactions\n          const [fetchedTransactionData, fetchedProjectData, transactionItems] = await Promise.all([\n            transactionService.getTransaction(currentAccountId, actualProjectId, transactionId),\n            projectService.getProject(currentAccountId, actualProjectId),\n            unifiedItemsService.getItemsForTransaction(currentAccountId, actualProjectId, transactionId)\n          ])\n\n          transactionData = fetchedTransactionData\n          projectData = fetchedProjectData\n\n          // Fetch the actual item details for regular project transactions\n          if (transactionItems.length > 0 && actualProjectId) {\n            const itemIds = transactionItems.map(item => item.itemId)\n            const itemsPromises = itemIds.map(itemId => unifiedItemsService.getItemById(currentAccountId, itemId))\n            const items = await Promise.all(itemsPromises)\n            const validItems = items.filter(item => item !== null) as Item[]\n            console.log('TransactionDetail - fetched items:', validItems.length)\n            setTransactionItems(validItems)\n          } else {\n            setTransactionItems([])\n          }\n        }\n\n        const convertedTransaction: Transaction = {\n          ...transactionData,\n          transactionImages: Array.isArray(transactionData?.transactionImages) ? transactionData.transactionImages : []\n        } as Transaction\n\n        console.log('TransactionDetail - loaded transactionData:', transactionData)\n        console.log('TransactionDetail - convertedTransaction:', convertedTransaction)\n        console.log('TransactionDetail - actualProjectId:', actualProjectId)\n        setTransaction(convertedTransaction)\n        setProject(projectData)\n\n        // Fetch transaction items for business inventory transactions\n        if (!projectId && actualProjectId) {\n          // For business inventory transactions, fetch items after we have the project ID\n            const transactionItems = await unifiedItemsService.getItemsForTransaction(currentAccountId, actualProjectId!, transactionId)\n          if (transactionItems.length > 0) {\n            const itemIds = transactionItems.map(item => item.itemId)\n            const itemsPromises = itemIds.map(itemId => unifiedItemsService.getItemById(currentAccountId, itemId))\n            const items = await Promise.all(itemsPromises)\n            const validItems = items.filter(item => item !== null) as Item[]\n            console.log('TransactionDetail - fetched items for business inventory transaction:', validItems.length)\n            setTransactionItems(validItems)\n          } else {\n            setTransactionItems([])\n          }\n        }\n\n      } catch (error) {\n        console.error('Error loading transaction:', error)\n        setTransactionItems([])\n      } finally {\n        setIsLoading(false)\n        setIsLoadingItems(false)\n      }\n    }\n\n    loadTransaction()\n  }, [projectId, transactionId, currentAccountId])\n\n  // Set up real-time subscription for transaction updates\n  useEffect(() => {\n    if (!transactionId || !transaction) return\n    // Use the actual project ID (whether from URL params or discovered from transaction lookup)\n    const actualProjectId = projectId || transaction.projectId\n\n    if (!actualProjectId) return\n\n    // Temporarily disable real-time subscription to debug\n    // const unsubscribe = transactionService.subscribeToTransaction(\n    //   actualProjectId,\n    //   transactionId,\n    //   (updatedTransaction) => {\n    //     if (updatedTransaction) {\n    //       console.log('TransactionDetail - real-time updatedTransaction:', updatedTransaction)\n    //       console.log('TransactionDetail - real-time updatedTransaction.transaction_images:', updatedTransaction.transaction_images)\n    //       console.log('TransactionDetail - real-time updatedTransaction.transaction_images length:', updatedTransaction.transaction_images?.length)\n\n    //       const convertedTransaction: Transaction = {\n    //         ...updatedTransaction,\n    //         transaction_images: Array.isArray(updatedTransaction.transaction_images) ? updatedTransaction.transaction_images : []\n    //       } as Transaction\n\n    //       console.log('TransactionDetail - real-time convertedTransaction:', convertedTransaction)\n    //       setTransaction(convertedTransaction)\n    //     } else {\n    //       setTransaction(null)\n    //     }\n    //   }\n    // )\n\n    // return () => {\n    //   unsubscribe()\n    // }\n  }, [projectId, transactionId, transaction])\n\n\n  // Clean up any unwanted icons from transaction type badges\n  useEffect(() => {\n    if (transaction) {\n      removeUnwantedIcons()\n      // Also run after a short delay to catch any dynamically added icons\n      const timer = setTimeout(removeUnwantedIcons, 100)\n      const timer2 = setTimeout(removeUnwantedIcons, 500)\n      return () => {\n        clearTimeout(timer)\n        clearTimeout(timer2)\n      }\n    }\n  }, [transaction])\n\n  const handleDelete = async () => {\n    if (!projectId || !transactionId || !transaction || !currentAccountId) return\n\n    if (window.confirm('Are you sure you want to delete this transaction? This action cannot be undone.')) {\n      try {\n        await transactionService.deleteTransaction(currentAccountId, projectId, transactionId)\n        navigate(`/project/${projectId}?tab=transactions`)\n      } catch (error) {\n        console.error('Error deleting transaction:', error)\n        showError('Failed to delete transaction. Please try again.')\n      }\n    }\n  }\n\n  const handleImageClick = (index: number) => {\n    setGalleryInitialIndex(index)\n    setShowGallery(true)\n  }\n\n  const handleGalleryClose = () => {\n    setShowGallery(false)\n  }\n\n  const handleReceiptImagesUpload = async (files: File[]) => {\n    if (!projectId || !transactionId || !project || files.length === 0) return\n\n    setIsUploadingReceiptImages(true)\n\n    try {\n      // Upload receipt images\n      const uploadResults = await ImageUploadService.uploadMultipleReceiptImages(\n        files,\n        project.name,\n        transactionId\n      )\n\n      // Convert to TransactionImage format\n      const newReceiptImages = ImageUploadService.convertFilesToReceiptImages(uploadResults)\n\n      // Update transaction with new receipt images\n      const currentReceiptImages = transaction?.receiptImages || []\n      const updatedReceiptImages = [...currentReceiptImages, ...newReceiptImages]\n\n      const updateProjectId = transaction?.projectId || projectId\n      if (!currentAccountId) return\n      await transactionService.updateTransaction(currentAccountId, updateProjectId || '', transactionId, {\n        receiptImages: updatedReceiptImages,\n        transactionImages: updatedReceiptImages // Also update legacy field for compatibility\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.projectId || projectId\n      const updatedTransaction = await transactionService.getTransaction(currentAccountId, refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Receipt images uploaded successfully')\n    } catch (error) {\n      console.error('Error uploading receipt images:', error)\n      showError('Failed to upload receipt images. Please try again.')\n    } finally {\n      setIsUploadingReceiptImages(false)\n    }\n  }\n\n  const handleOtherImagesUpload = async (files: File[]) => {\n    if (!projectId || !transactionId || !project || files.length === 0) return\n\n    setIsUploadingOtherImages(true)\n\n    try {\n      // Upload other images\n      const uploadResults = await ImageUploadService.uploadMultipleOtherImages(\n        files,\n        project.name,\n        transactionId\n      )\n\n      // Convert to TransactionImage format\n      const newOtherImages = ImageUploadService.convertFilesToOtherImages(uploadResults)\n\n      // Update transaction with new other images\n      const currentOtherImages = transaction?.otherImages || []\n      const updatedOtherImages = [...currentOtherImages, ...newOtherImages]\n\n      const updateProjectId = transaction?.projectId || projectId\n      if (!currentAccountId) return\n      await transactionService.updateTransaction(currentAccountId, updateProjectId || '', transactionId, {\n        otherImages: updatedOtherImages\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.projectId || projectId\n      const updatedTransaction = await transactionService.getTransaction(currentAccountId, refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Other images uploaded successfully')\n    } catch (error) {\n      console.error('Error uploading other images:', error)\n      showError('Failed to upload other images. Please try again.')\n    } finally {\n      setIsUploadingOtherImages(false)\n    }\n  }\n\n  const handleDeleteReceiptImage = async (imageUrl: string) => {\n    if (!projectId || !transactionId || !transaction || !currentAccountId) return\n\n    try {\n      // Filter out the image to be deleted\n      const currentReceiptImages = transaction.receiptImages || []\n      const updatedReceiptImages = currentReceiptImages.filter(img => img.url !== imageUrl)\n\n      const updateProjectId = transaction?.projectId || projectId\n      await transactionService.updateTransaction(currentAccountId, updateProjectId || '', transactionId, {\n        receiptImages: updatedReceiptImages,\n        transactionImages: updatedReceiptImages // Also update legacy field for compatibility\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.projectId || projectId\n      const updatedTransaction = await transactionService.getTransaction(currentAccountId, refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Receipt image deleted successfully')\n    } catch (error) {\n      console.error('Error deleting receipt image:', error)\n      showError('Failed to delete receipt image. Please try again.')\n    }\n  }\n\n  const handleDeleteOtherImage = async (imageUrl: string) => {\n    if (!projectId || !transactionId || !transaction) return\n\n    try {\n      // Filter out the image to be deleted\n      const currentOtherImages = transaction.otherImages || []\n      const updatedOtherImages = currentOtherImages.filter(img => img.url !== imageUrl)\n\n      const updateProjectId = transaction?.projectId || projectId\n      if (!currentAccountId) return\n      await transactionService.updateTransaction(currentAccountId, updateProjectId || '', transactionId, {\n        otherImages: updatedOtherImages\n      })\n\n      // Refresh transaction data (use actual project_id from transaction)\n      const refreshProjectId = transaction?.projectId || projectId\n      const updatedTransaction = await transactionService.getTransaction(currentAccountId, refreshProjectId || '', transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Other image deleted successfully')\n    } catch (error) {\n      console.error('Error deleting other image:', error)\n      showError('Failed to delete other image. Please try again.')\n    }\n  }\n\n  const handleImageFilesChange = (itemId: string, imageFiles: File[]) => {\n    setImageFilesMap(prev => {\n      const newMap = new Map(prev)\n      newMap.set(itemId, imageFiles)\n      return newMap\n    })\n  }\n\n  const handleSaveItem = async (item: TransactionItemFormData) => {\n    if (!projectId || !transactionId || !transaction || !currentAccountId) return\n\n    try {\n      // Create the item linked to the existing transaction\n      const itemData = {\n        ...item,\n        projectId: projectId,\n        transactionId: transactionId,\n        dateCreated: transaction.transactionDate || new Date().toISOString(),\n        source: transaction.source,\n        inventoryStatus: 'available' as const,\n        paymentMethod: 'Unknown',\n        qrKey: `QR-${Date.now()}-${Math.random().toString(36).substr(2, 4)}`,\n        bookmark: false,\n        sku: item.sku || '',\n        purchasePrice: item.purchasePrice || '',\n        projectPrice: item.projectPrice || '',\n        marketValue: item.marketValue || '',\n        notes: item.notes || '',\n        space: item.space || '',\n        disposition: 'keep'\n      }\n      const itemId = await unifiedItemsService.createItem(currentAccountId, itemData)\n\n      // Upload item images if any\n      // Try to get files from the map first, then fall back to item.imageFiles\n      let imageFiles = imageFilesMap.get(item.id)\n      if (!imageFiles && item.imageFiles) {\n        imageFiles = item.imageFiles\n      }\n\n      if (imageFiles && imageFiles.length > 0) {\n        try {\n          const uploadedImages = await Promise.all(\n            imageFiles.map(async (file, index) => {\n              try {\n                const uploadResult = await ImageUploadService.uploadItemImage(\n                  file,\n                  project ? project.name : 'Unknown Project',\n                  itemId\n                )\n\n                return {\n                  url: uploadResult.url,\n                  alt: file.name,\n                  isPrimary: index === 0, // First image is primary\n                  uploadedAt: new Date(),\n                  fileName: file.name,\n                  size: file.size,\n                  mimeType: file.type\n                }\n              } catch (uploadError) {\n                console.error(`Failed to upload ${file.name}:`, uploadError)\n                // Return a placeholder for failed uploads so the process continues\n                return {\n                  url: '',\n                  alt: file.name,\n                  isPrimary: false,\n                  uploadedAt: new Date(),\n                  fileName: file.name,\n                  size: file.size,\n                  mimeType: file.type\n                }\n              }\n            })\n          )\n\n          // Filter out failed uploads (empty URLs)\n          const validImages = uploadedImages.filter(img => img.url && img.url.trim() !== '')\n\n          // Update the item with uploaded images\n          if (validImages.length > 0) {\n            await unifiedItemsService.updateItem(currentAccountId, itemId, { images: validImages })\n          }\n        } catch (error) {\n          console.error('Error in image upload process:', error)\n        }\n      }\n\n      // Refresh the transaction items list\n      const transactionItems = await unifiedItemsService.getItemsForTransaction(currentAccountId, projectId, transactionId)\n      const itemIds = transactionItems.map(item => item.itemId)\n      const itemsPromises = itemIds.map(id => unifiedItemsService.getItemById(currentAccountId, id))\n      const items = await Promise.all(itemsPromises)\n      const validItems = items.filter(item => item !== null) as Item[]\n      setTransactionItems(validItems)\n\n      // Reset state\n      setIsAddingItem(false)\n      setImageFilesMap(new Map())\n\n      showSuccess('Item added successfully')\n    } catch (error) {\n      console.error('Error adding item:', error)\n      showError('Failed to add item. Please try again.')\n    }\n  }\n\n  const handleCancelAddItem = () => {\n    setIsAddingItem(false)\n    setImageFilesMap(new Map())\n  }\n\n  // Convert all transaction images (receipt and other) to ItemImage format for the gallery\n  const allTransactionImages = [\n    ...(transaction?.receiptImages || []),\n    ...(transaction?.otherImages || [])\n  ]\n\n    const itemImages = allTransactionImages.map((img, index) => ({\n    url: img.url,\n    alt: img.fileName,\n    fileName: img.fileName,\n    uploadedAt: img.uploadedAt,\n    size: img.size,\n    mimeType: img.mimeType,\n    isPrimary: index === 0 // First image is primary\n  })) || []\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto\"></div>\n          <p className=\"mt-2 text-sm text-gray-600\">Loading transaction...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!transaction) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"mx-auto h-12 w-12 text-gray-400\">ðŸ“„</div>\n        <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Transaction not found</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">The transaction you're looking for doesn't exist.</p>\n        <div className=\"mt-6\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-4\">\n        {/* Back button row */}\n        <div className=\"flex items-center justify-between\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Link>\n          <div className=\"flex space-x-3\">\n            <Link\n              to={`/project/${projectId}/transaction/${transactionId}/edit`}\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              title=\"Edit Transaction\"\n            >\n              <Edit className=\"h-4 w-4\" />\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Transaction Details */}\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"px-6 py-6 border-b border-gray-200\">\n          <h1 className=\"text-2xl font-bold text-gray-900 leading-tight\">\n            {getCanonicalTransactionTitle(transaction)} - {formatCurrency(transaction.amount)}\n          </h1>\n        </div>\n\n\n        <div className=\"px-6 py-4 border-t border-gray-200\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n            Transaction Details\n          </h3>\n          <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Source</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{transaction.source}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Budget Category</dt>\n              <dd className=\"mt-1\">\n              <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n                  transaction.budgetCategory === 'Design Fee'\n                    ? 'bg-amber-100 text-amber-800'\n                    : transaction.budgetCategory === 'Furnishings'\n                    ? 'bg-yellow-100 text-yellow-800'\n                    : transaction.budgetCategory === 'Property Management'\n                    ? 'bg-orange-100 text-orange-800'\n                    : transaction.budgetCategory === 'Kitchen'\n                    ? 'bg-amber-200 text-amber-900'\n                    : transaction.budgetCategory === 'Install'\n                    ? 'bg-yellow-200 text-yellow-900'\n                    : transaction.budgetCategory === 'Storage & Receiving'\n                    ? 'bg-orange-200 text-orange-900'\n                    : transaction.budgetCategory === 'Fuel'\n                    ? 'bg-amber-300 text-amber-900'\n                    : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {transaction.budgetCategory || 'Not specified'}\n                </span>\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Transaction Type</dt>\n              <dd className=\"mt-1\">\n                <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${\n                  transaction.transactionType === 'Purchase'\n                    ? 'bg-green-100 text-green-800'\n                    : transaction.transactionType === 'Return'\n                    ? 'bg-red-100 text-red-800'\n                    : transaction.transactionType === 'To Inventory'\n                    ? 'bg-primary-100 text-primary-800'\n                    : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {transaction.transactionType}\n                </span>\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Amount</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{formatCurrency(transaction.amount)}</dd>\n            </div>\n\n            {transaction.taxRatePreset && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">Tax Rate Preset</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {transaction.taxRatePreset === 'Other' \n                    ? 'Custom'\n                    : (() => {\n                        const preset = taxPresets.find(p => p.id === transaction.taxRatePreset)\n                        return preset ? `${preset.name} (${preset.rate.toFixed(2)}%)` : transaction.taxRatePreset\n                      })()\n                  }\n                </dd>\n              </div>\n            )}\n\n            {transaction.subtotal && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">Subtotal</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{formatCurrency(transaction.subtotal)}</dd>\n              </div>\n            )}\n\n            {transaction.taxRatePct !== undefined && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">Tax Rate</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{Number(transaction.taxRatePct).toFixed(2)}%</dd>\n              </div>\n            )}\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Transaction Date</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">\n                {transaction.transactionDate ? formatDate(transaction.transactionDate) : 'No date'}\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Payment Method</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{transaction.paymentMethod}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Status</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">\n                {(transaction.status || 'pending').charAt(0).toUpperCase() + (transaction.status || 'pending').slice(1)}\n              </dd>\n            </div>\n\n            {transaction.reimbursementType && (transaction.reimbursementType as string) !== '' && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">Reimbursement Type</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {transaction.reimbursementType === CLIENT_OWES_COMPANY ? CLIENT_OWES_COMPANY : COMPANY_OWES_CLIENT}\n                </dd>\n              </div>\n            )}\n\n            {transaction.receiptEmailed && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">\n                  Receipt Emailed\n                </dt>\n                <dd className=\"mt-1\">\n                  <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                    Yes\n                  </span>\n                </dd>\n              </div>\n            )}\n\n            {transaction.notes && (\n              <div className=\"sm:col-span-2\">\n                <dt className=\"text-sm font-medium text-gray-500\">Notes</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 whitespace-pre-wrap\">{transaction.notes}</dd>\n              </div>\n            )}\n          </dl>\n        </div>\n\n        {/* Receipt Images */}\n        <div className=\"px-6 py-6 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <ImageIcon className=\"h-5 w-5 mr-2\" />\n              Receipt Images\n            </h3>\n                {transaction.receiptImages && transaction.receiptImages.length > 0 && (\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleReceiptImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingReceiptImages}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingReceiptImages ? 'Uploading...' : 'Add Images'}\n              </button>\n            )}\n          </div>\n          {transaction.receiptImages && transaction.receiptImages.length > 0 ? (\n            <TransactionImagePreview\n              images={transaction.receiptImages}\n              onRemoveImage={handleDeleteReceiptImage}\n              onImageClick={handleImageClick}\n              maxImages={5}\n              showControls={true}\n              size=\"md\"\n              className=\"mb-4\"\n            />\n          ) : (\n            <div className=\"text-center py-8\">\n              <ImageIcon className=\"mx-auto h-8 w-8 text-gray-400\" />\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No receipt images uploaded</h3>\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleReceiptImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingReceiptImages}\n                className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 mt-3 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingReceiptImages ? 'Uploading...' : 'Add Receipt Images'}\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Other Images - Only show if there are other images */}\n            {transaction.otherImages && transaction.otherImages.length > 0 && (\n          <div className=\"px-6 py-6 border-t border-gray-200\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n                <ImageIcon className=\"h-5 w-5 mr-2\" />\n                Other Images\n              </h3>\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleOtherImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingOtherImages}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingOtherImages ? 'Uploading...' : 'Add Images'}\n              </button>\n            </div>\n            <TransactionImagePreview\n              images={transaction.otherImages}\n              onRemoveImage={handleDeleteOtherImage}\n              onImageClick={(index) => {\n                // Find the correct index in the combined array for gallery navigation\n                const receiptCount = transaction.receiptImages?.length || 0\n                const legacyCount = transaction.transactionImages?.length || 0\n                const galleryIndex = receiptCount + legacyCount + index\n                handleImageClick(galleryIndex)\n              }}\n              maxImages={5}\n              showControls={true}\n              size=\"md\"\n              className=\"mb-4\"\n            />\n\n          </div>\n        )}\n\n        {/* Transaction Items */}\n        <div className=\"px-6 py-6 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <Package className=\"h-5 w-5 mr-2\" />\n              Transaction Items\n            </h3>\n            {/* Add Item Button - Only show when items exist (like Receipt Images section) */}\n            {(!isLoadingItems && !isAddingItem && transactionItems.length > 0) && (\n              <button\n                onClick={() => setIsAddingItem(true)}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                title=\"Add new item\"\n              >\n                <Package className=\"h-3 w-3 mr-1\" />\n                Add Item\n              </button>\n            )}\n          </div>\n\n          {isLoadingItems ? (\n            <div className=\"flex justify-center items-center h-16\">\n              <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\"></div>\n              <span className=\"ml-2 text-sm text-gray-600\">Loading items...</span>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {/* Existing Items Display */}\n              {transactionItems.length > 0 && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {transactionItems.map((item) => {\n                    // Check if item has been deallocated to inventory (projectId is null)\n                    const isDeallocated = item.projectId == null\n                    const itemLink = isDeallocated\n                      ? buildContextUrl(`/business-inventory/${item.itemId}`, { from: 'business-inventory-item' })\n                      : buildContextUrl(`/project/${projectId}/item/${item.itemId}`, { from: 'transaction' })\n\n                    return (\n                      <Link\n                        key={item.itemId}\n                        to={itemLink}\n                        className=\"block p-4 border border-gray-200 rounded-lg bg-white hover:border-primary-300 hover:shadow-sm transition-all duration-200 group relative\"\n                      >\n                      {/* Disposition badge in upper right corner */}\n                      {item.disposition && (\n                        <div className=\"absolute top-1 right-1 z-10\">\n                          <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${\n                            item.disposition === 'keep'\n                              ? 'bg-green-100 text-green-800'\n                              : item.disposition === 'to return'\n                              ? 'bg-red-100 text-red-700'\n                              : item.disposition === 'return' // Backward compatibility\n                              ? 'bg-red-100 text-red-700'\n                              : item.disposition === 'returned'\n                              ? 'bg-red-800 text-red-100'\n                              : item.disposition === 'inventory'\n                              ? 'bg-primary-100 text-primary-600'\n                              : 'bg-gray-100 text-gray-800'\n                          }`}>\n                            {item.disposition === 'to return' ? 'To Return' : item.disposition ? item.disposition.charAt(0).toUpperCase() + item.disposition.slice(1) : 'Not Set'}\n                          </span>\n                        </div>\n                      )}\n\n                      {/* Image and Description row - side by side like inventory list */}\n                      <div className=\"flex items-center gap-3 py-3\">\n                        <div className=\"flex-shrink-0\">\n                          {item.images && item.images.length > 0 ? (\n                            // Show primary image thumbnail or first image if no primary\n                            (() => {\n                              const primaryImage = item.images.find(img => img.isPrimary) || item.images[0]\n                              return (\n                                <div className=\"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200\">\n                                  <img\n                                    src={primaryImage.url}\n                                    alt={primaryImage.alt || 'Item image'}\n                                    className=\"w-full h-full object-cover\"\n                                  />\n                                </div>\n                              )\n                            })()\n                          ) : (\n                            // Show placeholder when no images\n                            <div className=\"w-16 h-16 rounded-lg border-2 border-gray-200 flex items-center justify-center text-gray-400 bg-gray-100\">\n                              <Package className=\"h-6 w-6\" />\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Item description - matching inventory list styling */}\n                        <div className=\"flex-1 min-w-0 flex items-center\">\n                          <div>\n                            <h3 className=\"text-base font-medium text-gray-900 line-clamp-2 break-words\">\n                              {item.description}\n                            </h3>\n                            {/* Space field - if available */}\n                            {item.space && (\n                              <p className=\"text-sm text-gray-600 mt-1\">\n                                {item.space}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Bottom row: Price, Source, SKU - exactly like inventory list */}\n                      <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500\">\n                        {(item.projectPrice || item.purchasePrice) && (\n                          <span className=\"font-medium text-gray-700\">{formatCurrency(item.projectPrice || item.purchasePrice || '0')}</span>\n                        )}\n                        {item.source && (\n                          <>\n                            {(item.projectPrice || item.purchasePrice) && <span className=\"hidden sm:inline\">â€¢</span>}\n                            <span className=\"font-medium text-gray-700\">{item.source}</span>\n                          </>\n                        )}\n                        {item.sku && (\n                          <>\n                            {(item.projectPrice || item.purchasePrice || item.source) && <span className=\"hidden sm:inline\">â€¢</span>}\n                            <span className=\"font-medium text-gray-700\">{item.sku}</span>\n                          </>\n                        )}\n                      </div>\n                      </Link>\n                    )\n                  })}\n                </div>\n              )}\n\n              {/* In-line Item Addition */}\n              {isAddingItem && (\n                <TransactionItemForm\n                  onSave={handleSaveItem}\n                  onCancel={handleCancelAddItem}\n                  projectId={projectId}\n                  projectName={project ? project.name : ''}\n                  onImageFilesChange={handleImageFilesChange}\n                />\n              )}\n\n              {/* Empty State - Only show when no items exist and not adding */}\n              {transactionItems.length === 0 && !isAddingItem && (\n                <div className=\"text-center py-8\">\n                  <Package className=\"mx-auto h-8 w-8 text-gray-400\" />\n                  <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No items added</h3>\n                  <button\n                    onClick={() => setIsAddingItem(true)}\n                    className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 mt-3\"\n                    title=\"Add new item\"\n                  >\n                    <Package className=\"h-3 w-3 mr-1\" />\n                    Add Item\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Metadata */}\n        <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200\">\n          <div className=\"relative\">\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-3\">\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Project</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{project?.name || transaction.projectName}</dd>\n              </div>\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Created</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {formatDate(transaction.createdAt)}\n                </dd>\n              </div>\n            </dl>\n\n            {/* Delete button in lower right corner */}\n            <div className=\"absolute bottom-0 right-0\">\n              <button\n                onClick={handleDelete}\n                className=\"inline-flex items-center justify-center p-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                title=\"Delete Transaction\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Image gallery modal */}\n      {showGallery && (\n        <ImageGallery\n          images={itemImages}\n          initialIndex={galleryInitialIndex}\n          onClose={handleGalleryClose}\n        />\n      )}\n    </div>\n  )\n}\n"],"names":["removeUnwantedIcons","badge","child","getCanonicalTransactionTitle","transaction","_a","COMPANY_INVENTORY_SALE","_b","COMPANY_INVENTORY_PURCHASE","TransactionDetail","projectId","transactionId","useParams","navigate","useNavigate","currentAccountId","useAccount","setTransaction","useState","project","setProject","taxPresets","setTaxPresets","useEffect","presets","getTaxPresets","error","transactionItems","setTransactionItems","isLoading","setIsLoading","isLoadingItems","setIsLoadingItems","showGallery","setShowGallery","galleryInitialIndex","setGalleryInitialIndex","isUploadingReceiptImages","setIsUploadingReceiptImages","isUploadingOtherImages","setIsUploadingOtherImages","isAddingItem","setIsAddingItem","imageFilesMap","setImageFilesMap","showError","showSuccess","useToast","buildContextUrl","getBackDestination","useNavigationContext","backDestination","useMemo","actualProjectId","transactionData","projectData","fetchedTransactionData","fetchedProjectData","transactionService","projectService","unifiedItemsService","itemsPromises","item","itemId","validItems","result","convertedTransaction","timer","timer2","handleDelete","handleImageClick","index","handleGalleryClose","handleReceiptImagesUpload","files","uploadResults","ImageUploadService","newReceiptImages","updatedReceiptImages","updateProjectId","refreshProjectId","updatedTransaction","handleOtherImagesUpload","newOtherImages","updatedOtherImages","handleDeleteReceiptImage","imageUrl","img","handleDeleteOtherImage","handleImageFilesChange","imageFiles","prev","newMap","handleSaveItem","itemData","validImages","file","uploadError","id","handleCancelAddItem","itemImages","jsxs","jsx","Link","ArrowLeft","Edit","formatCurrency","preset","p","formatDate","CLIENT_OWES_COMPANY","COMPANY_OWES_CLIENT","ImageIcon","input","e","TransactionImagePreview","receiptCount","legacyCount","galleryIndex","Package","itemLink","primaryImage","Fragment","TransactionItemForm","Trash2","ImageGallery"],"mappings":"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"}