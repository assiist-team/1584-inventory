{"version":3,"file":"TransactionDetail.js","sources":["../../src/pages/TransactionDetail.tsx"],"sourcesContent":["import { ArrowLeft, Edit, Trash2, Image as ImageIcon, Package } from 'lucide-react'\nimport { useState } from 'react'\nimport ImageGallery from '@/components/ui/ImageGallery'\nimport { TransactionImagePreview } from '@/components/ui/ImagePreview'\nimport { useMemo } from 'react'\nimport { Link, useParams, useNavigate, useLocation } from 'react-router-dom'\nimport { useEffect } from 'react'\nimport { Transaction, Project, Item, TransactionItemFormData } from '@/types'\nimport { transactionService, projectService, itemService } from '@/services/inventoryService'\nimport { ImageUploadService } from '@/services/imageService'\nimport { formatDate, formatCurrency } from '@/utils/dateUtils'\nimport { useToast } from '@/components/ui/ToastContext'\nimport TransactionItemForm from '@/components/TransactionItemForm'\n\n// Remove any unwanted icons from transaction type badges\nconst removeUnwantedIcons = () => {\n  const badges = document.querySelectorAll('.no-icon')\n  badges.forEach(badge => {\n    // Remove any child elements that aren't text nodes\n    const children = Array.from(badge.childNodes)\n    children.forEach(child => {\n      if (child.nodeType !== Node.TEXT_NODE) {\n        if (child.parentNode) {\n          child.parentNode.removeChild(child)\n        }\n      }\n    })\n  })\n}\n\n\nexport default function TransactionDetail() {\n  const { id: projectId, transactionId } = useParams<{ id: string; transactionId: string }>()\n  const navigate = useNavigate()\n  const location = useLocation()\n  const [transaction, setTransaction] = useState<Transaction | null>(null)\n  const [project, setProject] = useState<Project | null>(null)\n  const [transactionItems, setTransactionItems] = useState<Item[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [isLoadingItems, setIsLoadingItems] = useState(true)\n  const [showGallery, setShowGallery] = useState(false)\n  const [galleryInitialIndex, setGalleryInitialIndex] = useState(0)\n  const [isUploadingReceiptImages, setIsUploadingReceiptImages] = useState(false)\n  const [isUploadingOtherImages, setIsUploadingOtherImages] = useState(false)\n  const [isAddingItem, setIsAddingItem] = useState(false)\n  const [imageFilesMap, setImageFilesMap] = useState<Map<string, File[]>>(new Map())\n  const { showError, showSuccess } = useToast()\n\n  // Navigation context logic\n  const currentSearchParams = new URLSearchParams(location.search)\n  const fromBusinessInventoryItem = currentSearchParams.get('from') === 'business-inventory-item'\n\n  const backDestination = useMemo(() => {\n    // Check if we have a returnTo parameter (highest priority)\n    const returnTo = currentSearchParams.get('returnTo')\n    if (returnTo) return returnTo\n\n    // If we came from business inventory item, go back there\n    if (fromBusinessInventoryItem) {\n      // Extract the item ID from the returnTo URL if available, otherwise go to main inventory\n      const returnToUrl = currentSearchParams.get('returnTo')\n      if (returnToUrl && returnToUrl.includes('/business-inventory/')) {\n        return returnToUrl\n      }\n      return '/business-inventory' // Fallback to main inventory\n    }\n\n    return `/project/${projectId}?tab=transactions` // Default to project transactions tab\n  }, [fromBusinessInventoryItem, currentSearchParams, projectId])\n\n\n  useEffect(() => {\n    const loadTransaction = async () => {\n      if (!projectId || !transactionId) return\n\n      try {\n        // Fetch transaction, project data, and transaction items\n        const [transactionData, projectData, itemIds] = await Promise.all([\n          transactionService.getTransaction(projectId, transactionId),\n          projectService.getProject(projectId),\n          itemService.getTransactionItems(projectId, transactionId)\n        ])\n\n        const convertedTransaction: Transaction = {\n          ...transactionData,\n          transaction_images: Array.isArray(transactionData?.transaction_images) ? transactionData.transaction_images : []\n        } as Transaction\n\n        console.log('TransactionDetail - loaded transactionData:', transactionData)\n        console.log('TransactionDetail - convertedTransaction:', convertedTransaction)\n        console.log('TransactionDetail - item IDs:', itemIds)\n        setTransaction(convertedTransaction)\n        setProject(projectData)\n\n        // Fetch the actual item details\n        if (itemIds.length > 0) {\n          const itemsPromises = itemIds.map(itemId => itemService.getItem(projectId, itemId))\n          const items = await Promise.all(itemsPromises)\n          const validItems = items.filter(item => item !== null) as Item[]\n          console.log('TransactionDetail - fetched items:', validItems.length)\n          setTransactionItems(validItems)\n        } else {\n          setTransactionItems([])\n        }\n\n      } catch (error) {\n        console.error('Error loading transaction:', error)\n        setTransactionItems([])\n      } finally {\n        setIsLoading(false)\n        setIsLoadingItems(false)\n      }\n    }\n\n    loadTransaction()\n  }, [projectId, transactionId])\n\n  // Set up real-time subscription for transaction updates\n  useEffect(() => {\n    if (!projectId || !transactionId) return\n\n    // Temporarily disable real-time subscription to debug\n    // const unsubscribe = transactionService.subscribeToTransaction(\n    //   projectId,\n    //   transactionId,\n    //   (updatedTransaction) => {\n    //     if (updatedTransaction) {\n    //       console.log('TransactionDetail - real-time updatedTransaction:', updatedTransaction)\n    //       console.log('TransactionDetail - real-time updatedTransaction.transaction_images:', updatedTransaction.transaction_images)\n    //       console.log('TransactionDetail - real-time updatedTransaction.transaction_images length:', updatedTransaction.transaction_images?.length)\n\n    //       const convertedTransaction: Transaction = {\n    //         ...updatedTransaction,\n    //         transaction_images: Array.isArray(updatedTransaction.transaction_images) ? updatedTransaction.transaction_images : []\n    //       } as Transaction\n\n    //       console.log('TransactionDetail - real-time convertedTransaction:', convertedTransaction)\n    //       setTransaction(convertedTransaction)\n    //     } else {\n    //       setTransaction(null)\n    //     }\n    //   }\n    // )\n\n    // return () => {\n    //   unsubscribe()\n    // }\n  }, [projectId, transactionId])\n\n\n  // Clean up any unwanted icons from transaction type badges\n  useEffect(() => {\n    if (transaction) {\n      removeUnwantedIcons()\n      // Also run after a short delay to catch any dynamically added icons\n      const timer = setTimeout(removeUnwantedIcons, 100)\n      const timer2 = setTimeout(removeUnwantedIcons, 500)\n      return () => {\n        clearTimeout(timer)\n        clearTimeout(timer2)\n      }\n    }\n  }, [transaction])\n\n  const handleDelete = async () => {\n    if (!projectId || !transactionId || !transaction) return\n\n    if (window.confirm('Are you sure you want to delete this transaction? This action cannot be undone.')) {\n      try {\n        await transactionService.deleteTransaction(projectId, transactionId)\n        navigate(`/project/${projectId}?tab=transactions`)\n      } catch (error) {\n        console.error('Error deleting transaction:', error)\n        showError('Failed to delete transaction. Please try again.')\n      }\n    }\n  }\n\n  const handleImageClick = (index: number) => {\n    setGalleryInitialIndex(index)\n    setShowGallery(true)\n  }\n\n  const handleGalleryClose = () => {\n    setShowGallery(false)\n  }\n\n  const handleReceiptImagesUpload = async (files: File[]) => {\n    if (!projectId || !transactionId || !project || files.length === 0) return\n\n    setIsUploadingReceiptImages(true)\n\n    try {\n      // Upload receipt images\n      const uploadResults = await ImageUploadService.uploadMultipleReceiptImages(\n        files,\n        project.name,\n        transactionId\n      )\n\n      // Convert to TransactionImage format\n      const newReceiptImages = ImageUploadService.convertFilesToReceiptImages(uploadResults)\n\n      // Update transaction with new receipt images\n      const currentReceiptImages = transaction?.receipt_images || []\n      const updatedReceiptImages = [...currentReceiptImages, ...newReceiptImages]\n\n      await transactionService.updateTransaction(projectId, transactionId, {\n        receipt_images: updatedReceiptImages,\n        transaction_images: updatedReceiptImages // Also update legacy field for compatibility\n      })\n\n      // Refresh transaction data\n      const updatedTransaction = await transactionService.getTransaction(projectId, transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Receipt images uploaded successfully')\n    } catch (error) {\n      console.error('Error uploading receipt images:', error)\n      showError('Failed to upload receipt images. Please try again.')\n    } finally {\n      setIsUploadingReceiptImages(false)\n    }\n  }\n\n  const handleOtherImagesUpload = async (files: File[]) => {\n    if (!projectId || !transactionId || !project || files.length === 0) return\n\n    setIsUploadingOtherImages(true)\n\n    try {\n      // Upload other images\n      const uploadResults = await ImageUploadService.uploadMultipleOtherImages(\n        files,\n        project.name,\n        transactionId\n      )\n\n      // Convert to TransactionImage format\n      const newOtherImages = ImageUploadService.convertFilesToOtherImages(uploadResults)\n\n      // Update transaction with new other images\n      const currentOtherImages = transaction?.other_images || []\n      const updatedOtherImages = [...currentOtherImages, ...newOtherImages]\n\n      await transactionService.updateTransaction(projectId, transactionId, {\n        other_images: updatedOtherImages\n      })\n\n      // Refresh transaction data\n      const updatedTransaction = await transactionService.getTransaction(projectId, transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Other images uploaded successfully')\n    } catch (error) {\n      console.error('Error uploading other images:', error)\n      showError('Failed to upload other images. Please try again.')\n    } finally {\n      setIsUploadingOtherImages(false)\n    }\n  }\n\n  const handleDeleteReceiptImage = async (imageUrl: string) => {\n    if (!projectId || !transactionId || !transaction) return\n\n    try {\n      // Filter out the image to be deleted\n      const currentReceiptImages = transaction.receipt_images || []\n      const updatedReceiptImages = currentReceiptImages.filter(img => img.url !== imageUrl)\n\n      await transactionService.updateTransaction(projectId, transactionId, {\n        receipt_images: updatedReceiptImages,\n        transaction_images: updatedReceiptImages // Also update legacy field for compatibility\n      })\n\n      // Refresh transaction data\n      const updatedTransaction = await transactionService.getTransaction(projectId, transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Receipt image deleted successfully')\n    } catch (error) {\n      console.error('Error deleting receipt image:', error)\n      showError('Failed to delete receipt image. Please try again.')\n    }\n  }\n\n  const handleDeleteOtherImage = async (imageUrl: string) => {\n    if (!projectId || !transactionId || !transaction) return\n\n    try {\n      // Filter out the image to be deleted\n      const currentOtherImages = transaction.other_images || []\n      const updatedOtherImages = currentOtherImages.filter(img => img.url !== imageUrl)\n\n      await transactionService.updateTransaction(projectId, transactionId, {\n        other_images: updatedOtherImages\n      })\n\n      // Refresh transaction data\n      const updatedTransaction = await transactionService.getTransaction(projectId, transactionId)\n      setTransaction(updatedTransaction)\n\n      showSuccess('Other image deleted successfully')\n    } catch (error) {\n      console.error('Error deleting other image:', error)\n      showError('Failed to delete other image. Please try again.')\n    }\n  }\n\n  const handleImageFilesChange = (itemId: string, imageFiles: File[]) => {\n    setImageFilesMap(prev => {\n      const newMap = new Map(prev)\n      newMap.set(itemId, imageFiles)\n      return newMap\n    })\n  }\n\n  const handleSaveItem = async (item: TransactionItemFormData) => {\n    if (!projectId || !transactionId || !transaction) return\n\n    try {\n      // Create the item linked to the existing transaction\n      const itemId = await itemService.addItemToTransaction(\n        projectId,\n        transactionId,\n        transaction.transaction_date || new Date().toISOString(),\n        transaction.source,\n        item\n      )\n\n      // Upload item images if any\n      // Try to get files from the map first, then fall back to item.imageFiles\n      let imageFiles = imageFilesMap.get(item.id)\n      if (!imageFiles && item.imageFiles) {\n        imageFiles = item.imageFiles\n      }\n\n      if (imageFiles && imageFiles.length > 0) {\n        try {\n          const uploadedImages = await Promise.all(\n            imageFiles.map(async (file, index) => {\n              try {\n                const uploadResult = await ImageUploadService.uploadItemImage(\n                  file,\n                  project ? project.name : 'Unknown Project',\n                  itemId\n                )\n\n                return {\n                  url: uploadResult.url,\n                  alt: file.name,\n                  isPrimary: index === 0, // First image is primary\n                  uploadedAt: new Date(),\n                  fileName: file.name,\n                  size: file.size,\n                  mimeType: file.type\n                }\n              } catch (uploadError) {\n                console.error(`Failed to upload ${file.name}:`, uploadError)\n                // Return a placeholder for failed uploads so the process continues\n                return {\n                  url: '',\n                  alt: file.name,\n                  isPrimary: false,\n                  uploadedAt: new Date(),\n                  fileName: file.name,\n                  size: file.size,\n                  mimeType: file.type\n                }\n              }\n            })\n          )\n\n          // Filter out failed uploads (empty URLs)\n          const validImages = uploadedImages.filter(img => img.url && img.url.trim() !== '')\n\n          // Update the item with uploaded images\n          if (validImages.length > 0) {\n            await itemService.updateItemImages(projectId, itemId, validImages)\n          }\n        } catch (error) {\n          console.error('Error in image upload process:', error)\n        }\n      }\n\n      // Refresh the transaction items list\n      const itemIds = await itemService.getTransactionItems(projectId, transactionId)\n      const itemsPromises = itemIds.map(id => itemService.getItem(projectId, id))\n      const items = await Promise.all(itemsPromises)\n      const validItems = items.filter(item => item !== null) as Item[]\n      setTransactionItems(validItems)\n\n      // Reset state\n      setIsAddingItem(false)\n      setImageFilesMap(new Map())\n\n      showSuccess('Item added successfully')\n    } catch (error) {\n      console.error('Error adding item:', error)\n      showError('Failed to add item. Please try again.')\n    }\n  }\n\n  const handleCancelAddItem = () => {\n    setIsAddingItem(false)\n    setImageFilesMap(new Map())\n  }\n\n  // Convert all transaction images (receipt and other) to ItemImage format for the gallery\n  const allTransactionImages = [\n    ...(transaction?.receipt_images || []),\n    ...(transaction?.other_images || [])\n  ]\n\n  const itemImages = allTransactionImages.map((img, index) => ({\n    url: img.url,\n    alt: img.fileName,\n    fileName: img.fileName,\n    uploadedAt: img.uploadedAt,\n    size: img.size,\n    mimeType: img.mimeType,\n    isPrimary: index === 0 // First image is primary\n  })) || []\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto\"></div>\n          <p className=\"mt-2 text-sm text-gray-600\">Loading transaction...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!transaction) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"mx-auto h-12 w-12 text-gray-400\">ðŸ“„</div>\n        <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Transaction not found</h3>\n        <p className=\"mt-1 text-sm text-gray-500\">The transaction you're looking for doesn't exist.</p>\n        <div className=\"mt-6\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-4\">\n        {/* Back button row */}\n        <div className=\"flex items-center justify-between\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Link>\n          <div className=\"flex space-x-3\">\n            <Link\n              to={`/project/${projectId}/transaction/${transactionId}/edit`}\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              title=\"Edit Transaction\"\n            >\n              <Edit className=\"h-4 w-4\" />\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Transaction Details */}\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"px-6 py-6 border-b border-gray-200\">\n          <h1 className=\"text-2xl font-bold text-gray-900 leading-tight\">\n            {transaction.source} - {transaction.transaction_type}\n          </h1>\n        </div>\n\n\n        <div className=\"px-6 py-4 border-t border-gray-200\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n            Transaction Details\n          </h3>\n          <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Source</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{transaction.source}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Budget Category</dt>\n              <dd className=\"mt-1\">\n                <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n                  transaction.budget_category === 'Design Fee'\n                    ? 'bg-amber-100 text-amber-800'\n                    : transaction.budget_category === 'Furnishings'\n                    ? 'bg-yellow-100 text-yellow-800'\n                    : transaction.budget_category === 'Property Management'\n                    ? 'bg-orange-100 text-orange-800'\n                    : transaction.budget_category === 'Kitchen'\n                    ? 'bg-amber-200 text-amber-900'\n                    : transaction.budget_category === 'Install'\n                    ? 'bg-yellow-200 text-yellow-900'\n                    : transaction.budget_category === 'Storage & Receiving'\n                    ? 'bg-orange-200 text-orange-900'\n                    : transaction.budget_category === 'Fuel'\n                    ? 'bg-amber-300 text-amber-900'\n                    : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {transaction.budget_category || 'Not specified'}\n                </span>\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Transaction Type</dt>\n              <dd className=\"mt-1\">\n                <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${\n                  transaction.transaction_type === 'Purchase'\n                    ? 'bg-green-100 text-green-800'\n                    : transaction.transaction_type === 'Return'\n                    ? 'bg-red-100 text-red-800'\n                    : transaction.transaction_type === 'To Inventory'\n                    ? 'bg-primary-100 text-primary-800'\n                    : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {transaction.transaction_type === 'To Inventory' ? 'Inventory' : transaction.transaction_type}\n                </span>\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Amount</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{formatCurrency(transaction.amount)}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Transaction Date</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">\n                {transaction.transaction_date ? formatDate(transaction.transaction_date) : 'No date'}\n              </dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Payment Method</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">{transaction.payment_method}</dd>\n            </div>\n\n            <div>\n              <dt className=\"text-sm font-medium text-gray-500\">Status</dt>\n              <dd className=\"mt-1 text-sm text-gray-900\">\n                {(transaction.status || 'pending').charAt(0).toUpperCase() + (transaction.status || 'pending').slice(1)}\n              </dd>\n            </div>\n\n            {transaction.reimbursement_type && (transaction.reimbursement_type as string) !== '' && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">Reimbursement Type</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {transaction.reimbursement_type === 'Client Owes' ? 'Client Owes' : 'We Owe'}\n                </dd>\n              </div>\n            )}\n\n            {transaction.receipt_emailed && (\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500\">\n                  Receipt Emailed\n                </dt>\n                <dd className=\"mt-1\">\n                  <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                    Yes\n                  </span>\n                </dd>\n              </div>\n            )}\n\n            {transaction.notes && (\n              <div className=\"sm:col-span-2\">\n                <dt className=\"text-sm font-medium text-gray-500\">Notes</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 whitespace-pre-wrap\">{transaction.notes}</dd>\n              </div>\n            )}\n          </dl>\n        </div>\n\n        {/* Receipt Images */}\n        <div className=\"px-6 py-6 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <ImageIcon className=\"h-5 w-5 mr-2\" />\n              Receipt Images\n            </h3>\n            {transaction.receipt_images && transaction.receipt_images.length > 0 && (\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleReceiptImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingReceiptImages}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingReceiptImages ? 'Uploading...' : 'Add Images'}\n              </button>\n            )}\n          </div>\n          {transaction.receipt_images && transaction.receipt_images.length > 0 ? (\n            <TransactionImagePreview\n              images={transaction.receipt_images}\n              onRemoveImage={handleDeleteReceiptImage}\n              onImageClick={handleImageClick}\n              maxImages={5}\n              showControls={true}\n              size=\"md\"\n              className=\"mb-4\"\n            />\n          ) : (\n            <div className=\"text-center py-8\">\n              <ImageIcon className=\"mx-auto h-8 w-8 text-gray-400\" />\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No receipt images uploaded</h3>\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleReceiptImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingReceiptImages}\n                className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 mt-3 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingReceiptImages ? 'Uploading...' : 'Add Receipt Images'}\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Other Images - Only show if there are other images */}\n        {transaction.other_images && transaction.other_images.length > 0 && (\n          <div className=\"px-6 py-6 border-t border-gray-200\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n                <ImageIcon className=\"h-5 w-5 mr-2\" />\n                Other Images\n              </h3>\n              <button\n                onClick={() => {\n                  // Trigger file input click programmatically\n                  const input = document.createElement('input')\n                  input.type = 'file'\n                  input.multiple = true\n                  input.accept = 'image/*'\n                  input.onchange = (e) => {\n                    const files = (e.target as HTMLInputElement).files\n                    if (files) {\n                      handleOtherImagesUpload(Array.from(files))\n                    }\n                  }\n                  input.click()\n                }}\n                disabled={isUploadingOtherImages}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n              >\n                <ImageIcon className=\"h-3 w-3 mr-1\" />\n                {isUploadingOtherImages ? 'Uploading...' : 'Add Images'}\n              </button>\n            </div>\n            <TransactionImagePreview\n              images={transaction.other_images}\n              onRemoveImage={handleDeleteOtherImage}\n              onImageClick={(index) => {\n                // Find the correct index in the combined array for gallery navigation\n                const receiptCount = transaction.receipt_images?.length || 0\n                const legacyCount = transaction.transaction_images?.length || 0\n                const galleryIndex = receiptCount + legacyCount + index\n                handleImageClick(galleryIndex)\n              }}\n              maxImages={5}\n              showControls={true}\n              size=\"md\"\n              className=\"mb-4\"\n            />\n\n          </div>\n        )}\n\n        {/* Transaction Items */}\n        <div className=\"px-6 py-6 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <Package className=\"h-5 w-5 mr-2\" />\n              Transaction Items\n            </h3>\n            {/* Add Item Button - Only show when items exist (like Receipt Images section) */}\n            {(!isLoadingItems && !isAddingItem && transactionItems.length > 0) && (\n              <button\n                onClick={() => setIsAddingItem(true)}\n                className=\"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                title=\"Add new item\"\n              >\n                <Package className=\"h-3 w-3 mr-1\" />\n                Add Item\n              </button>\n            )}\n          </div>\n\n          {isLoadingItems ? (\n            <div className=\"flex justify-center items-center h-16\">\n              <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\"></div>\n              <span className=\"ml-2 text-sm text-gray-600\">Loading items...</span>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {/* Existing Items Display */}\n              {transactionItems.length > 0 && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {transactionItems.map((item) => (\n                    <Link\n                      key={item.item_id}\n                      to={`/project/${projectId}/item/${item.item_id}?from=transaction`}\n                      className=\"block p-4 border border-gray-200 rounded-lg bg-white hover:border-primary-300 hover:shadow-sm transition-all duration-200 group relative\"\n                    >\n                      {/* Disposition badge in upper right corner */}\n                      {item.disposition && (\n                        <div className=\"absolute top-1 right-1 z-10\">\n                          <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${\n                            item.disposition === 'keep'\n                              ? 'bg-green-100 text-green-800'\n                              : item.disposition === 'to return'\n                              ? 'bg-red-100 text-red-700'\n                              : item.disposition === 'return' // Backward compatibility\n                              ? 'bg-red-100 text-red-700'\n                              : item.disposition === 'returned'\n                              ? 'bg-red-800 text-red-100'\n                              : item.disposition === 'inventory'\n                              ? 'bg-blue-100 text-blue-800'\n                              : 'bg-gray-100 text-gray-800'\n                          }`}>\n                            {item.disposition === 'to return' ? 'To Return' : item.disposition ? item.disposition.charAt(0).toUpperCase() + item.disposition.slice(1) : 'Not Set'}\n                          </span>\n                        </div>\n                      )}\n\n                      {/* Image and Description row - side by side like inventory list */}\n                      <div className=\"flex items-center gap-3 py-3\">\n                        <div className=\"flex-shrink-0\">\n                          {item.images && item.images.length > 0 ? (\n                            // Show primary image thumbnail or first image if no primary\n                            (() => {\n                              const primaryImage = item.images.find(img => img.isPrimary) || item.images[0]\n                              return (\n                                <div className=\"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200\">\n                                  <img\n                                    src={primaryImage.url}\n                                    alt={primaryImage.alt || 'Item image'}\n                                    className=\"w-full h-full object-cover\"\n                                  />\n                                </div>\n                              )\n                            })()\n                          ) : (\n                            // Show placeholder when no images\n                            <div className=\"w-16 h-16 rounded-lg border-2 border-gray-200 flex items-center justify-center text-gray-400 bg-gray-100\">\n                              <Package className=\"h-6 w-6\" />\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Item description - matching inventory list styling */}\n                        <div className=\"flex-1 min-w-0 flex items-center\">\n                          <div>\n                            <h3 className=\"text-base font-medium text-gray-900 line-clamp-2 break-words\">\n                              {item.description}\n                            </h3>\n                            {/* Space field - if available */}\n                            {item.space && (\n                              <p className=\"text-sm text-gray-600 mt-1\">\n                                {item.space}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Bottom row: Price, Source, SKU - exactly like inventory list */}\n                      <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500\">\n                        {item.purchase_price && (\n                          <span className=\"font-medium text-gray-700\">{formatCurrency(item.purchase_price)}</span>\n                        )}\n                        {item.source && (\n                          <>\n                            {(item.purchase_price) && <span className=\"hidden sm:inline\">â€¢</span>}\n                            <span className=\"font-medium text-gray-700\">{item.source}</span>\n                          </>\n                        )}\n                        {item.sku && (\n                          <>\n                            {(item.purchase_price || item.source) && <span className=\"hidden sm:inline\">â€¢</span>}\n                            <span className=\"font-medium text-gray-700\">{item.sku}</span>\n                          </>\n                        )}\n                      </div>\n                    </Link>\n                  ))}\n                </div>\n              )}\n\n              {/* In-line Item Addition */}\n              {isAddingItem && (\n                <TransactionItemForm\n                  onSave={handleSaveItem}\n                  onCancel={handleCancelAddItem}\n                  projectId={projectId}\n                  projectName={project ? project.name : ''}\n                  onImageFilesChange={handleImageFilesChange}\n                />\n              )}\n\n              {/* Empty State - Only show when no items exist and not adding */}\n              {transactionItems.length === 0 && !isAddingItem && (\n                <div className=\"text-center py-8\">\n                  <Package className=\"mx-auto h-8 w-8 text-gray-400\" />\n                  <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No items added</h3>\n                  <button\n                    onClick={() => setIsAddingItem(true)}\n                    className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 mt-3\"\n                    title=\"Add new item\"\n                  >\n                    <Package className=\"h-3 w-3 mr-1\" />\n                    Add Item\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Metadata */}\n        <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200\">\n          <div className=\"relative\">\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-3\">\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Project</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{project?.name || transaction.project_name}</dd>\n              </div>\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Created</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {formatDate(transaction.created_at)}\n                </dd>\n              </div>\n            </dl>\n\n            {/* Delete button in lower right corner */}\n            <div className=\"absolute bottom-0 right-0\">\n              <button\n                onClick={handleDelete}\n                className=\"inline-flex items-center justify-center p-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                title=\"Delete Transaction\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Image gallery modal */}\n      {showGallery && (\n        <ImageGallery\n          images={itemImages}\n          initialIndex={galleryInitialIndex}\n          onClose={handleGalleryClose}\n        />\n      )}\n    </div>\n  )\n}\n"],"names":["removeUnwantedIcons","badge","child","TransactionDetail","projectId","transactionId","useParams","navigate","useNavigate","location","useLocation","transaction","setTransaction","useState","project","setProject","transactionItems","setTransactionItems","isLoading","setIsLoading","isLoadingItems","setIsLoadingItems","showGallery","setShowGallery","galleryInitialIndex","setGalleryInitialIndex","isUploadingReceiptImages","setIsUploadingReceiptImages","isUploadingOtherImages","setIsUploadingOtherImages","isAddingItem","setIsAddingItem","imageFilesMap","setImageFilesMap","showError","showSuccess","useToast","currentSearchParams","fromBusinessInventoryItem","backDestination","useMemo","returnTo","returnToUrl","useEffect","transactionData","projectData","itemIds","transactionService","projectService","itemService","convertedTransaction","itemsPromises","itemId","validItems","item","error","timer","timer2","handleDelete","handleImageClick","index","handleGalleryClose","handleReceiptImagesUpload","files","uploadResults","ImageUploadService","newReceiptImages","updatedReceiptImages","updatedTransaction","handleOtherImagesUpload","newOtherImages","updatedOtherImages","handleDeleteReceiptImage","imageUrl","img","handleDeleteOtherImage","handleImageFilesChange","imageFiles","prev","newMap","handleSaveItem","validImages","file","uploadError","id","handleCancelAddItem","itemImages","jsxs","jsx","Link","ArrowLeft","Edit","formatCurrency","formatDate","ImageIcon","input","e","TransactionImagePreview","receiptCount","_a","legacyCount","_b","galleryIndex","Package","primaryImage","Fragment","TransactionItemForm","Trash2","ImageGallery"],"mappings":"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"}