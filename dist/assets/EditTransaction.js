import{u as me,d as ue,U as ge,j as e,m as O,f as $,C as A}from"./index.js";import{c as xe,b as he,L as pe}from"./router.js";import{r as d}from"./vendor.js";import{T as X}from"./transactionSources.js";import{t as k,p as ye,b as be,u as U}from"./inventoryService.js";import{I as G}from"./imageService.js";import{I as fe}from"./ImageUpload.js";import{g as je}from"./taxPresetsService.js";import{d as Ne,g as ve,b as H,t as J}from"./ui.js";import"./supabase.js";function De(){const{id:x,transactionId:m}=xe(),C=he(),{hasRole:Z}=me(),{currentAccountId:l}=ue();if(!Z(ge.USER))return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-red-100",children:e.jsx(Ne,{className:"h-6 w-6 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to edit transactions. Please contact an administrator if you need access."}),e.jsx(pe,{to:`/project/${x}`,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Project"})]})});const[ee,te]=d.useState(""),[n,L]=d.useState({transactionDate:"",source:"",transactionType:"Purchase",paymentMethod:"",amount:"",budgetCategory:"Furnishings",notes:"",status:"completed",reimbursementType:"",triggerEvent:"Manual",receiptImages:[],otherImages:[],receiptEmailed:!1}),[h,F]=d.useState(void 0),[V,W]=d.useState(""),[P,se]=d.useState([]),[B,q]=d.useState(void 0),[i,I]=d.useState({}),[v,E]=d.useState(!1),[ae,re]=d.useState(!0),[w,ne]=d.useState(!1),[D,ie]=d.useState([]),[R,K]=d.useState([]),_=d.useRef(null),[Y,M]=d.useState(!1);d.useEffect(()=>{(async()=>{if(l)try{const a=await je(l);se(a)}catch(a){console.error("Error loading tax presets:",a)}})()},[l]),d.useEffect(()=>{if(h&&h!=="Other"){const t=P.find(a=>a.id===h);q(t==null?void 0:t.rate)}else q(void 0)},[h,P]),d.useEffect(()=>{(async()=>{if(!(!x||!m||!l))try{const[a,c]=await Promise.all([k.getTransaction(l,x,m),ye.getProject(l,x)]);if(c&&te(c.name),a){const f=a.source==="Other"||a.source==="",T=f&&c?c.name:a.source,z=!!(T&&!X.includes(T));if(L({transactionDate:be(a.transactionDate)||"",source:T,transactionType:a.transactionType,paymentMethod:a.paymentMethod,amount:a.amount,budgetCategory:a.budgetCategory||"Furnishings",notes:a.notes||"",status:a.status||"completed",reimbursementType:a.reimbursementType||"",triggerEvent:a.triggerEvent||"Manual",receiptImages:[],otherImages:[],receiptEmailed:a.receiptEmailed}),a.taxRatePreset&&F(a.taxRatePreset),W(a.subtotal||""),M(z),f&&c&&x&&m&&l)try{await k.updateTransaction(l,x,m,{source:c.name})}catch(b){console.warn("Failed to auto-correct source to project name:",b)}const S=a.otherImages||[];ie(Array.isArray(S)?S:[]);try{const b=await U.getItemsForTransaction(l,x,m);console.log("Loaded transaction items:",b);const g=b.map(r=>r.itemId);console.log("Transaction item IDs:",g);const y=await Promise.all(b.map(async r=>{var N,j;return console.log(`Loaded item ${r.itemId}:`,{id:r.itemId,description:(r==null?void 0:r.description)||"",hasValidFormat:r.itemId.startsWith("I-")&&r.itemId.length>10}),{id:r.itemId,description:(r==null?void 0:r.description)||"",purchasePrice:((N=r==null?void 0:r.purchasePrice)==null?void 0:N.toString())||"",sku:(r==null?void 0:r.sku)||"",marketValue:((j=r==null?void 0:r.marketValue)==null?void 0:j.toString())||"",notes:(r==null?void 0:r.notes)||"",imageFiles:[],images:(r==null?void 0:r.images)||[]}}));console.log("Loaded transaction items:",b.map(r=>({id:r.itemId,description:r.description,isTempId:r.itemId.startsWith("temp-")}))),K(y);try{_.current=y.map(r=>({id:r.id,description:r.description,purchasePrice:r.purchasePrice,sku:r.sku,marketValue:r.marketValue,notes:r.notes}))}catch{_.current=null}}catch(b){console.error("Error loading transaction items:",b)}}}catch(a){console.error("Error loading transaction:",a)}finally{re(!1)}})()},[x,m,l]);const oe=()=>{var a;const t={};return n.source.trim()||(t.source="Source is required"),(a=n.budgetCategory)!=null&&a.trim()||(t.budgetCategory="Budget category is required"),n.amount.trim()?(isNaN(Number(n.amount))||Number(n.amount)<=0)&&(t.amount="Amount must be a positive number"):t.amount="Amount is required",I(t),Object.keys(t).length===0},ce=async t=>{if(t.preventDefault(),!oe()||!x||!m||!l)return;E(!0);let a=!1;try{if(l&&m)try{k.beginNeedsReviewBatch(l,m),a=!0}catch(g){console.warn("Failed to begin needs review batch:",g)}if(R.length>0){console.log("All items before processing:",R.map(s=>({id:s.id,description:s.description,price:s.purchasePrice,sku:s.sku,isTempId:s.id.startsWith("temp-"),idFormat:s.id.startsWith("I-")?"database":s.id.startsWith("temp-")?"temp":"unknown"})));const g=[],y=[];R.forEach(s=>{s.id.startsWith("temp-")?y.push(s):s.id.startsWith("I-")&&s.id.length>10?g.push(s):s.id.length>5&&!s.id.includes("_")?(console.warn(`Item with ambiguous ID treated as existing: ${s.id} - ${s.description}`),g.push(s)):(console.warn(`Item with unclear ID format treated as new: ${s.id} - ${s.description}`),y.push(s))}),console.log(`Separated ${g.length} existing items and ${y.length} new items`);const r=new Map;if(_.current)for(const s of _.current)r.set(s.id,s);const N=[];for(const s of g){const u=r.get(s.id),p={};(!u||u.description!==s.description)&&(p.description=s.description),(!u||String(u.purchasePrice||"")!==String(s.purchasePrice||""))&&(p.purchasePrice=s.purchasePrice),(!u||String(u.marketValue||"")!==String(s.marketValue||""))&&(p.marketValue=s.marketValue),(!u||(u.sku||"")!==(s.sku||""))&&(p.sku=s.sku),(!u||(u.notes||"")!==(s.notes||""))&&(p.notes=s.notes),p.transactionId=m,Object.keys(p).filter(de=>de!=="transactionId").length>0&&N.push({id:s.id,updates:p})}console.log(`Preparing to update ${N.length} of ${g.length} existing items`);for(const s of N)await U.updateItem(l,s.id,s.updates);let j=[];y.length>0&&(j=await Promise.all(y.map(async s=>{const u={...s,projectId:x,transactionId:m,dateCreated:n.transactionDate,source:n.source,inventoryStatus:"available",paymentMethod:"Unknown",qrKey:`QR-${Date.now()}-${Math.random().toString(36).substr(2,4)}`,bookmark:!1,sku:s.sku||"",purchasePrice:s.purchasePrice||"",projectPrice:s.projectPrice||"",marketValue:s.marketValue||"",notes:s.notes||"",space:s.space||"",disposition:"keep"};return await U.createItem(l,u)})),console.log("Created new items:",j),K(s=>s.map(u=>{const p=y.findIndex(Q=>Q.id===u.id);return p>=0&&p<j.length?{...u,id:j[p]}:u})))}let c=[...D];if(n.otherImages&&n.otherImages.length>0)try{const g=await G.uploadMultipleOtherImages(n.otherImages,ee,m,le),y=G.convertFilesToOtherImages(g);c=[...D,...y]}catch(g){console.error("Error uploading other images:",g),I({otherImages:"Failed to upload other images. Please try again."}),E(!1),ne(!1);return}else c=D;const{otherImages:f,receiptImages:T,transactionImages:z,...S}=n,b={...S,otherImages:c,...h?{taxRatePreset:h,subtotal:h==="Other"?V:""}:{subtotal:""}};await k.updateTransaction(l,x,m,b),C(`/project/${x}/transaction/${m}`)}catch(c){console.error("Error updating transaction:",c),I({general:c instanceof Error?c.message:"Failed to update transaction. Please try again."})}finally{if(a&&l&&m)try{await k.flushNeedsReviewBatch(l,m,{flushImmediately:!0})}catch(c){console.warn("Failed to flush needs review batch:",c)}E(!1)}},o=(t,a)=>{L(c=>{const f={...c,[t]:a};return t==="status"&&a==="completed"&&c.reimbursementType?f.reimbursementType="":t==="reimbursementType"&&a&&c.status==="completed"&&(f.status="pending"),f}),i[t]&&I(c=>({...c,[t]:void 0}))},le=(t,a)=>{console.log(`Upload progress for file ${t}: ${a.percentage}%`)};return ae?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading transaction..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>C(-1),className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Transaction"})}),e.jsxs("form",{onSubmit:ce,className:"space-y-6 p-6",children:[i.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:i.general})})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Source/Vendor *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:X.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:t,checked:n.source===t,onChange:a=>{o("source",a.target.value),M(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:Y,onChange:()=>{M(!0),o("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),Y&&e.jsx("input",{type:"text",id:"source_custom_input",value:n.source,onChange:t=>o("source",t.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.source?"border-red-300":"border-gray-300"}`}),i.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.source})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Budget Category *"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_design_fee",name:"budgetCategory",value:"Design Fee",checked:n.budgetCategory==="Design Fee",onChange:t=>o("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_design_fee",className:"ml-2 block text-sm text-gray-900",children:"Design Fee"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_furnishings",name:"budgetCategory",value:"Furnishings",checked:n.budgetCategory==="Furnishings",onChange:t=>o("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_furnishings",className:"ml-2 block text-sm text-gray-900",children:"Furnishings"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_property_management",name:"budgetCategory",value:"Property Management",checked:n.budgetCategory==="Property Management",onChange:t=>o("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_property_management",className:"ml-2 block text-sm text-gray-900",children:"Property Management"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_kitchen",name:"budgetCategory",value:"Kitchen",checked:n.budgetCategory==="Kitchen",onChange:t=>o("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_kitchen",className:"ml-2 block text-sm text-gray-900",children:"Kitchen"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_install",name:"budgetCategory",value:"Install",checked:n.budgetCategory==="Install",onChange:t=>o("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_install",className:"ml-2 block text-sm text-gray-900",children:"Install"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_storage_receiving",name:"budgetCategory",value:"Storage & Receiving",checked:n.budgetCategory==="Storage & Receiving",onChange:t=>o("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_storage_receiving",className:"ml-2 block text-sm text-gray-900",children:"Storage & Receiving"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_fuel",name:"budgetCategory",value:"Fuel",checked:n.budgetCategory==="Fuel",onChange:t=>o("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_fuel",className:"ml-2 block text-sm text-gray-900",children:"Fuel"})]})]}),i.budgetCategory&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.budgetCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Type"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_purchase",name:"transactionType",value:"Purchase",checked:n.transactionType==="Purchase",onChange:t=>o("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_purchase",className:"ml-2 block text-sm text-gray-900",children:"Purchase"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_return",name:"transactionType",value:"Return",checked:n.transactionType==="Return",onChange:t=>o("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_return",className:"ml-2 block text-sm text-gray-900",children:"Return"})]})]}),i.transactionType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.transactionType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Status"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"status_pending",name:"status",value:"pending",checked:n.status==="pending",onChange:t=>o("status",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"status_pending",className:"ml-2 block text-sm text-gray-900",children:"Pending"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"status_completed",name:"status",value:"completed",checked:n.status==="completed",onChange:t=>o("status",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"status_completed",className:"ml-2 block text-sm text-gray-900",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"status_cancelled",name:"status",value:"canceled",checked:n.status==="canceled",onChange:t=>o("status",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"status_cancelled",className:"ml-2 block text-sm text-gray-900",children:"Canceled"})]})]}),i.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Method"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"method_client_card",name:"paymentMethod",value:"Client Card",checked:n.paymentMethod==="Client Card",onChange:t=>o("paymentMethod",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"method_client_card",className:"ml-2 block text-sm text-gray-900",children:"Client Card"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"method_1584_card",name:"paymentMethod",value:O,checked:n.paymentMethod===O,onChange:t=>o("paymentMethod",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"method_1584_card",className:"ml-2 block text-sm text-gray-900",children:O})]})]}),i.paymentMethod&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.paymentMethod})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Reimbursement Type"}),e.jsx("p",{className:"mb-3 text-xs text-gray-500",children:"Flags transactions that require reimbursement"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_none",name:"reimbursementType",value:"",checked:!n.reimbursementType,onChange:t=>o("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_none",className:"ml-2 block text-sm text-gray-900",children:"None"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_client_owes",name:"reimbursementType",value:$,checked:n.reimbursementType===$,onChange:t=>o("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_client_owes",className:"ml-2 block text-sm text-gray-900",children:$})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_we_owe",name:"reimbursementType",value:A,checked:n.reimbursementType===A,onChange:t=>o("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_we_owe",className:"ml-2 block text-sm text-gray-900",children:A})]})]}),i.reimbursementType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.reimbursementType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Receipt Email Copy"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_yes",name:"receiptEmailed",checked:n.receiptEmailed===!0,onChange:()=>o("receiptEmailed",!0),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_yes",className:"ml-2 block text-sm text-gray-900",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_no",name:"receiptEmailed",checked:n.receiptEmailed===!1,onChange:()=>o("receiptEmailed",!1),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_no",className:"ml-2 block text-sm text-gray-900",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"amount",value:n.amount,onChange:t=>o("amount",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.amount?"border-red-300":"border-gray-300"}`})]}),i.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tax Rate Preset"}),e.jsxs("div",{className:"space-y-2",children:[P.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`tax_preset_${t.id}`,name:"tax_rate_preset",value:t.id,checked:h===t.id,onChange:a=>F(a.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsxs("label",{htmlFor:`tax_preset_${t.id}`,className:"ml-2 block text-sm text-gray-900",children:[t.name," (",t.rate.toFixed(2),"%)"]})]},t.id)),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"tax_preset_other",name:"tax_rate_preset",value:"Other",checked:h==="Other",onChange:t=>F(t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"tax_preset_other",className:"ml-2 block text-sm text-gray-900",children:"Other"})]})]}),h&&h!=="Other"&&B!==void 0&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Tax Rate:"})," ",B.toFixed(2),"%"]})})]}),h==="Other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subtotal"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"subtotal",value:V,onChange:t=>W(t.target.value),placeholder:"0.00",className:"block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 border-gray-300"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This will be used to calculate the tax rate."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transactionDate",className:"block text-sm font-medium text-gray-700",children:"Transaction Date"}),e.jsx("input",{type:"date",id:"transactionDate",value:n.transactionDate,onChange:t=>{o("transactionDate",t.target.value)},className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.transactionDate?"border-red-300":"border-gray-300"}`}),i.transactionDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.transactionDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:n.notes,onChange:t=>o("notes",t.target.value),placeholder:"Additional notes about this transaction...",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.notes?"border-red-300":"border-gray-300"}`}),i.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.notes})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Other Images"}),e.jsx(fe,{onImagesChange:t=>o("otherImages",t),maxImages:5,maxFileSize:10,disabled:v||w,className:"mb-2"}),i.otherImages&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.otherImages})]}),e.jsxs("div",{className:"hidden sm:flex justify-end sm:space-x-3 pt-4",children:[e.jsxs("button",{onClick:()=>C(-1),className:"inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:v||w,className:"inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),v?"Updating...":w?"Uploading Images...":"Update"]})]})]})]}),e.jsx("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>C(-1),className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:v||w,onClick:t=>{var c;const a=(c=t.currentTarget.closest(".space-y-6"))==null?void 0:c.querySelector("form");a&&a.requestSubmit()},className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),v?"Updating...":w?"Uploading Images...":"Update"]})]})}),e.jsx("div",{className:"sm:hidden h-20"})]})}export{De as default};
//# sourceMappingURL=EditTransaction.js.map
