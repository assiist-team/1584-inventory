import{j as e}from"./index.js";import{u as P,b as $,L as f}from"./router.js";import{r as i}from"./vendor.js";import{t as b,p as U}from"./inventoryService.js";import{I as j}from"./imageService.js";import{I as A}from"./ImageUpload.js";import{b as L,a as D,l as q}from"./ui.js";import"./firebase.js";function G(){const{id:n,transactionId:m}=P(),N=$(),[v,_]=i.useState(""),[r,p]=i.useState({transaction_date:"",source:"",transaction_type:"Purchase",payment_method:"",amount:"",notes:"",transaction_images:[],receipt_emailed:!1}),[s,d]=i.useState({}),[x,g]=i.useState(!1),[w,I]=i.useState(!0),[h,y]=i.useState(!1),[u,k]=i.useState([]);i.useEffect(()=>{(async()=>{if(!(!n||!m))try{const[a,o]=await Promise.all([b.getTransaction(n,m),U.getProject(n)]);if(o&&_(o.name),a){p({transaction_date:a.transaction_date||"",source:a.source,transaction_type:a.transaction_type,payment_method:a.payment_method,amount:a.amount,notes:a.notes||"",transaction_images:[],receipt_emailed:a.receipt_emailed});const l=a.transaction_images||[];k(Array.isArray(l)?l:[])}}catch(a){console.error("Error loading transaction:",a)}finally{I(!1)}})()},[n,m]);const S=()=>{const t={};return r.source.trim()||(t.source="Source is required"),r.transaction_type.trim()||(t.transaction_type="Transaction type is required"),r.payment_method.trim()||(t.payment_method="Payment method is required"),r.amount.trim()?(isNaN(Number(r.amount))||Number(r.amount)<=0)&&(t.amount="Amount must be a positive number"):t.amount="Amount is required",r.transaction_date||(t.transaction_date="Transaction date is required"),d(t),Object.keys(t).length===0},T=async t=>{if(t.preventDefault(),!(!S()||!n||!m)){g(!0);try{let a=[...u];if(r.transaction_images&&r.transaction_images.length>0){y(!0);try{const l=await j.uploadMultipleTransactionImages(r.transaction_images,v,m,E),F=j.convertFilesToTransactionImages(l);a=[...u,...F]}catch(l){console.error("Error uploading images:",l),d({transaction_images:"Failed to upload transaction images. Please try again."}),g(!1),y(!1);return}y(!1)}else a=u;const o={...r,transaction_images:a};await b.updateTransaction(n,m,o),N(`/project/${n}?tab=transactions`)}catch(a){console.error("Error updating transaction:",a),d({general:a instanceof Error?a.message:"Failed to update transaction. Please try again."})}finally{g(!1)}}},c=(t,a)=>{p(o=>({...o,[t]:a})),s[t]&&d(o=>({...o,[t]:void 0}))},C=t=>{p(a=>({...a,transaction_images:t})),s.transaction_images&&d(a=>({...a,transaction_images:void 0}))},E=(t,a)=>{console.log(`Upload progress for file ${t}: ${a.percentage}%`)};return w?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading transaction..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(f,{to:`/project/${n}?tab=transactions`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Transaction"})}),e.jsxs("form",{onSubmit:T,className:"space-y-6 p-6",children:[s.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:s.general})})]})})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"amount",value:r.amount,onChange:t=>c("amount",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.amount?"border-red-300":"border-gray-300"}`})]}),s.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.amount})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700",children:"Source/Vendor *"}),e.jsx("input",{type:"text",id:"source",value:r.source,onChange:t=>c("source",t.target.value),placeholder:"e.g., Home Depot, Amazon, Local Store",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.source?"border-red-300":"border-gray-300"}`}),s.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-sm font-medium text-gray-700",children:"Payment Method *"}),e.jsx("input",{type:"text",id:"payment_method",value:r.payment_method,onChange:t=>c("payment_method",t.target.value),placeholder:"e.g., 1584 Card, Client Card, Cash, Check",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.payment_method?"border-red-300":"border-gray-300"}`}),s.payment_method&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.payment_method})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transaction_date",className:"block text-sm font-medium text-gray-700",children:"Transaction Date *"}),e.jsx("input",{type:"date",id:"transaction_date",value:r.transaction_date,onChange:t=>{c("transaction_date",t.target.value)},className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.transaction_date?"border-red-300":"border-gray-300"}`}),s.transaction_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.transaction_date})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transaction_type",className:"block text-sm font-medium text-gray-700",children:"Transaction Type *"}),e.jsxs("select",{id:"transaction_type",value:r.transaction_type,onChange:t=>c("transaction_type",t.target.value),className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.transaction_type?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"Purchase",children:"Purchase"}),e.jsx("option",{value:"Return",children:"Return"})]}),s.transaction_type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.transaction_type})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"receipt_emailed",checked:r.receipt_emailed,onChange:t=>c("receipt_emailed",t.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"receipt_emailed",className:"ml-2 block text-sm text-gray-900",children:"Receipt emailed to client"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:r.notes,onChange:t=>c("notes",t.target.value),placeholder:"Additional notes about this transaction...",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.notes?"border-red-300":"border-gray-300"}`}),s.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.notes})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Transaction Images"}),u.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-600 mb-2",children:"Current Images:"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-4",children:u.map((t,a)=>e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"aspect-w-4 aspect-h-3 rounded-lg overflow-hidden bg-gray-100",children:[e.jsx("img",{src:t.url,alt:t.fileName,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center",children:e.jsx("p",{className:"text-white text-xs opacity-0 group-hover:opacity-100 text-center p-2",children:t.fileName})})]})},a))})]}),e.jsx(A,{onImagesChange:C,maxImages:5,maxFileSize:10,disabled:x||h,className:"mb-2"}),s.transaction_images&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.transaction_images})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsxs(f,{to:`/project/${n}?tab=transactions`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:x||h,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),x?"Updating...":h?"Uploading Images...":"Update Transaction"]})]})]})]})]})}export{G as default};
//# sourceMappingURL=EditTransaction.js.map
