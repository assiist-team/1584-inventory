import{u as D,U as B,j as e}from"./index.js";import{u as A,b as R,L as x}from"./router.js";import{r as n}from"./vendor.js";import{i as g,t as U}from"./inventoryService.js";import{T as k}from"./transactionSources.js";import{S as w}from"./Select.js";import{r as O,d as S,B as P,b as M,s as K}from"./ui.js";import"./firebase.js";function J(){const{id:o,itemId:c}=A(),_=R(),{hasRole:C}=D();if(!C(B.DESIGNER))return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-red-100",children:e.jsx(O,{className:"h-6 w-6 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to edit items. Please contact an administrator if you need access."}),e.jsx(x,{to:`/project/${o}`,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Project"})]})});const[r,m]=n.useState({description:"",source:"",sku:"",price:"",market_value:"",payment_method:"",disposition:"",space:"",notes:"",bookmark:!1,selectedTransactionId:""}),[b,u]=n.useState(!1),[I,T]=n.useState(!0),[f,y]=n.useState(!1),[a,d]=n.useState({}),[p,$]=n.useState([]),[l,j]=n.useState(!1);console.log("EditItem - URL params:",{projectId:o,itemId:c}),n.useEffect(()=>{const t=k;r.source&&!t.includes(r.source)?u(!0):r.source&&t.includes(r.source)&&u(!1)},[r.source]),n.useEffect(()=>{(async()=>{if(console.log("fetchItem called with:",{projectId:o,itemId:c}),c&&o)try{const s=await g.getItem(o,c);console.log("Fetched item data:",s),s&&(m({description:String(s.description||""),source:String(s.source||""),sku:String(s.sku||""),price:String(s.price||""),market_value:String(s.market_value||""),payment_method:String(s.payment_method||""),disposition:String(s.disposition||""),space:String(s.space||""),notes:String(s.notes||""),bookmark:!!s.bookmark,selectedTransactionId:String(s.transaction_id||"")}),console.log("Form data set:",{description:String(s.description||""),source:String(s.source||""),sku:String(s.sku||""),price:String(s.price||""),market_value:String(s.market_value||""),payment_method:String(s.payment_method||""),disposition:String(s.disposition||""),notes:String(s.notes||""),bookmark:!!s.bookmark}))}catch(s){console.error("Failed to fetch item:",s),d({fetch:"Failed to load item data"})}T(!1)})()},[c,o]),n.useEffect(()=>{(async()=>{if(o){j(!0);try{const s=await U.getTransactions(o);$(s)}catch(s){console.error("Error fetching transactions:",s)}finally{j(!1)}}})()},[o]);const F=()=>{const t={};return r.description.trim()||(t.description="Description is required"),r.market_value.trim()&&(isNaN(Number(r.market_value))||Number(r.market_value)<=0)&&(t.market_value="Market value must be a positive number"),d(t),Object.keys(t).length===0},E=async t=>{if(t.preventDefault(),!(!F()||!c||!o)){y(!0);try{const s={...r,transaction_id:r.selectedTransactionId||"",last_updated:new Date().toISOString()};await g.updateItem(o,c,s),_(`/project/${o}?tab=inventory`)}catch(s){console.error("Error updating item:",s),d({submit:"Failed to update item. Please try again."})}finally{y(!1)}}},i=(t,s)=>{console.log("Updating field:",t,"with value:",s),m(h=>{const N={...h,[t]:s};return console.log("New form data:",N),N}),a[t]&&d(h=>({...h,[t]:""}))},v=t=>{m(s=>({...s,selectedTransactionId:t})),a.selectedTransactionId&&d(s=>({...s,selectedTransactionId:""}))},L=async()=>{if(!(!c||!o))try{await g.updateItem(o,c,{bookmark:!r.bookmark}),m(t=>({...t,bookmark:!t.bookmark}))}catch(t){console.error("Failed to update bookmark:",t)}};return I?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(x,{to:`/project/${o}?tab=inventory`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Item"})}),e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-2/3"})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(x,{to:`/project/${o}?tab=inventory`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Item"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"flex justify-end mb-8",children:e.jsxs("button",{onClick:L,className:`inline-flex items-center px-3 py-2 border text-sm font-medium rounded-md ${r.bookmark?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`,children:[e.jsx(P,{className:"h-4 w-4 mr-2",fill:r.bookmark?"currentColor":"none"}),r.bookmark?"Bookmarked":"Bookmark"]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("form",{onSubmit:E,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:r.description,onChange:t=>i("description",t.target.value),placeholder:"e.g., Wooden dining table, 6 chairs",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.description?"border-red-300":"border-gray-300"}`}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.description})]}),e.jsxs(w,{label:"Associate with Transaction (Optional)",id:"selectedTransactionId",value:r.selectedTransactionId,onChange:t=>v(t.target.value),error:a.selectedTransactionId,disabled:l,children:[e.jsx("option",{value:"",children:"Select a transaction (optional)"}),l?e.jsx("option",{disabled:!0,children:"Loading transactions..."}):p.map(t=>e.jsxs("option",{value:t.transaction_id,children:[new Date(t.transaction_date).toLocaleDateString()," - ",t.source," - $",t.amount]},t.transaction_id))]}),!l&&p.length===0&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No transactions available for this project"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Source"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:k.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:t,checked:r.source===t,onChange:s=>{i("source",s.target.value),u(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:b,onChange:()=>{u(!0),i("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),b&&e.jsx("input",{type:"text",id:"source_custom_input",value:r.source,onChange:t=>i("source",t.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.source?"border-red-300":"border-gray-300"}`}),a.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:r.sku,onChange:t=>i("sku",t.target.value),placeholder:"Product SKU or model number",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"price",value:r.price,onChange:t=>i("price",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.price?"border-red-300":"border-gray-300"}`})]}),a.price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"market_value",value:r.market_value,onChange:t=>i("market_value",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.market_value?"border-red-300":"border-gray-300"}`})]}),a.market_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.market_value})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:["Client Card","1584 Design"].map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`payment_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"payment_method",value:t,checked:r.payment_method===t,onChange:s=>{i("payment_method",s.target.value)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`payment_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),a.payment_method&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.payment_method})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Disposition"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["keep","to return","returned","inventory"].map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`disposition_${t.toLowerCase()}`,name:"disposition",value:t,checked:r.disposition===t,onChange:s=>i("disposition",s.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`disposition_${t.toLowerCase()}`,className:"ml-2 block text-sm text-gray-900",children:t==="to return"?"To Return":t.charAt(0).toUpperCase()+t.slice(1)})]},t))}),a.disposition&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.disposition})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"space",className:"block text-sm font-medium text-gray-700",children:"Space"}),e.jsx("input",{type:"text",id:"space",value:r.space,onChange:t=>i("space",t.target.value),placeholder:"e.g., Living Room, Master Bedroom, Kitchen",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs(w,{label:"Associate with Transaction (Optional)",id:"selectedTransactionId",value:r.selectedTransactionId,onChange:t=>v(t.target.value),error:a.selectedTransactionId,disabled:l,children:[e.jsx("option",{value:"",children:"Select a transaction (optional)"}),l?e.jsx("option",{disabled:!0,children:"Loading transactions..."}):p.map(t=>e.jsxs("option",{value:t.transaction_id,children:[new Date(t.transaction_date).toLocaleDateString()," - ",t.source," - $",t.amount]},t.transaction_id))]}),!l&&p.length===0&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No transactions available for this project"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:r.notes,onChange:t=>i("notes",t.target.value),placeholder:"Additional notes about this item...",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),a.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:a.submit})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsxs(x,{to:`/project/${o}?tab=inventory`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:f,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),f?"Saving...":"Save"]})]})]})})]})]})]})}export{J as default};
//# sourceMappingURL=EditItem.js.map
