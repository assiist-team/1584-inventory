import{d as _,l as F,j as e,B as N,f as O,C as A}from"./index.js";import{r as d}from"./vendor.js";import{c as R,b as U,L as W}from"./router.js";import{p as D,u as Y,t as $}from"./inventoryService.js";import"./supabase.js";import"./ui.js";import"./taxPresetsService.js";const h=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function j(a){if(typeof a=="number")return isNaN(a)?0:a;if(typeof a=="string"){const l=parseFloat(a||"0");return isNaN(l)?0:l}return 0}function X(){const{id:a}=R(),l=U(),{currentAccountId:u}=_(),{businessName:P,businessLogoUrl:b}=F(),[m,k]=d.useState(null),[o,C]=d.useState([]),[g,E]=d.useState([]),[B,v]=d.useState(!0),[w,I]=d.useState(null),L=d.useMemo(()=>new Date().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),[]);d.useEffect(()=>{(async()=>{if(!a||!u){if(!u)return;l("/projects");return}v(!0),I(null);try{const[r,n,p]=await Promise.all([D.getProject(u,a),Y.getItemsByProject(u,a),$.getTransactions(u,a)]);if(!r){l("/projects");return}k(r),C(n),E(p)}catch(r){console.error("Failed to load client summary:",r),I("Failed to load client summary. Please try again.")}finally{v(!1)}})()},[a,u,l]);const x=d.useMemo(()=>{const s=o.reduce((t,i)=>{const c=j(i.projectPrice);return t+c},0),r={},n=new Map;g.forEach(t=>{t.budgetCategory&&t.transactionId&&n.set(t.transactionId,t.budgetCategory)}),o.forEach(t=>{if(t.transactionId){const i=n.get(t.transactionId);if(i){const c=j(t.projectPrice);r[i]=(r[i]||0)+c}}});const p=o.reduce((t,i)=>{const c=j(i.marketValue);return t+c},0),y=o.reduce((t,i)=>{const c=j(i.marketValue),f=j(i.projectPrice);return c>0?t+(c-f):t},0);return{totalSpent:s,categoryBreakdown:r,totalMarketValue:p,totalSaved:y}},[o,g]),T=()=>window.print(),S=()=>{if(!a)return l("/projects");l(`/project/${a}?tab=inventory`)},V=s=>{var r,n,p,y;if(!a)return null;if(s.transactionId){const t=g.find(M=>M.transactionId===s.transactionId);if(!t)return null;const i=((r=t.transactionId)==null?void 0:r.startsWith("INV_SALE_"))||((n=t.transactionId)==null?void 0:n.startsWith("INV_PURCHASE_")),c=t.reimbursementType===O||t.reimbursementType===A;if(i||c)return{href:`/project/${a}/invoice`,isInternal:!0};const f=(y=(p=t.receiptImages)==null?void 0:p[0])==null?void 0:y.url;return f?{href:f,isInternal:!1}:null}return null};return B?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading client summary..."})]})}):w?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-red-400",children:"âš ï¸"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Error"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:w}),e.jsx("div",{className:"mt-6",children:e.jsx(N,{onClick:S,children:"Back"})})]}):e.jsxs("div",{className:"max-w-4xl mx-auto bg-white shadow rounded-lg p-8 print:shadow-none print:p-0",children:[e.jsxs("div",{className:"flex justify-end space-x-3 mb-6 print:hidden",children:[e.jsx(N,{variant:"secondary",onClick:S,children:"Back"}),e.jsx(N,{onClick:T,children:"Print"})]}),e.jsx("div",{className:"border-b pb-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[b&&e.jsx("img",{src:b,alt:P,className:"h-24 w-auto object-contain"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Client Summary"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-800",children:(m==null?void 0:m.name)||"Project"}),(m==null?void 0:m.clientName)&&e.jsxs("div",{children:["Client: ",m.clientName]}),e.jsxs("div",{children:["Date: ",L]})]})]})]})}),o.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"ðŸ“¦"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No items found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"There are no items associated with this project."})]}),o.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("section",{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Project Overview"})}),e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"Total Spent Overall"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:h.format(x.totalSpent)})]}),Object.keys(x.categoryBreakdown).length>0&&e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsx("div",{className:"space-y-2",children:Object.entries(x.categoryBreakdown).sort(([s],[r])=>s.localeCompare(r)).map(([s,r])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:s}),e.jsx("span",{className:"text-gray-900 font-medium",children:h.format(r)})]},s))})})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Furnishing Savings"})}),e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"Market Value"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:h.format(x.totalMarketValue)})]}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"What You Spent"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:h.format(x.totalSpent)})]})}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-green-600",children:"What You Saved"}),e.jsx("span",{className:"text-base font-semibold text-green-600",children:h.format(x.totalSaved)})]})})]})]})]})}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-baseline justify-between mb-3",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Furnishings"})}),e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"divide-y",children:o.map(s=>{const r=j(s.projectPrice),n=V(s);return e.jsx("div",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:s.description||"Item"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mt-0.5",children:[s.source&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Source: ",s.source]}),n&&e.jsxs(e.Fragment,{children:[s.source&&e.jsx("span",{className:"text-xs text-gray-400",children:"â€¢"}),n.isInternal?e.jsx(W,{to:n.href,className:"text-xs text-primary-600 hover:text-primary-700 underline print:hidden",children:"View Receipt"}):e.jsx("a",{href:n.href,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary-600 hover:text-primary-700 underline print:hidden",children:"View Receipt"}),e.jsx("span",{className:"text-xs text-primary-600 print:inline hidden",children:"Receipt available"})]})]}),s.space&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Space: ",s.space]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("div",{className:"text-sm text-gray-700 font-medium",children:h.format(r)})})]})},s.itemId)})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-white border-t border-gray-100",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Furnishings Total"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:h.format(x.totalSpent)})]})]})]})]})]})}export{X as default};
//# sourceMappingURL=ClientSummary.js.map
