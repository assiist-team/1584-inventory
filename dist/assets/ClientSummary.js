import{d as M,l as T,j as e,B as y}from"./index.js";import{r as d}from"./vendor.js";import{c as D,b as O,L as R}from"./router.js";import{p as U,u as $,t as A}from"./inventoryService.js";import"./supabase.js";import"./ui.js";import"./taxPresetsService.js";const h=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function u(t){if(typeof t=="number")return isNaN(t)?0:t;if(typeof t=="string"){const c=parseFloat(t||"0");return isNaN(c)?0:c}return 0}function K(){const{id:t}=D(),c=O(),{currentAccountId:j}=M(),{businessName:S,businessLogoUrl:g}=T(),[o,k]=d.useState(null),[i,P]=d.useState([]),[f,I]=d.useState([]),[C,N]=d.useState(!0),[b,v]=d.useState(null),B=d.useMemo(()=>new Date().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),[]);d.useEffect(()=>{(async()=>{if(!t||!j){if(!j)return;c("/projects");return}N(!0),v(null);try{const[a,x,p]=await Promise.all([U.getProject(j,t),$.getItemsByProject(j,t),A.getTransactions(j,t)]);if(!a){c("/projects");return}k(a),P(x),I(p)}catch(a){console.error("Failed to load client summary:",a),v("Failed to load client summary. Please try again.")}finally{N(!1)}})()},[t,j,c]);const m=d.useMemo(()=>{const s=i.reduce((r,n)=>{const l=u(n.projectPrice);return r+l},0),a={},x=new Map;f.forEach(r=>{r.budgetCategory&&r.transactionId&&x.set(r.transactionId,r.budgetCategory)}),i.forEach(r=>{if(r.transactionId){const n=x.get(r.transactionId);if(n){const l=u(r.projectPrice);a[n]=(a[n]||0)+l}}});const p=i.reduce((r,n)=>{const l=u(n.marketValue);return r+l},0),V=i.reduce((r,n)=>{const l=u(n.marketValue),E=u(n.projectPrice);return l>0?r+(l-E):r},0);return{totalSpent:s,categoryBreakdown:a,totalMarketValue:p,totalSaved:V}},[i,f]),L=()=>window.print(),w=()=>{if(!t)return c("/projects");c(`/project/${t}?tab=inventory`)},F=s=>s.transactionId&&t?`/project/${t}/transaction/${s.transactionId}`:null;return C?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading client summary..."})]})}):b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-red-400",children:"âš ï¸"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Error"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:b}),e.jsx("div",{className:"mt-6",children:e.jsx(y,{onClick:w,children:"Back"})})]}):e.jsxs("div",{className:"max-w-4xl mx-auto bg-white shadow rounded-lg p-8 print:shadow-none print:p-0",children:[e.jsxs("div",{className:"flex justify-end space-x-3 mb-6 print:hidden",children:[e.jsx(y,{variant:"secondary",onClick:w,children:"Back"}),e.jsx(y,{onClick:L,children:"Print"})]}),e.jsx("div",{className:"border-b pb-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[g&&e.jsx("img",{src:g,alt:S,className:"h-24 w-auto object-contain"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Client Summary"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-800",children:(o==null?void 0:o.name)||"Project"}),(o==null?void 0:o.clientName)&&e.jsxs("div",{children:["Client: ",o.clientName]}),e.jsxs("div",{children:["Date: ",B]})]})]})]})}),i.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"ðŸ“¦"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No items found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"There are no items associated with this project."})]}),i.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("section",{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Project Overview"})}),e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"Total Spent Overall"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:h.format(m.totalSpent)})]}),Object.keys(m.categoryBreakdown).length>0&&e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsx("div",{className:"space-y-2",children:Object.entries(m.categoryBreakdown).sort(([s],[a])=>s.localeCompare(a)).map(([s,a])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:s}),e.jsx("span",{className:"text-gray-900 font-medium",children:h.format(a)})]},s))})})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Furnishing Savings"})}),e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"Market Value"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:h.format(m.totalMarketValue)})]}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"What You Spent"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:h.format(m.totalSpent)})]})}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-green-600",children:"What You Saved"}),e.jsx("span",{className:"text-base font-semibold text-green-600",children:h.format(m.totalSaved)})]})})]})]})]})}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-baseline justify-between mb-3",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Furnishings"})}),e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"divide-y",children:i.map(s=>{const a=u(s.projectPrice),x=F(s);return e.jsx("div",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:s.description||"Item"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mt-0.5",children:[s.source&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Source: ",s.source]}),x&&e.jsxs(e.Fragment,{children:[s.source&&e.jsx("span",{className:"text-xs text-gray-400",children:"â€¢"}),e.jsx(R,{to:x,className:"text-xs text-primary-600 hover:text-primary-700 underline print:hidden",children:"View Receipt"}),e.jsx("span",{className:"text-xs text-primary-600 print:inline hidden",children:"Receipt available"})]})]}),s.space&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Space: ",s.space]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("div",{className:"text-sm text-gray-700 font-medium",children:h.format(a)})})]})},s.itemId)})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-white border-t border-gray-100",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Furnishings Total"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:h.format(m.totalSpent)})]})]})]})]})]})}export{K as default};
//# sourceMappingURL=ClientSummary.js.map
