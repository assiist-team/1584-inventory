import{d as O,k as U,j as e,B as N,f as A,C as R}from"./index.js";import{r as l}from"./vendor.js";import{C as W}from"./ContextLink.js";import{u as D}from"./useStackedNavigate.js";import{p as Y,u as $,t as H}from"./inventoryService.js";import{u as q}from"./CategorySelect.js";import{b as z}from"./router.js";import"./supabase.js";import"./ui.js";import"./taxPresetsService.js";const u=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function j(a){if(typeof a=="number")return isNaN(a)?0:a;if(typeof a=="string"){const o=parseFloat(a||"0");return isNaN(o)?0:o}return 0}function ae(){const{id:a}=z(),o=D(),{currentAccountId:h}=O(),{businessName:C,businessLogoUrl:b}=U(),{categories:v}=q(!1),[m,E]=l.useState(null),[d,B]=l.useState([]),[g,M]=l.useState([]),[L,w]=l.useState(!0),[I,S]=l.useState(null),T=l.useMemo(()=>new Date().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),[]);l.useEffect(()=>{(async()=>{if(!a||!h){if(!h)return;o("/projects");return}w(!0),S(null);try{const[r,i,p]=await Promise.all([Y.getProject(h,a),$.getItemsByProject(h,a),H.getTransactions(h,a)]);if(!r){o("/projects");return}E(r),B(i),M(p)}catch(r){console.error("Failed to load client summary:",r),S("Failed to load client summary. Please try again.")}finally{w(!1)}})()},[a,h,o]);const k=l.useMemo(()=>{const t=new Map;return v.forEach(r=>{t.set(r.id,r.name)}),t},[v]),x=l.useMemo(()=>{const t=d.reduce((s,n)=>{const c=j(n.projectPrice);return s+c},0),r={},i=new Map;g.forEach(s=>{if(s.categoryId&&s.transactionId){const n=k.get(s.categoryId);n&&i.set(s.transactionId,n)}}),d.forEach(s=>{if(s.transactionId){const n=i.get(s.transactionId);if(n){const c=j(s.projectPrice);r[n]=(r[n]||0)+c}}});const p=d.reduce((s,n)=>{const c=j(n.marketValue);return s+c},0),f=d.reduce((s,n)=>{const c=j(n.marketValue),y=j(n.projectPrice);return c>0?s+(c-y):s},0);return{totalSpent:t,categoryBreakdown:r,totalMarketValue:p,totalSaved:f}},[d,g,k]),V=()=>window.print(),P=()=>{if(!a)return o("/projects");o(`/project/${a}?tab=inventory`)},_=t=>{var r,i,p,f;if(!a)return null;if(t.transactionId){const s=g.find(F=>F.transactionId===t.transactionId);if(!s)return null;const n=((r=s.transactionId)==null?void 0:r.startsWith("INV_SALE_"))||((i=s.transactionId)==null?void 0:i.startsWith("INV_PURCHASE_")),c=s.reimbursementType===A||s.reimbursementType===R;if(n||c)return{href:`/project/${a}/invoice`,isInternal:!0};const y=(f=(p=s.receiptImages)==null?void 0:p[0])==null?void 0:f.url;return y?{href:y,isInternal:!1}:null}return null};return L?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading client summary..."})]})}):I?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-red-400",children:"âš ï¸"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Error"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:I}),e.jsx("div",{className:"mt-6",children:e.jsx(N,{onClick:P,children:"Back"})})]}):e.jsxs("div",{className:"max-w-4xl mx-auto bg-white shadow rounded-lg p-8 print:shadow-none print:p-0",children:[e.jsxs("div",{className:"flex justify-end space-x-3 mb-6 print:hidden",children:[e.jsx(N,{variant:"secondary",onClick:P,children:"Back"}),e.jsx(N,{onClick:V,children:"Print"})]}),e.jsx("div",{className:"border-b pb-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[b&&e.jsx("img",{src:b,alt:C,className:"h-24 w-auto object-contain"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Client Summary"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-800",children:(m==null?void 0:m.name)||"Project"}),(m==null?void 0:m.clientName)&&e.jsxs("div",{children:["Client: ",m.clientName]}),e.jsxs("div",{children:["Date: ",T]})]})]})]})}),d.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"ðŸ“¦"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No items found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"There are no items associated with this project."})]}),d.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("section",{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Project Overview"})}),e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"Total Spent Overall"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:u.format(x.totalSpent)})]}),Object.keys(x.categoryBreakdown).length>0&&e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsx("div",{className:"space-y-2",children:Object.entries(x.categoryBreakdown).sort(([t],[r])=>t.localeCompare(r)).map(([t,r])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:t}),e.jsx("span",{className:"text-gray-900 font-medium",children:u.format(r)})]},t))})})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Furnishing Savings"})}),e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"Market Value"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:u.format(x.totalMarketValue)})]}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"What You Spent"}),e.jsx("span",{className:"text-base font-semibold text-gray-900",children:u.format(x.totalSpent)})]})}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-medium text-green-600",children:"What You Saved"}),e.jsx("span",{className:"text-base font-semibold text-green-600",children:u.format(x.totalSaved)})]})})]})]})]})}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-baseline justify-between mb-3",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Furnishings"})}),e.jsxs("div",{className:"rounded-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"divide-y",children:d.map(t=>{const r=j(t.projectPrice),i=_(t);return e.jsx("div",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:t.description||"Item"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mt-0.5",children:[t.source&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Source: ",t.source]}),i&&e.jsxs(e.Fragment,{children:[t.source&&e.jsx("span",{className:"text-xs text-gray-400",children:"â€¢"}),i.isInternal?e.jsx(W,{to:buildContextUrl(i.href),className:"text-xs text-primary-600 hover:text-primary-700 underline print:hidden",children:"View Receipt"}):e.jsx("a",{href:i.href,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary-600 hover:text-primary-700 underline print:hidden",children:"View Receipt"}),e.jsx("span",{className:"text-xs text-primary-600 print:inline hidden",children:"Receipt available"})]})]}),t.space&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Space: ",t.space]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("div",{className:"text-sm text-gray-700 font-medium",children:u.format(r)})})]})},t.itemId)})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-white border-t border-gray-100",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Furnishings Total"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:u.format(x.totalSpent)})]})]})]})]})]})}export{ae as default};
//# sourceMappingURL=ClientSummary.js.map
