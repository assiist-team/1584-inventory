import{j as e}from"./index-DRwKqTma.js";import{u as I,b as E,L as m}from"./router-Bad1IJif.js";import{r as l}from"./vendor-Gm9i_4Ku.js";import{i as x}from"./inventoryService-CSqmAljY.js";import{T as k}from"./transactionSources-Bmq7Rv82.js";import{b as h,B as P,R as D,e as q,a as L,l as B}from"./ui-DKDhksGx.js";import"./firebase-DTZupgGV.js";function T(){const{id:o,itemId:n}=I(),N=E(),[s,c]=l.useState({description:"",source:"",sku:"",price:"",resale_price:"",market_value:"",payment_method:"",disposition:"",notes:"",bookmark:!1,qr_key:""}),[y,d]=l.useState(!1),[f,u]=l.useState(!1),[_,w]=l.useState(!0),[b,v]=l.useState(!1),[a,p]=l.useState({});console.log("EditItem - URL params:",{projectId:o,itemId:n}),l.useEffect(()=>{const r=k;s.source&&!r.includes(s.source)?d(!0):s.source&&r.includes(s.source)&&d(!1)},[s.source]),l.useEffect(()=>{const r=["Client Card","1584 Card","Split","Store Credit"];s.payment_method&&!r.includes(s.payment_method)?u(!0):s.payment_method&&r.includes(s.payment_method)&&u(!1)},[s.payment_method]),l.useEffect(()=>{(async()=>{if(console.log("fetchItem called with:",{projectId:o,itemId:n}),n&&o)try{const t=await x.getItem(o,n);console.log("Fetched item data:",t),t&&(c({description:String(t.description||""),source:String(t.source||""),sku:String(t.sku||""),price:String(t.price||""),resale_price:String(t.resale_price||""),market_value:String(t.market_value||""),payment_method:String(t.payment_method||""),disposition:String(t.disposition||""),notes:String(t.notes||""),bookmark:!!t.bookmark,qr_key:String(t.qr_key||"")}),console.log("Form data set:",{description:String(t.description||""),source:String(t.source||""),sku:String(t.sku||""),price:String(t.price||""),resale_price:String(t.resale_price||""),market_value:String(t.market_value||""),payment_method:String(t.payment_method||""),disposition:String(t.disposition||""),notes:String(t.notes||""),bookmark:!!t.bookmark,qr_key:String(t.qr_key||"")}))}catch(t){console.error("Failed to fetch item:",t),p({fetch:"Failed to load item data"})}w(!1)})()},[n,o]);const S=()=>{const r={};return s.description.trim()||(r.description="Description is required"),s.source.trim()||(r.source="Source is required"),s.payment_method.trim()||(r.payment_method="Payment method is required"),s.disposition.trim()||(r.disposition="Disposition is required"),s.price.trim()?(isNaN(Number(s.price))||Number(s.price)<=0)&&(r.price="Price must be a positive number"):r.price="Price is required",s.market_value.trim()&&(isNaN(Number(s.market_value))||Number(s.market_value)<=0)&&(r.market_value="Market value must be a positive number"),p(r),Object.keys(r).length===0},C=async r=>{if(r.preventDefault(),!(!S()||!n||!o)){v(!0);try{const t={...s,last_updated:new Date().toISOString()};await x.updateItem(o,n,t),N(`/project/${o}?tab=inventory`)}catch(t){console.error("Error updating item:",t),p({submit:"Failed to update item. Please try again."})}finally{v(!1)}}},i=(r,t)=>{console.log("Updating field:",r,"with value:",t),c(g=>{const j={...g,[r]:t};return console.log("New form data:",j),j}),a[r]&&p(g=>({...g,[r]:""}))},$=async()=>{if(!(!n||!o))try{await x.updateItem(o,n,{bookmark:!s.bookmark}),c(r=>({...r,bookmark:!r.bookmark}))}catch(r){console.error("Failed to update bookmark:",r)}},F=async()=>{if(!(!n||!o))try{const r=s.disposition==="return"?"keep":"return";await x.updateItem(o,n,{disposition:r}),c(t=>({...t,disposition:r}))}catch(r){console.error("Failed to update disposition:",r)}};return _?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{to:`/project/${o}?tab=inventory`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(m,{to:`/project/${o}/item/${n}`,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"View Item"]})})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Item"})}),e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-2/3"})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{to:`/project/${o}?tab=inventory`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(m,{to:`/project/${o}/item/${n}`,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"View Item"]})})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Item"})}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex space-x-2 mb-8",children:[e.jsxs("button",{onClick:$,className:`inline-flex items-center px-3 py-2 border text-sm font-medium rounded-md ${s.bookmark?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`,children:[e.jsx(P,{className:"h-4 w-4 mr-2",fill:s.bookmark?"currentColor":"none"}),s.bookmark?"Bookmarked":"Bookmark"]}),e.jsxs("button",{onClick:F,className:`inline-flex items-center px-3 py-2 border text-sm font-medium rounded-md ${s.disposition==="return"?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),s.disposition==="return"?"Return":"Keep"]}),e.jsxs("button",{className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",onClick:()=>window.open(`/qr-image/${s.qr_key}`,"_blank"),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"QR"]})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("form",{onSubmit:C,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:s.description,onChange:r=>i("description",r.target.value),placeholder:"e.g., Wooden dining table, 6 chairs",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.description?"border-red-300":"border-gray-300"}`}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Source *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:k.map(r=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${r.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:r,checked:s.source===r,onChange:t=>{i("source",t.target.value),d(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${r.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:r})]},r))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:y,onChange:()=>{d(!0),i("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),y&&e.jsx("input",{type:"text",id:"source_custom_input",value:s.source,onChange:r=>i("source",r.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.source?"border-red-300":"border-gray-300"}`}),a.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:s.sku,onChange:r=>i("sku",r.target.value),placeholder:"Product SKU or model number",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Purchase Price *"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"price",value:s.price,onChange:r=>i("price",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.price?"border-red-300":"border-gray-300"}`})]}),a.price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"market_value",value:s.market_value,onChange:r=>i("market_value",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.market_value?"border-red-300":"border-gray-300"}`})]}),a.market_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.market_value})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resale_price",className:"block text-sm font-medium text-gray-700",children:"1584 Resale Price"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"resale_price",value:s.resale_price,onChange:r=>i("resale_price",r.target.value),placeholder:"0.00",className:"block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Payment Method *"}),e.jsx("div",{className:"flex items-center space-x-6 mb-3",children:["Client Card","1584 Card","Split","Store Credit"].map(r=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`payment_${r.toLowerCase().replace(/\s+/g,"_")}`,name:"payment_method",value:r,checked:s.payment_method===r,onChange:t=>{i("payment_method",t.target.value),u(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`payment_${r.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:r})]},r))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"payment_custom",name:"payment_method",value:"custom",checked:f,onChange:()=>{u(!0),i("payment_method","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"payment_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),f&&e.jsx("input",{type:"text",id:"payment_custom_input",value:s.payment_method,onChange:r=>i("payment_method",r.target.value),placeholder:"Enter custom payment method...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.payment_method?"border-red-300":"border-gray-300"}`}),a.payment_method&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.payment_method})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Disposition *"}),e.jsx("div",{className:"flex items-center space-x-6",children:["keep","return","1584"].map(r=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`disposition_${r.toLowerCase()}`,name:"disposition",value:r,checked:s.disposition===r,onChange:t=>i("disposition",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`disposition_${r.toLowerCase()}`,className:"ml-2 block text-sm text-gray-900",children:r==="1584"?"1584 Design":r.charAt(0).toUpperCase()+r.slice(1)})]},r))}),a.disposition&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.disposition})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"market_value",value:s.market_value,onChange:r=>i("market_value",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${a.market_value?"border-red-300":"border-gray-300"}`})]}),a.market_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.market_value})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:s.notes,onChange:r=>i("notes",r.target.value),placeholder:"Additional notes about this item...",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),a.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:a.submit})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsxs(m,{to:`/project/${o}?tab=inventory`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:b,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),b?"Saving...":"Save Changes"]})]})]})})]})]})]})}export{T as default};
//# sourceMappingURL=EditItem-Di6yNp5W.js.map
