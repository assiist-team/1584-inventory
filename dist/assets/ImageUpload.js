import{j as t}from"./index.js";import{r as n,b as A}from"./vendor.js";import{I as j}from"./imageService.js";import{U as B,p as S,A as O,g as G,E as L,T as z}from"./ui.js";function W({onImagesChange:m,maxImages:c=5,acceptedTypes:p=["image/jpeg","image/jpg","image/png","image/gif","image/webp"],maxFileSize:u=10,disabled:i=!1,className:D=""}){const[o,w]=n.useState([]),[h,x]=n.useState(!1),[d,v]=n.useState(null),b=n.useRef(null),U=n.useRef(null),C=n.useRef(null),N=n.useCallback(e=>{if(!p.includes(e.type))return`Invalid file type. Please upload: ${p.join(", ")}`;const r=u*1024*1024;return e.size>r?`File too large. Maximum size: ${u}MB`:null},[p,u]),g=n.useCallback(e=>{const r=Array.from(e),s=[],a=[];if(r.forEach(l=>{const f=N(l);f?a.push({file:l,previewUrl:"",error:f}):(s.push(l),a.push({file:l,previewUrl:j.createPreviewUrl(l)}))}),s.length+o.length>c){const l=c-o.length;l>0?(s.splice(l),a.splice(l)):(s.length=0,a.length=0),a.push({file:new File([],""),previewUrl:"",error:`Maximum ${c} images allowed. Additional images were skipped.`})}w(l=>[...l,...a]),m(s)},[o.length,c,N,m]),P=n.useCallback(e=>{const r=o[e];r.previewUrl&&j.revokePreviewUrl(r.previewUrl),w(a=>a.filter((l,f)=>f!==e));const s=o.filter((a,l)=>l!==e).filter(a=>!a.error).map(a=>a.file);m(s)},[o,m]),y=e=>{const r=e.target.files;r&&r.length>0&&g(r)},M=async()=>{try{const e=await j.selectFromGallery();e.length>0&&g(e)}catch(e){console.error("Error selecting from gallery:",e)}},I=n.useCallback(e=>{e.preventDefault(),e.stopPropagation(),i||x(!0)},[i]),E=n.useCallback(e=>{e.preventDefault(),e.stopPropagation(),x(!1)},[]),F=n.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),x(!1),i)return;const r=e.dataTransfer.files;r&&r.length>0&&g(r)},[i,g]),R=e=>{if(e===0)return"0 Bytes";const r=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(r));return(e/Math.pow(r,a)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+" "+s[a]},$=(e,r)=>{e.stopPropagation(),v(d===r?null:r)},k=(e,r,s)=>{switch(e.stopPropagation(),v(null),r){case"preview":window.open(o[s].previewUrl,"_blank");break;case"delete":P(s);break}};return A.useEffect(()=>{const e=r=>{d!==null&&!r.target.closest(".image-menu-container")&&v(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[d]),t.jsxs("div",{className:`space-y-4 ${D}`,children:[t.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 sm:p-8 text-center transition-colors touch-manipulation ${h?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-gray-400"} ${i?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onDragOver:I,onDragLeave:E,onDrop:F,onClick:()=>{var e;return!i&&((e=b.current)==null?void 0:e.click())},children:[t.jsx("input",{ref:b,type:"file",multiple:!0,accept:p.join(","),onChange:y,disabled:i,className:"hidden"}),t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx("div",{className:`p-3 rounded-full ${h?"bg-primary-100":"bg-gray-100"}`,children:t.jsx(B,{className:`h-6 w-6 ${h?"text-primary-600":"text-gray-600"}`})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Drop images here, or click to browse"}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Supports: JPEG, PNG, GIF, WebP (max ",u,"MB each, up to ",c," images)"]})]}),t.jsxs("button",{type:"button",onClick:e=>{e.stopPropagation(),M()},disabled:i,className:"inline-flex items-center justify-center px-4 py-2.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 mt-3 touch-manipulation",title:"Add images from gallery or camera",children:[t.jsx(S,{className:"h-4 w-4 mr-2"}),"Add Images"]})]})]}),t.jsx("input",{ref:U,type:"file",accept:"image/*",capture:"environment",onChange:y,className:"hidden"}),t.jsx("input",{ref:C,type:"file",accept:"image/*",multiple:!0,onChange:y,className:"hidden"}),o.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Transaction Images"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:o.map((e,r)=>t.jsxs("div",{className:"relative group",children:[t.jsx("div",{className:"aspect-w-4 aspect-h-3 rounded-lg overflow-visible bg-gray-100",children:e.error?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("div",{className:"text-center p-4",children:[t.jsx(O,{className:"h-8 w-8 text-red-500 mx-auto mb-2"}),t.jsx("p",{className:"text-xs text-red-600",children:e.error})]})}):t.jsxs(t.Fragment,{children:[t.jsx("img",{src:e.previewUrl,alt:e.file.name,className:"w-full h-full object-cover"}),e.isUploading&&t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-white text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white mx-auto mb-2"}),t.jsx("p",{className:"text-xs",children:e.uploadProgress?`${Math.round(e.uploadProgress)}%`:"Uploading..."})]})}),t.jsxs("div",{className:"absolute top-1 right-1 image-menu-container",children:[t.jsx("button",{type:"button",onClick:s=>$(s,r),className:"p-1.5 bg-primary-500 text-white rounded-full opacity-90 hover:opacity-100 transition-opacity",children:t.jsx(G,{className:"h-3 w-3"})}),d===r&&t.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 w-28 bg-white rounded-md shadow-lg border border-gray-200 py-1 z-50",children:[t.jsxs("button",{onClick:s=>k(s,"preview",r),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors",children:[t.jsx(L,{className:"h-4 w-4 mr-2 text-gray-500"}),"Open"]}),t.jsxs("button",{onClick:s=>k(s,"delete",r),className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center transition-colors",children:[t.jsx(z,{className:"h-4 w-4 mr-2 text-red-500"}),"Delete"]})]})]})]})}),t.jsxs("div",{className:"mt-1",children:[t.jsx("p",{className:"text-xs text-gray-500 truncate",title:e.file.name,children:e.file.name}),t.jsx("p",{className:"text-xs text-gray-400",children:R(e.file.size)})]})]},r))})]})]})}export{W as I};
//# sourceMappingURL=ImageUpload.js.map
