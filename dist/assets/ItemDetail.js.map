{"version":3,"file":"ItemDetail.js","sources":["../../src/pages/ItemDetail.tsx"],"sourcesContent":["import { useState, useEffect, useMemo, useRef } from 'react'\nimport { ArrowLeft, Bookmark, QrCode, Trash2, Edit, FileText, ImagePlus, ChevronDown, Copy } from 'lucide-react'\nimport { Link, useParams, useNavigate, useSearchParams } from 'react-router-dom'\nimport { Item, ItemImage } from '@/types'\nimport { formatDate, formatCurrency } from '@/utils/dateUtils'\nimport { unifiedItemsService, projectService, integrationService } from '@/services/inventoryService'\nimport { ImageUploadService } from '@/services/imageService'\nimport ImagePreview from '@/components/ui/ImagePreview'\nimport ItemLineageBreadcrumb from '@/components/ui/ItemLineageBreadcrumb'\nimport { lineageService } from '@/services/lineageService'\nimport { getUserFriendlyErrorMessage, getErrorAction } from '@/utils/imageUtils'\nimport { useToast } from '@/components/ui/ToastContext'\nimport { useDuplication } from '@/hooks/useDuplication'\nimport { useNavigationContext } from '@/hooks/useNavigationContext'\nimport { useAccount } from '@/contexts/AccountContext'\n\nexport default function ItemDetail() {\n  const { id, itemId } = useParams<{ id?: string; itemId?: string }>()\n  const navigate = useNavigate()\n  const { currentAccountId } = useAccount()\n  const [searchParams] = useSearchParams()\n  const [item, setItem] = useState<Item | null>(null)\n  const [projectName, setProjectName] = useState<string>('')\n  const [isUploadingImage, setIsUploadingImage] = useState(false)\n  const [uploadProgress, setUploadProgress] = useState<number>(0)\n  const [openDispositionMenu, setOpenDispositionMenu] = useState(false)\n  const [isSticky, setIsSticky] = useState(false)\n  const { showError } = useToast()\n  const { buildContextUrl, getBackDestination } = useNavigationContext()\n  const stickyRef = useRef<HTMLDivElement>(null)\n\n  // Use itemId if available (from /project/:id/item/:itemId), otherwise use id (from /item/:id)\n  const actualItemId = itemId || id\n\n  // Get project ID from URL path (for /project/:id/item/:itemId) or search parameters (for /item/:id)\n  // For business inventory items, the URL structure is /business-inventory/:id\n  const projectId = searchParams.get('project') || id\n\n  // Check if this is a business inventory item (no project context)\n  const isBusinessInventoryItem = !projectId && location.pathname.startsWith('/business-inventory/')\n\n  // Use duplication hook\n  const { duplicateItem } = useDuplication({\n    items: item ? [item] : [],\n    setItems: (items) => {\n      if (typeof items === 'function') {\n        setItem(prev => items([prev!])[0] || prev)\n      } else if (items.length > 0) {\n        setItem(items[0])\n      }\n    },\n    projectId,\n    accountId: currentAccountId || undefined\n  })\n\n  // Determine back navigation destination using navigation context\n  const backDestination = useMemo(() => {\n    // If item is not loaded yet (null), use appropriate default\n    if (!item) {\n      return isBusinessInventoryItem ? '/business-inventory' : `/project/${projectId}?tab=inventory`\n    }\n\n    // Use navigation context's getBackDestination function\n    const defaultPath = isBusinessInventoryItem ? '/business-inventory' : `/project/${projectId}?tab=inventory`\n    return getBackDestination(defaultPath)\n  }, [item, projectId, getBackDestination, isBusinessInventoryItem])\n\n\n  useEffect(() => {\n    const fetchItem = async () => {\n      console.log('ðŸ”„ ItemDetail useEffect triggered. itemId:', actualItemId, 'id:', id, 'projectId:', projectId)\n\n      if (actualItemId) {\n        try {\n          if (!currentAccountId) return\n          \n          if (isBusinessInventoryItem) {\n            console.log('ðŸ“¦ Fetching business inventory item (no project context)...')\n            const fetchedItem = await unifiedItemsService.getItemById(currentAccountId, actualItemId)\n\n            if (fetchedItem) {\n              console.log('âœ… Business inventory item loaded successfully:', fetchedItem.itemId)\n              setItem(fetchedItem)\n              setProjectName('Business Inventory') // Set a default project name for UI display\n            } else {\n              console.error('âŒ Business inventory item not found with ID:', actualItemId)\n              setItem(null)\n            }\n          } else if (projectId) {\n            console.log('ðŸ“¡ Fetching item and project data...')\n            const [fetchedItem, project] = await Promise.all([\n              unifiedItemsService.getItemById(currentAccountId, actualItemId),\n              projectService.getProject(currentAccountId, projectId)\n            ])\n\n            if (fetchedItem) {\n              console.log('âœ… Item loaded successfully:', fetchedItem.itemId)\n              setItem(fetchedItem)\n            } else {\n              console.error('âŒ Item not found in project:', projectId, 'with ID:', actualItemId)\n              setItem(null)\n            }\n\n            if (project) {\n              console.log('âœ… Project loaded:', project.name)\n              setProjectName(project.name)\n            }\n          } else {\n            console.error('âŒ No project ID found in URL parameters')\n            setItem(null)\n          }\n        } catch (error) {\n          console.error('âŒ Failed to fetch item:', error)\n          setItem(null)\n        }\n      } else {\n        console.log('âš ï¸ No itemId or id in URL parameters')\n        setItem(null)\n      }\n    }\n\n    fetchItem()\n  }, [actualItemId, id, searchParams, currentAccountId])\n\n  // Set up real-time listener for item updates\n  useEffect(() => {\n    const currentProjectId = id || searchParams.get('project')\n    if (!currentProjectId || !actualItemId || !currentAccountId) return\n\n    console.log('Setting up real-time listener for item:', actualItemId)\n\n    const unsubscribe = unifiedItemsService.subscribeToProjectItems(\n      currentAccountId,\n      currentProjectId,\n      (items: Item[]) => {\n        console.log('Real-time items update:', items.length, 'items')\n        const updatedItem = items.find((item: Item) => item.itemId === actualItemId)\n        if (updatedItem) {\n          console.log('Found updated item with', updatedItem.images?.length || 0, 'images')\n          setItem(updatedItem)\n        }\n      }\n    )\n\n    return () => {\n      console.log('Cleaning up real-time listener for item:', actualItemId)\n      unsubscribe()\n    }\n  }, [searchParams, actualItemId, id, currentAccountId])\n\n  // Subscribe to item-lineage edges for this item and refetch the item when an edge arrives\n  useEffect(() => {\n    if (!actualItemId || !currentAccountId) return\n\n    const unsubscribe = lineageService.subscribeToItemLineageForItem(currentAccountId, actualItemId, async () => {\n      try {\n        const updatedItem = await unifiedItemsService.getItemById(currentAccountId, actualItemId)\n        if (updatedItem) {\n          setItem(updatedItem)\n        }\n      } catch (err) {\n        console.debug('ItemDetail - failed to refetch item on lineage event', err)\n      }\n    })\n\n    return () => {\n      try { unsubscribe() } catch (err) { /* noop */ }\n    }\n  }, [actualItemId, currentAccountId])\n\n  // Close disposition menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (openDispositionMenu && !event.target) return\n\n      const target = event.target as Element\n      if (!target.closest('.disposition-menu') && !target.closest('.disposition-badge')) {\n        setOpenDispositionMenu(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [openDispositionMenu])\n\n  // Handle sticky header border\n  useEffect(() => {\n    const handleScroll = () => {\n      if (stickyRef.current) {\n        const rect = stickyRef.current.getBoundingClientRect()\n        const isElementSticky = rect.top <= 0\n        setIsSticky(isElementSticky)\n      }\n    }\n\n    window.addEventListener('scroll', handleScroll)\n    handleScroll() // Check initial state\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll)\n    }\n  }, [])\n\n  const toggleBookmark = async () => {\n    if (!item || !currentAccountId) return\n\n    try {\n      await unifiedItemsService.updateItem(currentAccountId, item.itemId, {\n        bookmark: !item.bookmark\n      })\n      setItem({ ...item, bookmark: !item.bookmark })\n    } catch (error) {\n      console.error('Failed to update bookmark:', error)\n    }\n  }\n\n  const updateDisposition = async (newDisposition: string) => {\n    console.log('ðŸŽ¯ updateDisposition called with:', newDisposition, 'Current item:', item?.itemId)\n\n    if (!item || !currentAccountId) {\n      console.error('âŒ No item available for disposition update')\n      return\n    }\n\n    console.log('ðŸ“ Updating disposition from', item.disposition, 'to', newDisposition)\n\n    try {\n      // Update the disposition in the database first\n      await unifiedItemsService.updateItem(currentAccountId, item.itemId, {\n        disposition: newDisposition\n      })\n      console.log('ðŸ’¾ Database updated successfully')\n\n      // Update local state\n      setItem({ ...item, disposition: newDisposition })\n      setOpenDispositionMenu(false)\n\n      // If disposition is set to 'inventory', trigger deallocation process\n      if (newDisposition === 'inventory') {\n        console.log('ðŸš€ Starting deallocation process for item:', item.itemId)\n        try {\n          await integrationService.handleItemDeallocation(\n            currentAccountId,\n            item.itemId,\n            item.projectId || '',\n            newDisposition\n          )\n          console.log('âœ… Deallocation completed successfully')\n          // Refresh the item data after deallocation\n          const updatedItem = await unifiedItemsService.getItemById(currentAccountId, item.itemId)\n          if (updatedItem) {\n            setItem(updatedItem)\n          }\n        } catch (deallocationError) {\n          console.error('âŒ Failed to handle deallocation:', deallocationError)\n          // Revert the disposition change if deallocation fails\n          await unifiedItemsService.updateItem(currentAccountId, item.itemId, {\n            disposition: item.disposition // Revert to previous disposition\n          })\n          setItem({ ...item, disposition: item.disposition })\n          showError('Failed to move item to inventory. Please try again.')\n        }\n      }\n    } catch (error) {\n      console.error('Failed to update disposition:', error)\n      showError('Failed to update disposition. Please try again.')\n    }\n  }\n\n  const toggleDispositionMenu = () => {\n    console.log('ðŸ–±ï¸ toggleDispositionMenu called, current state:', openDispositionMenu, 'item:', item?.itemId)\n    setOpenDispositionMenu(!openDispositionMenu)\n  }\n\n  const getDispositionBadgeClasses = (disposition: string) => {\n    const baseClasses = 'inline-flex items-center px-3 py-2 rounded-full text-sm font-medium cursor-pointer transition-colors hover:opacity-80'\n\n    switch (disposition) {\n      case 'keep':\n        return `${baseClasses} bg-green-100 text-green-800`\n      case 'to return':\n      case 'return': // Backward compatibility for old disposition\n        return `${baseClasses} bg-red-100 text-red-700`\n      case 'returned':\n        return `${baseClasses} bg-red-800 text-red-100`\n      case 'inventory':\n        return `${baseClasses} bg-primary-100 text-primary-600`\n      default:\n        return `${baseClasses} bg-gray-100 text-gray-800`\n    }\n  }\n\n  const handleDeleteItem = async () => {\n    if (!item || !currentAccountId) return\n\n    if (!confirm('Are you sure you want to delete this item? This action cannot be undone.')) {\n      return\n    }\n\n    try {\n      await unifiedItemsService.deleteItem(currentAccountId, item.itemId)\n      navigate(isBusinessInventoryItem ? '/business-inventory' : `/project/${projectId}?tab=inventory`)\n    } catch (error) {\n      console.error('Failed to delete item:', error)\n      showError('Failed to delete item. Please try again.')\n    }\n  }\n\n  const handleMultipleImageUpload = async (files: File[]) => {\n    if (!item) return\n\n    try {\n      setIsUploadingImage(true)\n      setUploadProgress(0)\n\n      console.log('Starting multiple image upload for', files.length, 'files')\n      for (let i = 0; i < files.length; i++) {\n        console.log(`Processing file ${i + 1}:`, files[i].name)\n      }\n\n      const uploadResults = await ImageUploadService.uploadMultipleItemImages(\n        files,\n        projectName || 'Business Inventory',\n        item.itemId,\n        (fileIndex, progress) => {\n          // Show progress for current file being uploaded\n          const overallProgress = Math.round(((fileIndex + progress.percentage / 100) / files.length) * 100)\n          setUploadProgress(overallProgress)\n        }\n      )\n\n      console.log('All uploads completed successfully:', uploadResults.length, 'images')\n\n      // Convert upload results to ItemImage objects\n      const newImages: ItemImage[] = uploadResults.map((result, index) => ({\n        url: result.url,\n        alt: result.fileName,\n        isPrimary: item.images?.length === 0 && index === 0, // First image is primary if no images exist\n        uploadedAt: new Date(),\n        fileName: result.fileName,\n        size: result.size,\n        mimeType: result.mimeType\n      }))\n\n      console.log('New image objects created:', newImages.length)\n\n      // Update the item with all new images\n      const currentImages = item.images || []\n      const updatedImages = [...currentImages, ...newImages]\n\n      console.log('Before update - item.images length:', currentImages.length)\n      console.log('After update - updatedImages length:', updatedImages.length)\n      console.log('New images URLs:', newImages.map(img => img.url))\n\n      if (projectId && currentAccountId) {\n        console.log('Updating item in database with multiple new images')\n        await unifiedItemsService.updateItem(currentAccountId, item.itemId, { images: updatedImages })\n      }\n\n      // Update local state\n      setItem({ ...item, images: updatedImages })\n      setUploadProgress(100)\n\n      console.log('Multiple image upload completed successfully')\n    } catch (error) {\n      console.error('Error uploading multiple images:', error)\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    } finally {\n      setIsUploadingImage(false)\n      setUploadProgress(0)\n    }\n  }\n\n  const handleSelectFromGallery = async () => {\n    if (!item) return\n\n    try {\n      setIsUploadingImage(true)\n      const files = await ImageUploadService.selectFromGallery()\n\n      if (files && files.length > 0) {\n        console.log('Selected', files.length, 'files from gallery')\n        await handleMultipleImageUpload(files)\n      } else {\n        console.log('No files selected from gallery')\n      }\n    } catch (error: any) {\n      console.error('Error selecting from gallery:', error)\n\n      // Handle cancel/timeout gracefully - don't show error for user cancellation\n      if (error.message?.includes('timeout') || error.message?.includes('canceled')) {\n        console.log('User canceled image selection or selection timed out')\n        return\n      }\n\n      // Show error for actual failures\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    } finally {\n      setIsUploadingImage(false)\n      setUploadProgress(0)\n    }\n  }\n\n\n  const handleRemoveImage = async (imageUrl: string) => {\n    if (!item || !currentAccountId) return\n\n    try {\n      // Remove from database\n      await unifiedItemsService.updateItem(currentAccountId, item.itemId, {\n        images: item.images?.filter(img => img.url !== imageUrl) || []\n      })\n\n      // Update local state\n      const updatedImages = item.images?.filter(img => img.url !== imageUrl) || []\n      setItem({ ...item, images: updatedImages })\n    } catch (error) {\n      console.error('Error removing image:', error)\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    }\n  }\n\n  const handleSetPrimaryImage = async (imageUrl: string) => {\n    if (!item || !currentAccountId) return\n\n    try {\n      // Update in database\n      await unifiedItemsService.updateItem(currentAccountId, item.itemId, {\n        images: item.images?.map(img => ({\n          ...img,\n          isPrimary: img.url === imageUrl\n        })) || []\n      })\n\n      // Update local state\n      const updatedImages = item.images?.map(img => ({\n        ...img,\n        isPrimary: img.url === imageUrl\n      })) || []\n      setItem({ ...item, images: updatedImages })\n    } catch (error) {\n      console.error('Error setting primary image:', error)\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    }\n  }\n\n  if (!item) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center space-x-4\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Link>\n        </div>\n        <div className=\"bg-white shadow rounded-lg\">\n          <div className=\"px-4 py-5 sm:p-6\">\n            <p className=\"text-gray-500\">Item not found.</p>\n            {projectId && <p className=\"text-sm text-gray-400 mt-2\">Project ID: {projectId}</p>}\n            <p className=\"text-sm text-gray-400 mt-1\">Item ID: {actualItemId || 'unknown'}</p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Sticky Header Controls */}\n      <div\n        ref={stickyRef}\n        className={`sticky top-0 bg-gray-50 z-10 px-4 py-2 ${isSticky ? 'border-b border-gray-200' : ''}`}\n      >\n        {/* Back button and controls row */}\n        <div className=\"flex items-center justify-between gap-4\">\n          <Link\n            to={backDestination}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Link>\n\n          <div className=\"flex flex-wrap gap-2 sm:space-x-2\">\n            <button\n              onClick={toggleBookmark}\n              className={`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md ${\n                item.bookmark\n                  ? 'border-red-300 text-red-700 bg-red-50 hover:bg-red-100'\n                  : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n              } focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`}\n              title={item.bookmark ? 'Remove Bookmark' : 'Add Bookmark'}\n            >\n              <Bookmark className=\"h-4 w-4\" fill={item.bookmark ? 'currentColor' : 'none'} />\n            </button>\n\n            <Link\n              to={isBusinessInventoryItem\n                ? `/business-inventory/${item.itemId}/edit?returnTo=${encodeURIComponent(window.location.pathname + window.location.search)}`\n                : `/project/${projectId}/edit-item/${item.itemId}?project=${projectId}&returnTo=${encodeURIComponent(window.location.pathname + window.location.search)}`\n              }\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              title=\"Edit Item\"\n            >\n              <Edit className=\"h-4 w-4\" />\n            </Link>\n\n            <button\n              onClick={() => duplicateItem(item.itemId)}\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              title=\"Duplicate Item\"\n            >\n              <Copy className=\"h-4 w-4\" />\n            </button>\n\n            <button\n              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              onClick={() => window.open(`/qr-image/${item.qrKey}`, '_blank')}\n              title=\"View QR Code\"\n            >\n              <QrCode className=\"h-4 w-4\" />\n            </button>\n\n\n            <div className=\"relative\">\n              <span\n                onClick={toggleDispositionMenu}\n                className={`disposition-badge ${getDispositionBadgeClasses(item.disposition || 'keep')}`}\n              >\n                {item.disposition === 'to return' ? 'To Return' : (item.disposition || 'keep').charAt(0).toUpperCase() + (item.disposition || 'keep').slice(1)}\n                <ChevronDown className=\"h-3 w-3 ml-1\" />\n              </span>\n\n              {/* Dropdown menu */}\n              {openDispositionMenu && (\n                <div className=\"disposition-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-20\">\n                  <div className=\"py-2\">\n                    {['keep', 'to return', 'returned', 'inventory'].map((disposition) => (\n                      <button\n                        key={disposition}\n                        onClick={() => updateDisposition(disposition)}\n                        className={`block w-full text-left px-4 py-3 text-sm hover:bg-gray-50 ${\n                          (item.disposition === disposition) || (disposition === 'to return' && item.disposition === 'return')\n                            ? 'bg-gray-100 text-gray-900'\n                            : 'text-gray-700'\n                        }`}\n                      >\n                        {disposition === 'to return' ? 'To Return' : disposition.charAt(0).toUpperCase() + disposition.slice(1)}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"space-y-4\">\n\n        {/* Item information */}\n        <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n          <div className=\"px-6 py-4\">\n            <h1 className=\"text-xl font-semibold text-gray-900\">{item.description}</h1>\n          </div>\n\n          {/* Item Images */}\n          <div className=\"px-6 py-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\n                <ImagePlus className=\"h-5 w-5 mr-2\" />\n                Item Images\n              </h3>\n              <button\n                onClick={handleSelectFromGallery}\n                disabled={isUploadingImage}\n                className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n                title=\"Add images from gallery or camera\"\n              >\n                <ImagePlus className=\"h-3 w-3 mr-1\" />\n                {isUploadingImage\n                  ? uploadProgress > 0 && uploadProgress < 100\n                    ? `Uploading... ${Math.round(uploadProgress)}%`\n                    : 'Uploading...'\n                  : 'Add Images'\n                }\n              </button>\n            </div>\n\n            {item.images && item.images.length > 0 ? (\n              <ImagePreview\n                images={item.images}\n                onRemoveImage={handleRemoveImage}\n                onSetPrimary={handleSetPrimaryImage}\n                maxImages={5}\n                size=\"md\"\n                showControls={true}\n              />\n            ) : (\n              <div className=\"text-center py-8\">\n                <ImagePlus className=\"mx-auto h-8 w-8 text-gray-400\" />\n                <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No images uploaded</h3>\n              </div>\n            )}\n          </div>\n\n          {/* Item Details */}\n          <div className=\"px-6 py-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4 flex items-center\">\n              <FileText className=\"h-5 w-5 mr-2\" />\n              Item Details\n            </h3>\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\n              {item.source && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Source</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900 capitalize\">{item.source}</dd>\n                </div>\n              )}\n\n              {item.sku && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">SKU</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{item.sku}</dd>\n                </div>\n              )}\n\n              {item.space && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Space</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{item.space}</dd>\n                </div>\n              )}\n\n              {item.purchasePrice && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Purchase Price</dt>\n                  <p className=\"text-xs text-gray-500 mt-1\">What the item was purchased for</p>\n                  <dd className=\"mt-1 text-sm text-gray-900 font-medium\">{formatCurrency(item.purchasePrice)}</dd>\n                  {item.taxAmountPurchasePrice !== undefined && (\n                    <p className=\"mt-1 text-sm text-gray-600\">Tax on purchase: {formatCurrency(item.taxAmountPurchasePrice)}</p>\n                  )}\n                </div>\n              )}\n\n              {item.projectPrice && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Project Price</dt>\n                  <p className=\"text-xs text-gray-500 mt-1\">What the client is charged</p>\n                  <dd className=\"mt-1 text-sm text-gray-900 font-medium\">{formatCurrency(item.projectPrice)}</dd>\n                  {item.taxAmountProjectPrice !== undefined && (\n                    <p className=\"mt-1 text-sm text-gray-600\">Tax on project: {formatCurrency(item.taxAmountProjectPrice)}</p>\n                  )}\n                </div>\n              )}\n\n              {item.marketValue && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Market Value</dt>\n                  <p className=\"text-xs text-gray-500 mt-1\">The fair market value of the item</p>\n                  <dd className=\"mt-1 text-sm text-gray-900 font-medium\">${item.marketValue}</dd>\n                </div>\n              )}\n              {item.taxRatePct !== undefined && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Tax Rate</dt>\n                  <p className=\"text-xs text-gray-500 mt-1\">Applied tax rate for this item</p>\n                  <dd className=\"mt-1 text-sm text-gray-900 font-medium\">{item.taxRatePct}%</dd>\n                </div>\n              )}\n\n              {item.paymentMethod && (\n                <div>\n                  <dt className=\"text-sm font-medium text-gray-500\">Payment Method</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{item.paymentMethod}</dd>\n                </div>\n              )}\n\n              {item.notes && item.notes !== 'No notes' && (\n                <div className=\"sm:col-span-2\">\n                  <dt className=\"text-sm font-medium text-gray-500\">Notes</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">{item.notes}</dd>\n                </div>\n              )}\n            </dl>\n          </div>\n\n\n          {/* Metadata */}\n          <div className=\"px-6 py-4 bg-gray-50\">\n            <div className=\"relative\">\n              <dl className=\"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-3\">\n                <div>\n                  <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Project</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{projectName}</dd>\n                </div>\n                <div>\n                  <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Created</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(item.dateCreated)}</dd>\n                </div>\n                <div>\n                  <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Transaction</dt>\n                  <dd className=\"mt-1 text-sm text-gray-900\">\n                    <Link\n                      to={isBusinessInventoryItem\n                        ? buildContextUrl(`/business-inventory/transaction/${item.transactionId}`)\n                        : buildContextUrl(`/project/${projectId}/transaction/${item.transactionId}`)\n                      }\n                    className=\"text-primary-600 hover:text-primary-800 underline\"\n                    >\n                      {item.transactionId\n                        ? item.transactionId.startsWith('INV_PURCHASE')\n                          ? 'INV_PURCHASE...'\n                          : (item.transactionId.length > 12 ? `${item.transactionId.slice(0, 12)}...` : item.transactionId)\n                        : ''}\n                    </Link>\n                  </dd>\n                </div>\n              {/* Lineage breadcrumb (compact) */}\n              {item.itemId && (\n                <div className=\"sm:col-span-3 mt-2\">\n                  <ItemLineageBreadcrumb itemId={item.itemId} />\n                </div>\n              )}\n              </dl>\n\n              {/* Delete button in lower right corner */}\n              <div className=\"absolute bottom-0 right-0\">\n                <button\n                  onClick={handleDeleteItem}\n                  className=\"inline-flex items-center justify-center p-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                  title=\"Delete Item\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n\n\n"],"names":["ItemDetail","id","itemId","useParams","navigate","useNavigate","currentAccountId","useAccount","searchParams","useSearchParams","item","setItem","useState","projectName","setProjectName","isUploadingImage","setIsUploadingImage","uploadProgress","setUploadProgress","openDispositionMenu","setOpenDispositionMenu","isSticky","setIsSticky","showError","useToast","buildContextUrl","getBackDestination","useNavigationContext","stickyRef","useRef","actualItemId","projectId","isBusinessInventoryItem","duplicateItem","useDuplication","items","prev","backDestination","useMemo","defaultPath","useEffect","fetchedItem","unifiedItemsService","project","projectService","error","currentProjectId","unsubscribe","updatedItem","_a","lineageService","err","handleClickOutside","event","target","handleScroll","isElementSticky","toggleBookmark","updateDisposition","newDisposition","integrationService","deallocationError","toggleDispositionMenu","getDispositionBadgeClasses","disposition","baseClasses","handleDeleteItem","handleMultipleImageUpload","files","i","uploadResults","ImageUploadService","fileIndex","progress","overallProgress","newImages","result","index","currentImages","updatedImages","img","friendlyMessage","getUserFriendlyErrorMessage","action","getErrorAction","handleSelectFromGallery","_b","handleRemoveImage","imageUrl","handleSetPrimaryImage","jsxs","jsx","Link","ArrowLeft","Bookmark","Edit","Copy","QrCode","ChevronDown","ImagePlus","ImagePreview","FileText","formatCurrency","formatDate","ItemLineageBreadcrumb","Trash2"],"mappings":"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"}