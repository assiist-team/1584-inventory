{"version":3,"file":"ItemDetail-BM_5545j.js","sources":["../../src/pages/ItemDetail.tsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { ArrowLeft, Bookmark, Printer, RotateCcw, Trash2, Edit, FileText, ShoppingBag, Tag, DollarSign, CreditCard, Camera } from 'lucide-react'\nimport { Link, useParams, useNavigate, useSearchParams } from 'react-router-dom'\nimport { Item, ItemImage } from '@/types'\nimport { formatDate } from '@/utils/dateUtils'\nimport { itemService, projectService } from '@/services/inventoryService'\nimport { ImageUploadService } from '@/services/imageService'\nimport ImagePreview from '@/components/ui/ImagePreview'\nimport { getUserFriendlyErrorMessage, getErrorAction } from '@/utils/imageUtils'\nimport { useToast } from '@/components/ui/ToastContext'\n\nexport default function ItemDetail() {\n  const { id } = useParams<{ id: string }>()\n  const navigate = useNavigate()\n  const [searchParams] = useSearchParams()\n  const [item, setItem] = useState<Item | null>(null)\n  const [projectName, setProjectName] = useState<string>('')\n  const [isUploadingImage, setIsUploadingImage] = useState(false)\n  const [uploadProgress, setUploadProgress] = useState<number>(0)\n  const { showError } = useToast()\n\n  // Initialize with sample data for demo\n  const sampleItem: Item = {\n    item_id: id || 'I-1',\n    description: 'Marble Countertop Sample',\n    source: 'Home Depot',\n    sku: 'MCT-001',\n    price: '150.00',\n    resale_price: '250.00',\n    market_value: '300.00',\n    payment_method: '1584 Card',\n    notes: 'High-end marble sample for client presentation',\n    qr_key: 'QR001',\n    bookmark: true,\n    disposition: 'keep',\n    transaction_id: 'T-1',\n    project_id: 'P-1',\n    date_created: '2024-01-15',\n    last_updated: '2024-01-20'\n  }\n\n  useEffect(() => {\n    const fetchItem = async () => {\n      if (id) {\n        try {\n          // Get the project ID from URL search parameters\n          const projectId = searchParams.get('project')\n\n          if (projectId) {\n            const [fetchedItem, project] = await Promise.all([\n              itemService.getItem(projectId, id),\n              projectService.getProject(projectId)\n            ])\n\n            if (fetchedItem) {\n              setItem(fetchedItem)\n            } else {\n              console.error('Item not found in project:', projectId, 'with ID:', id)\n              setItem(sampleItem)\n            }\n\n            if (project) {\n              setProjectName(project.name)\n            }\n          } else {\n            console.error('No project ID found in URL parameters')\n            setItem(sampleItem)\n          }\n        } catch (error) {\n          console.error('Failed to fetch item:', error)\n          setItem(sampleItem)\n        }\n      } else {\n        setItem(sampleItem)\n      }\n    }\n\n    fetchItem()\n  }, [id, searchParams])\n\n  // Set up real-time listener for item updates\n  useEffect(() => {\n    const currentProjectId = searchParams.get('project')\n    if (!currentProjectId || !id) return\n\n    console.log('Setting up real-time listener for item:', id)\n\n    const unsubscribe = itemService.subscribeToItems(\n      currentProjectId,\n      (items) => {\n        console.log('Real-time items update:', items.length, 'items')\n        const updatedItem = items.find(item => item.item_id === id)\n        if (updatedItem) {\n          console.log('Found updated item with', updatedItem.images?.length || 0, 'images')\n          setItem(updatedItem)\n        }\n      }\n    )\n\n    return () => {\n      console.log('Cleaning up real-time listener for item:', id)\n      unsubscribe()\n    }\n  }, [searchParams, id])\n\n  const toggleBookmark = async () => {\n    if (!item) return\n\n    try {\n      await itemService.updateItem(item.project_id, item.item_id, {\n        bookmark: !item.bookmark\n      })\n      setItem({ ...item, bookmark: !item.bookmark })\n    } catch (error) {\n      console.error('Failed to update bookmark:', error)\n    }\n  }\n\n  const toggleDisposition = async () => {\n    if (!item) return\n\n    try {\n      const newDisposition = item.disposition === 'return' ? 'keep' : 'return'\n      await itemService.updateItem(item.project_id, item.item_id, {\n        disposition: newDisposition\n      })\n      setItem({ ...item, disposition: newDisposition })\n    } catch (error) {\n      console.error('Failed to update disposition:', error)\n    }\n  }\n\n  const handleDeleteItem = async () => {\n    if (!item || !projectId) return\n\n    if (!confirm('Are you sure you want to delete this item? This action cannot be undone.')) {\n      return\n    }\n\n    try {\n      await itemService.deleteItem(projectId, item.item_id)\n      navigate(`/project/${projectId}?tab=inventory`)\n    } catch (error) {\n      console.error('Failed to delete item:', error)\n      showError('Failed to delete item. Please try again.')\n    }\n  }\n\n  const handleMultipleImageUpload = async (files: File[]) => {\n    if (!item || !projectName) return\n\n    try {\n      setIsUploadingImage(true)\n      setUploadProgress(0)\n\n      console.log('Starting multiple image upload for', files.length, 'files')\n      for (let i = 0; i < files.length; i++) {\n        console.log(`Processing file ${i + 1}:`, files[i].name)\n      }\n\n      const uploadResults = await ImageUploadService.uploadMultipleItemImages(\n        files,\n        projectName,\n        item.item_id,\n        (fileIndex, progress) => {\n          // Show progress for current file being uploaded\n          const overallProgress = Math.round(((fileIndex + progress.percentage / 100) / files.length) * 100)\n          setUploadProgress(overallProgress)\n        }\n      )\n\n      console.log('All uploads completed successfully:', uploadResults.length, 'images')\n\n      // Convert upload results to ItemImage objects\n      const newImages: ItemImage[] = uploadResults.map((result, index) => ({\n        url: result.url,\n        alt: result.fileName,\n        isPrimary: item.images?.length === 0 && index === 0, // First image is primary if no images exist\n        uploadedAt: new Date(),\n        fileName: result.fileName,\n        size: result.size,\n        mimeType: result.mimeType\n      }))\n\n      console.log('New image objects created:', newImages.length)\n\n      // Update the item with all new images\n      const currentImages = item.images || []\n      const updatedImages = [...currentImages, ...newImages]\n\n      console.log('Before update - item.images length:', currentImages.length)\n      console.log('After update - updatedImages length:', updatedImages.length)\n      console.log('New images URLs:', newImages.map(img => img.url))\n\n      if (projectId) {\n        console.log('Updating item in database with multiple new images')\n        await itemService.updateItem(projectId, item.item_id, { images: updatedImages })\n      }\n\n      // Update local state\n      setItem({ ...item, images: updatedImages })\n      setUploadProgress(100)\n\n      console.log('Multiple image upload completed successfully')\n    } catch (error) {\n      console.error('Error uploading multiple images:', error)\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    } finally {\n      setIsUploadingImage(false)\n      setUploadProgress(0)\n    }\n  }\n\n  const handleSelectFromGallery = async () => {\n    if (!item || !projectName) return\n\n    try {\n      setIsUploadingImage(true)\n      const files = await ImageUploadService.selectFromGallery()\n\n      if (files && files.length > 0) {\n        console.log('Selected', files.length, 'files from gallery')\n        await handleMultipleImageUpload(files)\n      } else {\n        console.log('No files selected from gallery')\n      }\n    } catch (error: any) {\n      console.error('Error selecting from gallery:', error)\n\n      // Handle cancel/timeout gracefully - don't show error for user cancellation\n      if (error.message?.includes('timeout') || error.message?.includes('canceled')) {\n        console.log('User canceled image selection or selection timed out')\n        return\n      }\n\n      // Show error for actual failures\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    } finally {\n      setIsUploadingImage(false)\n      setUploadProgress(0)\n    }\n  }\n\n\n  const handleRemoveImage = async (imageUrl: string) => {\n    if (!item || !projectId) return\n\n    try {\n      // Remove from database\n      if (projectId) {\n        await itemService.removeItemImage(projectId, item.item_id, imageUrl)\n      }\n\n      // Update local state\n      const updatedImages = item.images?.filter(img => img.url !== imageUrl) || []\n      setItem({ ...item, images: updatedImages })\n    } catch (error) {\n      console.error('Error removing image:', error)\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    }\n  }\n\n  const handleSetPrimaryImage = async (imageUrl: string) => {\n    if (!item || !projectId) return\n\n    try {\n      // Update in database\n      if (projectId) {\n        await itemService.setPrimaryImage(projectId, item.item_id, imageUrl)\n      }\n\n      // Update local state\n      const updatedImages = item.images?.map(img => ({\n        ...img,\n        isPrimary: img.url === imageUrl\n      })) || []\n      setItem({ ...item, images: updatedImages })\n    } catch (error) {\n      console.error('Error setting primary image:', error)\n      const friendlyMessage = getUserFriendlyErrorMessage(error)\n      const action = getErrorAction(error)\n      showError(`${friendlyMessage} Suggestion: ${action}`)\n    }\n  }\n\n  // Get project ID from search parameters\n  const projectId = searchParams.get('project')\n\n  if (!item) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center space-x-4\">\n          <Link\n            to={projectId ? `/project/${projectId}?tab=inventory` : '/projects'}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back to {projectId ? 'Project' : 'Projects'}\n          </Link>\n        </div>\n        <div className=\"bg-white shadow rounded-lg\">\n          <div className=\"px-4 py-5 sm:p-6\">\n            <p className=\"text-gray-500\">Item not found.</p>\n            {projectId && <p className=\"text-sm text-gray-400 mt-2\">Project ID: {projectId}</p>}\n            <p className=\"text-sm text-gray-400 mt-1\">Item ID: {id || 'unknown'}</p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-4\">\n        {/* Back button row */}\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n          <Link\n            to={`/project/${projectId}?tab=inventory`}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Link>\n\n          <div className=\"flex flex-wrap gap-2 sm:space-x-2\">\n            <Link\n              to={`/project/${projectId}/edit-item/${item.item_id}?project=${projectId}`}\n              className=\"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n            >\n              <Edit className=\"h-4 w-4 mr-2\" />\n              Edit\n            </Link>\n\n            <button\n              onClick={toggleBookmark}\n              className={`inline-flex items-center px-3 py-2 border text-sm font-medium rounded-md ${\n                item.bookmark\n                  ? 'border-red-300 text-red-700 bg-red-50 hover:bg-red-100'\n                  : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n              } focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`}\n            >\n              <Bookmark className=\"h-4 w-4 mr-2\" fill={item.bookmark ? 'currentColor' : 'none'} />\n              {item.bookmark ? 'Bookmarked' : 'Bookmark'}\n            </button>\n\n            <button\n              onClick={toggleDisposition}\n              className={`inline-flex items-center px-3 py-2 border text-sm font-medium rounded-md ${\n                item.disposition === 'return'\n                  ? 'border-red-300 text-red-700 bg-red-50 hover:bg-red-100'\n                  : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n              } focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`}\n            >\n              <RotateCcw className=\"h-4 w-4 mr-2\" />\n              {item.disposition === 'keep' ? 'Return' : 'Keep'}\n            </button>\n\n            <button\n              className=\"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              onClick={() => window.open(`/qr-image/${item.qr_key}`, '_blank')}\n            >\n              <Printer className=\"h-4 w-4 mr-2\" />\n              QR\n            </button>\n\n            <button\n              onClick={handleDeleteItem}\n              className=\"inline-flex items-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Delete\n            </button>\n          </div>\n        </div>\n\n        {/* Item information */}\n        <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n          <div className=\"px-6 py-4 border-b border-gray-200\">\n            <h1 className=\"text-xl font-semibold text-gray-900\">{item.description}</h1>\n          </div>\n\n          <div className=\"px-6 py-4\">\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <FileText className=\"h-4 w-4 mr-1\" />\n                  Description\n                </dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{item.description}</dd>\n              </div>\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <ShoppingBag className=\"h-4 w-4 mr-1\" />\n                  Source\n                </dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{item.source}</dd>\n              </div>\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <Tag className=\"h-4 w-4 mr-1\" />\n                  SKU\n                </dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{item.sku}</dd>\n              </div>\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <DollarSign className=\"h-4 w-4 mr-1\" />\n                  Price\n                </dt>\n                <dd className=\"mt-1 text-sm text-gray-900 font-medium\">${item.price}</dd>\n              </div>\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <DollarSign className=\"h-4 w-4 mr-1\" />\n                  Market Value\n                </dt>\n                <dd className=\"mt-1 text-sm text-green-600 font-medium\">${item.market_value || ''}</dd>\n              </div>\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <DollarSign className=\"h-4 w-4 mr-1\" />\n                  1584 Resale Price\n                </dt>\n                <dd className=\"mt-1 text-sm text-primary-600 font-medium\">${item.resale_price || ''}</dd>\n              </div>\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <CreditCard className=\"h-4 w-4 mr-1\" />\n                  Payment Method\n                </dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{item.payment_method}</dd>\n              </div>\n\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <RotateCcw className=\"h-4 w-4 mr-1\" />\n                  Disposition\n                </dt>\n                <dd className=\"mt-1\">\n                  <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${\n                    item.disposition === 'return'\n                      ? 'bg-red-100 text-red-800'\n                      : 'bg-green-100 text-green-800'\n                  }`}>\n                    {item.disposition === 'return' ? 'Return' : item.disposition === 'keep' ? 'Keep' : item.disposition === '1584' ? '1584' : item.disposition}\n                  </span>\n                </dd>\n              </div>\n\n              <div className=\"sm:col-span-2\">\n                <dt className=\"text-sm font-medium text-gray-500 flex items-center\">\n                  <FileText className=\"h-4 w-4 mr-1\" />\n                  Notes\n                </dt>\n                <dd className=\"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">{item.notes || 'No notes'}</dd>\n              </div>\n            </dl>\n          </div>\n\n          {/* Item Images */}\n          <div className=\"px-6 py-4 border-t border-gray-200\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-sm font-medium text-gray-900\">Item Images</h3>\n              <button\n                onClick={handleSelectFromGallery}\n                disabled={isUploadingImage}\n                className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50\"\n                title=\"Add images from gallery or camera\"\n              >\n                <Camera className=\"h-3 w-3 mr-1\" />\n                {isUploadingImage\n                  ? uploadProgress > 0 && uploadProgress < 100\n                    ? `Uploading... ${Math.round(uploadProgress)}%`\n                    : 'Uploading...'\n                  : 'Add Images'\n                }\n              </button>\n            </div>\n\n            {item.images && item.images.length > 0 ? (\n              <ImagePreview\n                images={item.images}\n                onRemoveImage={handleRemoveImage}\n                onSetPrimary={handleSetPrimaryImage}\n                maxImages={5}\n                size=\"md\"\n                showControls={true}\n              />\n            ) : (\n              <div className=\"text-center py-8\">\n                <p className=\"text-sm text-gray-500 mb-3\">No images for this item yet</p>\n              </div>\n            )}\n          </div>\n\n          {/* Metadata */}\n          <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200\">\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-3\">\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Item ID</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{item.item_id}</dd>\n              </div>\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Transaction ID</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{item.transaction_id}</dd>\n              </div>\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Project ID</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{item.project_id}</dd>\n              </div>\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Date Created</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(item.date_created)}</dd>\n              </div>\n              <div>\n                <dt className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Last Updated</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{formatDate(item.last_updated)}</dd>\n              </div>\n            </dl>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n\n"],"names":["ItemDetail","id","useParams","navigate","useNavigate","searchParams","useSearchParams","item","setItem","useState","projectName","setProjectName","isUploadingImage","setIsUploadingImage","uploadProgress","setUploadProgress","showError","useToast","sampleItem","useEffect","projectId","fetchedItem","project","itemService","projectService","error","currentProjectId","unsubscribe","items","updatedItem","_a","toggleBookmark","toggleDisposition","newDisposition","handleDeleteItem","handleMultipleImageUpload","files","i","uploadResults","ImageUploadService","fileIndex","progress","overallProgress","newImages","result","index","currentImages","updatedImages","img","friendlyMessage","getUserFriendlyErrorMessage","action","getErrorAction","handleSelectFromGallery","_b","handleRemoveImage","imageUrl","handleSetPrimaryImage","jsxs","Link","jsx","ArrowLeft","Edit","Bookmark","RotateCcw","Printer","Trash2","FileText","ShoppingBag","Tag","DollarSign","CreditCard","Camera","ImagePreview","formatDate"],"mappings":"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"}