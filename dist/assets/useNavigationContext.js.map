{"version":3,"file":"useNavigationContext.js","sources":["../../src/hooks/useNavigationContext.ts"],"sourcesContent":["import { useLocation } from 'react-router-dom'\nimport { useNavigationStack } from '../contexts/NavigationStackContext'\n\nexport interface NavigationContext {\n  getBackDestination: (defaultPath: string) => string\n  getNavigationSource: () => string | null\n  buildContextUrl: (targetPath: string, additionalParams?: Record<string, string>) => string\n}\n\nexport function useNavigationContext(): NavigationContext {\n  const location = useLocation()\n  const searchParams = new URLSearchParams(location.search)\n  const navigationStack = useNavigationStack()\n\n  return {\n    getBackDestination: (defaultPath: string) => {\n      // Prefer navigation stack first (mimic native Back).\n      // Use `peek` here (non-mutating) because this function is called during render\n      // to compute the Back link target; calling `pop` during render triggers state\n      // updates and can cause render-time side-effects / freezes.\n      try {\n        const candidate = navigationStack.peek(location.pathname + location.search)\n        if (candidate) return candidate\n      } catch {\n        // ignore if stack not available\n      }\n\n      // Check for returnTo parameter next\n      const returnTo = searchParams.get('returnTo')\n      if (returnTo) return returnTo\n\n      // Check for from parameter and handle accordingly\n      const from = searchParams.get('from')\n      switch (from) {\n        case 'business-inventory-item':\n          // If we're on a project page and came from business inventory item\n          if (location.pathname.startsWith('/project/')) {\n            return returnTo || '/business-inventory'\n          }\n          break\n        case 'transaction':\n          // If we're on an item page and came from transaction\n          if (location.pathname.startsWith('/item/')) {\n            const projectId = searchParams.get('project')\n            const transactionId = searchParams.get('transactionId')\n            if (projectId && transactionId) {\n              return `/project/${projectId}/transaction/${transactionId}`\n            }\n          }\n          break\n      }\n\n      return defaultPath\n    },\n\n    getNavigationSource: () => {\n      return searchParams.get('from')\n    },\n\n    buildContextUrl: (targetPath: string, additionalParams?: Record<string, string>) => {\n\n      const url = new URL(targetPath, window.location.origin)\n      const currentParams = new URLSearchParams(location.search)\n\n      // Preserve navigation context\n      const from = currentParams.get('from')\n      if (from) url.searchParams.set('from', from)\n\n      // Add current path as returnTo for back navigation (fallback)\n      url.searchParams.set('returnTo', location.pathname + location.search)\n\n      // Add any additional parameters\n      if (additionalParams) {\n        Object.entries(additionalParams).forEach(([key, value]) => {\n          url.searchParams.set(key, value)\n        })\n      }\n\n      return url.pathname + url.search\n    }\n  }\n}\n"],"names":["useNavigationContext","location","useLocation","searchParams","navigationStack","useNavigationStack","defaultPath","candidate","returnTo","projectId","transactionId","targetPath","additionalParams","url","from","key","value"],"mappings":"+DASO,SAASA,GAA0C,CACxD,MAAMC,EAAWC,EAAA,EACXC,EAAe,IAAI,gBAAgBF,EAAS,MAAM,EAClDG,EAAkBC,EAAA,EAExB,MAAO,CACL,mBAAqBC,GAAwB,CAK3C,GAAI,CACF,MAAMC,EAAYH,EAAgB,KAAKH,EAAS,SAAWA,EAAS,MAAM,EAC1E,GAAIM,EAAW,OAAOA,CACxB,MAAQ,CAER,CAGA,MAAMC,EAAWL,EAAa,IAAI,UAAU,EAC5C,GAAIK,EAAU,OAAOA,EAIrB,OADaL,EAAa,IAAI,MAAM,EAC5B,CACN,IAAK,0BAEH,GAAIF,EAAS,SAAS,WAAW,WAAW,EAC1C,OAAOO,GAAY,sBAErB,MACF,IAAK,cAEH,GAAIP,EAAS,SAAS,WAAW,QAAQ,EAAG,CAC1C,MAAMQ,EAAYN,EAAa,IAAI,SAAS,EACtCO,EAAgBP,EAAa,IAAI,eAAe,EACtD,GAAIM,GAAaC,EACf,MAAO,YAAYD,CAAS,gBAAgBC,CAAa,EAE7D,CACA,KAAA,CAGJ,OAAOJ,CACT,EAEA,oBAAqB,IACZH,EAAa,IAAI,MAAM,EAGhC,gBAAiB,CAACQ,EAAoBC,IAA8C,CAElF,MAAMC,EAAM,IAAI,IAAIF,EAAY,OAAO,SAAS,MAAM,EAIhDG,EAHgB,IAAI,gBAAgBb,EAAS,MAAM,EAG9B,IAAI,MAAM,EACrC,OAAIa,GAAMD,EAAI,aAAa,IAAI,OAAQC,CAAI,EAG3CD,EAAI,aAAa,IAAI,WAAYZ,EAAS,SAAWA,EAAS,MAAM,EAGhEW,GACF,OAAO,QAAQA,CAAgB,EAAE,QAAQ,CAAC,CAACG,EAAKC,CAAK,IAAM,CACzDH,EAAI,aAAa,IAAIE,EAAKC,CAAK,CACjC,CAAC,EAGIH,EAAI,SAAWA,EAAI,MAC5B,CAAA,CAEJ"}