{"version":3,"file":"ImageUpload-B0ch5OEQ.js","sources":["../../src/components/ui/ImageUpload.tsx"],"sourcesContent":["import React, { useState, useRef, useCallback } from 'react'\nimport { Upload, X, Image as ImageIcon, AlertCircle } from 'lucide-react'\nimport { ImageUploadService } from '@/services/imageService'\n\ninterface ImageUploadProps {\n  onImagesChange: (files: File[]) => void\n  maxImages?: number\n  acceptedTypes?: string[]\n  maxFileSize?: number // in MB\n  disabled?: boolean\n  className?: string\n}\n\ninterface PreviewImage {\n  file: File\n  previewUrl: string\n  isUploading?: boolean\n  uploadProgress?: number\n  error?: string\n}\n\nexport default function ImageUpload({\n  onImagesChange,\n  maxImages = 5,\n  acceptedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'],\n  maxFileSize = 10,\n  disabled = false,\n  className = ''\n}: ImageUploadProps) {\n  const [images, setImages] = useState<PreviewImage[]>([])\n  const [isDragOver, setIsDragOver] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const cameraInputRef = useRef<HTMLInputElement>(null)\n  const galleryInputRef = useRef<HTMLInputElement>(null)\n\n  const validateFile = useCallback((file: File): string | null => {\n    if (!acceptedTypes.includes(file.type)) {\n      return `Invalid file type. Please upload: ${acceptedTypes.join(', ')}`\n    }\n\n    const maxSizeBytes = maxFileSize * 1024 * 1024\n    if (file.size > maxSizeBytes) {\n      return `File too large. Maximum size: ${maxFileSize}MB`\n    }\n\n    return null\n  }, [acceptedTypes, maxFileSize])\n\n  const addImages = useCallback((files: FileList | File[]) => {\n    const fileArray = Array.from(files)\n    const validFiles: File[] = []\n    const newPreviewImages: PreviewImage[] = []\n\n    fileArray.forEach(file => {\n      const error = validateFile(file)\n      if (error) {\n        newPreviewImages.push({\n          file,\n          previewUrl: '',\n          error\n        })\n      } else {\n        validFiles.push(file)\n        newPreviewImages.push({\n          file,\n          previewUrl: ImageUploadService.createPreviewUrl(file)\n        })\n      }\n    })\n\n    if (validFiles.length + images.length > maxImages) {\n      const allowedCount = maxImages - images.length\n      if (allowedCount > 0) {\n        validFiles.splice(allowedCount)\n        newPreviewImages.splice(allowedCount)\n      } else {\n        validFiles.length = 0\n        newPreviewImages.length = 0\n      }\n\n      newPreviewImages.push({\n        file: new File([], ''),\n        previewUrl: '',\n        error: `Maximum ${maxImages} images allowed. Additional images were skipped.`\n      })\n    }\n\n    setImages(prev => [...prev, ...newPreviewImages])\n    onImagesChange(validFiles)\n  }, [images.length, maxImages, validateFile, onImagesChange])\n\n  const removeImage = useCallback((index: number) => {\n    const imageToRemove = images[index]\n\n    // Clean up preview URL\n    if (imageToRemove.previewUrl) {\n      ImageUploadService.revokePreviewUrl(imageToRemove.previewUrl)\n    }\n\n    setImages(prev => prev.filter((_, i) => i !== index))\n\n    // Update parent component with remaining files\n    const remainingFiles = images\n      .filter((_, i) => i !== index)\n      .filter(img => !img.error)\n      .map(img => img.file)\n\n    onImagesChange(remainingFiles)\n  }, [images, onImagesChange])\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (files && files.length > 0) {\n      addImages(files)\n    }\n  }\n\n\n  const handleGallerySelect = async () => {\n    try {\n      const files = await ImageUploadService.selectFromGallery()\n      if (files.length > 0) {\n        addImages(files)\n      }\n    } catch (error) {\n      console.error('Error selecting from gallery:', error)\n    }\n  }\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (!disabled) {\n      setIsDragOver(true)\n    }\n  }, [disabled])\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n  }, [])\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n\n    if (disabled) return\n\n    const files = e.dataTransfer.files\n    if (files && files.length > 0) {\n      addImages(files)\n    }\n  }, [disabled, addImages])\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 Bytes'\n    const k = 1024\n    const sizes = ['Bytes', 'KB', 'MB', 'GB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return (bytes / Math.pow(k, i)).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' ' + sizes[i]\n  }\n\n  return (\n    <div className={`space-y-4 ${className}`}>\n      {/* Upload Area */}\n      <div\n        className={`relative border-2 border-dashed rounded-lg p-6 sm:p-8 text-center transition-colors touch-manipulation ${\n          isDragOver\n            ? 'border-primary-500 bg-primary-50'\n            : 'border-gray-300 hover:border-gray-400'\n        } ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n        onClick={() => !disabled && fileInputRef.current?.click()}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          multiple\n          accept={acceptedTypes.join(',')}\n          onChange={handleFileSelect}\n          disabled={disabled}\n          className=\"hidden\"\n        />\n\n        <div className=\"flex flex-col items-center space-y-2\">\n          <div className={`p-3 rounded-full ${isDragOver ? 'bg-primary-100' : 'bg-gray-100'}`}>\n            <Upload className={`h-6 w-6 ${isDragOver ? 'text-primary-600' : 'text-gray-600'}`} />\n          </div>\n\n          <div>\n            <p className=\"text-sm font-medium text-gray-900\">\n              Drop images here, or click to browse\n            </p>\n            <p className=\"text-xs text-gray-500 mt-1\">\n              Supports: JPEG, PNG, GIF, WebP (max {maxFileSize}MB each, up to {maxImages} images)\n            </p>\n          </div>\n\n          <button\n            type=\"button\"\n            onClick={(e) => {\n              e.stopPropagation()\n              handleGallerySelect()\n            }}\n            disabled={disabled}\n            className=\"inline-flex items-center justify-center px-4 py-2.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 mt-3 touch-manipulation\"\n            title=\"Add images from gallery or camera\"\n          >\n            <ImageIcon className=\"h-4 w-4 mr-2\" />\n            Add Images\n          </button>\n        </div>\n      </div>\n\n      {/* Hidden camera input */}\n      <input\n        ref={cameraInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        capture=\"environment\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      {/* Hidden gallery input */}\n      <input\n        ref={galleryInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      {/* Image Previews */}\n      {images.length > 0 && (\n        <div className=\"space-y-3\">\n          <h4 className=\"text-sm font-medium text-gray-900\">Transaction Images</h4>\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4\">\n            {images.map((image, index) => (\n              <div key={index} className=\"relative group\">\n                <div className=\"aspect-w-4 aspect-h-3 rounded-lg overflow-hidden bg-gray-100\">\n                  {image.error ? (\n                    <div className=\"flex items-center justify-center h-full\">\n                      <div className=\"text-center p-4\">\n                        <AlertCircle className=\"h-8 w-8 text-red-500 mx-auto mb-2\" />\n                        <p className=\"text-xs text-red-600\">{image.error}</p>\n                      </div>\n                    </div>\n                  ) : (\n                    <>\n                      <img\n                        src={image.previewUrl}\n                        alt={image.file.name}\n                        className=\"w-full h-full object-cover\"\n                      />\n\n                      {image.isUploading && (\n                        <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center\">\n                          <div className=\"text-white text-center\">\n                            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-white mx-auto mb-2\"></div>\n                            <p className=\"text-xs\">\n                              {image.uploadProgress ? `${Math.round(image.uploadProgress)}%` : 'Uploading...'}\n                            </p>\n                          </div>\n                        </div>\n                      )}\n\n                      <button\n                        type=\"button\"\n                        onClick={() => removeImage(index)}\n                        className=\"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600\"\n                      >\n                        <X className=\"h-3 w-3\" />\n                      </button>\n                    </>\n                  )}\n                </div>\n\n                <div className=\"mt-1\">\n                  <p className=\"text-xs text-gray-500 truncate\" title={image.file.name}>\n                    {image.file.name}\n                  </p>\n                  <p className=\"text-xs text-gray-400\">\n                    {formatFileSize(image.file.size)}\n                  </p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":["ImageUpload","onImagesChange","maxImages","acceptedTypes","maxFileSize","disabled","className","images","setImages","useState","isDragOver","setIsDragOver","fileInputRef","useRef","cameraInputRef","galleryInputRef","validateFile","useCallback","file","maxSizeBytes","addImages","files","fileArray","validFiles","newPreviewImages","error","ImageUploadService","allowedCount","prev","removeImage","index","imageToRemove","_","i","remainingFiles","img","handleFileSelect","handleGallerySelect","handleDragOver","handleDragLeave","handleDrop","formatFileSize","bytes","k","sizes","jsxs","_a","jsx","Upload","ImageIcon","image","AlertCircle","Fragment","X"],"mappings":"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"}