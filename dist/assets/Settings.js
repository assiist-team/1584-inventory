import{u as X,d as W,U as D,n as de,o as Z,j as e,B as z,p as ne,e as me,q as xe,k as ue,r as ge}from"./index.js";import{r as s}from"./vendor.js";import{I as re}from"./imageService.js";import{S as he}from"./Select.js";import{d as _,U as Q,M as ie,y as ee,i as se,z as fe,p as te,f as le,b as J,s as pe,j as ye,A as ae,t as K,G as be,H as ve,J as je,q as Ne,u as we}from"./ui.js";import{a as Se,u as Ce,g as ke,s as Ee}from"./taxPresetsService.js";import{a as Ae,u as Ie}from"./vendorDefaultsService.js";import{b as G,C as Pe}from"./CategorySelect.js";import"./router.js";import"./supabase.js";function De({className:a}){const{user:f,isOwner:v,loading:C,userLoading:L}=X(),{currentAccountId:x,isAdmin:m,loading:h}=W(),[k,d]=s.useState([]),[p,c]=s.useState(!0),[u,N]=s.useState(""),[j,n]=s.useState(D.USER),[y,g]=s.useState(!1),[b,l]=s.useState(""),[o,w]=s.useState([]),[U,F]=s.useState(null),S=m||v(),E=s.useCallback(async()=>{if(x)try{const r=await de(x);w(r)}catch(r){console.error("Error loading pending invitations:",r)}},[x]),T=s.useCallback(async()=>{try{if(c(!0),!x){d([]),c(!1);return}const r=await Z.getAccountUsers(x);d(r.map(A=>({...A,role:A.role==="owner"?D.OWNER:A.role==="admin"?D.ADMIN:D.USER})))}catch(r){console.error("Error loading users:",r),l("Failed to load users")}finally{c(!1)}},[x]);s.useEffect(()=>{if(C||L||h){c(!0);return}S&&x?(T(),E()):c(!1)},[S,x,C,L,h,T,E]);const M=async()=>{if(u.trim())try{if(g(!0),l(""),!x){l("Account ID is required");return}if(!(f!=null&&f.id)){l("User ID is required");return}const r=await ne(u.trim(),j,f.id,x);await E(),await navigator.clipboard.writeText(r),F(r),setTimeout(()=>F(null),2e3),N(""),n(D.USER)}catch(r){console.error("Error inviting user:",r),l("Failed to create invitation")}finally{g(!1)}},O=async r=>{const A=`${window.location.origin}/invite/${r}`;await navigator.clipboard.writeText(A),F(r),setTimeout(()=>F(null),2e3)},R=r=>{switch(r){case D.OWNER:return e.jsx(fe,{className:"h-4 w-4 text-yellow-500"});case D.ADMIN:return e.jsx(_,{className:"h-4 w-4 text-blue-500"});case D.USER:return e.jsx(Q,{className:"h-4 w-4 text-gray-500"});default:return e.jsx(Q,{className:"h-4 w-4 text-gray-500"})}},B=r=>{switch(r){case D.OWNER:return"bg-yellow-100 text-yellow-800";case D.ADMIN:return"bg-blue-100 text-blue-800";case D.USER:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return S?e.jsxs("div",{className:`p-6 ${a}`,children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Q,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Invite team members and manage user roles"})]})]}),b&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-red-600",children:b})}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Invite Team Member"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",value:u,onChange:r=>N(r.target.value),placeholder:"user@example.com",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"})]}),e.jsx(he,{label:"Assign Role",value:j,onChange:r=>n(r.target.value),children:e.jsx("option",{value:D.USER,children:"User"})}),e.jsxs(z,{onClick:M,disabled:y||!u.trim(),className:"w-full flex items-center justify-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:y?"Creating...":"Create Invitation Link"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"An invitation link will be generated and copied to your clipboard. Share it with the user to invite them."})]}),o.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Pending Invitations"}),e.jsx("div",{className:"space-y-2",children:o.map(r=>{const A=`${window.location.origin}/invite/${r.token}`,$=U===r.token;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded border border-gray-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:r.email}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Role: ",r.role," • Expires: ",new Date(r.expiresAt).toLocaleDateString()]}),e.jsx("div",{className:"text-xs text-gray-400 font-mono truncate mt-1",children:A})]}),e.jsx("button",{onClick:()=>O(r.token),className:"ml-3 flex-shrink-0 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded",title:"Copy invitation link",children:$?e.jsx(ee,{className:"h-4 w-4 text-green-600"}):e.jsx(se,{className:"h-4 w-4"})})]},r.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Team Members"}),p?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600 mx-auto"})}):e.jsx("div",{className:"space-y-3",children:k.map(r=>{const A=r.role||D.USER;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[R(A),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.fullName}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${B(A)}`,children:A})})]},r.id)})})]})]}):e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have permission to manage users."})]})})}function Le({className:a}){const{user:f,isOwner:v,loading:C,userLoading:L}=X(),{showSuccess:x,showError:m}=me(),[h,k]=s.useState([]),[d,p]=s.useState(!0),[c,u]=s.useState(!1),[N,j]=s.useState(""),[n,y]=s.useState(""),[g,b]=s.useState(""),[l,o]=s.useState(null),[w,U]=s.useState(null),[F,S]=s.useState(!1),[E,T]=s.useState({}),[M,O]=s.useState(new Set),[R,B]=s.useState(new Set);s.useEffect(()=>{C||L||(v()?r():p(!1))},[C,L,v]),s.useEffect(()=>{v()&&h.length>0&&A()},[h]);const r=async()=>{try{p(!0),b("");const t=await Z.getAllAccounts();k(t)}catch(t){console.error("Error loading accounts:",t),b("Failed to load accounts"),m("Failed to load accounts")}finally{p(!1)}},A=async()=>{try{const t=h.map(I=>I.id);if(t.length===0)return;const P=await xe(t);T(P)}catch(t){console.error("Error loading account invitations:",t)}},$=async()=>{if(!(!N.trim()||!f)){if(!n.trim()){b("First user email is required"),m("Please provide an email address for the first user");return}try{u(!0),b("");const t=await Z.createAccount(N.trim(),f.id),P=await ne(n.trim(),D.ADMIN,f.id,t);o(P),U(n.trim()),x(`Account "${N.trim()}" created successfully.`),j(""),y(""),await r(),await A()}catch(t){console.error("Error creating account:",t);const P=t instanceof Error?t.message:"Failed to create account";b(P),m(P)}finally{u(!1)}}},H=async()=>{if(l)try{await navigator.clipboard.writeText(l),S(!0),x("Invitation link copied to clipboard"),setTimeout(()=>S(!1),2e3)}catch(t){console.error("Error copying link:",t),m("Failed to copy link")}},V=async t=>{const P=`${window.location.origin}/invite/${t}`;try{await navigator.clipboard.writeText(P),B(new Set([...R,t])),x("Invitation link copied to clipboard"),setTimeout(()=>{B(new Set([...R].filter(I=>I!==t)))},2e3)}catch(I){console.error("Error copying link:",I),m("Failed to copy link")}},i=t=>{O(P=>{const I=new Set(P);return I.has(t)?I.delete(t):I.add(t),I})};return C?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):v()?e.jsxs("div",{className:`p-6 ${a}`,children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(te,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Account Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Create and manage accounts in the system"})]})]}),g&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-red-600",children:g})}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Create New Account"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Account Name"}),e.jsx("input",{type:"text",value:N,onChange:t=>j(t.target.value),placeholder:"Enter account name",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",onKeyDown:t=>{t.key==="Enter"&&N.trim()&&n.trim()&&!c&&$()}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"First User Email (Admin)"}),e.jsx("input",{type:"email",value:n,onChange:t=>y(t.target.value),placeholder:"user@example.com",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",onKeyDown:t=>{t.key==="Enter"&&N.trim()&&n.trim()&&!c&&$()}})]}),e.jsxs(z,{onClick:$,disabled:c||!N.trim()||!n.trim(),className:"w-full flex items-center justify-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:c?"Creating...":"Create Account"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Accounts are used to organize projects and data. An invitation link will be generated for the first user."})]}),l&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-1",children:"Invitation Link Created"}),e.jsxs("p",{className:"text-xs text-blue-700 mb-3",children:["Share this link with ",e.jsx("span",{className:"font-medium",children:w||"the invited user"})," to complete their account setup."]}),e.jsx("div",{className:"bg-white border border-blue-200 rounded-md p-3 mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"flex-1 text-xs text-gray-800 break-all font-mono",children:l}),e.jsx("button",{onClick:H,className:"flex-shrink-0 p-2 text-blue-600 hover:text-blue-900 hover:bg-blue-100 rounded transition-colors",title:"Copy invitation link",children:F?e.jsx(ee,{className:"h-4 w-4 text-green-600"}):e.jsx(se,{className:"h-4 w-4"})})]})})]}),e.jsx("button",{onClick:()=>{o(null),U(null)},className:"flex-shrink-0 ml-2 p-1 text-blue-600 hover:text-blue-900 hover:bg-blue-100 rounded transition-colors",title:"Dismiss",children:e.jsx(J,{className:"h-4 w-4"})})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"All Accounts"}),d?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600 mx-auto"})}):e.jsx("div",{className:"space-y-3",children:h.length===0?e.jsx("div",{className:"text-center py-4 text-sm text-gray-500",children:"No accounts found. Create your first account above."}):h.map(t=>{const P=E[t.id]||[],I=P.length,Y=M.has(t.id);return e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created ",t.createdAt instanceof Date?t.createdAt.toLocaleDateString():new Date(t.createdAt).toLocaleDateString()]})]}),I>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-xs font-medium text-blue-600",children:[I," ",I===1?"invitation":"invitations"]})]})]}),I>0&&e.jsx("button",{onClick:()=>i(t.id),className:"ml-2 p-1 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",title:Y?"Collapse invitations":"View invitations",children:Y?e.jsx(pe,{className:"h-5 w-5"}):e.jsx(ye,{className:"h-5 w-5"})})]}),Y&&I>0&&e.jsxs("div",{className:"border-t border-gray-200 p-3 bg-white rounded-b-lg",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-700 mb-2",children:"Pending Invitations"}),e.jsx("div",{className:"space-y-2",children:P.map(q=>{const ce=`${window.location.origin}/invite/${q.token}`,oe=R.has(q.token);return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:q.email}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Role: ",q.role," • Expires: ",new Date(q.expiresAt).toLocaleDateString()]}),e.jsx("div",{className:"text-xs text-gray-400 font-mono truncate mt-1",children:ce})]}),e.jsx("button",{onClick:()=>V(q.token),className:"ml-3 flex-shrink-0 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",title:"Copy invitation link",children:oe?e.jsx(ee,{className:"h-4 w-4 text-green-600"}):e.jsx(se,{className:"h-4 w-4"})})]},q.id)})})]})]},t.id)})})]})]}):e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Only app owners can manage accounts."})]})})}function Fe(){const{currentAccountId:a,loading:f}=W(),[v,C]=s.useState([]),[L,x]=s.useState(!0),[m,h]=s.useState(!1),[k,d]=s.useState(null),[p,c]=s.useState(null),u=s.useCallback(async()=>{if(a)try{x(!0),d(null);const n=await Se(a);C(n)}catch(n){console.error("Error loading tax presets:",n),d("Failed to load tax presets")}finally{x(!1)}},[a]);s.useEffect(()=>{f||(a?u():(x(!1),d("No account found. Please ensure you are logged in and have an account.")))},[a,f,u]);const N=(n,y,g)=>{C(b=>b.map((l,o)=>o===n?{...l,[y]:g}:l)),d(null),c(null)},j=async()=>{if(!a){d("Account ID is required to save tax presets");return}try{h(!0),d(null),c(null);for(const n of v){if(!n.name.trim())throw new Error("All presets must have a name");if(n.rate<0||n.rate>100)throw new Error("Tax rates must be between 0 and 100")}await Ce(a,v),c("Tax presets updated successfully"),setTimeout(()=>c(null),3e3)}catch(n){console.error("Error saving tax presets:",n),d(n instanceof Error?n.message:"Failed to save tax presets")}finally{h(!1)}};return L?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-1",children:"Tax Rate Presets"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage the 5 tax rate presets available when creating transactions. These presets can be selected to auto-populate the tax rate."})]}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(ae,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:k})})]})]})}),p&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-green-800",children:p})}),e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 rounded-md",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"Preset Name"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Tax Rate (%)"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:v.map((n,y)=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6",children:e.jsx("input",{type:"text",value:n.name,onChange:g=>N(y,"name",g.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Preset name"})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:n.rate,onChange:g=>N(y,"rate",parseFloat(g.target.value)||0),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"0.00"})})]},n.id))})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:j,disabled:m,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),m?"Saving...":"Save Presets"]})})]})}function Te(){const{currentAccountId:a,loading:f}=W(),{user:v}=X(),[C,L]=s.useState([]),[x,m]=s.useState(!0),[h,k]=s.useState(null),[d,p]=s.useState(null),[c,u]=s.useState(null),[N,j]=s.useState(null),[n,y]=s.useState(""),g=s.useCallback(async()=>{if(a)try{m(!0),p(null);const l=await Ae(a);L(l.slots)}catch(l){console.error("Error loading vendor defaults:",l),p("Failed to load vendor defaults")}finally{m(!1)}},[a]);s.useEffect(()=>{f||(a?g():(m(!1),p("No account found. Please ensure you are logged in and have an account.")))},[a,f,g]);const b=async l=>{if(!a){p("Account ID is required to save vendor defaults");return}const o=n!=null&&n.trim()?n.trim():null;try{k(l),p(null),u(null),await Ie(a,l+1,o,v==null?void 0:v.id),L(w=>w.map((U,F)=>F===l?o?{id:o,name:o}:{id:null,name:null}:U)),u(`Slot ${l+1} updated successfully`),j(null),setTimeout(()=>u(null),3e3)}catch(w){console.error("Error saving vendor slot:",w),p(w instanceof Error?w.message:"Failed to save vendor slot")}finally{k(null)}};return x?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-1",children:"Transaction Vendor Defaults"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Set your top 10 vendors/sources for transaction forms. Each slot can be individually edited and saved."})]}),d&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(ae,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:d})})]})]})}),c&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-green-800",children:c})}),e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 rounded-md",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"Slot"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Vendor/Source"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:C.map((l,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6",children:o+1}),e.jsx("td",{className:"px-3 py-4 text-sm text-gray-500",children:N===o?e.jsx("div",{className:"space-y-2",children:e.jsx("input",{type:"text",value:n,onChange:w=>y(w.target.value),placeholder:"Enter vendor/source name (any text allowed)",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",autoFocus:!0})}):e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:l.name?"text-gray-900":"text-gray-400 italic",children:l.name||"Empty"})})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:N===o?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>b(o),disabled:h===o,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),h===o?"Saving...":"Save"]}),e.jsx("button",{type:"button",onClick:()=>{j(null),y(""),g()},className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:e.jsx(J,{className:"h-3 w-3"})})]}):e.jsx("button",{type:"button",onClick:()=>{j(o),y((l==null?void 0:l.name)||"")},className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Edit"})})]},o))})]})})]})}function Ue(){const{currentAccountId:a,loading:f}=W(),[v,C]=s.useState([]),[L,x]=s.useState(!0),[m,h]=s.useState(!1),[k,d]=s.useState(null),[p,c]=s.useState(null),[u,N]=s.useState(!0),[j,n]=s.useState(null),[y,g]=s.useState(!1),[b,l]=s.useState({name:""}),[o,w]=s.useState(null),[U,F]=s.useState(!1),[S,E]=s.useState(null),T=s.useCallback(async()=>{if(a)try{x(!0),d(null);const i=await G.getCategories(a,u);C(i);try{const t=await ke(a);w(t)}catch(t){console.error("Error loading account default category:",t),w(null)}}catch(i){console.error("Error loading budget categories:",i),d("Failed to load budget categories")}finally{x(!1)}},[a,u]);s.useEffect(()=>{f||(a?T():(x(!1),d("No account found. Please ensure you are logged in and have an account.")))},[a,f,T]);const M=()=>{g(!0),n(null),l({name:""}),d(null),c(null)},O=i=>{n(i.id),g(!1),l({name:i.name}),d(null),c(null)},R=()=>{g(!1),n(null),l({name:""})},B=(i,t)=>{l(P=>({...P,[i]:t})),d(null),c(null)},r=async()=>{if(!a){d("Account ID is required");return}if(!b.name.trim()){d("Category name is required");return}try{h(!0),d(null),c(null),y?(await G.createCategory(a,b.name.trim()),c("Category created successfully")):j&&(await G.updateCategory(a,j,{name:b.name.trim()}),c("Category updated successfully")),await T(),R(),setTimeout(()=>c(null),3e3)}catch(i){console.error("Error saving category:",i),d(i instanceof Error?i.message:"Failed to save category")}finally{h(!1)}},A=async i=>{if(a)try{h(!0),d(null),c(null),await G.archiveCategory(a,i),c("Category archived successfully"),await T(),setTimeout(()=>c(null),3e3)}catch(t){console.error("Error archiving category:",t),d(t instanceof Error?t.message:"Failed to archive category")}finally{h(!1)}},$=async i=>{if(a)try{h(!0),d(null),c(null),await G.unarchiveCategory(a,i),c("Category unarchived successfully"),await T(),setTimeout(()=>c(null),3e3)}catch(t){console.error("Error unarchiving category:",t),d(t instanceof Error?t.message:"Failed to unarchive category")}finally{h(!1)}};if(L)return e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});const H=v.filter(i=>!i.isArchived),V=v.filter(i=>i.isArchived);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-1",children:"Budget Categories"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage budget categories for transactions. Archive transactions to hide them from the list in forms."})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:"Default transaction category"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Set the default category that will be used when creating transactions."}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Pe,{id:"accountDefaultCategory",label:"Default Transaction Category",value:o||void 0,onChange:i=>w(i||null),helperText:"This default applies account-wide (saved locally for now)",asDropdown:!0})}),e.jsxs("div",{className:"pt-6",children:[e.jsx(z,{onClick:async()=>{if(a){F(!0),E(null);try{await Ee(a,o),E("Default category saved"),setTimeout(()=>E(null),3e3)}catch(i){console.error("Error saving default category to Postgres:",i),E("Failed to save default")}finally{F(!1)}}},disabled:U,children:U?"Saving...":"Save"}),S&&e.jsx("div",{className:"mt-2 text-sm text-green-700",children:S})]})]})]}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(ae,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:k})})]})]})}),p&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-green-800",children:p})}),y&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4 space-y-3",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900",children:"Create New Category"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",id:"category-name",value:b.name,onChange:i=>B("name",i.target.value),placeholder:"e.g., Design Fee, Furnishings",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",autoFocus:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(z,{onClick:r,disabled:m||!b.name.trim(),size:"sm",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),m?"Saving...":y?"Create":"Save"]}),e.jsxs(z,{onClick:R,variant:"secondary",size:"sm",disabled:m,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]}),!y&&!j&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsxs(z,{onClick:M,size:"sm",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Add Category"]})]}),e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 rounded-md",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"Name"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 bg-white",children:[H.length===0&&V.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-8 text-center text-sm text-gray-500",children:"No categories found. Create your first category to get started."})}):H.map(i=>e.jsxs("tr",{className:`${j===i.id?"bg-gray-50":""}`,children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6",children:j===i.id?e.jsx("input",{type:"text",value:b.name,onChange:t=>B("name",t.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",autoFocus:!0}):i.name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:j===i.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{type:"button",onClick:r,disabled:m||!b.name.trim(),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),m?"Saving...":"Save"]}),e.jsx("button",{type:"button",onClick:R,disabled:m,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:e.jsx(J,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>O(i),disabled:m,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Edit"]}),e.jsxs("button",{type:"button",onClick:()=>A(i.id),disabled:m,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Archive"]})]})})]},i.id)),V.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 bg-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Archived Categories"}),e.jsxs("button",{type:"button",onClick:()=>N(!u),className:"text-sm text-primary-600 hover:text-primary-700",children:[u?"Hide":"Show"," Archived"]})]})})}),u&&V.map(i=>e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-500 sm:pl-6",children:i.name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsxs("button",{type:"button",onClick:()=>$(i.id),disabled:m,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),"Unarchive"]})})]},i.id))]})]})]})})]})}function He(){const{user:a,isOwner:f}=X(),{currentAccountId:v,isAdmin:C}=W(),{businessProfile:L,businessName:x,businessLogoUrl:m,refreshProfile:h}=ue(),[k,d]=s.useState(x),[p,c]=s.useState(null),[u,N]=s.useState(m||null),[j,n]=s.useState(!1),[y,g]=s.useState(null),[b,l]=s.useState(!1),[o,w]=s.useState("general"),U=S=>{var T;const E=(T=S.target.files)==null?void 0:T[0];if(E){if(!re.validateImageFile(E)){g("Invalid image file. Please upload a valid image (JPEG, PNG, GIF, WebP) under 10MB.");return}c(E);const M=new FileReader;M.onloadend=()=>{N(M.result)},M.readAsDataURL(E),g(null)}},F=async()=>{if(!(!v||!a)){n(!0),g(null),l(!1);try{let S=m||null;p&&(console.log("Attempting to upload business logo..."),S=(await re.uploadBusinessLogo(v,p)).url,console.log("Business logo uploaded successfully.")),console.log("Attempting to update business profile..."),await ge.updateBusinessProfile(v,k.trim(),S,a.id),console.log("Business profile updated successfully."),console.log("Attempting to refresh profile..."),await h(),console.log("Profile refreshed successfully."),l(!0),c(null),setTimeout(()=>l(!1),3e3)}catch(S){console.error("Error saving business profile:",S),g(S.message||"Failed to save business profile. Please try again.")}finally{n(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage your account settings and preferences."})]}),e.jsx("div",{className:"bg-white rounded-md shadow-sm",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px space-x-6 px-6","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>w("general"),className:`py-4 px-1 border-b-2 font-medium text-sm ${o==="general"?"border-primary-500 text-gray-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"General"}),e.jsx("button",{onClick:()=>w("presets"),className:`py-4 px-1 border-b-2 font-medium text-sm ${o==="presets"?"border-primary-500 text-gray-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Presets"}),(f()||C)&&e.jsx("button",{onClick:()=>w("users"),className:`py-4 px-1 border-b-2 font-medium text-sm ${o==="users"?"border-primary-500 text-gray-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Users"}),f()&&e.jsx("button",{onClick:()=>w("account"),className:`py-4 px-1 border-b-2 font-medium text-sm ${o==="account"?"border-primary-500 text-gray-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Account"})]})})}),e.jsxs("div",{children:[o==="general"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ne,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Profile"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your account settings and preferences"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Profile Information"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md text-sm text-gray-900",children:a==null?void 0:a.fullName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md text-sm text-gray-900",children:a==null?void 0:a.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md text-sm text-gray-900 capitalize",children:a==null?void 0:a.role}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Contact an administrator to change your role."})]})]})]})})]})}),C&&e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(te,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Business Profile"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your business name and logo for invoices and branding"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"businessName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name"}),e.jsx("input",{type:"text",id:"businessName",value:k,onChange:S=>d(S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter business name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Logo"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[u&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:u,alt:"Business logo preview",className:"h-24 w-24 object-contain border border-gray-300 rounded"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:U,className:"hidden"}),e.jsxs("div",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),p||u?"Change Logo":"Upload Logo"]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Recommended: Square image, at least 200x200px. Max size: 10MB"})]})]})]}),y&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800",children:y})}),b&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md",children:e.jsx("p",{className:"text-sm text-green-800",children:"Business profile saved successfully!"})}),e.jsx("div",{className:"pt-4",children:e.jsx(z,{onClick:F,disabled:j||!k.trim(),className:"w-full sm:w-auto",children:j?"Saving...":"Save Business Profile"})})]})]})})]}),o==="presets"&&e.jsx("div",{className:"space-y-6",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-6",children:e.jsx(Fe,{})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-6",children:e.jsx(Te,{})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-6",children:e.jsx(Ue,{})})})]}):e.jsx("div",{className:"p-6 bg-white rounded-md shadow",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Presets are only configurable by account administrators."})})}),o==="account"&&e.jsx("div",{className:"space-y-6",children:f()?e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-6",children:e.jsx(Le,{})})}):e.jsx("div",{className:"p-6 bg-white rounded-md shadow",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Account management is only available to account owners."})})}),o==="users"&&e.jsx("div",{className:"space-y-6",children:f()||C?e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-6",children:e.jsx(De,{})})}):e.jsx("div",{className:"p-6 bg-white rounded-md shadow",children:e.jsx("p",{className:"text-sm text-gray-600",children:"User management is only available to account owners and administrators."})})})]})]})}export{He as default};
//# sourceMappingURL=Settings.js.map
