import{u as k,U as t,d as W,j as e,b as D,c as B}from"./index.js";import{r as n}from"./vendor.js";import{S as $}from"./Select.js";import{z as F,t as b,u as y,m as A,B as Y,j as _,D as L}from"./firebase.js";import{o as G,r as O,M as Q,f as H,s as J,t as K,u as X}from"./ui.js";import"./router.js";function Z({className:a}){const{user:r,hasRole:v}=k(),[f,M]=n.useState([]),[w,c]=n.useState(!0),[d,I]=n.useState(""),[i,R]=n.useState(t.VIEWER),[E,l]=n.useState(!1),[h,o]=n.useState(""),u=v(t.ADMIN);n.useEffect(()=>{u&&j()},[u]);const j=async()=>{try{c(!0);const s=F(b(W,"users")),x=(await y(s)).docs.map(P=>P.data());M(x)}catch(s){console.error("Error loading users:",s),o("Failed to load users")}finally{c(!1)}},g=async(s,m)=>{try{const x=A(W,"users",s);await Y(x,{role:m}),await j()}catch(x){console.error("Error updating user role:",x),o("Failed to update user role")}},N=async()=>{if(d.trim())try{l(!0),o(""),await B(d.trim(),i,(r==null?void 0:r.id)||""),alert(`Invitation sent to ${d} with ${i} role. They can now sign up with Google and will be automatically assigned the ${i} role.`),I(""),R(t.VIEWER)}catch(s){console.error("Error inviting user:",s),o("Failed to send invitation")}finally{l(!1)}},S=s=>{switch(s){case t.OWNER:return e.jsx(J,{className:"h-4 w-4 text-yellow-500"});case t.ADMIN:return e.jsx(G,{className:"h-4 w-4 text-blue-500"});case t.DESIGNER:return e.jsx(H,{className:"h-4 w-4 text-green-500"});default:return e.jsx(O,{className:"h-4 w-4 text-gray-500"})}},p=s=>{switch(s){case t.OWNER:return"bg-yellow-100 text-yellow-800";case t.ADMIN:return"bg-blue-100 text-blue-800";case t.DESIGNER:return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return u?e.jsxs("div",{className:`p-6 ${a}`,children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(O,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Invite team members and manage user roles"})]})]}),h&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-red-600",children:h})}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Invite Team Member"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",value:d,onChange:s=>I(s.target.value),placeholder:"user@example.com",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"})]}),e.jsxs($,{label:"Assign Role",value:i,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:t.VIEWER,children:"Viewer"}),e.jsx("option",{value:t.DESIGNER,children:"Designer"}),e.jsx("option",{value:t.ADMIN,children:"Admin"}),e.jsx("option",{value:t.OWNER,children:"Owner"})]}),e.jsxs(D,{onClick:N,disabled:E||!d.trim(),className:"w-full flex items-center justify-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:E?"Sending...":"Send Invitation"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Invited users can sign up with Google and will be automatically assigned the selected role."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Team Members"}),w?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600 mx-auto"})}):e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[S(s.role),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.displayName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p(s.role)}`,children:s.role}),s.id!==(r==null?void 0:r.id)&&e.jsxs($,{size:"sm",value:s.role,onChange:m=>g(s.id,m.target.value),children:[e.jsx("option",{value:t.VIEWER,children:"Viewer"}),e.jsx("option",{value:t.DESIGNER,children:"Designer"}),e.jsx("option",{value:t.ADMIN,children:"Admin"}),e.jsx("option",{value:t.OWNER,children:"Owner"})]})]})]},s.id))})]})]}):e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have permission to manage users."})]})})}function ee(){const{user:a}=k(),[r,v]=n.useState(!1),[f,M]=n.useState(null),[w,c]=n.useState(null),[d,I]=n.useState(null),i=_(),R=async()=>{try{c(null);const l=b(i,"projects"),h=await y(l);let o=0;for(const u of h.docs){const j=u.id,g=b(i,"projects",j,"items"),N=await y(g);o+=N.docs.length}return I({projects:h.docs.length,totalItems:o}),!0}catch(l){return c(`Validation failed: ${l}`),!1}},E=async()=>{if(!a){c("You must be authenticated to run migration");return}try{v(!0),c(null),console.log("üöÄ Starting migration...");const l=b(i,"projects"),h=await y(l);if(h.empty){c("No projects found to migrate");return}let o=0,u=0;for(const j of h.docs){const g=j.id,N=j.data();console.log(`Processing project: ${N.name||g}`);const S=b(i,"projects",g,"items"),p=await y(S);if(p.empty)continue;const s=10;for(let m=0;m<p.docs.length;m+=s){const x=L(i);p.docs.slice(m,m+s).forEach(V=>{const C=V.id,U=V.data(),T={...U,project_id:g,inventory_status:U.inventory_status||"available"},q=A(i,"items",C);x.set(q,T);const z=A(i,"projects",g,"items",C);x.delete(z)}),await x.commit()}o+=p.docs.length,u++}M({projectsProcessed:u,itemsMigrated:o}),console.log("‚úÖ Migration completed successfully!")}catch(l){console.error("‚ùå Migration failed:",l),c(`Migration failed: ${l}`)}finally{v(!1)}};return a?e.jsxs("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Items Migration Tool"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This tool migrates items from project subcollections to the unified items collection."}),w&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-800",children:w})}),f&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-green-800",children:["‚úÖ Migration completed successfully!",e.jsx("br",{}),"‚Ä¢ Projects processed: ",f.projectsProcessed,e.jsx("br",{}),"‚Ä¢ Items migrated: ",f.itemsMigrated]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{onClick:R,disabled:r,variant:"secondary",children:"Validate Migration"}),e.jsx(D,{onClick:E,disabled:r,variant:"primary",children:r?"Running Migration...":"Run Migration"})]}),d&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-blue-800",children:["üìä Validation Results:",e.jsx("br",{}),"‚Ä¢ Projects found: ",d.projects,e.jsx("br",{}),"‚Ä¢ Items to migrate: ",d.totalItems]})})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800",children:"You must be authenticated to run the migration."})})}function ne(){const{user:a,hasRole:r}=k();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage your account settings and preferences."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(K,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Profile"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your account settings and preferences"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Profile Information"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Display Name"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md text-sm text-gray-900",children:a==null?void 0:a.displayName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md text-sm text-gray-900",children:a==null?void 0:a.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md text-sm text-gray-900 capitalize",children:a==null?void 0:a.role}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Contact an administrator to change your role."})]})]})]})})]})}),r(t.ADMIN)&&e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx(Z,{})}),r(t.ADMIN)&&e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(X,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Data Migration"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Migrate items from project subcollections to unified collection"})]})]}),e.jsx(ee,{})]})})]})]})}export{ne as default};
//# sourceMappingURL=Settings.js.map
