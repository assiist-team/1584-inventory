{"version":3,"file":"TransactionItemsList.js","sources":["../../src/components/ui/ImageUpload.tsx","../../src/components/TransactionItemForm.tsx","../../src/components/TransactionItemsList.tsx"],"sourcesContent":["import React, { useState, useRef, useCallback } from 'react'\nimport { Upload, Image as ImageIcon, AlertCircle, ChevronDown, Trash2, Eye } from 'lucide-react'\nimport { ImageUploadService } from '@/services/imageService'\n\ninterface ImageUploadProps {\n  onImagesChange: (files: File[]) => void\n  maxImages?: number\n  acceptedTypes?: string[]\n  maxFileSize?: number // in MB\n  disabled?: boolean\n  className?: string\n}\n\ninterface PreviewImage {\n  file: File\n  previewUrl: string\n  isUploading?: boolean\n  uploadProgress?: number\n  error?: string\n}\n\nexport default function ImageUpload({\n  onImagesChange,\n  maxImages = 5,\n  acceptedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'],\n  maxFileSize = 10,\n  disabled = false,\n  className = ''\n}: ImageUploadProps) {\n  const [images, setImages] = useState<PreviewImage[]>([])\n  const [isDragOver, setIsDragOver] = useState(false)\n  const [openMenuIndex, setOpenMenuIndex] = useState<number | null>(null)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const cameraInputRef = useRef<HTMLInputElement>(null)\n  const galleryInputRef = useRef<HTMLInputElement>(null)\n\n  const validateFile = useCallback((file: File): string | null => {\n    if (!acceptedTypes.includes(file.type)) {\n      return `Invalid file type. Please upload: ${acceptedTypes.join(', ')}`\n    }\n\n    const maxSizeBytes = maxFileSize * 1024 * 1024\n    if (file.size > maxSizeBytes) {\n      return `File too large. Maximum size: ${maxFileSize}MB`\n    }\n\n    return null\n  }, [acceptedTypes, maxFileSize])\n\n  const addImages = useCallback((files: FileList | File[]) => {\n    const fileArray = Array.from(files)\n    const validFiles: File[] = []\n    const newPreviewImages: PreviewImage[] = []\n\n    fileArray.forEach(file => {\n      const error = validateFile(file)\n      if (error) {\n        newPreviewImages.push({\n          file,\n          previewUrl: '',\n          error\n        })\n      } else {\n        validFiles.push(file)\n        newPreviewImages.push({\n          file,\n          previewUrl: ImageUploadService.createPreviewUrl(file)\n        })\n      }\n    })\n\n    if (validFiles.length + images.length > maxImages) {\n      const allowedCount = maxImages - images.length\n      if (allowedCount > 0) {\n        validFiles.splice(allowedCount)\n        newPreviewImages.splice(allowedCount)\n      } else {\n        validFiles.length = 0\n        newPreviewImages.length = 0\n      }\n\n      newPreviewImages.push({\n        file: new File([], ''),\n        previewUrl: '',\n        error: `Maximum ${maxImages} images allowed. Additional images were skipped.`\n      })\n    }\n\n    setImages(prev => [...prev, ...newPreviewImages])\n    onImagesChange(validFiles)\n  }, [images.length, maxImages, validateFile, onImagesChange])\n\n  const removeImage = useCallback((index: number) => {\n    const imageToRemove = images[index]\n\n    // Clean up preview URL\n    if (imageToRemove.previewUrl) {\n      ImageUploadService.revokePreviewUrl(imageToRemove.previewUrl)\n    }\n\n    setImages(prev => prev.filter((_, i) => i !== index))\n\n    // Update parent component with remaining files\n    const remainingFiles = images\n      .filter((_, i) => i !== index)\n      .filter(img => !img.error)\n      .map(img => img.file)\n\n    onImagesChange(remainingFiles)\n  }, [images, onImagesChange])\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (files && files.length > 0) {\n      addImages(files)\n    }\n  }\n\n\n  const handleGallerySelect = async () => {\n    try {\n      const files = await ImageUploadService.selectFromGallery()\n      if (files.length > 0) {\n        addImages(files)\n      }\n    } catch (error) {\n      console.error('Error selecting from gallery:', error)\n    }\n  }\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (!disabled) {\n      setIsDragOver(true)\n    }\n  }, [disabled])\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n  }, [])\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n\n    if (disabled) return\n\n    const files = e.dataTransfer.files\n    if (files && files.length > 0) {\n      addImages(files)\n    }\n  }, [disabled, addImages])\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 Bytes'\n    const k = 1024\n    const sizes = ['Bytes', 'KB', 'MB', 'GB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return (bytes / Math.pow(k, i)).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' ' + sizes[i]\n  }\n\n  const toggleMenu = (e: React.MouseEvent, index: number) => {\n    e.stopPropagation()\n    setOpenMenuIndex(openMenuIndex === index ? null : index)\n  }\n\n  const handleMenuAction = (e: React.MouseEvent, action: string, index: number) => {\n    e.stopPropagation()\n    setOpenMenuIndex(null)\n\n    switch (action) {\n      case 'preview':\n        // Open preview in new tab or modal - for now just open in new tab\n        window.open(images[index].previewUrl, '_blank')\n        break\n      case 'delete':\n        removeImage(index)\n        break\n    }\n  }\n\n  // Close menu when clicking outside\n  React.useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (openMenuIndex !== null && !(e.target as Element).closest('.image-menu-container')) {\n        setOpenMenuIndex(null)\n      }\n    }\n\n    document.addEventListener('click', handleClickOutside)\n    return () => document.removeEventListener('click', handleClickOutside)\n  }, [openMenuIndex])\n\n  return (\n    <div className={`space-y-4 ${className}`}>\n      {/* Upload Area */}\n      <div\n        className={`relative border-2 border-dashed rounded-lg p-6 sm:p-8 text-center transition-colors touch-manipulation ${\n          isDragOver\n            ? 'border-primary-500 bg-primary-50'\n            : 'border-gray-300 hover:border-gray-400'\n        } ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n        onClick={() => !disabled && fileInputRef.current?.click()}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          multiple\n          accept={acceptedTypes.join(',')}\n          onChange={handleFileSelect}\n          disabled={disabled}\n          className=\"hidden\"\n        />\n\n        <div className=\"flex flex-col items-center space-y-2\">\n          <div className={`p-3 rounded-full ${isDragOver ? 'bg-primary-100' : 'bg-gray-100'}`}>\n            <Upload className={`h-6 w-6 ${isDragOver ? 'text-primary-600' : 'text-gray-600'}`} />\n          </div>\n\n          <div>\n            <p className=\"text-sm font-medium text-gray-900\">\n              Drop images here, or click to browse\n            </p>\n            <p className=\"text-xs text-gray-500 mt-1\">\n              Supports: JPEG, PNG, GIF, WebP (max {maxFileSize}MB each, up to {maxImages} images)\n            </p>\n          </div>\n\n          <button\n            type=\"button\"\n            onClick={(e) => {\n              e.stopPropagation()\n              handleGallerySelect()\n            }}\n            disabled={disabled}\n            className=\"inline-flex items-center justify-center px-4 py-2.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 mt-3 touch-manipulation\"\n            title=\"Add images from gallery or camera\"\n          >\n            <ImageIcon className=\"h-4 w-4 mr-2\" />\n            Add Images\n          </button>\n        </div>\n      </div>\n\n      {/* Hidden camera input */}\n      <input\n        ref={cameraInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        capture=\"environment\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      {/* Hidden gallery input */}\n      <input\n        ref={galleryInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      {/* Image Previews */}\n      {images.length > 0 && (\n        <div className=\"space-y-3\">\n          <h4 className=\"text-sm font-medium text-gray-900\">Transaction Images</h4>\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4\">\n            {images.map((image, index) => (\n              <div key={index} className=\"relative group\">\n                <div className=\"aspect-w-4 aspect-h-3 rounded-lg overflow-visible bg-gray-100\">\n                  {image.error ? (\n                    <div className=\"flex items-center justify-center h-full\">\n                      <div className=\"text-center p-4\">\n                        <AlertCircle className=\"h-8 w-8 text-red-500 mx-auto mb-2\" />\n                        <p className=\"text-xs text-red-600\">{image.error}</p>\n                      </div>\n                    </div>\n                  ) : (\n                    <>\n                      <img\n                        src={image.previewUrl}\n                        alt={image.file.name}\n                        className=\"w-full h-full object-cover\"\n                      />\n\n                      {image.isUploading && (\n                        <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center\">\n                          <div className=\"text-white text-center\">\n                            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-white mx-auto mb-2\"></div>\n                            <p className=\"text-xs\">\n                              {image.uploadProgress ? `${Math.round(image.uploadProgress)}%` : 'Uploading...'}\n                            </p>\n                          </div>\n                        </div>\n                      )}\n\n                      <div className=\"absolute top-1 right-1 image-menu-container\">\n                        <button\n                          type=\"button\"\n                          onClick={(e) => toggleMenu(e, index)}\n                          className=\"p-1.5 bg-primary-500 text-white rounded-full opacity-90 hover:opacity-100 transition-opacity\"\n                        >\n                          <ChevronDown className=\"h-3 w-3\" />\n                        </button>\n\n                        {/* Dropdown menu */}\n                        {openMenuIndex === index && (\n                          <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 w-28 bg-white rounded-md shadow-lg border border-gray-200 py-1 z-50\">\n                            <button\n                              onClick={(e) => handleMenuAction(e, 'preview', index)}\n                              className=\"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors\"\n                            >\n                              <Eye className=\"h-4 w-4 mr-2 text-gray-500\" />\n                              Open\n                            </button>\n                            <button\n                              onClick={(e) => handleMenuAction(e, 'delete', index)}\n                              className=\"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center transition-colors\"\n                            >\n                              <Trash2 className=\"h-4 w-4 mr-2 text-red-500\" />\n                              Delete\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n\n                <div className=\"mt-1\">\n                  <p className=\"text-xs text-gray-500 truncate\" title={image.file.name}>\n                    {image.file.name}\n                  </p>\n                  <p className=\"text-xs text-gray-400\">\n                    {formatFileSize(image.file.size)}\n                  </p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { X, Camera } from 'lucide-react'\nimport { TransactionItemFormData, TransactionItemValidationErrors, ItemImage } from '@/types'\nimport { ImageUploadService } from '@/services/imageService'\nimport ImagePreview from './ui/ImagePreview'\nimport { useToast } from '@/components/ui/ToastContext'\n\ninterface TransactionItemFormProps {\n  item?: TransactionItemFormData\n  onSave: (item: TransactionItemFormData) => void\n  onCancel: () => void\n  isEditing?: boolean\n  projectId?: string\n  projectName?: string\n  onImageFilesChange?: (itemId: string, imageFiles: File[]) => void\n}\n\nexport default function TransactionItemForm({ item, onSave, onCancel, isEditing = false, onImageFilesChange }: TransactionItemFormProps) {\n  const [formData, setFormData] = useState<TransactionItemFormData>(\n    item || {\n      id: `temp_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,\n      description: '',\n      sku: '',\n      price: '',\n      market_value: '',\n      notes: ''\n    }\n  )\n\n  const [itemImages, setItemImages] = useState<ItemImage[]>(item?.images || [])\n  const [imageFiles, setImageFiles] = useState<File[]>(item?.imageFiles || [])\n  const [isUploadingImage, setIsUploadingImage] = useState(false)\n\n  const [errors, setErrors] = useState<TransactionItemValidationErrors>({})\n  const { showError } = useToast()\n\n  // Update state when item prop changes (for editing existing items)\n  useEffect(() => {\n    if (item) {\n      console.log('TransactionItemForm: Editing item with images:', item.images?.length || 0, 'imageFiles:', item.imageFiles?.length || 0)\n      setItemImages(item.images || [])\n      setImageFiles(item.imageFiles || [])\n      setFormData({\n        id: item.id,\n        description: item.description,\n        sku: item.sku || '',\n        price: item.price,\n        market_value: item.market_value || '',\n        notes: item.notes || ''\n      })\n    }\n  }, [item])\n\n\n  const handleSelectFromGallery = async () => {\n    try {\n      setIsUploadingImage(true)\n      const files = await ImageUploadService.selectFromGallery()\n\n      if (files && files.length > 0) {\n        console.log('Selected', files.length, 'files from gallery')\n\n        // Store the files for later upload when the transaction is submitted\n        setImageFiles(prev => [...prev, ...files])\n\n        // Create preview image objects (without URLs until uploaded)\n        const previewImages: ItemImage[] = files.map((file, index) => ({\n          url: '', // Will be set when uploaded with final item ID\n          alt: file.name,\n          isPrimary: itemImages.length === 0 && index === 0, // First image is primary if no images exist\n          uploadedAt: new Date(),\n          fileName: file.name,\n          size: file.size,\n          mimeType: file.type\n        }))\n\n        setItemImages(prev => [...prev, ...previewImages])\n        console.log('Added', previewImages.length, 'preview images')\n      } else {\n        console.log('No files selected from gallery')\n      }\n    } catch (error: any) {\n      console.error('Error selecting from gallery:', error)\n\n      // Handle cancel/timeout gracefully - don't show error for user cancellation\n      if (error.message?.includes('timeout') || error.message?.includes('canceled')) {\n        console.log('User canceled image selection or selection timed out')\n        return\n      }\n\n      // Show error for actual failures\n      showError('Failed to select images from gallery. Please try again.')\n    } finally {\n      setIsUploadingImage(false)\n    }\n  }\n\n  const handleRemoveImage = (imageUrl: string) => {\n    const imageIndex = itemImages.findIndex(img => img.url === imageUrl)\n    if (imageIndex !== -1 && imageIndex < imageFiles.length) {\n      // Remove both the image and the corresponding file\n      setItemImages(prev => prev.filter(img => img.url !== imageUrl))\n      setImageFiles(prev => prev.filter((_, index) => index !== imageIndex))\n    }\n  }\n\n  const handleSetPrimaryImage = (imageUrl: string) => {\n    setItemImages(prev => prev.map(img => ({\n      ...img,\n      isPrimary: img.url === imageUrl\n    })))\n  }\n\n  const validateForm = (): boolean => {\n    const newErrors: TransactionItemValidationErrors = {}\n\n    if (!formData.description.trim()) {\n      newErrors.description = 'Description is required'\n    }\n\n    if (!formData.price.trim()) {\n      newErrors.price = 'Price is required'\n    } else if (isNaN(Number(formData.price)) || Number(formData.price) <= 0) {\n      newErrors.price = 'Price must be a positive number'\n    }\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  const handleSubmit = () => {\n    if (!validateForm()) return\n\n    // Include images and files in the form data\n    const itemWithImages = {\n      ...formData,\n      images: itemImages,\n      imageFiles: imageFiles // Include the actual files for upload\n    }\n\n    // Notify parent about image files if callback exists\n    if (onImageFilesChange && imageFiles.length > 0) {\n      onImageFilesChange(formData.id, imageFiles)\n    }\n\n    onSave(itemWithImages)\n  }\n\n  const handleInputChange = (field: keyof TransactionItemFormData, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }))\n\n    // Clear error when user starts typing\n    if (errors[field as keyof TransactionItemValidationErrors]) {\n      setErrors(prev => ({ ...prev, [field]: undefined } as TransactionItemValidationErrors))\n    }\n  }\n\n  return (\n    <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-medium text-gray-900\">\n          {isEditing ? 'Edit Item' : 'Add Item'}\n        </h3>\n        <button\n          onClick={onCancel}\n          className=\"text-gray-400 hover:text-gray-600\"\n          type=\"button\"\n        >\n          <X className=\"h-5 w-5\" />\n        </button>\n      </div>\n\n      <div className=\"space-y-4\">\n        {/* Description */}\n        <div>\n          <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700\">\n            Description *\n          </label>\n          <input\n            type=\"text\"\n            id=\"description\"\n            value={formData.description}\n            onChange={(e) => handleInputChange('description', e.target.value)}\n            placeholder=\"Item description\"\n            className={`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n              errors.description ? 'border-red-300' : 'border-gray-300'\n            }`}\n          />\n          {errors.description && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.description}</p>\n          )}\n        </div>\n\n        {/* SKU */}\n        <div>\n          <label htmlFor=\"sku\" className=\"block text-sm font-medium text-gray-700\">\n            SKU\n          </label>\n          <input\n            type=\"text\"\n            id=\"sku\"\n            value={formData.sku}\n            onChange={(e) => handleInputChange('sku', e.target.value)}\n            placeholder=\"Stock keeping unit\"\n            className={`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n              errors.sku ? 'border-red-300' : 'border-gray-300'\n            }`}\n          />\n          {errors.sku && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.sku}</p>\n          )}\n        </div>\n\n        {/* Price */}\n        <div>\n          <label htmlFor=\"price\" className=\"block text-sm font-medium text-gray-700\">\n            Price *\n          </label>\n          <div className=\"mt-1 relative rounded-md shadow-sm\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <span className=\"text-gray-500 sm:text-sm\">$</span>\n            </div>\n            <input\n              type=\"text\"\n              id=\"price\"\n              value={formData.price}\n              onChange={(e) => handleInputChange('price', e.target.value)}\n              placeholder=\"0.00\"\n              className={`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n                errors.price ? 'border-red-300' : 'border-gray-300'\n              }`}\n            />\n          </div>\n          {errors.price && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.price}</p>\n          )}\n        </div>\n\n        {/* Market Value */}\n        <div>\n          <label htmlFor=\"market_value\" className=\"block text-sm font-medium text-gray-700\">\n            Market Value\n          </label>\n          <div className=\"mt-1 relative rounded-md shadow-sm\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <span className=\"text-gray-500 sm:text-sm\">$</span>\n            </div>\n            <input\n              type=\"text\"\n              id=\"market_value\"\n              value={formData.market_value}\n              onChange={(e) => handleInputChange('market_value', e.target.value)}\n              placeholder=\"0.00\"\n              className={`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n                errors.market_value ? 'border-red-300' : 'border-gray-300'\n              }`}\n            />\n          </div>\n          {errors.market_value && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.market_value}</p>\n          )}\n        </div>\n\n        {/* Notes */}\n        <div>\n          <label htmlFor=\"notes\" className=\"block text-sm font-medium text-gray-700\">\n            Notes\n          </label>\n          <textarea\n            id=\"notes\"\n            rows={2}\n            value={formData.notes}\n            onChange={(e) => handleInputChange('notes', e.target.value)}\n            placeholder=\"Additional notes about this item\"\n            className={`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n              errors.notes ? 'border-red-300' : 'border-gray-300'\n            }`}\n          />\n          {errors.notes && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.notes}</p>\n          )}\n        </div>\n\n        {/* Item Images */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Item Images\n          </label>\n\n          {/* Image upload button */}\n          <button\n            type=\"button\"\n            onClick={handleSelectFromGallery}\n            disabled={isUploadingImage}\n            className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 mb-3\"\n            title=\"Add images from gallery or camera\"\n          >\n            <Camera className=\"h-4 w-4 mr-2\" />\n            {isUploadingImage ? 'Uploading...' : 'Add Images'}\n          </button>\n\n          {/* Image preview */}\n          <ImagePreview\n            images={itemImages}\n            onRemoveImage={handleRemoveImage}\n            onSetPrimary={handleSetPrimaryImage}\n            maxImages={3}\n            size=\"md\"\n          />\n        </div>\n\n        {/* Form Actions */}\n        <div className=\"flex justify-end space-x-3 pt-4\">\n          <button\n            type=\"button\"\n            onClick={(e) => {\n              e.preventDefault()\n              e.stopPropagation()\n              onCancel()\n            }}\n            className=\"px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={(e) => {\n              e.preventDefault()\n              e.stopPropagation()\n              handleSubmit()\n            }}\n            className=\"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n          >\n            {isEditing ? 'Update Item' : 'Add Item'}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { useState } from 'react'\nimport { Edit, X, Plus } from 'lucide-react'\nimport { TransactionItemFormData } from '@/types'\nimport TransactionItemForm from './TransactionItemForm'\n\ninterface TransactionItemsListProps {\n  items: TransactionItemFormData[]\n  onItemsChange: (items: TransactionItemFormData[]) => void\n  projectId?: string\n  projectName?: string\n  onImageFilesChange?: (itemId: string, imageFiles: File[]) => void\n}\n\nexport default function TransactionItemsList({ items, onItemsChange, projectId, projectName, onImageFilesChange }: TransactionItemsListProps) {\n  const [isAddingItem, setIsAddingItem] = useState(false)\n  const [editingItemId, setEditingItemId] = useState<string | null>(null)\n\n  const handleSaveItem = (item: TransactionItemFormData) => {\n    if (editingItemId) {\n      // Update existing item\n      const updatedItems = items.map(existingItem =>\n        existingItem.id === editingItemId ? item : existingItem\n      )\n      onItemsChange(updatedItems)\n    } else {\n      // Add new item\n      onItemsChange([...items, item])\n    }\n\n    // Handle image files if they exist\n    if (item.imageFiles && item.imageFiles.length > 0 && onImageFilesChange) {\n      onImageFilesChange(item.id, item.imageFiles)\n    }\n\n    setIsAddingItem(false)\n    setEditingItemId(null)\n  }\n\n  const handleCancelItem = () => {\n    setIsAddingItem(false)\n    setEditingItemId(null)\n  }\n\n  const handleEditItem = (itemId: string) => {\n    setEditingItemId(itemId)\n    setIsAddingItem(false)\n  }\n\n  const handleDeleteItem = (itemId: string) => {\n    const updatedItems = items.filter(item => item.id !== itemId)\n    onItemsChange(updatedItems)\n  }\n\n  const getItemToEdit = () => {\n    if (!editingItemId) return null\n    return items.find(item => item.id === editingItemId) || null\n  }\n\n  const formatCurrency = (amount: string) => {\n    const num = parseFloat(amount)\n    return isNaN(num) ? '$0.00' : `$${num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`\n  }\n\n  if (isAddingItem || editingItemId) {\n    const itemToEdit = getItemToEdit()\n    return (\n      <TransactionItemForm\n        item={itemToEdit || undefined}\n        onSave={handleSaveItem}\n        onCancel={handleCancelItem}\n        isEditing={!!itemToEdit}\n        projectId={projectId}\n        projectName={projectName}\n        onImageFilesChange={onImageFilesChange}\n      />\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-lg font-medium text-gray-900\">Transaction Items</h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {items.map((item, index) => (\n          <div key={item.id} className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center space-x-4 mb-2\">\n                  <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800\">\n                    Item {index + 1}\n                  </span>\n                  <span className=\"text-sm text-gray-500\">\n                    {formatCurrency(item.price)}\n                  </span>\n                </div>\n\n                <h4 className=\"text-sm font-medium text-gray-900 mb-1\">\n                  {item.description || 'No description'}\n                </h4>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\">\n                  {item.sku && (\n                    <div>\n                      <span className=\"font-medium\">SKU:</span> {item.sku}\n                    </div>\n                  )}\n                  {item.market_value && (\n                    <div>\n                      <span className=\"font-medium\">Market Value:</span> ${item.market_value}\n                    </div>\n                  )}\n                </div>\n\n                {item.notes && (\n                  <div className=\"mt-2 text-sm text-gray-600\">\n                    <span className=\"font-medium\">Notes:</span> {item.notes}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center space-x-2 ml-4\">\n                <button\n                  onClick={(e) => {\n                    e.preventDefault()\n                    e.stopPropagation()\n                    handleEditItem(item.id)\n                  }}\n                  className=\"text-primary-600 hover:text-primary-900 p-1\"\n                  title=\"Edit item\"\n                >\n                  <Edit className=\"h-4 w-4\" />\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.preventDefault()\n                    e.stopPropagation()\n                    handleDeleteItem(item.id)\n                  }}\n                  className=\"text-red-600 hover:text-red-900 p-1\"\n                  title=\"Delete item\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        {/* Add Item Button - Always visible */}\n        <div className=\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg\">\n          <button\n            onClick={() => setIsAddingItem(true)}\n            className=\"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n            title=\"Add new item\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Item\n          </button>\n        </div>\n\n        {items.length > 0 && (\n          <div className=\"flex justify-between items-center pt-4 border-t border-gray-200\">\n            <div className=\"text-sm text-gray-600\">\n              Total Items: {items.length}\n            </div>\n            <div className=\"text-lg font-semibold text-gray-900\">\n              Total: {formatCurrency(\n                items.reduce((sum, item) => sum + (parseFloat(item.price) || 0), 0).toString()\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":["ImageUpload","onImagesChange","maxImages","acceptedTypes","maxFileSize","disabled","className","images","setImages","useState","isDragOver","setIsDragOver","openMenuIndex","setOpenMenuIndex","fileInputRef","useRef","cameraInputRef","galleryInputRef","validateFile","useCallback","file","maxSizeBytes","addImages","files","fileArray","validFiles","newPreviewImages","error","ImageUploadService","allowedCount","prev","removeImage","index","imageToRemove","_","i","remainingFiles","img","handleFileSelect","e","handleGallerySelect","handleDragOver","handleDragLeave","handleDrop","formatFileSize","bytes","k","sizes","toggleMenu","handleMenuAction","action","React","handleClickOutside","jsxs","_a","jsx","Upload","ImageIcon","image","AlertCircle","Fragment","ChevronDown","Eye","Trash2","TransactionItemForm","item","onSave","onCancel","isEditing","onImageFilesChange","formData","setFormData","itemImages","setItemImages","imageFiles","setImageFiles","isUploadingImage","setIsUploadingImage","errors","setErrors","showError","useToast","useEffect","_b","handleSelectFromGallery","previewImages","handleRemoveImage","imageUrl","imageIndex","handleSetPrimaryImage","validateForm","newErrors","handleSubmit","itemWithImages","handleInputChange","field","value","X","Camera","ImagePreview","TransactionItemsList","items","onItemsChange","projectId","projectName","isAddingItem","setIsAddingItem","editingItemId","setEditingItemId","handleSaveItem","updatedItems","existingItem","handleCancelItem","handleEditItem","itemId","handleDeleteItem","getItemToEdit","formatCurrency","amount","num","itemToEdit","Edit","Plus","sum"],"mappings":"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"}