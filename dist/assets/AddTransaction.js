import{j as e,u as Re,d as Ae,l as K,f as X,C as G}from"./index.js";import{C as H}from"./ContextBackLink.js";import{u as Me}from"./useNavigationContext.js";import{u as Oe}from"./useStackedNavigate.js";import{r as m}from"./vendor.js";import{p as Ue,t as J,u as ve}from"./inventoryService.js";import{I as $}from"./imageService.js";import{I as Ie}from"./ImageUpload.js";import{T as Le}from"./TransactionItemForm.js";import{h as qe,b as we,f as ze,d as Ve,g as Be,t as Ye}from"./ui.js";import{g as We,a as Ke}from"./taxPresetsService.js";import{g as Xe}from"./vendorDefaultsService.js";import{C as Ge}from"./CategorySelect.js";import{b as He}from"./router.js";import"./supabase.js";import"./ImagePreview.js";function Je({items:c,onItemsChange:C,projectId:w,projectName:B,onImageFilesChange:l}){const[T,f]=m.useState(!1),[v,a]=m.useState(null),I=r=>{if(v){const h=c.map(y=>y.id===v?r:y);C(h)}else C([...c,r]);r.imageFiles&&r.imageFiles.length>0&&l&&l(r.id,r.imageFiles),f(!1),a(null)},p=()=>{f(!1),a(null)},D=r=>{a(r),f(!1)},N=r=>{const h=c.filter(y=>y.id!==r);C(h)},Y=()=>v&&c.find(r=>r.id===v)||null,k=r=>{const h=parseFloat(r);return isNaN(h)?"$0.00":`$${h.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`};if(T||v){const r=Y();return e.jsx(Le,{item:r||void 0,onSave:I,onCancel:p,isEditing:!!r,projectId:w,projectName:B,onImageFilesChange:l})}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transaction Items"})}),e.jsxs("div",{className:"space-y-3",children:[c.map((r,h)=>e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-2",children:[e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:["Item ",h+1]}),e.jsx("span",{className:"text-sm text-gray-500",children:k(r.projectPrice||r.purchasePrice||"")})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:r.description||"No description"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[r.sku&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"SKU:"})," ",r.sku]}),r.marketValue&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Market Value:"})," $",r.marketValue]})]}),r.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",r.notes]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:y=>{y.preventDefault(),y.stopPropagation(),D(r.id)},className:"text-primary-600 hover:text-primary-900 p-1",title:"Edit item",children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:y=>{y.preventDefault(),y.stopPropagation(),N(r.id)},className:"text-red-600 hover:text-red-900 p-1",title:"Delete item",children:e.jsx(we,{className:"h-4 w-4"})})]})]})},r.id)),e.jsx("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",title:"Add new item",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),c.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Total Items: ",c.length]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["Total: ",k(c.reduce((r,h)=>r+(parseFloat(h.projectPrice||h.purchasePrice||"0")||0),0).toString())]})]})]})]})}function ht(){const{id:c}=He(),C=Oe(),{user:w,isOwner:B}=Re(),{currentAccountId:l}=Ae(),{getBackDestination:T}=Me();if(!l&&!B())return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-red-100",children:e.jsx(Ve,{className:"h-6 w-6 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to add transactions. Please contact an administrator if you need access."}),e.jsx(H,{fallback:T(`/project/${c}`),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Project"})]})});const[f,v]=m.useState("");m.useEffect(()=>{(async()=>{if(c&&l)try{const s=await Ue.getProject(l,c);s&&v(s.name)}catch(s){console.error("Failed to fetch project:",s)}})()},[c,l]),m.useEffect(()=>{if(!l)return;(async()=>{try{const s=await We(l);s&&I(u=>({...u,categoryId:s}))}catch(s){console.error("Error loading account default category:",s)}})()},[l]);const[a,I]=m.useState({transactionDate:(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`})(),source:"",transactionType:"Purchase",paymentMethod:"",amount:"",categoryId:"",notes:"",status:"completed",reimbursementType:"",triggerEvent:"Manual",transactionImages:[],receiptImages:[],otherImages:[],items:[]}),[p,D]=m.useState(void 0),[N,Y]=m.useState(""),[k,r]=m.useState([]),[h,y]=m.useState(void 0),[P,Q]=m.useState([]),[Z,ke]=m.useState(new Map),[ee,R]=m.useState(!1),[A,te]=m.useState([]);m.useEffect(()=>{(async()=>{if(l)try{const s=await Xe(l);te(s)}catch(s){console.error("Error loading vendor defaults:",s),te([])}})()},[l]),m.useEffect(()=>{a.source&&!A.includes(a.source)?R(!0):a.source&&A.includes(a.source)&&R(!1)},[a.source,A]),m.useEffect(()=>{(async()=>{if(l)try{const s=await Ke(l);r(s)}catch(s){console.error("Error loading tax presets:",s)}})()},[l]),m.useEffect(()=>{if(p&&p!=="Other"){const t=k.find(s=>s.id===p);y(t==null?void 0:t.rate)}else y(void 0)},[p,k]);const[o,b]=m.useState({}),[M,O]=m.useState(!1),[U,S]=m.useState(!1),Se=()=>{var s;const t={};return a.source.trim()||(t.source="Source is required"),(s=a.categoryId)!=null&&s.trim()||(t.categoryId="Budget category is required"),a.amount.trim()?(isNaN(Number(a.amount))||Number(a.amount)<=0)&&(t.amount="Amount must be a positive number"):t.amount="Amount is required",p==="Other"&&(!N.trim()||isNaN(Number(N))||Number(N)<=0?t.general="Subtotal must be provided and greater than 0 when Tax Rate Preset is Other.":Number(a.amount)<Number(N)&&(t.general="Subtotal cannot exceed the total amount.")),b(t),Object.keys(t).length===0},Ce=async t=>{var s,u,j,ae,re,oe,ne,ie,ce,le,me,de,ue,ge,xe,pe,he,ye;if(t.preventDefault(),!(!Se()||!c||!l)){O(!0);try{const{transactionImages:L,receiptImages:Qe,otherImages:Ze,...Ee}=a;if(!(w!=null&&w.id))throw new Error("User must be authenticated to create transactions");const q={...Ee,projectId:c,projectName:f,createdBy:w.id,taxRatePreset:p,receiptEmailed:a.receiptEmailed??!1,subtotal:p==="Other"?N:""};console.log("Attempting to create transaction with data:",q),console.log("Transaction date value:",q.transactionDate),console.log("Transaction date type:",typeof q.transactionDate),console.log("Transaction items:",P);const _=await J.createTransaction(l,c,q,P);if(a.receiptImages&&a.receiptImages.length>0){S(!0);try{const i=await $.uploadMultipleReceiptImages(a.receiptImages,f,_,se),n=$.convertFilesToReceiptImages(i);if(console.log("Receipt images uploaded successfully:",n.length,"images"),console.log("Receipt images to save:",n),n&&n.length>0){console.log("Updating transaction with receipt images...");try{await J.updateTransaction(l,c,_,{receiptImages:n}),console.log("Transaction updated successfully with receipt images")}catch(x){console.error("Failed to update transaction with receipt images:",x)}}await new Promise(x=>setTimeout(x,500))}catch(i){console.error("Error uploading receipt images:",i);let n="Failed to upload receipt images. Please try again.";(s=i.message)!=null&&s.includes("Storage service is not available")?n="Storage service is unavailable. Please check your internet connection.":(u=i.message)!=null&&u.includes("Network error")||(j=i.message)!=null&&j.includes("offline")?n="Network connection issue. Please check your internet and try again.":(ae=i.message)!=null&&ae.includes("quota exceeded")?n="Storage quota exceeded. Please contact support.":(re=i.message)!=null&&re.includes("Unauthorized")?n="Permission denied. Please check your account permissions.":((oe=i.message)!=null&&oe.includes("CORS")||(ne=i.message)!=null&&ne.includes("Access-Control")||(ie=i.message)!=null&&ie.includes("ERR_FAILED")||(ce=i.message)!=null&&ce.includes("preflight"))&&(n="Upload blocked by browser security policy. Please check Supabase Storage configuration or try refreshing the page."),b({receiptImages:n}),O(!1),S(!1);return}S(!1)}if(a.otherImages&&a.otherImages.length>0){S(!0);try{const i=await $.uploadMultipleOtherImages(a.otherImages,f,_,se),n=$.convertFilesToOtherImages(i);if(console.log("Other images uploaded successfully:",n.length,"images"),console.log("Other images to save:",n),n&&n.length>0){console.log("Updating transaction with other images...");try{await J.updateTransaction(l,c,_,{otherImages:n}),console.log("Transaction updated successfully with other images")}catch(x){console.error("Failed to update transaction with other images:",x)}}await new Promise(x=>setTimeout(x,500))}catch(i){console.error("Error uploading other images:",i);let n="Failed to upload other images. Please try again.";(le=i.message)!=null&&le.includes("Storage service is not available")?n="Storage service is unavailable. Please check your internet connection.":(me=i.message)!=null&&me.includes("Network error")||(de=i.message)!=null&&de.includes("offline")?n="Network connection issue. Please check your internet and try again.":(ue=i.message)!=null&&ue.includes("quota exceeded")?n="Storage quota exceeded. Please contact support.":(ge=i.message)!=null&&ge.includes("Unauthorized")?n="Permission denied. Please check your account permissions.":((xe=i.message)!=null&&xe.includes("CORS")||(pe=i.message)!=null&&pe.includes("Access-Control")||(he=i.message)!=null&&he.includes("ERR_FAILED")||(ye=i.message)!=null&&ye.includes("preflight"))&&(n="Upload blocked by browser security policy. Please check Supabase Storage configuration or try refreshing the page."),b({otherImages:n}),O(!1),S(!1);return}S(!1)}if(Z.size>0)try{console.log("Starting image upload process...");const n=(await ve.getItemsForTransaction(l,c,_)).map(x=>x.itemId);console.log("Created item IDs:",n);for(let x=0;x<P.length&&x<n.length;x++){const fe=P[x],z=n[x],E=Z.get(fe.id);if(E&&E.length>0){console.log(`Uploading ${E.length} images for item ${z}`);const Fe=E.map(async(g,$e)=>{var be,je;try{console.log(`Uploading file ${$e+1}/${E.length}: ${g.name}`);const F=await $.uploadItemImage(g,f,z);console.log(`Upload successful for ${g.name}:`,F),console.log(`Upload result URL: ${F.url}`);const Ne={url:F.url,alt:g.name,isPrimary:((je=(be=fe.images)==null?void 0:be.find(De=>De.fileName===g.name))==null?void 0:je.isPrimary)||!1,uploadedAt:new Date,fileName:g.name,size:g.size,mimeType:g.type};return console.log("Created ItemImage object:",Ne),Ne}catch(F){return console.error(`Failed to upload ${g.name}:`,F),{url:"",alt:g.name,isPrimary:!1,uploadedAt:new Date,fileName:g.name,size:g.size,mimeType:g.type}}}),W=await Promise.all(Fe);console.log("All uploads completed, updating item with images:",W);const V=W.filter(g=>g.url&&g.url.trim()!=="");console.log(`Valid images to save: ${V.length}/${W.length}`),V.length>0&&(await ve.updateItem(l,z,{images:V}),console.log(`Successfully updated item ${z} with ${V.length} images`))}}}catch(i){console.error("Error in image upload process:",i)}C(`/project/${c}?tab=transactions`)}catch(L){console.error("Error creating transaction:",L),b({general:L instanceof Error?L.message:"Failed to create transaction. Please try again."})}finally{O(!1)}}},d=(t,s)=>{if(t==="categoryId"){I(u=>({...u,categoryId:s})),o.categoryId&&b(u=>({...u,categoryId:void 0}));return}I(u=>({...u,[t]:s})),o[t]&&b(u=>({...u,[t]:void 0}))},Te=t=>{I(s=>({...s,receiptImages:t})),o.receiptImages&&b(s=>({...s,receiptImages:void 0}))},Pe=t=>{I(s=>({...s,otherImages:t})),o.otherImages&&b(s=>({...s,otherImages:void 0}))},_e=(t,s)=>{ke(u=>{const j=new Map(u);return j.set(t,s),j}),Q(u=>u.map(j=>j.id===t?{...j,imageFiles:s}:j))},se=(t,s)=>{console.log(`Upload progress for file ${t}: ${s.percentage}%`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(H,{fallback:T(`/project/${c}?tab=transactions`),className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Add Transaction"})}),e.jsxs("form",{onSubmit:Ce,className:"space-y-8 p-8",children:[o.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:o.general})})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Source *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:A.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:t,checked:a.source===t,onChange:s=>{d("source",s.target.value),R(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:ee,onChange:()=>{R(!0),d("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),ee&&e.jsx("input",{type:"text",id:"source_custom_input",value:a.source,onChange:t=>d("source",t.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.source?"border-red-300":"border-gray-300"}`}),o.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.source})]}),e.jsx("div",{children:e.jsx(Ge,{value:a.categoryId,onChange:t=>{d("categoryId",t)},label:"Budget Category",error:o.categoryId,required:!0})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Type"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_purchase",name:"transactionType",value:"Purchase",checked:a.transactionType==="Purchase",onChange:t=>d("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_purchase",className:"ml-2 block text-sm text-gray-900",children:"Purchase"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_return",name:"transactionType",value:"Return",checked:a.transactionType==="Return",onChange:t=>d("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_return",className:"ml-2 block text-sm text-gray-900",children:"Return"})]})]}),o.transactionType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.transactionType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Method"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"method_client_card",name:"paymentMethod",value:"Client Card",checked:a.paymentMethod==="Client Card",onChange:t=>d("paymentMethod",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"method_client_card",className:"ml-2 block text-sm text-gray-900",children:"Client Card"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"method_1584_card",name:"paymentMethod",value:K,checked:a.paymentMethod===K,onChange:t=>d("paymentMethod",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"method_1584_card",className:"ml-2 block text-sm text-gray-900",children:K})]})]}),o.paymentMethod&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.paymentMethod})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Reimbursement Type"}),e.jsx("p",{className:"mb-3 text-xs text-gray-500",children:"Flags transactions that require reimbursement"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_none",name:"reimbursementType",value:"",checked:!a.reimbursementType,onChange:t=>d("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_none",className:"ml-2 block text-sm text-gray-900",children:"None"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_client_owes",name:"reimbursementType",value:X,checked:a.reimbursementType===X,onChange:t=>d("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_client_owes",className:"ml-2 block text-sm text-gray-900",children:X})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_we_owe",name:"reimbursementType",value:G,checked:a.reimbursementType===G,onChange:t=>d("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_we_owe",className:"ml-2 block text-sm text-gray-900",children:G})]})]}),o.reimbursementType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.reimbursementType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Receipt Email Copy"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_yes",name:"receiptEmailed",checked:a.receiptEmailed===!0,onChange:()=>d("receiptEmailed",!0),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_yes",className:"ml-2 block text-sm text-gray-900",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_no",name:"receiptEmailed",checked:a.receiptEmailed===!1,onChange:()=>d("receiptEmailed",!1),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_no",className:"ml-2 block text-sm text-gray-900",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"amount",value:a.amount,onChange:t=>d("amount",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.amount?"border-red-300":"border-gray-300"}`})]}),o.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tax Rate Preset"}),e.jsxs("div",{className:"space-y-2",children:[k.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`tax_preset_${t.id}`,name:"taxRatePreset",value:t.id,checked:p===t.id,onChange:s=>D(s.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsxs("label",{htmlFor:`tax_preset_${t.id}`,className:"ml-2 block text-sm text-gray-900",children:[t.name," (",t.rate.toFixed(2),"%)"]})]},t.id)),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"tax_preset_other",name:"tax_rate_preset",value:"Other",checked:p==="Other",onChange:t=>D(t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"tax_preset_other",className:"ml-2 block text-sm text-gray-900",children:"Other"})]})]}),p&&p!=="Other"&&h!==void 0&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Tax Rate:"})," ",h.toFixed(2),"%"]})})]}),p==="Other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subtotal"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"subtotal",value:N,onChange:t=>Y(t.target.value),placeholder:"0.00",className:"block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 border-gray-300"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This will be used to calculate the tax rate."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transactionDate",className:"block text-sm font-medium text-gray-700",children:"Transaction Date"}),e.jsx("input",{type:"date",id:"transactionDate",value:a.transactionDate,onChange:t=>{d("transactionDate",t.target.value)},className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.transactionDate?"border-red-300":"border-gray-300"}`}),o.transactionDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.transactionDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:a.notes,onChange:t=>d("notes",t.target.value),placeholder:"Additional notes about this transaction...",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.notes?"border-red-300":"border-gray-300"}`}),o.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.notes})]}),e.jsxs("div",{children:[e.jsx(Je,{items:P,onItemsChange:t=>{Q(t),o.items&&t.length>0&&b(s=>({...s,items:void 0}))},projectId:c,projectName:f,onImageFilesChange:_e}),o.items&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.items})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Receipt Images"}),e.jsx(Ie,{onImagesChange:Te,maxImages:5,maxFileSize:10,disabled:M||U,className:"mb-2"}),o.receiptImages&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.receiptImages})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Other Images"}),e.jsx(Ie,{onImagesChange:Pe,maxImages:5,maxFileSize:10,disabled:M||U,className:"mb-2"}),o.otherImages&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.otherImages})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsxs(H,{fallback:T(`/project/${c}?tab=transactions`),className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:M||U,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),M?"Creating...":U?"Uploading Images...":"Create Transaction"]})]})]})]})]})}export{ht as default};
//# sourceMappingURL=AddTransaction.js.map
