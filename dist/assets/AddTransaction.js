import{j as e,u as Re,d as $e,m as K,f as V,C as W}from"./index.js";import{c as De,b as Ae,L as X}from"./router.js";import{r as m}from"./vendor.js";import{T as G}from"./transactionSources.js";import{p as Me,t as H,u as je}from"./inventoryService.js";import{I as P}from"./imageService.js";import{I as Ne}from"./ImageUpload.js";import{T as Oe}from"./TransactionItemForm.js";import{h as Ue,b as ve,f as Le,d as qe,g as ze,t as Ye}from"./ui.js";import{g as Be}from"./taxPresetsService.js";import"./supabase.js";import"./ImagePreview.js";function Ke({items:o,onItemsChange:k,projectId:w,projectName:z,onImageFilesChange:d}){const[N,I]=m.useState(!1),[s,v]=m.useState(null),h=r=>{if(s){const p=o.map(u=>u.id===s?r:u);k(p)}else k([...o,r]);r.imageFiles&&r.imageFiles.length>0&&d&&d(r.id,r.imageFiles),I(!1),v(null)},E=()=>{I(!1),v(null)},f=r=>{v(r),I(!1)},Y=r=>{const p=o.filter(u=>u.id!==r);k(p)},_=()=>s&&o.find(r=>r.id===s)||null,R=r=>{const p=parseFloat(r);return isNaN(p)?"$0.00":`$${p.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`};if(N||s){const r=_();return e.jsx(Oe,{item:r||void 0,onSave:h,onCancel:E,isEditing:!!r,projectId:w,projectName:z,onImageFilesChange:d})}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transaction Items"})}),e.jsxs("div",{className:"space-y-3",children:[o.map((r,p)=>e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-2",children:[e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:["Item ",p+1]}),e.jsx("span",{className:"text-sm text-gray-500",children:R(r.projectPrice||r.purchasePrice||"")})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:r.description||"No description"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[r.sku&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"SKU:"})," ",r.sku]}),r.marketValue&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Market Value:"})," $",r.marketValue]})]}),r.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",r.notes]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),f(r.id)},className:"text-primary-600 hover:text-primary-900 p-1",title:"Edit item",children:e.jsx(Ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),Y(r.id)},className:"text-red-600 hover:text-red-900 p-1",title:"Delete item",children:e.jsx(ve,{className:"h-4 w-4"})})]})]})},r.id)),e.jsx("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsxs("button",{onClick:()=>I(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",title:"Add new item",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),o.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Total Items: ",o.length]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["Total: ",R(o.reduce((r,p)=>r+(parseFloat(p.projectPrice||p.purchasePrice||"0")||0),0).toString())]})]})]})]})}function nt(){const{id:o}=De(),k=Ae(),{user:w,isOwner:z}=Re(),{currentAccountId:d}=$e();if(!d&&!z())return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-red-100",children:e.jsx(qe,{className:"h-6 w-6 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to add transactions. Please contact an administrator if you need access."}),e.jsx(X,{to:`/project/${o}`,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Project"})]})});const[N,I]=m.useState("");m.useEffect(()=>{(async()=>{if(o&&d)try{const a=await Me.getProject(d,o);a&&I(a.name)}catch(a){console.error("Failed to fetch project:",a)}})()},[o,d]);const[s,v]=m.useState({transactionDate:(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`})(),source:"",transactionType:"Purchase",paymentMethod:"",amount:"",budgetCategory:"Furnishings",notes:"",status:"completed",reimbursementType:"",triggerEvent:"Manual",transactionImages:[],receiptImages:[],otherImages:[],items:[]}),[h,E]=m.useState(void 0),[f,Y]=m.useState(""),[_,R]=m.useState([]),[r,p]=m.useState(void 0),[u,J]=m.useState([]),[Q,we]=m.useState(new Map),[Z,$]=m.useState(!1);m.useEffect(()=>{s.source&&!G.includes(s.source)?$(!0):s.source&&G.includes(s.source)&&$(!1)},[s.source]),m.useEffect(()=>{(async()=>{if(d)try{const a=await Be(d);R(a)}catch(a){console.error("Error loading tax presets:",a)}})()},[d]),m.useEffect(()=>{if(h&&h!=="Other"){const t=_.find(a=>a.id===h);p(t==null?void 0:t.rate)}else p(void 0)},[h,_]);const[i,j]=m.useState({}),[D,A]=m.useState(!1),[M,C]=m.useState(!1),Ie=()=>{var a;const t={};return s.source.trim()||(t.source="Source is required"),(a=s.budgetCategory)!=null&&a.trim()||(t.budgetCategory="Budget category is required"),s.amount.trim()?(isNaN(Number(s.amount))||Number(s.amount)<=0)&&(t.amount="Amount must be a positive number"):t.amount="Amount is required",h==="Other"&&(!f.trim()||isNaN(Number(f))||Number(f)<=0?t.general="Subtotal must be provided and greater than 0 when Tax Rate Preset is Other.":Number(s.amount)<Number(f)&&(t.general="Subtotal cannot exceed the total amount.")),j(t),Object.keys(t).length===0},Ce=async t=>{var a,y,b,te,se,ae,re,ie,ne,le,oe,ce,me,de,ue,ge,xe,he;if(t.preventDefault(),!(!Ie()||!o||!d)){A(!0);try{const{transactionImages:O,receiptImages:Ve,otherImages:We,...Te}=s;if(!(w!=null&&w.id))throw new Error("User must be authenticated to create transactions");const U={...Te,projectId:o,projectName:N,createdBy:w.id,taxRatePreset:h,receiptEmailed:s.receiptEmailed??!1,subtotal:h==="Other"?f:""};console.log("Attempting to create transaction with data:",U),console.log("Transaction date value:",U.transactionDate),console.log("Transaction date type:",typeof U.transactionDate),console.log("Transaction items:",u);const S=await H.createTransaction(d,o,U,u);if(s.receiptImages&&s.receiptImages.length>0){C(!0);try{const l=await P.uploadMultipleReceiptImages(s.receiptImages,N,S,ee),n=P.convertFilesToReceiptImages(l);if(console.log("Receipt images uploaded successfully:",n.length,"images"),console.log("Receipt images to save:",n),n&&n.length>0){console.log("Updating transaction with receipt images...");try{await H.updateTransaction(d,o,S,{receiptImages:n}),console.log("Transaction updated successfully with receipt images")}catch(x){console.error("Failed to update transaction with receipt images:",x)}}await new Promise(x=>setTimeout(x,500))}catch(l){console.error("Error uploading receipt images:",l);let n="Failed to upload receipt images. Please try again.";(a=l.message)!=null&&a.includes("Storage service is not available")?n="Storage service is unavailable. Please check your internet connection.":(y=l.message)!=null&&y.includes("Network error")||(b=l.message)!=null&&b.includes("offline")?n="Network connection issue. Please check your internet and try again.":(te=l.message)!=null&&te.includes("quota exceeded")?n="Storage quota exceeded. Please contact support.":(se=l.message)!=null&&se.includes("Unauthorized")?n="Permission denied. Please check your account permissions.":((ae=l.message)!=null&&ae.includes("CORS")||(re=l.message)!=null&&re.includes("Access-Control")||(ie=l.message)!=null&&ie.includes("ERR_FAILED")||(ne=l.message)!=null&&ne.includes("preflight"))&&(n="Upload blocked by browser security policy. Please check Supabase Storage configuration or try refreshing the page."),j({receiptImages:n}),A(!1),C(!1);return}C(!1)}if(s.otherImages&&s.otherImages.length>0){C(!0);try{const l=await P.uploadMultipleOtherImages(s.otherImages,N,S,ee),n=P.convertFilesToOtherImages(l);if(console.log("Other images uploaded successfully:",n.length,"images"),console.log("Other images to save:",n),n&&n.length>0){console.log("Updating transaction with other images...");try{await H.updateTransaction(d,o,S,{otherImages:n}),console.log("Transaction updated successfully with other images")}catch(x){console.error("Failed to update transaction with other images:",x)}}await new Promise(x=>setTimeout(x,500))}catch(l){console.error("Error uploading other images:",l);let n="Failed to upload other images. Please try again.";(le=l.message)!=null&&le.includes("Storage service is not available")?n="Storage service is unavailable. Please check your internet connection.":(oe=l.message)!=null&&oe.includes("Network error")||(ce=l.message)!=null&&ce.includes("offline")?n="Network connection issue. Please check your internet and try again.":(me=l.message)!=null&&me.includes("quota exceeded")?n="Storage quota exceeded. Please contact support.":(de=l.message)!=null&&de.includes("Unauthorized")?n="Permission denied. Please check your account permissions.":((ue=l.message)!=null&&ue.includes("CORS")||(ge=l.message)!=null&&ge.includes("Access-Control")||(xe=l.message)!=null&&xe.includes("ERR_FAILED")||(he=l.message)!=null&&he.includes("preflight"))&&(n="Upload blocked by browser security policy. Please check Supabase Storage configuration or try refreshing the page."),j({otherImages:n}),A(!1),C(!1);return}C(!1)}if(Q.size>0)try{console.log("Starting image upload process...");const n=(await je.getItemsForTransaction(d,o,S)).map(x=>x.itemId);console.log("Created item IDs:",n);for(let x=0;x<u.length&&x<n.length;x++){const pe=u[x],L=n[x],T=Q.get(pe.id);if(T&&T.length>0){console.log(`Uploading ${T.length} images for item ${L}`);const Fe=T.map(async(g,Pe)=>{var ye,be;try{console.log(`Uploading file ${Pe+1}/${T.length}: ${g.name}`);const F=await P.uploadItemImage(g,N,L);console.log(`Upload successful for ${g.name}:`,F),console.log(`Upload result URL: ${F.url}`);const fe={url:F.url,alt:g.name,isPrimary:((be=(ye=pe.images)==null?void 0:ye.find(Ee=>Ee.fileName===g.name))==null?void 0:be.isPrimary)||!1,uploadedAt:new Date,fileName:g.name,size:g.size,mimeType:g.type};return console.log("Created ItemImage object:",fe),fe}catch(F){return console.error(`Failed to upload ${g.name}:`,F),{url:"",alt:g.name,isPrimary:!1,uploadedAt:new Date,fileName:g.name,size:g.size,mimeType:g.type}}}),B=await Promise.all(Fe);console.log("All uploads completed, updating item with images:",B);const q=B.filter(g=>g.url&&g.url.trim()!=="");console.log(`Valid images to save: ${q.length}/${B.length}`),q.length>0&&(await je.updateItem(d,L,{images:q}),console.log(`Successfully updated item ${L} with ${q.length} images`))}}}catch(l){console.error("Error in image upload process:",l)}k(`/project/${o}?tab=transactions`)}catch(O){console.error("Error creating transaction:",O),j({general:O instanceof Error?O.message:"Failed to create transaction. Please try again."})}finally{A(!1)}}},c=(t,a)=>{v(y=>({...y,[t]:a})),i[t]&&j(y=>({...y,[t]:void 0}))},ke=t=>{v(a=>({...a,receiptImages:t})),i.receiptImages&&j(a=>({...a,receiptImages:void 0}))},_e=t=>{v(a=>({...a,otherImages:t})),i.otherImages&&j(a=>({...a,otherImages:void 0}))},Se=(t,a)=>{we(y=>{const b=new Map(y);return b.set(t,a),b}),J(y=>y.map(b=>b.id===t?{...b,imageFiles:a}:b))},ee=(t,a)=>{console.log(`Upload progress for file ${t}: ${a.percentage}%`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(X,{to:`/project/${o}?tab=transactions`,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Add Transaction"})}),e.jsxs("form",{onSubmit:Ce,className:"space-y-8 p-8",children:[i.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:i.general})})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Source *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:G.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,name:"source",value:t,checked:s.source===t,onChange:a=>{c("source",a.target.value),$(!1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:`source_${t.toLowerCase().replace(/\s+/g,"_")}`,className:"ml-2 block text-sm text-gray-900",children:t})]},t))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"source_custom",name:"source",value:"custom",checked:Z,onChange:()=>{$(!0),c("source","")},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"source_custom",className:"ml-2 block text-sm text-gray-900",children:"Other"})]}),Z&&e.jsx("input",{type:"text",id:"source_custom_input",value:s.source,onChange:t=>c("source",t.target.value),placeholder:"Enter custom source...",className:`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.source?"border-red-300":"border-gray-300"}`}),i.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.source})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Budget Category *"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_design_fee",name:"budgetCategory",value:"Design Fee",checked:s.budgetCategory==="Design Fee",onChange:t=>c("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_design_fee",className:"ml-2 block text-sm text-gray-900",children:"Design Fee"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_furnishings",name:"budgetCategory",value:"Furnishings",checked:s.budgetCategory==="Furnishings",onChange:t=>c("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_furnishings",className:"ml-2 block text-sm text-gray-900",children:"Furnishings"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_property_management",name:"budgetCategory",value:"Property Management",checked:s.budgetCategory==="Property Management",onChange:t=>c("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_property_management",className:"ml-2 block text-sm text-gray-900",children:"Property Management"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_kitchen",name:"budgetCategory",value:"Kitchen",checked:s.budgetCategory==="Kitchen",onChange:t=>c("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_kitchen",className:"ml-2 block text-sm text-gray-900",children:"Kitchen"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_install",name:"budgetCategory",value:"Install",checked:s.budgetCategory==="Install",onChange:t=>c("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_install",className:"ml-2 block text-sm text-gray-900",children:"Install"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_storage_receiving",name:"budgetCategory",value:"Storage & Receiving",checked:s.budgetCategory==="Storage & Receiving",onChange:t=>c("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_storage_receiving",className:"ml-2 block text-sm text-gray-900",children:"Storage & Receiving"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"budget_fuel",name:"budgetCategory",value:"Fuel",checked:s.budgetCategory==="Fuel",onChange:t=>c("budgetCategory",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"budget_fuel",className:"ml-2 block text-sm text-gray-900",children:"Fuel"})]})]}),i.budgetCategory&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.budgetCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Type"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_purchase",name:"transactionType",value:"Purchase",checked:s.transactionType==="Purchase",onChange:t=>c("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_purchase",className:"ml-2 block text-sm text-gray-900",children:"Purchase"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"type_return",name:"transactionType",value:"Return",checked:s.transactionType==="Return",onChange:t=>c("transactionType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"type_return",className:"ml-2 block text-sm text-gray-900",children:"Return"})]})]}),i.transactionType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.transactionType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transaction Method"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"method_client_card",name:"paymentMethod",value:"Client Card",checked:s.paymentMethod==="Client Card",onChange:t=>c("paymentMethod",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"method_client_card",className:"ml-2 block text-sm text-gray-900",children:"Client Card"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"method_1584_card",name:"paymentMethod",value:K,checked:s.paymentMethod===K,onChange:t=>c("paymentMethod",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"method_1584_card",className:"ml-2 block text-sm text-gray-900",children:K})]})]}),i.paymentMethod&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.paymentMethod})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Reimbursement Type"}),e.jsx("p",{className:"mb-3 text-xs text-gray-500",children:"Flags transactions that require reimbursement"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_none",name:"reimbursementType",value:"",checked:!s.reimbursementType,onChange:t=>c("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_none",className:"ml-2 block text-sm text-gray-900",children:"None"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_client_owes",name:"reimbursementType",value:V,checked:s.reimbursementType===V,onChange:t=>c("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_client_owes",className:"ml-2 block text-sm text-gray-900",children:V})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"reimbursement_we_owe",name:"reimbursementType",value:W,checked:s.reimbursementType===W,onChange:t=>c("reimbursementType",t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"reimbursement_we_owe",className:"ml-2 block text-sm text-gray-900",children:W})]})]}),i.reimbursementType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.reimbursementType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Receipt Email Copy"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_yes",name:"receiptEmailed",checked:s.receiptEmailed===!0,onChange:()=>c("receiptEmailed",!0),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_yes",className:"ml-2 block text-sm text-gray-900",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"receipt_no",name:"receiptEmailed",checked:s.receiptEmailed===!1,onChange:()=>c("receiptEmailed",!1),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"receipt_no",className:"ml-2 block text-sm text-gray-900",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"amount",value:s.amount,onChange:t=>c("amount",t.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.amount?"border-red-300":"border-gray-300"}`})]}),i.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tax Rate Preset"}),e.jsxs("div",{className:"space-y-2",children:[_.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`tax_preset_${t.id}`,name:"taxRatePreset",value:t.id,checked:h===t.id,onChange:a=>E(a.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsxs("label",{htmlFor:`tax_preset_${t.id}`,className:"ml-2 block text-sm text-gray-900",children:[t.name," (",t.rate.toFixed(2),"%)"]})]},t.id)),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:"tax_preset_other",name:"tax_rate_preset",value:"Other",checked:h==="Other",onChange:t=>E(t.target.value),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300"}),e.jsx("label",{htmlFor:"tax_preset_other",className:"ml-2 block text-sm text-gray-900",children:"Other"})]})]}),h&&h!=="Other"&&r!==void 0&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Tax Rate:"})," ",r.toFixed(2),"%"]})})]}),h==="Other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subtotal"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"text",id:"subtotal",value:f,onChange:t=>Y(t.target.value),placeholder:"0.00",className:"block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 border-gray-300"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This will be used to calculate the tax rate."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transactionDate",className:"block text-sm font-medium text-gray-700",children:"Transaction Date"}),e.jsx("input",{type:"date",id:"transactionDate",value:s.transactionDate,onChange:t=>{c("transactionDate",t.target.value)},className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.transactionDate?"border-red-300":"border-gray-300"}`}),i.transactionDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.transactionDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:s.notes,onChange:t=>c("notes",t.target.value),placeholder:"Additional notes about this transaction...",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${i.notes?"border-red-300":"border-gray-300"}`}),i.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.notes})]}),e.jsxs("div",{children:[e.jsx(Ke,{items:u,onItemsChange:t=>{J(t),i.items&&t.length>0&&j(a=>({...a,items:void 0}))},projectId:o,projectName:N,onImageFilesChange:Se}),i.items&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.items})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Receipt Images"}),e.jsx(Ne,{onImagesChange:ke,maxImages:5,maxFileSize:10,disabled:D||M,className:"mb-2"}),i.receiptImages&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.receiptImages})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Other Images"}),e.jsx(Ne,{onImagesChange:_e,maxImages:5,maxFileSize:10,disabled:D||M,className:"mb-2"}),i.otherImages&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.otherImages})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsxs(X,{to:`/project/${o}?tab=transactions`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:D||M,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),D?"Creating...":M?"Uploading Images...":"Create Transaction"]})]})]})]})]})}export{nt as default};
//# sourceMappingURL=AddTransaction.js.map
