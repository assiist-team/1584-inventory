{"version":3,"file":"EditTransaction.js","sources":["../../src/pages/EditTransaction.tsx"],"sourcesContent":["import { ArrowLeft, Save, X } from 'lucide-react'\nimport { useParams, useLocation } from 'react-router-dom'\nimport { useStackedNavigate } from '@/hooks/useStackedNavigate'\nimport { useNavigationStack } from '@/contexts/NavigationStackContext'\nimport { useState, useEffect, useRef, FormEvent } from 'react'\nimport { TransactionFormData, TransactionValidationErrors, TransactionImage, TransactionItemFormData, TaxPreset } from '@/types'\nimport { COMPANY_NAME, CLIENT_OWES_COMPANY, COMPANY_OWES_CLIENT } from '@/constants/company'\nimport { transactionService, projectService, unifiedItemsService } from '@/services/inventoryService'\nimport { ImageUploadService, UploadProgress } from '@/services/imageService'\nimport ImageUpload from '@/components/ui/ImageUpload'\nimport { useAuth } from '../contexts/AuthContext'\nimport ContextLink from '@/components/ContextLink'\nimport { useNavigationContext } from '@/hooks/useNavigationContext'\nimport { useAccount } from '../contexts/AccountContext'\nimport { UserRole } from '../types'\nimport { Shield } from 'lucide-react'\nimport { toDateOnlyString } from '@/utils/dateUtils'\nimport { getTaxPresets } from '@/services/taxPresetsService'\nimport { getAvailableVendors } from '@/services/vendorDefaultsService'\nimport CategorySelect from '@/components/CategorySelect'\n\nexport default function EditTransaction() {\n  const { id: projectId, transactionId } = useParams<{ id: string; transactionId: string }>()\n  const navigate = useStackedNavigate()\n  const navigationStack = useNavigationStack()\n  const location = useLocation()\n  const { hasRole } = useAuth()\n  const { currentAccountId } = useAccount()\n  const { buildContextUrl } = useNavigationContext()\n\n  // Check if user has permission to edit transactions (USER role or higher)\n  if (!hasRole(UserRole.USER)) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full space-y-8 text-center\">\n          <div className=\"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-red-100\">\n            <Shield className=\"h-6 w-6 text-red-600\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Access Denied</h2>\n          <p className=\"text-gray-600\">\n            You don't have permission to edit transactions. Please contact an administrator if you need access.\n          </p>\n          <ContextLink\n            to={buildContextUrl(`/project/${projectId}`)}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n          >\n            Back to Project\n          </ContextLink>\n        </div>\n      </div>\n    )\n  }\n\n  const [projectName, setProjectName] = useState<string>('')\n\n  const [formData, setFormData] = useState<TransactionFormData>({\n    transactionDate: '',\n    source: '',\n    transactionType: 'Purchase',\n    paymentMethod: '',\n    amount: '',\n    categoryId: '',\n    notes: '',\n    status: 'completed',\n    reimbursementType: '',\n    triggerEvent: 'Manual',\n    receiptImages: [],\n    otherImages: [],\n    receiptEmailed: false\n  })\n\n  // Tax form state\n  const [taxRatePreset, setTaxRatePreset] = useState<string | undefined>(undefined)\n  const [subtotal, setSubtotal] = useState<string>('')\n  const [taxPresets, setTaxPresets] = useState<TaxPreset[]>([])\n  const [selectedPresetRate, setSelectedPresetRate] = useState<number | undefined>(undefined)\n\n  const [errors, setErrors] = useState<TransactionValidationErrors>({})\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [isLoading, setIsLoading] = useState(true)\n  const [isUploadingImages, setIsUploadingImages] = useState(false)\n  const [existingOtherImages, setExistingOtherImages] = useState<TransactionImage[]>([])\n\n  // Transaction items state\n  const [items, setItems] = useState<TransactionItemFormData[]>([])\n  const initialItemsRef = useRef<TransactionItemFormData[] | null>(null)\n\n  // Custom source state\n  const [isCustomSource, setIsCustomSource] = useState(false)\n  const [availableVendors, setAvailableVendors] = useState<string[]>([])\n\n  // Load vendor defaults on mount\n  useEffect(() => {\n    const loadVendors = async () => {\n      if (!currentAccountId) return\n      try {\n        const vendors = await getAvailableVendors(currentAccountId)\n        setAvailableVendors(vendors)\n      } catch (error) {\n        console.error('Error loading vendor defaults:', error)\n        // Fallback to empty array - will show only \"Other\" option\n        setAvailableVendors([])\n      }\n    }\n    loadVendors()\n  }, [currentAccountId])\n\n  // Load tax presets on mount\n  useEffect(() => {\n    const loadPresets = async () => {\n      if (!currentAccountId) return\n      try {\n        const presets = await getTaxPresets(currentAccountId)\n        setTaxPresets(presets)\n      } catch (error) {\n        console.error('Error loading tax presets:', error)\n      }\n    }\n    loadPresets()\n  }, [currentAccountId])\n\n  // Update selected preset rate when preset changes\n  useEffect(() => {\n    if (taxRatePreset && taxRatePreset !== 'Other') {\n      const preset = taxPresets.find(p => p.id === taxRatePreset)\n      setSelectedPresetRate(preset?.rate)\n    } else {\n      setSelectedPresetRate(undefined)\n    }\n  }, [taxRatePreset, taxPresets])\n\n  // Load transaction and project data\n  useEffect(() => {\n    const loadTransaction = async () => {\n      if (!projectId || !transactionId || !currentAccountId) return\n\n      try {\n        const [transaction, project] = await Promise.all([\n          transactionService.getTransaction(currentAccountId, projectId, transactionId),\n          projectService.getProject(currentAccountId, projectId)\n        ])\n\n        if (project) {\n          setProjectName(project.name)\n        }\n        if (transaction) {\n          // Determine the source to display: if database saved 'Other' (legacy), use project name\n          const legacyOther = transaction.source === 'Other' || transaction.source === ''\n          const resolvedSource = legacyOther && project ? project.name : transaction.source\n\n          // Check if source is custom (not in predefined list)\n          const sourceIsCustom = Boolean(resolvedSource && !availableVendors.includes(resolvedSource))\n\n          // Use the transaction date directly for date input (convert Date object to YYYY-MM-DD string)\n          setFormData({\n            transactionDate: toDateOnlyString(transaction.transactionDate) || '',\n            source: resolvedSource,\n            transactionType: transaction.transactionType,\n            paymentMethod: transaction.paymentMethod,\n            amount: transaction.amount,\n            categoryId: transaction.categoryId || '',\n            notes: transaction.notes || '',\n            status: transaction.status || 'completed',\n            reimbursementType: transaction.reimbursementType || '',\n            triggerEvent: transaction.triggerEvent || 'Manual',\n            receiptImages: [],\n            otherImages: [],\n            receiptEmailed: transaction.receiptEmailed\n          })\n\n          // Populate tax fields if present\n          if (transaction.taxRatePreset) {\n            setTaxRatePreset(transaction.taxRatePreset)\n          }\n          setSubtotal(transaction.subtotal || '')\n\n          setIsCustomSource(sourceIsCustom)\n\n          // If legacy 'Other' was stored, immediately correct database to the project name\n          if (legacyOther && project && projectId && transactionId && currentAccountId) {\n            try {\n              await transactionService.updateTransaction(currentAccountId, projectId, transactionId, { source: project.name })\n            } catch (e) {\n              console.warn('Failed to auto-correct source to project name:', e)\n            }\n          }\n\n          // Handle legacy and new image fields for loading transaction data\n          // Note: Legacy transaction_images is loaded but not stored in local state, receipt_images is the current field\n\n          const otherImages = transaction.otherImages || []\n          setExistingOtherImages(Array.isArray(otherImages) ? otherImages : [])\n\n          // Load transaction items\n          try {\n            const transactionItems = await unifiedItemsService.getItemsForTransaction(currentAccountId, projectId, transactionId)\n            console.log('Loaded transaction items:', transactionItems)\n\n            const transactionItemIds = transactionItems.map(item => item.itemId)\n            console.log('Transaction item IDs:', transactionItemIds)\n\n            const itemsWithDetails = await Promise.all(\n              transactionItems.map(async (item) => {\n                console.log(`Loaded item ${item.itemId}:`, {\n                  id: item.itemId,\n                  description: item?.description || '',\n                  hasValidFormat: item.itemId.startsWith('I-') && item.itemId.length > 10\n                })\n\n                return {\n                  id: item.itemId,\n                  description: item?.description || '',\n                  purchasePrice: item?.purchasePrice?.toString() || '',\n                  sku: item?.sku || '',\n                  marketValue: item?.marketValue?.toString() || '',\n                  notes: item?.notes || '',\n                  imageFiles: [],\n                  images: item?.images || []\n                }\n              })\n            )\n            console.log('Loaded transaction items:', transactionItems.map(item => ({\n              id: item.itemId,\n              description: item.description,\n              isTempId: item.itemId.startsWith('temp-')\n            })))\n            setItems(itemsWithDetails)\n            // Capture initial snapshot of loaded items to detect later edits.\n            try {\n              initialItemsRef.current = itemsWithDetails.map(i => ({\n                id: i.id,\n                description: i.description,\n                purchasePrice: i.purchasePrice,\n                sku: i.sku,\n                marketValue: i.marketValue,\n                notes: i.notes\n              } as TransactionItemFormData))\n            } catch (e) {\n              // Non-fatal\n              initialItemsRef.current = null\n            }\n          } catch (itemError) {\n            console.error('Error loading transaction items:', itemError)\n          }\n        }\n      } catch (error) {\n        console.error('Error loading transaction:', error)\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    loadTransaction()\n  }, [projectId, transactionId, currentAccountId, availableVendors])\n\n  // Validation function\n  const validateForm = (): boolean => {\n    const newErrors: TransactionValidationErrors = {}\n\n    // Source is still required to maintain data quality\n    if (!formData.source.trim()) {\n      newErrors.source = 'Source is required'\n    }\n\n    // TransactionType is optional\n    // PaymentMethod is optional\n\n    if (!formData.categoryId?.trim()) {\n      newErrors.categoryId = 'Budget category is required'\n    }\n\n    if (!formData.amount.trim()) {\n      newErrors.amount = 'Amount is required'\n    } else if (isNaN(Number(formData.amount)) || Number(formData.amount) <= 0) {\n      newErrors.amount = 'Amount must be a positive number'\n    }\n\n    // TransactionDate is optional\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault()\n\n    if (!validateForm() || !projectId || !transactionId || !currentAccountId) return\n\n  setIsSubmitting(true)\n    let _needsReviewBatchStarted = false\n    try {\n      if (currentAccountId && transactionId) {\n        try {\n          transactionService.beginNeedsReviewBatch(currentAccountId, transactionId)\n          _needsReviewBatchStarted = true\n        } catch (e) {\n          console.warn('Failed to begin needs review batch:', e)\n        }\n      }\n      // First, handle item updates and creations\n      if (items.length > 0) {\n        // Debug: Log all items to understand the issue\n        console.log('All items before processing:', items.map(item => ({\n          id: item.id,\n          description: item.description,\n          price: item.purchasePrice,\n          sku: item.sku,\n          isTempId: item.id.startsWith('temp-'),\n          idFormat: item.id.startsWith('I-') ? 'database' : item.id.startsWith('temp-') ? 'temp' : 'unknown'\n        })))\n        // Separate existing items from new items using robust classification\n        // Existing items have real database IDs (format: \"I-\" prefix followed by timestamp and random string)\n        // New items have temporary IDs (format: \"temp-\" prefix followed by timestamp and random string)\n        const existingItems: TransactionItemFormData[] = []\n        const newItems: TransactionItemFormData[] = []\n\n        items.forEach(item => {\n          // Robust classification logic\n          if (item.id.startsWith('temp-')) {\n            // Definitely a temp item\n            newItems.push(item)\n          } else if (item.id.startsWith('I-') && item.id.length > 10) {\n            // Likely a real database item (format: I-timestamp-randomstring)\n            existingItems.push(item)\n          } else if (item.id.length > 5 && !item.id.includes('_')) {\n            // Could be a real database item with different format, treat as existing for safety\n            console.warn(`Item with ambiguous ID treated as existing: ${item.id} - ${item.description}`)\n            existingItems.push(item)\n          } else {\n            // Default to treating as new item if ID format is unclear\n            console.warn(`Item with unclear ID format treated as new: ${item.id} - ${item.description}`)\n            newItems.push(item)\n          }\n        })\n\n        console.log(`Separated ${existingItems.length} existing items and ${newItems.length} new items`)\n\n        // Update existing items only if fields actually changed compared to the initial load.\n        const initialItemsMap = new Map<string, TransactionItemFormData>()\n        if (initialItemsRef.current) {\n          for (const it of initialItemsRef.current) initialItemsMap.set(it.id, it)\n        }\n\n        const itemsToUpdate: Array<{ id: string; updates: Partial<TransactionItemFormData> }> = []\n        for (const item of existingItems) {\n          const orig = initialItemsMap.get(item.id)\n          const updates: Partial<TransactionItemFormData> = {}\n          if (!orig || orig.description !== item.description) updates.description = item.description\n          // Normalize undefined/empty string comparisons for numeric fields stored as strings\n          if (!orig || String(orig.purchasePrice || '') !== String(item.purchasePrice || '')) updates.purchasePrice = item.purchasePrice\n          if (!orig || String(orig.marketValue || '') !== String(item.marketValue || '')) updates.marketValue = item.marketValue\n          if (!orig || (orig.sku || '') !== (item.sku || '')) updates.sku = item.sku\n          if (!orig || (orig.notes || '') !== (item.notes || '')) updates.notes = item.notes\n          // Ensure transaction linkage is present\n          updates.transactionId = transactionId\n\n          // If there are any meaningful updates (besides transactionId), add to update list\n          const meaningfulKeys = Object.keys(updates).filter(k => k !== 'transactionId')\n          if (meaningfulKeys.length > 0) {\n            itemsToUpdate.push({ id: item.id, updates })\n          }\n        }\n\n        console.log(`Preparing to update ${itemsToUpdate.length} of ${existingItems.length} existing items`)\n        for (const u of itemsToUpdate) {\n          await unifiedItemsService.updateItem(currentAccountId, u.id, u.updates)\n        }\n\n        // Create new items using the same batch infrastructure as new transactions\n        let createdItemIds: string[] = []\n        if (newItems.length > 0) {\n          createdItemIds = await Promise.all(\n            newItems.map(async (item) => {\n              const itemData = {\n                ...item,\n                projectId: projectId,\n                transactionId: transactionId,\n                dateCreated: formData.transactionDate,\n                source: formData.source,\n                inventoryStatus: 'available' as const,\n                paymentMethod: 'Unknown',\n                qrKey: `QR-${Date.now()}-${Math.random().toString(36).substr(2, 4)}`,\n                bookmark: false,\n                sku: item.sku || '',\n                purchasePrice: item.purchasePrice || '',\n                projectPrice: item.projectPrice || '',\n                marketValue: item.marketValue || '',\n                notes: item.notes || '',\n                space: item.space || '',\n                disposition: 'keep'\n              }\n              return await unifiedItemsService.createItem(currentAccountId, itemData)\n            })\n          )\n          console.log('Created new items:', createdItemIds)\n\n          // Update the item IDs in our local state (map temp IDs to real IDs)\n          setItems(prevItems => prevItems.map(prevItem => {\n            // Only update items that were in our newItems array (have temp IDs)\n            const newItemIndex = newItems.findIndex(item => item.id === prevItem.id)\n            if (newItemIndex >= 0 && newItemIndex < createdItemIds.length) {\n              return { ...prevItem, id: createdItemIds[newItemIndex] }\n            }\n            return prevItem\n          }))\n        }\n\n        // Note: Item image upload functionality removed for now - focusing on transaction images\n      }\n\n      // Upload other images\n      let otherImages: TransactionImage[] = [...existingOtherImages]\n      if (formData.otherImages && formData.otherImages.length > 0) {\n        try {\n          const uploadResults = await ImageUploadService.uploadMultipleOtherImages(\n            formData.otherImages,\n            projectName,\n            transactionId,\n            handleImageUploadProgress\n          )\n\n          // Convert to TransactionImage format and combine with existing images\n          const newOtherImages = ImageUploadService.convertFilesToOtherImages(uploadResults)\n          otherImages = [...existingOtherImages, ...newOtherImages]\n        } catch (error) {\n          console.error('Error uploading other images:', error)\n          setErrors({ otherImages: 'Failed to upload other images. Please try again.' })\n          setIsSubmitting(false)\n          setIsUploadingImages(false)\n          return\n        }\n      } else {\n        // Use existing images if no new ones uploaded\n        otherImages = existingOtherImages\n      }\n\n      // Update transaction with new data and images\n      const { otherImages: _, receiptImages: __, transactionImages: ___, ...formDataWithoutImages } = formData\n      const updateData = {\n        ...formDataWithoutImages,\n        otherImages: otherImages,\n        // Include tax fields only when a tax rate preset is explicitly selected.\n        ...(taxRatePreset ? { taxRatePreset: taxRatePreset, subtotal: taxRatePreset === 'Other' ? subtotal : '' } : { subtotal: '' })\n      }\n\n      await transactionService.updateTransaction(currentAccountId, projectId, transactionId, updateData)\n      navigate(`/project/${projectId}/transaction/${transactionId}`)\n    } catch (error) {\n      console.error('Error updating transaction:', error)\n      // Set a general error message instead of targeting specific fields\n      setErrors({ general: error instanceof Error ? error.message : 'Failed to update transaction. Please try again.' })\n    } finally {\n      if (_needsReviewBatchStarted && currentAccountId && transactionId) {\n        try {\n          await transactionService.flushNeedsReviewBatch(currentAccountId, transactionId, { flushImmediately: true })\n        } catch (e) {\n          console.warn('Failed to flush needs review batch:', e)\n        }\n      }\n      setIsSubmitting(false)\n    }\n  }\n\n  const handleInputChange = (field: Exclude<keyof TransactionFormData, 'taxRatePreset' | 'subtotal'> | 'categoryId', value: string | boolean | File[]) => {\n    // Handle categoryId separately since it's not in the original TransactionFormData type exclusion\n    if (field === 'categoryId') {\n      setFormData(prev => ({ ...prev, categoryId: value as string }))\n      if (errors.categoryId) {\n        setErrors(prev => ({ ...prev, categoryId: undefined }))\n      }\n      return\n    }\n    setFormData(prev => {\n      const newData = { ...prev, [field]: value }\n\n      // Apply business rules for status and reimbursement type\n      if (field === 'status' && value === 'completed' && prev.reimbursementType) {\n        // If setting status to completed, clear reimbursement type by setting to empty string\n        // The service layer will convert this to deleteField()\n        newData.reimbursementType = ''\n      } else if (field === 'reimbursementType' && value && prev.status === 'completed') {\n        // If setting reimbursement type while status is completed, change status to pending\n        newData.status = 'pending'\n      }\n\n      return newData\n    })\n\n    // Clear error when user starts typing\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: undefined }))\n    }\n  }\n\n\n  const handleImageUploadProgress = (fileIndex: number, progress: UploadProgress) => {\n    // Progress tracking removed to fix TypeScript errors\n    console.log(`Upload progress for file ${fileIndex}: ${progress.percentage}%`)\n  }\n\n\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto\"></div>\n          <p className=\"mt-2 text-sm text-gray-600\">Loading transaction...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-4\">\n        {/* Back button row */}\n        <div className=\"flex items-center justify-between\">\n          <button\n            onClick={() => {\n              const target = navigationStack.pop(location.pathname + location.search) || buildContextUrl(`/project/${projectId}`)\n              navigate(target)\n            }}\n            className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </button>\n        </div>\n\n      </div>\n\n      {/* Form */}\n      <div className=\"bg-white shadow rounded-lg\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Edit Transaction</h1>\n        </div>\n        <form onSubmit={handleSubmit} className=\"space-y-6 p-6\">\n          {/* General Error Display */}\n          {errors.general && (\n            <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n              <div className=\"flex\">\n                <div className=\"ml-3\">\n                  <h3 className=\"text-sm font-medium text-red-800\">Error</h3>\n                  <div className=\"mt-2 text-sm text-red-700\">\n                    <p>{errors.general}</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Source */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n              Source/Vendor *\n            </label>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3\">\n              {availableVendors.map((source) => (\n                <div key={source} className=\"flex items-center\">\n                  <input\n                    type=\"radio\"\n                    id={`source_${source.toLowerCase().replace(/\\s+/g, '_')}`}\n                    name=\"source\"\n                    value={source}\n                    checked={formData.source === source}\n                    onChange={(e) => {\n                      handleInputChange('source', e.target.value)\n                      setIsCustomSource(false)\n                    }}\n                    className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                  />\n                  <label htmlFor={`source_${source.toLowerCase().replace(/\\s+/g, '_')}`} className=\"ml-2 block text-sm text-gray-900\">\n                    {source}\n                  </label>\n                </div>\n              ))}\n            </div>\n            <div className=\"flex items-center\">\n              <input\n                type=\"radio\"\n                id=\"source_custom\"\n                name=\"source\"\n                value=\"custom\"\n                checked={isCustomSource}\n                onChange={() => {\n                  setIsCustomSource(true)\n                  handleInputChange('source', '')\n                }}\n                className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n              />\n              <label htmlFor=\"source_custom\" className=\"ml-2 block text-sm text-gray-900\">\n                Other\n              </label>\n            </div>\n            {isCustomSource && (\n              <input\n                type=\"text\"\n                id=\"source_custom_input\"\n                value={formData.source}\n                onChange={(e) => handleInputChange('source', e.target.value)}\n                placeholder=\"Enter custom source...\"\n                className={`mt-3 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n                  errors.source ? 'border-red-300' : 'border-gray-300'\n                }`}\n              />\n            )}\n            {errors.source && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.source}</p>\n            )}\n          </div>\n\n          {/* Budget Category */}\n          <div>\n            <CategorySelect\n              value={formData.categoryId}\n              onChange={(categoryId) => {\n                handleInputChange('categoryId', categoryId)\n              }}\n              label=\"Budget Category\"\n              error={errors.categoryId}\n              required\n            />\n          </div>\n\n          {/* Transaction Type */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n              Transaction Type\n            </label>\n            <div className=\"flex items-center space-x-6\">\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"type_purchase\"\n                  name=\"transactionType\"\n                  value=\"Purchase\"\n                  checked={formData.transactionType === 'Purchase'}\n                  onChange={(e) => handleInputChange('transactionType', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"type_purchase\" className=\"ml-2 block text-sm text-gray-900\">\n                  Purchase\n                </label>\n              </div>\n              {/* 'To Inventory' option removed */}\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"type_return\"\n                  name=\"transactionType\"\n                  value=\"Return\"\n                  checked={formData.transactionType === 'Return'}\n                  onChange={(e) => handleInputChange('transactionType', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"type_return\" className=\"ml-2 block text-sm text-gray-900\">\n                  Return\n                </label>\n              </div>\n            </div>\n            {errors.transactionType && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.transactionType}</p>\n            )}\n          </div>\n\n          {/* Status */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n              Status\n            </label>\n            <div className=\"flex items-center space-x-6\">\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"status_pending\"\n                  name=\"status\"\n                  value=\"pending\"\n                  checked={formData.status === 'pending'}\n                  onChange={(e) => handleInputChange('status', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"status_pending\" className=\"ml-2 block text-sm text-gray-900\">\n                  Pending\n                </label>\n              </div>\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"status_completed\"\n                  name=\"status\"\n                  value=\"completed\"\n                  checked={formData.status === 'completed'}\n                  onChange={(e) => handleInputChange('status', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"status_completed\" className=\"ml-2 block text-sm text-gray-900\">\n                  Completed\n                </label>\n              </div>\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"status_cancelled\"\n                  name=\"status\"\n                  value=\"canceled\"\n                  checked={formData.status === 'canceled'}\n                  onChange={(e) => handleInputChange('status', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"status_cancelled\" className=\"ml-2 block text-sm text-gray-900\">\n                  Canceled\n                </label>\n              </div>\n            </div>\n            {errors.status && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.status}</p>\n            )}\n          </div>\n\n          {/* Payment Method */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n              Transaction Method\n            </label>\n            <div className=\"flex items-center space-x-6\">\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"method_client_card\"\n                  name=\"paymentMethod\"\n                  value=\"Client Card\"\n                  checked={formData.paymentMethod === 'Client Card'}\n                  onChange={(e) => handleInputChange('paymentMethod', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"method_client_card\" className=\"ml-2 block text-sm text-gray-900\">\n                  Client Card\n                </label>\n              </div>\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"method_1584_card\"\n                  name=\"paymentMethod\"\n                  value={COMPANY_NAME}\n                  checked={formData.paymentMethod === COMPANY_NAME}\n                  onChange={(e) => handleInputChange('paymentMethod', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"method_1584_card\" className=\"ml-2 block text-sm text-gray-900\">\n                  {COMPANY_NAME}\n                </label>\n              </div>\n            </div>\n            {errors.paymentMethod && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.paymentMethod}</p>\n            )}\n          </div>\n\n          {/* Reimbursement Type */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n              Reimbursement Type\n            </label>\n            <p className=\"mb-3 text-xs text-gray-500\">Flags transactions that require reimbursement</p>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"reimbursement_none\"\n                  name=\"reimbursementType\"\n                  value=\"\"\n                  checked={!formData.reimbursementType}\n                  onChange={(e) => handleInputChange('reimbursementType', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"reimbursement_none\" className=\"ml-2 block text-sm text-gray-900\">\n                  None\n                </label>\n              </div>\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"reimbursement_client_owes\"\n                  name=\"reimbursementType\"\n                  value={CLIENT_OWES_COMPANY}\n                  checked={formData.reimbursementType === CLIENT_OWES_COMPANY}\n                  onChange={(e) => handleInputChange('reimbursementType', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"reimbursement_client_owes\" className=\"ml-2 block text-sm text-gray-900\">\n                  {CLIENT_OWES_COMPANY}\n                </label>\n              </div>\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"reimbursement_we_owe\"\n                  name=\"reimbursementType\"\n                  value={COMPANY_OWES_CLIENT}\n                  checked={formData.reimbursementType === COMPANY_OWES_CLIENT}\n                  onChange={(e) => handleInputChange('reimbursementType', e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"reimbursement_we_owe\" className=\"ml-2 block text-sm text-gray-900\">\n                  {COMPANY_OWES_CLIENT}\n                </label>\n              </div>\n            </div>\n            {errors.reimbursementType && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.reimbursementType}</p>\n            )}\n          </div>\n\n          {/* Receipt Email Copy */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n              Receipt Email Copy\n            </label>\n            <div className=\"flex items-center space-x-6\">\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"receipt_yes\"\n                  name=\"receiptEmailed\"\n                  checked={formData.receiptEmailed === true}\n                  onChange={() => handleInputChange('receiptEmailed', true)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"receipt_yes\" className=\"ml-2 block text-sm text-gray-900\">\n                  Yes\n                </label>\n              </div>\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"receipt_no\"\n                  name=\"receiptEmailed\"\n                  checked={formData.receiptEmailed === false}\n                  onChange={() => handleInputChange('receiptEmailed', false)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"receipt_no\" className=\"ml-2 block text-sm text-gray-900\">\n                  No\n                </label>\n              </div>\n            </div>\n          </div>\n\n          {/* Amount */}\n          <div>\n            <label htmlFor=\"amount\" className=\"block text-sm font-medium text-gray-700\">\n              Amount *\n            </label>\n            <div className=\"mt-1 relative rounded-md shadow-sm\">\n              <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                <span className=\"text-gray-500 sm:text-sm\">$</span>\n              </div>\n              <input\n                type=\"text\"\n                id=\"amount\"\n                value={formData.amount}\n                onChange={(e) => handleInputChange('amount', e.target.value)}\n                placeholder=\"0.00\"\n                className={`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n                  errors.amount ? 'border-red-300' : 'border-gray-300'\n                }`}\n              />\n            </div>\n            {errors.amount && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.amount}</p>\n            )}\n          </div>\n\n          {/* Tax Rate Presets */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">Tax Rate Preset</label>\n            <div className=\"space-y-2\">\n              {taxPresets.map((preset) => (\n                <div key={preset.id} className=\"flex items-center\">\n                  <input\n                    type=\"radio\"\n                    id={`tax_preset_${preset.id}`}\n                    name=\"tax_rate_preset\"\n                    value={preset.id}\n                    checked={taxRatePreset === preset.id}\n                    onChange={(e) => setTaxRatePreset(e.target.value)}\n                    className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                  />\n                  <label htmlFor={`tax_preset_${preset.id}`} className=\"ml-2 block text-sm text-gray-900\">\n                    {preset.name} ({preset.rate.toFixed(2)}%)\n                  </label>\n                </div>\n              ))}\n              <div className=\"flex items-center\">\n                <input\n                  type=\"radio\"\n                  id=\"tax_preset_other\"\n                  name=\"tax_rate_preset\"\n                  value=\"Other\"\n                  checked={taxRatePreset === 'Other'}\n                  onChange={(e) => setTaxRatePreset(e.target.value)}\n                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300\"\n                />\n                <label htmlFor=\"tax_preset_other\" className=\"ml-2 block text-sm text-gray-900\">\n                  Other\n                </label>\n              </div>\n            </div>\n            {/* Show selected tax rate for presets */}\n            {taxRatePreset && taxRatePreset !== 'Other' && selectedPresetRate !== undefined && (\n              <div className=\"mt-3 p-3 bg-gray-50 rounded-md\">\n                <p className=\"text-sm text-gray-700\">\n                  <span className=\"font-medium\">Tax Rate:</span> {selectedPresetRate.toFixed(2)}%\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Subtotal (shown only for Other) */}\n          {taxRatePreset === 'Other' && (\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700\">Subtotal</label>\n              <div className=\"mt-1 relative rounded-md shadow-sm\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <span className=\"text-gray-500 sm:text-sm\">$</span>\n                </div>\n                <input\n                  type=\"text\"\n                  id=\"subtotal\"\n                  value={subtotal}\n                  onChange={(e) => setSubtotal(e.target.value)}\n                  placeholder=\"0.00\"\n                  className={`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 border-gray-300`}\n                />\n              </div>\n              <p className=\"mt-1 text-sm text-gray-500\">This will be used to calculate the tax rate.</p>\n            </div>\n          )}\n\n          {/* Transaction Date */}\n          <div>\n            <label htmlFor=\"transactionDate\" className=\"block text-sm font-medium text-gray-700\">\n              Transaction Date\n            </label>\n            <input\n              type=\"date\"\n              id=\"transactionDate\"\n              value={formData.transactionDate}\n              onChange={(e) => {\n                // Use the date value directly (YYYY-MM-DD format)\n                handleInputChange('transactionDate', e.target.value)\n              }}\n              className={`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n                errors.transactionDate ? 'border-red-300' : 'border-gray-300'\n              }`}\n            />\n            {errors.transactionDate && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.transactionDate}</p>\n            )}\n          </div>\n\n          {/* Notes */}\n          <div>\n            <label htmlFor=\"notes\" className=\"block text-sm font-medium text-gray-700\">\n              Notes\n            </label>\n            <textarea\n              id=\"notes\"\n              rows={3}\n              value={formData.notes}\n              onChange={(e) => handleInputChange('notes', e.target.value)}\n              placeholder=\"Additional notes about this transaction...\"\n              className={`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${\n                errors.notes ? 'border-red-300' : 'border-gray-300'\n              }`}\n            />\n            {errors.notes && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.notes}</p>\n            )}\n          </div>\n\n          {/* Other Images */}\n          <div>\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n              Other Images\n            </h3>\n            <ImageUpload\n              onImagesChange={(files) => handleInputChange('otherImages', files)}\n              maxImages={5}\n              maxFileSize={10}\n              disabled={isSubmitting || isUploadingImages}\n              className=\"mb-2\"\n            />\n            {errors.otherImages && (\n              <p className=\"mt-1 text-sm text-red-600\">{errors.otherImages}</p>\n            )}\n          </div>\n\n\n          {/* Form Actions - Normal on desktop, hidden on mobile (replaced by sticky bar) */}\n          <div className=\"hidden sm:flex justify-end sm:space-x-3 pt-4\">\n            <button\n              onClick={() => {\n                const target = navigationStack.pop(location.pathname + location.search) || buildContextUrl(`/project/${projectId}`)\n                navigate(target)\n              }}\n              className=\"inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n            >\n              <X className=\"h-4 w-4 mr-2\" />\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={isSubmitting || isUploadingImages}\n              className=\"inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              {isSubmitting ? 'Updating...' : isUploadingImages ? 'Uploading Images...' : 'Update'}\n            </button>\n          </div>\n        </form>\n      </div>\n\n      {/* Sticky mobile action bar */}\n      <div className=\"sm:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50\">\n        <div className=\"flex space-x-3\">\n          <button\n            onClick={() => {\n              const target = navigationStack.pop(location.pathname + location.search) || buildContextUrl(`/project/${projectId}`)\n              navigate(target)\n            }}\n            className=\"flex-1 inline-flex justify-center items-center px-4 py-3 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n          >\n            <X className=\"h-4 w-4 mr-2\" />\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            disabled={isSubmitting || isUploadingImages}\n            onClick={(e) => {\n              // Find the form and submit it\n              const form = e.currentTarget.closest('.space-y-6')?.querySelector('form') as HTMLFormElement\n              if (form) {\n                form.requestSubmit()\n              }\n            }}\n            className=\"flex-1 inline-flex justify-center items-center px-4 py-3 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            {isSubmitting ? 'Updating...' : isUploadingImages ? 'Uploading Images...' : 'Update'}\n          </button>\n        </div>\n      </div>\n\n      {/* Add bottom padding to account for sticky bar on mobile */}\n      <div className=\"sm:hidden h-20\"></div>\n    </div>\n  )\n}\n"],"names":["EditTransaction","projectId","transactionId","useParams","navigate","useStackedNavigate","navigationStack","useNavigationStack","location","useLocation","hasRole","useAuth","currentAccountId","useAccount","buildContextUrl","useNavigationContext","UserRole","jsxs","jsx","Shield","ContextLink","projectName","setProjectName","useState","formData","setFormData","taxRatePreset","setTaxRatePreset","subtotal","setSubtotal","taxPresets","setTaxPresets","selectedPresetRate","setSelectedPresetRate","errors","setErrors","isSubmitting","setIsSubmitting","isLoading","setIsLoading","isUploadingImages","setIsUploadingImages","existingOtherImages","setExistingOtherImages","items","setItems","initialItemsRef","useRef","isCustomSource","setIsCustomSource","availableVendors","setAvailableVendors","useEffect","vendors","getAvailableVendors","error","presets","getTaxPresets","preset","p","transaction","project","transactionService","projectService","legacyOther","resolvedSource","sourceIsCustom","toDateOnlyString","e","otherImages","transactionItems","unifiedItemsService","transactionItemIds","item","itemsWithDetails","_a","_b","i","itemError","validateForm","newErrors","handleSubmit","_needsReviewBatchStarted","existingItems","newItems","initialItemsMap","it","itemsToUpdate","orig","updates","k","u","createdItemIds","itemData","prevItems","prevItem","newItemIndex","uploadResults","ImageUploadService","handleImageUploadProgress","newOtherImages","_","__","___","formDataWithoutImages","updateData","handleInputChange","field","value","prev","newData","fileIndex","progress","target","ArrowLeft","source","CategorySelect","categoryId","COMPANY_NAME","CLIENT_OWES_COMPANY","COMPANY_OWES_CLIENT","ImageUpload","files","X","Save","form"],"mappings":"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"}