{"version":3,"file":"AuthCallback.js","sources":["../../src/pages/AuthCallback.tsx"],"sourcesContent":["import { useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { supabase } from '../services/supabase'\nimport { checkInvitationByToken } from '../services/supabase'\n\nexport default function AuthCallback() {\n  const navigate = useNavigate()\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        // Poll for session with bounded timeout (replaces fixed delay)\n        // The auth listener in AuthContext will handle the actual auth state changes\n        const maxAttempts = 20 // 20 attempts * 100ms = 2 seconds max\n        let attempts = 0\n        let session = null\n\n        while (attempts < maxAttempts) {\n          const { data: { session: currentSession }, error } = await supabase.auth.getSession()\n          \n          if (error) {\n            console.error('Auth callback error:', error)\n            navigate('/')\n            return\n          }\n\n          if (currentSession?.user) {\n            session = currentSession\n            break\n          }\n\n          attempts++\n          await new Promise(resolve => setTimeout(resolve, 100))\n        }\n\n        if (session?.user) {\n          // Check if there's a pending invitation token\n          const pendingToken = localStorage.getItem('pendingInvitationToken')\n          if (pendingToken) {\n            try {\n              const invitation = await checkInvitationByToken(pendingToken)\n              if (invitation) {\n                // Store invitation info for use in createOrUpdateUserDocument\n                // Don't clear it here - let createOrUpdateUserDocument consume it first\n                localStorage.setItem('pendingInvitationData', JSON.stringify({\n                  invitationId: invitation.invitationId,\n                  accountId: invitation.accountId,\n                  role: invitation.role\n                }))\n              }\n            } catch (err) {\n              console.error('Error checking invitation token:', err)\n            }\n            // Clear the token (but keep pendingInvitationData for user doc creation)\n            localStorage.removeItem('pendingInvitationToken')\n          }\n\n          // Don't clear pendingInvitationData here - it will be cleared by createOrUpdateUserDocument\n          // after it consumes it during the SIGNED_IN event handling\n          \n          navigate('/')\n        } else {\n          navigate('/')\n        }\n      } catch (error) {\n        console.error('Error handling auth callback:', error)\n        navigate('/')\n      }\n    }\n\n    handleAuthCallback()\n  }, [navigate])\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4\"></div>\n        <p className=\"text-gray-600\">Completing sign in...</p>\n      </div>\n    </div>\n  )\n}\n\n"],"names":["AuthCallback","navigate","useNavigate","useEffect","attempts","session","currentSession","error","supabase","resolve","pendingToken","invitation","checkInvitationByToken","err","jsxs","jsx"],"mappings":"mJAKA,SAAwBA,GAAe,CACrC,MAAMC,EAAWC,EAAA,EAEjBC,OAAAA,EAAAA,UAAU,IAAM,EACa,SAAY,CACrC,GAAI,CAIF,IAAIC,EAAW,EACXC,EAAU,KAEd,KAAOD,EAAW,IAAa,CAC7B,KAAM,CAAE,KAAM,CAAE,QAASE,CAAA,EAAkB,MAAAC,CAAA,EAAU,MAAMC,EAAS,KAAK,WAAA,EAEzE,GAAID,EAAO,CACT,QAAQ,MAAM,uBAAwBA,CAAK,EAC3CN,EAAS,GAAG,EACZ,MACF,CAEA,GAAIK,GAAA,MAAAA,EAAgB,KAAM,CACxBD,EAAUC,EACV,KACF,CAEAF,IACA,MAAM,IAAI,QAAQK,GAAW,WAAWA,EAAS,GAAG,CAAC,CACvD,CAEA,GAAIJ,GAAA,MAAAA,EAAS,KAAM,CAEjB,MAAMK,EAAe,aAAa,QAAQ,wBAAwB,EAClE,GAAIA,EAAc,CAChB,GAAI,CACF,MAAMC,EAAa,MAAMC,EAAuBF,CAAY,EACxDC,GAGF,aAAa,QAAQ,wBAAyB,KAAK,UAAU,CAC3D,aAAcA,EAAW,aACzB,UAAWA,EAAW,UACtB,KAAMA,EAAW,IAAA,CAClB,CAAC,CAEN,OAASE,EAAK,CACZ,QAAQ,MAAM,mCAAoCA,CAAG,CACvD,CAEA,aAAa,WAAW,wBAAwB,CAClD,CAKAZ,EAAS,GAAG,CACd,MACEA,EAAS,GAAG,CAEhB,OAASM,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,EACpDN,EAAS,GAAG,CACd,CACF,GAEA,CACF,EAAG,CAACA,CAAQ,CAAC,QAGV,MAAA,CAAI,UAAU,gDACb,SAAAa,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,6EAAA,CAA8E,EAC7FA,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,uBAAA,CAAqB,CAAA,CAAA,CACpD,CAAA,CACF,CAEJ"}