import{j as e}from"./index.js";import{r as i}from"./vendor.js";import{b as I,c as C,L as m}from"./router.js";import{u as f}from"./inventoryService.js";import{e as F,b as y,p as g}from"./ui.js";import"./firebase.js";function U(){const{id:n}=I(),j=C(),[v,N]=i.useState(!0),[l,h]=i.useState(!1),[u,k]=i.useState(null),b=i.useRef(!1),[t,p]=i.useState({description:"",source:"",sku:"",purchase_price:"",project_price:"",market_value:"",disposition:"keep",notes:"",bookmark:!1,business_inventory_location:"",inventory_status:"available"}),[s,x]=i.useState({}),d=i.useMemo(()=>{const o=new URLSearchParams(location.search).get("returnTo");return o||"/business-inventory"},[location.search]);i.useEffect(()=>{n&&_()},[n]),i.useEffect(()=>{t.purchase_price&&!t.project_price&&!b.current&&p(r=>({...r,project_price:t.purchase_price}))},[t.purchase_price]);const _=async()=>{if(n)try{const r=await f.getItemById(n);r&&(k(r),p({description:r.description,source:r.source,sku:r.sku,purchase_price:r.purchase_price||"",project_price:r.project_price||"",market_value:r.market_value||"",disposition:r.disposition||"keep",notes:r.notes||"",bookmark:r.bookmark,business_inventory_location:r.business_inventory_location||"",inventory_status:r.inventory_status}))}catch(r){console.error("Error loading item:",r)}finally{N(!1)}},a=(r,o)=>{p(c=>({...c,[r]:o})),r==="project_price"&&(b.current=!0),s[r]&&x(c=>({...c,[r]:""}))},w=()=>{const r={};return t.description.trim()||(r.description="Description is required"),x(r),Object.keys(r).length===0},S=async r=>{if(r.preventDefault(),!(!n||!w())){h(!0);try{await f.updateItem(n,t),j(`/business-inventory/${n}`)}catch(o){console.error("Error updating item:",o),x({general:"Error updating item. Please try again."})}finally{h(!1)}}};return v?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(m,{to:d,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Item"})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("form",{onSubmit:S,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:t.description,onChange:r=>a("description",r.target.value),placeholder:"e.g., Vintage leather armchair",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.description?"border-red-300":"border-gray-300"}`}),s.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700",children:"Source"}),e.jsx("input",{type:"text",id:"source",value:t.source,onChange:r=>a("source",r.target.value),placeholder:"e.g., purchased, found, donated",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.source?"border-red-300":"border-gray-300"}`}),s.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:t.sku,onChange:r=>a("sku",r.target.value),placeholder:"e.g., CHR-001",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purchase_price",className:"block text-sm font-medium text-gray-700",children:"Purchase Price"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-2",children:"What the item was purchased for"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"purchase_price",value:t.purchase_price,onChange:r=>a("purchase_price",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.purchase_price?"border-red-300":"border-gray-300"}`})]}),s.purchase_price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.purchase_price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project_price",className:"block text-sm font-medium text-gray-700",children:"Project Price"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-2",children:"What the client is charged (defaults to purchase price)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"project_price",value:t.project_price,onChange:r=>a("project_price",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.project_price?"border-red-300":"border-gray-300"}`})]}),s.project_price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.project_price})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"market_value",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-2",children:"The fair market value of the item"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"market_value",value:t.market_value,onChange:r=>a("market_value",r.target.value),placeholder:"0.00",className:"mt-1 block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"business_inventory_location",className:"block text-sm font-medium text-gray-700",children:"Storage Location"}),e.jsx("input",{type:"text",id:"business_inventory_location",value:t.business_inventory_location,onChange:r=>a("business_inventory_location",r.target.value),placeholder:"e.g., Warehouse A - Section 3 - Shelf 5",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.business_inventory_location?"border-red-300":"border-gray-300"}`}),s.business_inventory_location&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.business_inventory_location})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:t.notes,onChange:r=>a("notes",r.target.value),placeholder:"Additional notes about this item...",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"inventory_status",className:"block text-sm font-medium text-gray-700",children:"Inventory Status"}),e.jsxs("select",{id:"inventory_status",value:t.inventory_status,onChange:r=>a("inventory_status",r.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"pending",children:"Allocated"}),e.jsx("option",{value:"sold",children:"Sold"})]}),u.project_id&&e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," This item is currently allocated to project ",u.project_id,". Changing the status may affect the pending transaction."]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"bookmark",checked:t.bookmark,onChange:r=>a("bookmark",r.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"bookmark",className:"ml-2 block text-sm text-gray-700",children:"Bookmark this item"})]}),s.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:s.general})}),e.jsxs("div",{className:"hidden sm:flex justify-end sm:space-x-3 pt-4",children:[e.jsxs(m,{to:d,className:"inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:l,className:"inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),l?"Updating Item...":"Update Item"]})]})]})}),e.jsx("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(m,{to:d,className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:l,onClick:r=>{var c;const o=(c=r.currentTarget.closest(".space-y-6"))==null?void 0:c.querySelector("form");o&&o.requestSubmit()},className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),l?"Updating...":"Update"]})]})})]}),e.jsx("div",{className:"sm:hidden h-20"})]}):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ“¦"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Item not found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"The item you're looking for doesn't exist or has been deleted."}),e.jsx(m,{to:d,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Inventory"})]})}export{U as default};
//# sourceMappingURL=EditBusinessInventoryItem.js.map
