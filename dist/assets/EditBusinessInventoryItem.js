import{d as C,j as e}from"./index.js";import{r as i}from"./vendor.js";import{c as F,b as E,u as V,L as u}from"./router.js";import{u as y}from"./inventoryService.js";import{g as $,b as g,t as j}from"./ui.js";import"./supabase.js";import"./taxPresetsService.js";function W(){const{id:n}=F(),v=E(),h=V(),{currentAccountId:c}=C(),[N,k]=i.useState(!0),[d,b]=i.useState(!1),[p,w]=i.useState(null),P=i.useRef(!1),[a,f]=i.useState({description:"",source:"",sku:"",purchasePrice:"",projectPrice:"",marketValue:"",disposition:"keep",notes:"",bookmark:!1,businessInventoryLocation:"",inventoryStatus:"available"}),[s,x]=i.useState({}),m=i.useMemo(()=>{const t=new URLSearchParams(h.search).get("returnTo");return t||"/business-inventory"},[h.search]);i.useEffect(()=>{n&&c&&I()},[n,c]);const I=async()=>{if(!(!n||!c))try{const r=await y.getItemById(c,n);r&&(w(r),f({description:r.description,source:r.source,sku:r.sku,purchasePrice:r.purchasePrice||"",projectPrice:r.projectPrice||"",marketValue:r.marketValue||"",disposition:r.disposition||"keep",notes:r.notes||"",bookmark:r.bookmark,businessInventoryLocation:r.businessInventoryLocation||"",inventoryStatus:r.inventoryStatus}))}catch(r){console.error("Error loading item:",r)}finally{k(!1)}},o=(r,t)=>{f(l=>({...l,[r]:t})),r==="projectPrice"&&(P.current=!0),s[r]&&x(l=>({...l,[r]:""}))},S=()=>{const r={};return a.description.trim()||(r.description="Description is required"),x(r),Object.keys(r).length===0},L=async r=>{if(r.preventDefault(),!(!n||!S()||!c)){b(!0);try{const t={...a};!t.projectPrice&&t.purchasePrice&&(t.projectPrice=t.purchasePrice),await y.updateItem(c,n,t),v(`/business-inventory/${n}`)}catch(t){console.error("Error updating item:",t),x({general:"Error updating item. Please try again."})}finally{b(!1)}}};return N?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):p?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(u,{to:m,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Back"]})})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Item"})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("form",{onSubmit:L,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("input",{type:"text",id:"description",value:a.description,onChange:r=>o("description",r.target.value),placeholder:"e.g., Vintage leather armchair",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.description?"border-red-300":"border-gray-300"}`}),s.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700",children:"Source"}),e.jsx("input",{type:"text",id:"source",value:a.source,onChange:r=>o("source",r.target.value),placeholder:"e.g., purchased, found, donated",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.source?"border-red-300":"border-gray-300"}`}),s.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",id:"sku",value:a.sku,onChange:r=>o("sku",r.target.value),placeholder:"e.g., CHR-001",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purchasePrice",className:"block text-sm font-medium text-gray-700",children:"Purchase Price"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-2",children:"What the item was purchased for"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"purchasePrice",value:a.purchasePrice,onChange:r=>o("purchasePrice",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.purchasePrice?"border-red-300":"border-gray-300"}`})]}),s.purchasePrice&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.purchasePrice})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"projectPrice",className:"block text-sm font-medium text-gray-700",children:"Project Price"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-2",children:"What the client is charged (defaults to purchase price)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"projectPrice",value:a.projectPrice,onChange:r=>o("projectPrice",r.target.value),placeholder:"0.00",className:`block w-full pl-8 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.projectPrice?"border-red-300":"border-gray-300"}`})]}),s.projectPrice&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.projectPrice})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"marketValue",className:"block text-sm font-medium text-gray-700",children:"Market Value"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-2",children:"The fair market value of the item"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",step:"0.01",id:"marketValue",value:a.marketValue,onChange:r=>o("marketValue",r.target.value),placeholder:"0.00",className:"mt-1 block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"businessInventoryLocation",className:"block text-sm font-medium text-gray-700",children:"Storage Location"}),e.jsx("input",{type:"text",id:"businessInventoryLocation",value:a.businessInventoryLocation,onChange:r=>o("businessInventoryLocation",r.target.value),placeholder:"e.g., Warehouse A - Section 3 - Shelf 5",className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${s.businessInventoryLocation?"border-red-300":"border-gray-300"}`}),s.businessInventoryLocation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.businessInventoryLocation})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,value:a.notes,onChange:r=>o("notes",r.target.value),placeholder:"Additional notes about this item...",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"inventoryStatus",className:"block text-sm font-medium text-gray-700",children:"Inventory Status"}),e.jsxs("select",{id:"inventoryStatus",value:a.inventoryStatus,onChange:r=>o("inventoryStatus",r.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"allocated",children:"Allocated"}),e.jsx("option",{value:"sold",children:"Sold"})]}),p.projectId&&e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," This item is currently allocated to project ",p.projectId,". Changing the status may affect the pending transaction."]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"bookmark",checked:a.bookmark,onChange:r=>o("bookmark",r.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"bookmark",className:"ml-2 block text-sm text-gray-700",children:"Bookmark this item"})]}),s.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:s.general})}),e.jsxs("div",{className:"hidden sm:flex justify-end sm:space-x-3 pt-4",children:[e.jsxs(u,{to:m,className:"inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:d,className:"inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),d?"Updating Item...":"Update Item"]})]})]})}),e.jsx("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(u,{to:m,className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:d,onClick:r=>{var l;const t=(l=r.currentTarget.closest(".space-y-6"))==null?void 0:l.querySelector("form");t&&t.requestSubmit()},className:"flex-1 inline-flex justify-center items-center px-4 py-3 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),d?"Updating...":"Update"]})]})})]}),e.jsx("div",{className:"sm:hidden h-20"})]}):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"ðŸ“¦"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Item not found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"The item you're looking for doesn't exist or has been deleted."}),e.jsx(u,{to:m,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Back to Inventory"})]})}export{W as default};
//# sourceMappingURL=EditBusinessInventoryItem.js.map
