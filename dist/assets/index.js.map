{"version":3,"mappings":"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","names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","Subscribable","listener","defaultTimeoutProvider","callback","delay","timeoutId","intervalId","TimeoutManager","_a","__privateAdd","_provider","_providerCalled","provider","__privateSet","__privateGet","timeoutManager","systemSetTimeoutZero","isServer","noop","functionalUpdate","updater","input","isValidTimeout","value","timeUntilStale","updatedAt","staleTime","resolveStaleTime","query","resolveEnabled","enabled","matchQuery","filters","type","exact","fetchStatus","predicate","queryKey","stale","hashQueryKeyByOptions","partialMatchKey","isActive","matchMutation","mutation","status","mutationKey","hashKey","options","_","val","isPlainObject","result","key","hasOwn","replaceEqualDeep","array","isPlainArray","aSize","bItems","bSize","copy","equalItems","i","aItem","bItem","v","o","hasObjectPrototype","ctor","prot","sleep","timeout","resolve","replaceData","prevData","data","addToEnd","items","item","max","newItems","addToStart","skipToken","ensureQueryFn","fetchOptions","FocusManager","_focused","_cleanup","_setup","onFocus","setup","focused","isFocused","focusManager","pendingThenable","reject","thenable","_resolve","_reject","finalize","reason","defaultScheduler","createNotifyManager","queue","transactions","notifyFn","batchNotifyFn","scheduleFn","schedule","flush","originalQueue","args","fn","notifyManager","OnlineManager","_online","onOnline","onlineListener","offlineListener","online","onlineManager","defaultRetryDelay","failureCount","canFetch","networkMode","CancelledError","createRetryer","config","isRetryCancelled","continueFn","isResolved","cancel","cancelOptions","error","cancelRetry","continueRetry","canContinue","canStart","pause","continueResolve","run","promiseOrValue","initialPromise","retry","retryDelay","shouldRetry","Removable","_gcTimeout","newGcTime","Query","_Query_instances","_initialState","_revertState","_cache","_client","_retryer","_defaultOptions","_abortSignalConsumed","getDefaultState","defaultState","newData","__privateMethod","dispatch_fn","state","setStateOptions","promise","_b","observer","x","abortController","addSignalProperty","object","fetchFn","queryFn","queryFnContext","queryFnContext2","context","context2","_c","_d","_f","_e","_h","_g","_j","_i","_l","_k","action","reducer","fetchState","newState","hasData","initialDataUpdatedAt","infiniteQueryBehavior","pages","direction","oldPages","oldPageParams","currentPage","cancelled","fetchPage","param","previous","page","maxPages","addTo","pageParamFn","getPreviousPageParam","getNextPageParam","oldData","remainingPages","pageParams","lastIndex","Mutation","_Mutation_instances","_observers","_mutationCache","variables","onContinue","mutationFnContext","restored","isPaused","_n","_m","_p","_o","_r","_q","_t","_s","MutationCache","_mutations","_scopes","_mutationId","__privateWrapper","scope","scopeFor","scopedMutations","index","mutationsWithSameScope","firstPendingMutation","foundMutation","defaultedFilters","event","pausedMutations","QueryCache","_queries","queryHash","queryInMap","queries","QueryClient","_queryCache","_queryDefaults","_mutationDefaults","_mountCount","_unsubscribeFocus","_unsubscribeOnline","defaultedOptions","cachedData","queryCache","defaultedCancelOptions","promises","defaults","queryDefault","QueryClientContext","React.createContext","QueryClientProvider","children","React.useEffect","jsx","UserRole","BudgetCategory","timestampToDate","timestamp","dateStr","year","month","day","convertTimestamps","timestampFields","convertObject","obj","field","ensureAuthenticatedForDatabase","session","supabase","accountService","name","createdBy","accountId","accountData","userId","userData","userError","user","converted","account","supabaseUrl","supabaseAnonKey","createClient","getCurrentUser","signInWithGoogle","signUpWithEmailPassword","email","password","signOutUser","createOrUpdateUserDocument","supabaseUser","userDoc","fetchError","updateError","existingUsers","countError","newUser","insertError","invitationId","storedInvitationData","invData","err","invitation","checkUserInvitation","invitationData","invError","userRole","existingAccountUsers","invCheck","acceptUserInvitation","getUserData","uid","getCurrentUserWithData","appUser","generateInvitationToken","byte","createUserInvitation","role","invitedBy","expiresAt","token","invitationLink","getInvitationByToken","getPendingInvitations","inv","getAllPendingInvitationsForAccounts","accountIds","grouped","checkInvitationByToken","AuthContext","createContext","authLogPrefix","describeSupabaseUser","id","lastSignInAt","describeAppUser","warnLog","message","AuthProvider","setSupabaseUser","useState","setUser","loading","setLoading","userLoading","setUserLoading","timedOutWithoutAuth","setTimedOutWithoutAuth","hasResolvedAuthRef","useRef","isInitialLoadRef","instanceIdRef","listenerIdRef","initStartTimeRef","supabaseUserLogRef","userLogRef","useEffect","handleVisibilityChange","instanceId","initStartTime","isMounted","authStateUnsubscribe","loadingTimeout","getSessionStartTime","resolveLoading","source","elapsedMs","swController","localStorageTokenExists","currentSupabaseUser","currentAppUser","listenerId","subscription","authUser","currentUser","createUserDocStartTime","createUserDocElapsedMs","sessionError","getSessionElapsedMs","signIn","useCallback","signOut","hasRole","isOwner","useMemo","useAuth","useContext","AccountContext","AccountProvider","authLoading","currentAccountId","setCurrentAccountId","currentAccount","setCurrentAccount","isAdmin","finalAccount","allAccounts","useAccount","businessProfileService","profileData","logoUrl","updatedBy","existing","checkError","COMPANY_NAME","CLIENT_OWES_COMPANY","COMPANY_OWES_CLIENT","COMPANY_INVENTORY","COMPANY_INVENTORY_SALE","COMPANY_INVENTORY_PURCHASE","BusinessProfileContext","BusinessProfileProvider","accountLoading","businessProfile","setBusinessProfile","loadProfile","profile","businessName","businessLogoUrl","useBusinessProfile","Button","variant","size","className","props","baseClasses","variantClasses","sizeClasses","classes","clsx","Header","location","useLocation","isProjectsActive","isBusinessInventoryActive","isSettingsActive","jsxs","Link","FolderOpen","Package","Settings","LogOut","Layout","Outlet","LoadingSpinner","Loader2","iconMap","CheckCircle","XCircle","AlertCircle","Info","colorMap","ToastItem","toast","onClose","isVisible","setIsVisible","isExiting","setIsExiting","Icon","colors","duration","timer","handleClose","X","ToastContext","useToast","ToastProvider","toasts","setToasts","generateId","showToast","prev","removeToast","showSuccess","showError","showWarning","showInfo","Login","onSuccess","setError","handleSignIn","ProtectedRoute","isAuthenticated","App","Suspense","Routes","Route","AuthCallback","InviteAccept","Projects","ItemDetail","ProjectDetail","ProjectInvoice","PropertyManagementSummary","ClientSummary","AddItem","EditItem","AddTransaction","EditTransaction","TransactionDetail","BusinessInventory","AddBusinessInventoryItem","BusinessInventoryItemDetail","EditBusinessInventoryItem","AddBusinessInventoryTransaction","EditBusinessInventoryTransaction","lazy","queryClient","ReactDOM","React","BrowserRouter"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../node_modules/@tanstack/query-core/build/modern/subscribable.js","../../node_modules/@tanstack/query-core/build/modern/timeoutManager.js","../../node_modules/@tanstack/query-core/build/modern/utils.js","../../node_modules/@tanstack/query-core/build/modern/focusManager.js","../../node_modules/@tanstack/query-core/build/modern/thenable.js","../../node_modules/@tanstack/query-core/build/modern/notifyManager.js","../../node_modules/@tanstack/query-core/build/modern/onlineManager.js","../../node_modules/@tanstack/query-core/build/modern/retryer.js","../../node_modules/@tanstack/query-core/build/modern/removable.js","../../node_modules/@tanstack/query-core/build/modern/query.js","../../node_modules/@tanstack/query-core/build/modern/infiniteQueryBehavior.js","../../node_modules/@tanstack/query-core/build/modern/mutation.js","../../node_modules/@tanstack/query-core/build/modern/mutationCache.js","../../node_modules/@tanstack/query-core/build/modern/queryCache.js","../../node_modules/@tanstack/query-core/build/modern/queryClient.js","../../node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js","../../src/types/index.ts","../../src/services/databaseService.ts","../../src/services/accountService.ts","../../src/services/supabase.ts","../../src/contexts/AuthContext.tsx","../../src/contexts/AccountContext.tsx","../../src/services/businessProfileService.ts","../../src/constants/company.ts","../../src/contexts/BusinessProfileContext.tsx","../../src/components/ui/Button.tsx","../../src/components/layout/Header.tsx","../../src/components/layout/Layout.tsx","../../src/components/ui/LoadingSpinner.tsx","../../src/components/ui/Toast.tsx","../../src/components/ui/ToastContext.tsx","../../src/components/auth/Login.tsx","../../src/components/auth/ProtectedRoute.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// src/subscribable.ts\nvar Subscribable = class {\n  constructor() {\n    this.listeners = /* @__PURE__ */ new Set();\n    this.subscribe = this.subscribe.bind(this);\n  }\n  subscribe(listener) {\n    this.listeners.add(listener);\n    this.onSubscribe();\n    return () => {\n      this.listeners.delete(listener);\n      this.onUnsubscribe();\n    };\n  }\n  hasListeners() {\n    return this.listeners.size > 0;\n  }\n  onSubscribe() {\n  }\n  onUnsubscribe() {\n  }\n};\nexport {\n  Subscribable\n};\n//# sourceMappingURL=subscribable.js.map","// src/timeoutManager.ts\nvar defaultTimeoutProvider = {\n  // We need the wrapper function syntax below instead of direct references to\n  // global setTimeout etc.\n  //\n  // BAD: `setTimeout: setTimeout`\n  // GOOD: `setTimeout: (cb, delay) => setTimeout(cb, delay)`\n  //\n  // If we use direct references here, then anything that wants to spy on or\n  // replace the global setTimeout (like tests) won't work since we'll already\n  // have a hard reference to the original implementation at the time when this\n  // file was imported.\n  setTimeout: (callback, delay) => setTimeout(callback, delay),\n  clearTimeout: (timeoutId) => clearTimeout(timeoutId),\n  setInterval: (callback, delay) => setInterval(callback, delay),\n  clearInterval: (intervalId) => clearInterval(intervalId)\n};\nvar TimeoutManager = class {\n  // We cannot have TimeoutManager<T> as we must instantiate it with a concrete\n  // type at app boot; and if we leave that type, then any new timer provider\n  // would need to support ReturnType<typeof setTimeout>, which is infeasible.\n  //\n  // We settle for type safety for the TimeoutProvider type, and accept that\n  // this class is unsafe internally to allow for extension.\n  #provider = defaultTimeoutProvider;\n  #providerCalled = false;\n  setTimeoutProvider(provider) {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (this.#providerCalled && provider !== this.#provider) {\n        console.error(\n          `[timeoutManager]: Switching provider after calls to previous provider might result in unexpected behavior.`,\n          { previous: this.#provider, provider }\n        );\n      }\n    }\n    this.#provider = provider;\n    if (process.env.NODE_ENV !== \"production\") {\n      this.#providerCalled = false;\n    }\n  }\n  setTimeout(callback, delay) {\n    if (process.env.NODE_ENV !== \"production\") {\n      this.#providerCalled = true;\n    }\n    return this.#provider.setTimeout(callback, delay);\n  }\n  clearTimeout(timeoutId) {\n    this.#provider.clearTimeout(timeoutId);\n  }\n  setInterval(callback, delay) {\n    if (process.env.NODE_ENV !== \"production\") {\n      this.#providerCalled = true;\n    }\n    return this.#provider.setInterval(callback, delay);\n  }\n  clearInterval(intervalId) {\n    this.#provider.clearInterval(intervalId);\n  }\n};\nvar timeoutManager = new TimeoutManager();\nfunction systemSetTimeoutZero(callback) {\n  setTimeout(callback, 0);\n}\nexport {\n  TimeoutManager,\n  defaultTimeoutProvider,\n  systemSetTimeoutZero,\n  timeoutManager\n};\n//# sourceMappingURL=timeoutManager.js.map","// src/utils.ts\nimport { timeoutManager } from \"./timeoutManager.js\";\nvar isServer = typeof window === \"undefined\" || \"Deno\" in globalThis;\nfunction noop() {\n}\nfunction functionalUpdate(updater, input) {\n  return typeof updater === \"function\" ? updater(input) : updater;\n}\nfunction isValidTimeout(value) {\n  return typeof value === \"number\" && value >= 0 && value !== Infinity;\n}\nfunction timeUntilStale(updatedAt, staleTime) {\n  return Math.max(updatedAt + (staleTime || 0) - Date.now(), 0);\n}\nfunction resolveStaleTime(staleTime, query) {\n  return typeof staleTime === \"function\" ? staleTime(query) : staleTime;\n}\nfunction resolveEnabled(enabled, query) {\n  return typeof enabled === \"function\" ? enabled(query) : enabled;\n}\nfunction matchQuery(filters, query) {\n  const {\n    type = \"all\",\n    exact,\n    fetchStatus,\n    predicate,\n    queryKey,\n    stale\n  } = filters;\n  if (queryKey) {\n    if (exact) {\n      if (query.queryHash !== hashQueryKeyByOptions(queryKey, query.options)) {\n        return false;\n      }\n    } else if (!partialMatchKey(query.queryKey, queryKey)) {\n      return false;\n    }\n  }\n  if (type !== \"all\") {\n    const isActive = query.isActive();\n    if (type === \"active\" && !isActive) {\n      return false;\n    }\n    if (type === \"inactive\" && isActive) {\n      return false;\n    }\n  }\n  if (typeof stale === \"boolean\" && query.isStale() !== stale) {\n    return false;\n  }\n  if (fetchStatus && fetchStatus !== query.state.fetchStatus) {\n    return false;\n  }\n  if (predicate && !predicate(query)) {\n    return false;\n  }\n  return true;\n}\nfunction matchMutation(filters, mutation) {\n  const { exact, status, predicate, mutationKey } = filters;\n  if (mutationKey) {\n    if (!mutation.options.mutationKey) {\n      return false;\n    }\n    if (exact) {\n      if (hashKey(mutation.options.mutationKey) !== hashKey(mutationKey)) {\n        return false;\n      }\n    } else if (!partialMatchKey(mutation.options.mutationKey, mutationKey)) {\n      return false;\n    }\n  }\n  if (status && mutation.state.status !== status) {\n    return false;\n  }\n  if (predicate && !predicate(mutation)) {\n    return false;\n  }\n  return true;\n}\nfunction hashQueryKeyByOptions(queryKey, options) {\n  const hashFn = options?.queryKeyHashFn || hashKey;\n  return hashFn(queryKey);\n}\nfunction hashKey(queryKey) {\n  return JSON.stringify(\n    queryKey,\n    (_, val) => isPlainObject(val) ? Object.keys(val).sort().reduce((result, key) => {\n      result[key] = val[key];\n      return result;\n    }, {}) : val\n  );\n}\nfunction partialMatchKey(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (a && b && typeof a === \"object\" && typeof b === \"object\") {\n    return Object.keys(b).every((key) => partialMatchKey(a[key], b[key]));\n  }\n  return false;\n}\nvar hasOwn = Object.prototype.hasOwnProperty;\nfunction replaceEqualDeep(a, b) {\n  if (a === b) {\n    return a;\n  }\n  const array = isPlainArray(a) && isPlainArray(b);\n  if (!array && !(isPlainObject(a) && isPlainObject(b))) return b;\n  const aItems = array ? a : Object.keys(a);\n  const aSize = aItems.length;\n  const bItems = array ? b : Object.keys(b);\n  const bSize = bItems.length;\n  const copy = array ? new Array(bSize) : {};\n  let equalItems = 0;\n  for (let i = 0; i < bSize; i++) {\n    const key = array ? i : bItems[i];\n    const aItem = a[key];\n    const bItem = b[key];\n    if (aItem === bItem) {\n      copy[key] = aItem;\n      if (array ? i < aSize : hasOwn.call(a, key)) equalItems++;\n      continue;\n    }\n    if (aItem === null || bItem === null || typeof aItem !== \"object\" || typeof bItem !== \"object\") {\n      copy[key] = bItem;\n      continue;\n    }\n    const v = replaceEqualDeep(aItem, bItem);\n    copy[key] = v;\n    if (v === aItem) equalItems++;\n  }\n  return aSize === bSize && equalItems === aSize ? a : copy;\n}\nfunction shallowEqualObjects(a, b) {\n  if (!b || Object.keys(a).length !== Object.keys(b).length) {\n    return false;\n  }\n  for (const key in a) {\n    if (a[key] !== b[key]) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction isPlainArray(value) {\n  return Array.isArray(value) && value.length === Object.keys(value).length;\n}\nfunction isPlainObject(o) {\n  if (!hasObjectPrototype(o)) {\n    return false;\n  }\n  const ctor = o.constructor;\n  if (ctor === void 0) {\n    return true;\n  }\n  const prot = ctor.prototype;\n  if (!hasObjectPrototype(prot)) {\n    return false;\n  }\n  if (!prot.hasOwnProperty(\"isPrototypeOf\")) {\n    return false;\n  }\n  if (Object.getPrototypeOf(o) !== Object.prototype) {\n    return false;\n  }\n  return true;\n}\nfunction hasObjectPrototype(o) {\n  return Object.prototype.toString.call(o) === \"[object Object]\";\n}\nfunction sleep(timeout) {\n  return new Promise((resolve) => {\n    timeoutManager.setTimeout(resolve, timeout);\n  });\n}\nfunction replaceData(prevData, data, options) {\n  if (typeof options.structuralSharing === \"function\") {\n    return options.structuralSharing(prevData, data);\n  } else if (options.structuralSharing !== false) {\n    if (process.env.NODE_ENV !== \"production\") {\n      try {\n        return replaceEqualDeep(prevData, data);\n      } catch (error) {\n        console.error(\n          `Structural sharing requires data to be JSON serializable. To fix this, turn off structuralSharing or return JSON-serializable data from your queryFn. [${options.queryHash}]: ${error}`\n        );\n        throw error;\n      }\n    }\n    return replaceEqualDeep(prevData, data);\n  }\n  return data;\n}\nfunction keepPreviousData(previousData) {\n  return previousData;\n}\nfunction addToEnd(items, item, max = 0) {\n  const newItems = [...items, item];\n  return max && newItems.length > max ? newItems.slice(1) : newItems;\n}\nfunction addToStart(items, item, max = 0) {\n  const newItems = [item, ...items];\n  return max && newItems.length > max ? newItems.slice(0, -1) : newItems;\n}\nvar skipToken = Symbol();\nfunction ensureQueryFn(options, fetchOptions) {\n  if (process.env.NODE_ENV !== \"production\") {\n    if (options.queryFn === skipToken) {\n      console.error(\n        `Attempted to invoke queryFn when set to skipToken. This is likely a configuration error. Query hash: '${options.queryHash}'`\n      );\n    }\n  }\n  if (!options.queryFn && fetchOptions?.initialPromise) {\n    return () => fetchOptions.initialPromise;\n  }\n  if (!options.queryFn || options.queryFn === skipToken) {\n    return () => Promise.reject(new Error(`Missing queryFn: '${options.queryHash}'`));\n  }\n  return options.queryFn;\n}\nfunction shouldThrowError(throwOnError, params) {\n  if (typeof throwOnError === \"function\") {\n    return throwOnError(...params);\n  }\n  return !!throwOnError;\n}\nexport {\n  addToEnd,\n  addToStart,\n  ensureQueryFn,\n  functionalUpdate,\n  hashKey,\n  hashQueryKeyByOptions,\n  isPlainArray,\n  isPlainObject,\n  isServer,\n  isValidTimeout,\n  keepPreviousData,\n  matchMutation,\n  matchQuery,\n  noop,\n  partialMatchKey,\n  replaceData,\n  replaceEqualDeep,\n  resolveEnabled,\n  resolveStaleTime,\n  shallowEqualObjects,\n  shouldThrowError,\n  skipToken,\n  sleep,\n  timeUntilStale\n};\n//# sourceMappingURL=utils.js.map","// src/focusManager.ts\nimport { Subscribable } from \"./subscribable.js\";\nimport { isServer } from \"./utils.js\";\nvar FocusManager = class extends Subscribable {\n  #focused;\n  #cleanup;\n  #setup;\n  constructor() {\n    super();\n    this.#setup = (onFocus) => {\n      if (!isServer && window.addEventListener) {\n        const listener = () => onFocus();\n        window.addEventListener(\"visibilitychange\", listener, false);\n        return () => {\n          window.removeEventListener(\"visibilitychange\", listener);\n        };\n      }\n      return;\n    };\n  }\n  onSubscribe() {\n    if (!this.#cleanup) {\n      this.setEventListener(this.#setup);\n    }\n  }\n  onUnsubscribe() {\n    if (!this.hasListeners()) {\n      this.#cleanup?.();\n      this.#cleanup = void 0;\n    }\n  }\n  setEventListener(setup) {\n    this.#setup = setup;\n    this.#cleanup?.();\n    this.#cleanup = setup((focused) => {\n      if (typeof focused === \"boolean\") {\n        this.setFocused(focused);\n      } else {\n        this.onFocus();\n      }\n    });\n  }\n  setFocused(focused) {\n    const changed = this.#focused !== focused;\n    if (changed) {\n      this.#focused = focused;\n      this.onFocus();\n    }\n  }\n  onFocus() {\n    const isFocused = this.isFocused();\n    this.listeners.forEach((listener) => {\n      listener(isFocused);\n    });\n  }\n  isFocused() {\n    if (typeof this.#focused === \"boolean\") {\n      return this.#focused;\n    }\n    return globalThis.document?.visibilityState !== \"hidden\";\n  }\n};\nvar focusManager = new FocusManager();\nexport {\n  FocusManager,\n  focusManager\n};\n//# sourceMappingURL=focusManager.js.map","// src/thenable.ts\nimport { noop } from \"./utils.js\";\nfunction pendingThenable() {\n  let resolve;\n  let reject;\n  const thenable = new Promise((_resolve, _reject) => {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  thenable.status = \"pending\";\n  thenable.catch(() => {\n  });\n  function finalize(data) {\n    Object.assign(thenable, data);\n    delete thenable.resolve;\n    delete thenable.reject;\n  }\n  thenable.resolve = (value) => {\n    finalize({\n      status: \"fulfilled\",\n      value\n    });\n    resolve(value);\n  };\n  thenable.reject = (reason) => {\n    finalize({\n      status: \"rejected\",\n      reason\n    });\n    reject(reason);\n  };\n  return thenable;\n}\nfunction tryResolveSync(promise) {\n  let data;\n  promise.then((result) => {\n    data = result;\n    return result;\n  }, noop)?.catch(noop);\n  if (data !== void 0) {\n    return { data };\n  }\n  return void 0;\n}\nexport {\n  pendingThenable,\n  tryResolveSync\n};\n//# sourceMappingURL=thenable.js.map","// src/notifyManager.ts\nimport { systemSetTimeoutZero } from \"./timeoutManager.js\";\nvar defaultScheduler = systemSetTimeoutZero;\nfunction createNotifyManager() {\n  let queue = [];\n  let transactions = 0;\n  let notifyFn = (callback) => {\n    callback();\n  };\n  let batchNotifyFn = (callback) => {\n    callback();\n  };\n  let scheduleFn = defaultScheduler;\n  const schedule = (callback) => {\n    if (transactions) {\n      queue.push(callback);\n    } else {\n      scheduleFn(() => {\n        notifyFn(callback);\n      });\n    }\n  };\n  const flush = () => {\n    const originalQueue = queue;\n    queue = [];\n    if (originalQueue.length) {\n      scheduleFn(() => {\n        batchNotifyFn(() => {\n          originalQueue.forEach((callback) => {\n            notifyFn(callback);\n          });\n        });\n      });\n    }\n  };\n  return {\n    batch: (callback) => {\n      let result;\n      transactions++;\n      try {\n        result = callback();\n      } finally {\n        transactions--;\n        if (!transactions) {\n          flush();\n        }\n      }\n      return result;\n    },\n    /**\n     * All calls to the wrapped function will be batched.\n     */\n    batchCalls: (callback) => {\n      return (...args) => {\n        schedule(() => {\n          callback(...args);\n        });\n      };\n    },\n    schedule,\n    /**\n     * Use this method to set a custom notify function.\n     * This can be used to for example wrap notifications with `React.act` while running tests.\n     */\n    setNotifyFunction: (fn) => {\n      notifyFn = fn;\n    },\n    /**\n     * Use this method to set a custom function to batch notifications together into a single tick.\n     * By default React Query will use the batch function provided by ReactDOM or React Native.\n     */\n    setBatchNotifyFunction: (fn) => {\n      batchNotifyFn = fn;\n    },\n    setScheduler: (fn) => {\n      scheduleFn = fn;\n    }\n  };\n}\nvar notifyManager = createNotifyManager();\nexport {\n  createNotifyManager,\n  defaultScheduler,\n  notifyManager\n};\n//# sourceMappingURL=notifyManager.js.map","// src/onlineManager.ts\nimport { Subscribable } from \"./subscribable.js\";\nimport { isServer } from \"./utils.js\";\nvar OnlineManager = class extends Subscribable {\n  #online = true;\n  #cleanup;\n  #setup;\n  constructor() {\n    super();\n    this.#setup = (onOnline) => {\n      if (!isServer && window.addEventListener) {\n        const onlineListener = () => onOnline(true);\n        const offlineListener = () => onOnline(false);\n        window.addEventListener(\"online\", onlineListener, false);\n        window.addEventListener(\"offline\", offlineListener, false);\n        return () => {\n          window.removeEventListener(\"online\", onlineListener);\n          window.removeEventListener(\"offline\", offlineListener);\n        };\n      }\n      return;\n    };\n  }\n  onSubscribe() {\n    if (!this.#cleanup) {\n      this.setEventListener(this.#setup);\n    }\n  }\n  onUnsubscribe() {\n    if (!this.hasListeners()) {\n      this.#cleanup?.();\n      this.#cleanup = void 0;\n    }\n  }\n  setEventListener(setup) {\n    this.#setup = setup;\n    this.#cleanup?.();\n    this.#cleanup = setup(this.setOnline.bind(this));\n  }\n  setOnline(online) {\n    const changed = this.#online !== online;\n    if (changed) {\n      this.#online = online;\n      this.listeners.forEach((listener) => {\n        listener(online);\n      });\n    }\n  }\n  isOnline() {\n    return this.#online;\n  }\n};\nvar onlineManager = new OnlineManager();\nexport {\n  OnlineManager,\n  onlineManager\n};\n//# sourceMappingURL=onlineManager.js.map","// src/retryer.ts\nimport { focusManager } from \"./focusManager.js\";\nimport { onlineManager } from \"./onlineManager.js\";\nimport { pendingThenable } from \"./thenable.js\";\nimport { isServer, sleep } from \"./utils.js\";\nfunction defaultRetryDelay(failureCount) {\n  return Math.min(1e3 * 2 ** failureCount, 3e4);\n}\nfunction canFetch(networkMode) {\n  return (networkMode ?? \"online\") === \"online\" ? onlineManager.isOnline() : true;\n}\nvar CancelledError = class extends Error {\n  constructor(options) {\n    super(\"CancelledError\");\n    this.revert = options?.revert;\n    this.silent = options?.silent;\n  }\n};\nfunction isCancelledError(value) {\n  return value instanceof CancelledError;\n}\nfunction createRetryer(config) {\n  let isRetryCancelled = false;\n  let failureCount = 0;\n  let continueFn;\n  const thenable = pendingThenable();\n  const isResolved = () => thenable.status !== \"pending\";\n  const cancel = (cancelOptions) => {\n    if (!isResolved()) {\n      const error = new CancelledError(cancelOptions);\n      reject(error);\n      config.onCancel?.(error);\n    }\n  };\n  const cancelRetry = () => {\n    isRetryCancelled = true;\n  };\n  const continueRetry = () => {\n    isRetryCancelled = false;\n  };\n  const canContinue = () => focusManager.isFocused() && (config.networkMode === \"always\" || onlineManager.isOnline()) && config.canRun();\n  const canStart = () => canFetch(config.networkMode) && config.canRun();\n  const resolve = (value) => {\n    if (!isResolved()) {\n      continueFn?.();\n      thenable.resolve(value);\n    }\n  };\n  const reject = (value) => {\n    if (!isResolved()) {\n      continueFn?.();\n      thenable.reject(value);\n    }\n  };\n  const pause = () => {\n    return new Promise((continueResolve) => {\n      continueFn = (value) => {\n        if (isResolved() || canContinue()) {\n          continueResolve(value);\n        }\n      };\n      config.onPause?.();\n    }).then(() => {\n      continueFn = void 0;\n      if (!isResolved()) {\n        config.onContinue?.();\n      }\n    });\n  };\n  const run = () => {\n    if (isResolved()) {\n      return;\n    }\n    let promiseOrValue;\n    const initialPromise = failureCount === 0 ? config.initialPromise : void 0;\n    try {\n      promiseOrValue = initialPromise ?? config.fn();\n    } catch (error) {\n      promiseOrValue = Promise.reject(error);\n    }\n    Promise.resolve(promiseOrValue).then(resolve).catch((error) => {\n      if (isResolved()) {\n        return;\n      }\n      const retry = config.retry ?? (isServer ? 0 : 3);\n      const retryDelay = config.retryDelay ?? defaultRetryDelay;\n      const delay = typeof retryDelay === \"function\" ? retryDelay(failureCount, error) : retryDelay;\n      const shouldRetry = retry === true || typeof retry === \"number\" && failureCount < retry || typeof retry === \"function\" && retry(failureCount, error);\n      if (isRetryCancelled || !shouldRetry) {\n        reject(error);\n        return;\n      }\n      failureCount++;\n      config.onFail?.(failureCount, error);\n      sleep(delay).then(() => {\n        return canContinue() ? void 0 : pause();\n      }).then(() => {\n        if (isRetryCancelled) {\n          reject(error);\n        } else {\n          run();\n        }\n      });\n    });\n  };\n  return {\n    promise: thenable,\n    status: () => thenable.status,\n    cancel,\n    continue: () => {\n      continueFn?.();\n      return thenable;\n    },\n    cancelRetry,\n    continueRetry,\n    canStart,\n    start: () => {\n      if (canStart()) {\n        run();\n      } else {\n        pause().then(run);\n      }\n      return thenable;\n    }\n  };\n}\nexport {\n  CancelledError,\n  canFetch,\n  createRetryer,\n  isCancelledError\n};\n//# sourceMappingURL=retryer.js.map","// src/removable.ts\nimport { timeoutManager } from \"./timeoutManager.js\";\nimport { isServer, isValidTimeout } from \"./utils.js\";\nvar Removable = class {\n  #gcTimeout;\n  destroy() {\n    this.clearGcTimeout();\n  }\n  scheduleGc() {\n    this.clearGcTimeout();\n    if (isValidTimeout(this.gcTime)) {\n      this.#gcTimeout = timeoutManager.setTimeout(() => {\n        this.optionalRemove();\n      }, this.gcTime);\n    }\n  }\n  updateGcTime(newGcTime) {\n    this.gcTime = Math.max(\n      this.gcTime || 0,\n      newGcTime ?? (isServer ? Infinity : 5 * 60 * 1e3)\n    );\n  }\n  clearGcTimeout() {\n    if (this.#gcTimeout) {\n      timeoutManager.clearTimeout(this.#gcTimeout);\n      this.#gcTimeout = void 0;\n    }\n  }\n};\nexport {\n  Removable\n};\n//# sourceMappingURL=removable.js.map","// src/query.ts\nimport {\n  ensureQueryFn,\n  noop,\n  replaceData,\n  resolveEnabled,\n  resolveStaleTime,\n  skipToken,\n  timeUntilStale\n} from \"./utils.js\";\nimport { notifyManager } from \"./notifyManager.js\";\nimport { CancelledError, canFetch, createRetryer } from \"./retryer.js\";\nimport { Removable } from \"./removable.js\";\nvar Query = class extends Removable {\n  #initialState;\n  #revertState;\n  #cache;\n  #client;\n  #retryer;\n  #defaultOptions;\n  #abortSignalConsumed;\n  constructor(config) {\n    super();\n    this.#abortSignalConsumed = false;\n    this.#defaultOptions = config.defaultOptions;\n    this.setOptions(config.options);\n    this.observers = [];\n    this.#client = config.client;\n    this.#cache = this.#client.getQueryCache();\n    this.queryKey = config.queryKey;\n    this.queryHash = config.queryHash;\n    this.#initialState = getDefaultState(this.options);\n    this.state = config.state ?? this.#initialState;\n    this.scheduleGc();\n  }\n  get meta() {\n    return this.options.meta;\n  }\n  get promise() {\n    return this.#retryer?.promise;\n  }\n  setOptions(options) {\n    this.options = { ...this.#defaultOptions, ...options };\n    this.updateGcTime(this.options.gcTime);\n    if (this.state && this.state.data === void 0) {\n      const defaultState = getDefaultState(this.options);\n      if (defaultState.data !== void 0) {\n        this.setData(defaultState.data, {\n          updatedAt: defaultState.dataUpdatedAt,\n          manual: true\n        });\n        this.#initialState = defaultState;\n      }\n    }\n  }\n  optionalRemove() {\n    if (!this.observers.length && this.state.fetchStatus === \"idle\") {\n      this.#cache.remove(this);\n    }\n  }\n  setData(newData, options) {\n    const data = replaceData(this.state.data, newData, this.options);\n    this.#dispatch({\n      data,\n      type: \"success\",\n      dataUpdatedAt: options?.updatedAt,\n      manual: options?.manual\n    });\n    return data;\n  }\n  setState(state, setStateOptions) {\n    this.#dispatch({ type: \"setState\", state, setStateOptions });\n  }\n  cancel(options) {\n    const promise = this.#retryer?.promise;\n    this.#retryer?.cancel(options);\n    return promise ? promise.then(noop).catch(noop) : Promise.resolve();\n  }\n  destroy() {\n    super.destroy();\n    this.cancel({ silent: true });\n  }\n  reset() {\n    this.destroy();\n    this.setState(this.#initialState);\n  }\n  isActive() {\n    return this.observers.some(\n      (observer) => resolveEnabled(observer.options.enabled, this) !== false\n    );\n  }\n  isDisabled() {\n    if (this.getObserversCount() > 0) {\n      return !this.isActive();\n    }\n    return this.options.queryFn === skipToken || this.state.dataUpdateCount + this.state.errorUpdateCount === 0;\n  }\n  isStatic() {\n    if (this.getObserversCount() > 0) {\n      return this.observers.some(\n        (observer) => resolveStaleTime(observer.options.staleTime, this) === \"static\"\n      );\n    }\n    return false;\n  }\n  isStale() {\n    if (this.getObserversCount() > 0) {\n      return this.observers.some(\n        (observer) => observer.getCurrentResult().isStale\n      );\n    }\n    return this.state.data === void 0 || this.state.isInvalidated;\n  }\n  isStaleByTime(staleTime = 0) {\n    if (this.state.data === void 0) {\n      return true;\n    }\n    if (staleTime === \"static\") {\n      return false;\n    }\n    if (this.state.isInvalidated) {\n      return true;\n    }\n    return !timeUntilStale(this.state.dataUpdatedAt, staleTime);\n  }\n  onFocus() {\n    const observer = this.observers.find((x) => x.shouldFetchOnWindowFocus());\n    observer?.refetch({ cancelRefetch: false });\n    this.#retryer?.continue();\n  }\n  onOnline() {\n    const observer = this.observers.find((x) => x.shouldFetchOnReconnect());\n    observer?.refetch({ cancelRefetch: false });\n    this.#retryer?.continue();\n  }\n  addObserver(observer) {\n    if (!this.observers.includes(observer)) {\n      this.observers.push(observer);\n      this.clearGcTimeout();\n      this.#cache.notify({ type: \"observerAdded\", query: this, observer });\n    }\n  }\n  removeObserver(observer) {\n    if (this.observers.includes(observer)) {\n      this.observers = this.observers.filter((x) => x !== observer);\n      if (!this.observers.length) {\n        if (this.#retryer) {\n          if (this.#abortSignalConsumed) {\n            this.#retryer.cancel({ revert: true });\n          } else {\n            this.#retryer.cancelRetry();\n          }\n        }\n        this.scheduleGc();\n      }\n      this.#cache.notify({ type: \"observerRemoved\", query: this, observer });\n    }\n  }\n  getObserversCount() {\n    return this.observers.length;\n  }\n  invalidate() {\n    if (!this.state.isInvalidated) {\n      this.#dispatch({ type: \"invalidate\" });\n    }\n  }\n  async fetch(options, fetchOptions) {\n    if (this.state.fetchStatus !== \"idle\" && // If the promise in the retyer is already rejected, we have to definitely\n    // re-start the fetch; there is a chance that the query is still in a\n    // pending state when that happens\n    this.#retryer?.status() !== \"rejected\") {\n      if (this.state.data !== void 0 && fetchOptions?.cancelRefetch) {\n        this.cancel({ silent: true });\n      } else if (this.#retryer) {\n        this.#retryer.continueRetry();\n        return this.#retryer.promise;\n      }\n    }\n    if (options) {\n      this.setOptions(options);\n    }\n    if (!this.options.queryFn) {\n      const observer = this.observers.find((x) => x.options.queryFn);\n      if (observer) {\n        this.setOptions(observer.options);\n      }\n    }\n    if (process.env.NODE_ENV !== \"production\") {\n      if (!Array.isArray(this.options.queryKey)) {\n        console.error(\n          `As of v4, queryKey needs to be an Array. If you are using a string like 'repoData', please change it to an Array, e.g. ['repoData']`\n        );\n      }\n    }\n    const abortController = new AbortController();\n    const addSignalProperty = (object) => {\n      Object.defineProperty(object, \"signal\", {\n        enumerable: true,\n        get: () => {\n          this.#abortSignalConsumed = true;\n          return abortController.signal;\n        }\n      });\n    };\n    const fetchFn = () => {\n      const queryFn = ensureQueryFn(this.options, fetchOptions);\n      const createQueryFnContext = () => {\n        const queryFnContext2 = {\n          client: this.#client,\n          queryKey: this.queryKey,\n          meta: this.meta\n        };\n        addSignalProperty(queryFnContext2);\n        return queryFnContext2;\n      };\n      const queryFnContext = createQueryFnContext();\n      this.#abortSignalConsumed = false;\n      if (this.options.persister) {\n        return this.options.persister(\n          queryFn,\n          queryFnContext,\n          this\n        );\n      }\n      return queryFn(queryFnContext);\n    };\n    const createFetchContext = () => {\n      const context2 = {\n        fetchOptions,\n        options: this.options,\n        queryKey: this.queryKey,\n        client: this.#client,\n        state: this.state,\n        fetchFn\n      };\n      addSignalProperty(context2);\n      return context2;\n    };\n    const context = createFetchContext();\n    this.options.behavior?.onFetch(context, this);\n    this.#revertState = this.state;\n    if (this.state.fetchStatus === \"idle\" || this.state.fetchMeta !== context.fetchOptions?.meta) {\n      this.#dispatch({ type: \"fetch\", meta: context.fetchOptions?.meta });\n    }\n    this.#retryer = createRetryer({\n      initialPromise: fetchOptions?.initialPromise,\n      fn: context.fetchFn,\n      onCancel: (error) => {\n        if (error instanceof CancelledError && error.revert) {\n          this.setState({\n            ...this.#revertState,\n            fetchStatus: \"idle\"\n          });\n        }\n        abortController.abort();\n      },\n      onFail: (failureCount, error) => {\n        this.#dispatch({ type: \"failed\", failureCount, error });\n      },\n      onPause: () => {\n        this.#dispatch({ type: \"pause\" });\n      },\n      onContinue: () => {\n        this.#dispatch({ type: \"continue\" });\n      },\n      retry: context.options.retry,\n      retryDelay: context.options.retryDelay,\n      networkMode: context.options.networkMode,\n      canRun: () => true\n    });\n    try {\n      const data = await this.#retryer.start();\n      if (data === void 0) {\n        if (process.env.NODE_ENV !== \"production\") {\n          console.error(\n            `Query data cannot be undefined. Please make sure to return a value other than undefined from your query function. Affected query key: ${this.queryHash}`\n          );\n        }\n        throw new Error(`${this.queryHash} data is undefined`);\n      }\n      this.setData(data);\n      this.#cache.config.onSuccess?.(data, this);\n      this.#cache.config.onSettled?.(\n        data,\n        this.state.error,\n        this\n      );\n      return data;\n    } catch (error) {\n      if (error instanceof CancelledError) {\n        if (error.silent) {\n          return this.#retryer.promise;\n        } else if (error.revert) {\n          if (this.state.data === void 0) {\n            throw error;\n          }\n          return this.state.data;\n        }\n      }\n      this.#dispatch({\n        type: \"error\",\n        error\n      });\n      this.#cache.config.onError?.(\n        error,\n        this\n      );\n      this.#cache.config.onSettled?.(\n        this.state.data,\n        error,\n        this\n      );\n      throw error;\n    } finally {\n      this.scheduleGc();\n    }\n  }\n  #dispatch(action) {\n    const reducer = (state) => {\n      switch (action.type) {\n        case \"failed\":\n          return {\n            ...state,\n            fetchFailureCount: action.failureCount,\n            fetchFailureReason: action.error\n          };\n        case \"pause\":\n          return {\n            ...state,\n            fetchStatus: \"paused\"\n          };\n        case \"continue\":\n          return {\n            ...state,\n            fetchStatus: \"fetching\"\n          };\n        case \"fetch\":\n          return {\n            ...state,\n            ...fetchState(state.data, this.options),\n            fetchMeta: action.meta ?? null\n          };\n        case \"success\":\n          const newState = {\n            ...state,\n            data: action.data,\n            dataUpdateCount: state.dataUpdateCount + 1,\n            dataUpdatedAt: action.dataUpdatedAt ?? Date.now(),\n            error: null,\n            isInvalidated: false,\n            status: \"success\",\n            ...!action.manual && {\n              fetchStatus: \"idle\",\n              fetchFailureCount: 0,\n              fetchFailureReason: null\n            }\n          };\n          this.#revertState = action.manual ? newState : void 0;\n          return newState;\n        case \"error\":\n          const error = action.error;\n          return {\n            ...state,\n            error,\n            errorUpdateCount: state.errorUpdateCount + 1,\n            errorUpdatedAt: Date.now(),\n            fetchFailureCount: state.fetchFailureCount + 1,\n            fetchFailureReason: error,\n            fetchStatus: \"idle\",\n            status: \"error\"\n          };\n        case \"invalidate\":\n          return {\n            ...state,\n            isInvalidated: true\n          };\n        case \"setState\":\n          return {\n            ...state,\n            ...action.state\n          };\n      }\n    };\n    this.state = reducer(this.state);\n    notifyManager.batch(() => {\n      this.observers.forEach((observer) => {\n        observer.onQueryUpdate();\n      });\n      this.#cache.notify({ query: this, type: \"updated\", action });\n    });\n  }\n};\nfunction fetchState(data, options) {\n  return {\n    fetchFailureCount: 0,\n    fetchFailureReason: null,\n    fetchStatus: canFetch(options.networkMode) ? \"fetching\" : \"paused\",\n    ...data === void 0 && {\n      error: null,\n      status: \"pending\"\n    }\n  };\n}\nfunction getDefaultState(options) {\n  const data = typeof options.initialData === \"function\" ? options.initialData() : options.initialData;\n  const hasData = data !== void 0;\n  const initialDataUpdatedAt = hasData ? typeof options.initialDataUpdatedAt === \"function\" ? options.initialDataUpdatedAt() : options.initialDataUpdatedAt : 0;\n  return {\n    data,\n    dataUpdateCount: 0,\n    dataUpdatedAt: hasData ? initialDataUpdatedAt ?? Date.now() : 0,\n    error: null,\n    errorUpdateCount: 0,\n    errorUpdatedAt: 0,\n    fetchFailureCount: 0,\n    fetchFailureReason: null,\n    fetchMeta: null,\n    isInvalidated: false,\n    status: hasData ? \"success\" : \"pending\",\n    fetchStatus: \"idle\"\n  };\n}\nexport {\n  Query,\n  fetchState\n};\n//# sourceMappingURL=query.js.map","// src/infiniteQueryBehavior.ts\nimport { addToEnd, addToStart, ensureQueryFn } from \"./utils.js\";\nfunction infiniteQueryBehavior(pages) {\n  return {\n    onFetch: (context, query) => {\n      const options = context.options;\n      const direction = context.fetchOptions?.meta?.fetchMore?.direction;\n      const oldPages = context.state.data?.pages || [];\n      const oldPageParams = context.state.data?.pageParams || [];\n      let result = { pages: [], pageParams: [] };\n      let currentPage = 0;\n      const fetchFn = async () => {\n        let cancelled = false;\n        const addSignalProperty = (object) => {\n          Object.defineProperty(object, \"signal\", {\n            enumerable: true,\n            get: () => {\n              if (context.signal.aborted) {\n                cancelled = true;\n              } else {\n                context.signal.addEventListener(\"abort\", () => {\n                  cancelled = true;\n                });\n              }\n              return context.signal;\n            }\n          });\n        };\n        const queryFn = ensureQueryFn(context.options, context.fetchOptions);\n        const fetchPage = async (data, param, previous) => {\n          if (cancelled) {\n            return Promise.reject();\n          }\n          if (param == null && data.pages.length) {\n            return Promise.resolve(data);\n          }\n          const createQueryFnContext = () => {\n            const queryFnContext2 = {\n              client: context.client,\n              queryKey: context.queryKey,\n              pageParam: param,\n              direction: previous ? \"backward\" : \"forward\",\n              meta: context.options.meta\n            };\n            addSignalProperty(queryFnContext2);\n            return queryFnContext2;\n          };\n          const queryFnContext = createQueryFnContext();\n          const page = await queryFn(queryFnContext);\n          const { maxPages } = context.options;\n          const addTo = previous ? addToStart : addToEnd;\n          return {\n            pages: addTo(data.pages, page, maxPages),\n            pageParams: addTo(data.pageParams, param, maxPages)\n          };\n        };\n        if (direction && oldPages.length) {\n          const previous = direction === \"backward\";\n          const pageParamFn = previous ? getPreviousPageParam : getNextPageParam;\n          const oldData = {\n            pages: oldPages,\n            pageParams: oldPageParams\n          };\n          const param = pageParamFn(options, oldData);\n          result = await fetchPage(oldData, param, previous);\n        } else {\n          const remainingPages = pages ?? oldPages.length;\n          do {\n            const param = currentPage === 0 ? oldPageParams[0] ?? options.initialPageParam : getNextPageParam(options, result);\n            if (currentPage > 0 && param == null) {\n              break;\n            }\n            result = await fetchPage(result, param);\n            currentPage++;\n          } while (currentPage < remainingPages);\n        }\n        return result;\n      };\n      if (context.options.persister) {\n        context.fetchFn = () => {\n          return context.options.persister?.(\n            fetchFn,\n            {\n              client: context.client,\n              queryKey: context.queryKey,\n              meta: context.options.meta,\n              signal: context.signal\n            },\n            query\n          );\n        };\n      } else {\n        context.fetchFn = fetchFn;\n      }\n    }\n  };\n}\nfunction getNextPageParam(options, { pages, pageParams }) {\n  const lastIndex = pages.length - 1;\n  return pages.length > 0 ? options.getNextPageParam(\n    pages[lastIndex],\n    pages,\n    pageParams[lastIndex],\n    pageParams\n  ) : void 0;\n}\nfunction getPreviousPageParam(options, { pages, pageParams }) {\n  return pages.length > 0 ? options.getPreviousPageParam?.(pages[0], pages, pageParams[0], pageParams) : void 0;\n}\nfunction hasNextPage(options, data) {\n  if (!data) return false;\n  return getNextPageParam(options, data) != null;\n}\nfunction hasPreviousPage(options, data) {\n  if (!data || !options.getPreviousPageParam) return false;\n  return getPreviousPageParam(options, data) != null;\n}\nexport {\n  hasNextPage,\n  hasPreviousPage,\n  infiniteQueryBehavior\n};\n//# sourceMappingURL=infiniteQueryBehavior.js.map","// src/mutation.ts\nimport { notifyManager } from \"./notifyManager.js\";\nimport { Removable } from \"./removable.js\";\nimport { createRetryer } from \"./retryer.js\";\nvar Mutation = class extends Removable {\n  #client;\n  #observers;\n  #mutationCache;\n  #retryer;\n  constructor(config) {\n    super();\n    this.#client = config.client;\n    this.mutationId = config.mutationId;\n    this.#mutationCache = config.mutationCache;\n    this.#observers = [];\n    this.state = config.state || getDefaultState();\n    this.setOptions(config.options);\n    this.scheduleGc();\n  }\n  setOptions(options) {\n    this.options = options;\n    this.updateGcTime(this.options.gcTime);\n  }\n  get meta() {\n    return this.options.meta;\n  }\n  addObserver(observer) {\n    if (!this.#observers.includes(observer)) {\n      this.#observers.push(observer);\n      this.clearGcTimeout();\n      this.#mutationCache.notify({\n        type: \"observerAdded\",\n        mutation: this,\n        observer\n      });\n    }\n  }\n  removeObserver(observer) {\n    this.#observers = this.#observers.filter((x) => x !== observer);\n    this.scheduleGc();\n    this.#mutationCache.notify({\n      type: \"observerRemoved\",\n      mutation: this,\n      observer\n    });\n  }\n  optionalRemove() {\n    if (!this.#observers.length) {\n      if (this.state.status === \"pending\") {\n        this.scheduleGc();\n      } else {\n        this.#mutationCache.remove(this);\n      }\n    }\n  }\n  continue() {\n    return this.#retryer?.continue() ?? // continuing a mutation assumes that variables are set, mutation must have been dehydrated before\n    this.execute(this.state.variables);\n  }\n  async execute(variables) {\n    const onContinue = () => {\n      this.#dispatch({ type: \"continue\" });\n    };\n    const mutationFnContext = {\n      client: this.#client,\n      meta: this.options.meta,\n      mutationKey: this.options.mutationKey\n    };\n    this.#retryer = createRetryer({\n      fn: () => {\n        if (!this.options.mutationFn) {\n          return Promise.reject(new Error(\"No mutationFn found\"));\n        }\n        return this.options.mutationFn(variables, mutationFnContext);\n      },\n      onFail: (failureCount, error) => {\n        this.#dispatch({ type: \"failed\", failureCount, error });\n      },\n      onPause: () => {\n        this.#dispatch({ type: \"pause\" });\n      },\n      onContinue,\n      retry: this.options.retry ?? 0,\n      retryDelay: this.options.retryDelay,\n      networkMode: this.options.networkMode,\n      canRun: () => this.#mutationCache.canRun(this)\n    });\n    const restored = this.state.status === \"pending\";\n    const isPaused = !this.#retryer.canStart();\n    try {\n      if (restored) {\n        onContinue();\n      } else {\n        this.#dispatch({ type: \"pending\", variables, isPaused });\n        await this.#mutationCache.config.onMutate?.(\n          variables,\n          this,\n          mutationFnContext\n        );\n        const context = await this.options.onMutate?.(\n          variables,\n          mutationFnContext\n        );\n        if (context !== this.state.context) {\n          this.#dispatch({\n            type: \"pending\",\n            context,\n            variables,\n            isPaused\n          });\n        }\n      }\n      const data = await this.#retryer.start();\n      await this.#mutationCache.config.onSuccess?.(\n        data,\n        variables,\n        this.state.context,\n        this,\n        mutationFnContext\n      );\n      await this.options.onSuccess?.(\n        data,\n        variables,\n        this.state.context,\n        mutationFnContext\n      );\n      await this.#mutationCache.config.onSettled?.(\n        data,\n        null,\n        this.state.variables,\n        this.state.context,\n        this,\n        mutationFnContext\n      );\n      await this.options.onSettled?.(\n        data,\n        null,\n        variables,\n        this.state.context,\n        mutationFnContext\n      );\n      this.#dispatch({ type: \"success\", data });\n      return data;\n    } catch (error) {\n      try {\n        await this.#mutationCache.config.onError?.(\n          error,\n          variables,\n          this.state.context,\n          this,\n          mutationFnContext\n        );\n        await this.options.onError?.(\n          error,\n          variables,\n          this.state.context,\n          mutationFnContext\n        );\n        await this.#mutationCache.config.onSettled?.(\n          void 0,\n          error,\n          this.state.variables,\n          this.state.context,\n          this,\n          mutationFnContext\n        );\n        await this.options.onSettled?.(\n          void 0,\n          error,\n          variables,\n          this.state.context,\n          mutationFnContext\n        );\n        throw error;\n      } finally {\n        this.#dispatch({ type: \"error\", error });\n      }\n    } finally {\n      this.#mutationCache.runNext(this);\n    }\n  }\n  #dispatch(action) {\n    const reducer = (state) => {\n      switch (action.type) {\n        case \"failed\":\n          return {\n            ...state,\n            failureCount: action.failureCount,\n            failureReason: action.error\n          };\n        case \"pause\":\n          return {\n            ...state,\n            isPaused: true\n          };\n        case \"continue\":\n          return {\n            ...state,\n            isPaused: false\n          };\n        case \"pending\":\n          return {\n            ...state,\n            context: action.context,\n            data: void 0,\n            failureCount: 0,\n            failureReason: null,\n            error: null,\n            isPaused: action.isPaused,\n            status: \"pending\",\n            variables: action.variables,\n            submittedAt: Date.now()\n          };\n        case \"success\":\n          return {\n            ...state,\n            data: action.data,\n            failureCount: 0,\n            failureReason: null,\n            error: null,\n            status: \"success\",\n            isPaused: false\n          };\n        case \"error\":\n          return {\n            ...state,\n            data: void 0,\n            error: action.error,\n            failureCount: state.failureCount + 1,\n            failureReason: action.error,\n            isPaused: false,\n            status: \"error\"\n          };\n      }\n    };\n    this.state = reducer(this.state);\n    notifyManager.batch(() => {\n      this.#observers.forEach((observer) => {\n        observer.onMutationUpdate(action);\n      });\n      this.#mutationCache.notify({\n        mutation: this,\n        type: \"updated\",\n        action\n      });\n    });\n  }\n};\nfunction getDefaultState() {\n  return {\n    context: void 0,\n    data: void 0,\n    error: null,\n    failureCount: 0,\n    failureReason: null,\n    isPaused: false,\n    status: \"idle\",\n    variables: void 0,\n    submittedAt: 0\n  };\n}\nexport {\n  Mutation,\n  getDefaultState\n};\n//# sourceMappingURL=mutation.js.map","// src/mutationCache.ts\nimport { notifyManager } from \"./notifyManager.js\";\nimport { Mutation } from \"./mutation.js\";\nimport { matchMutation, noop } from \"./utils.js\";\nimport { Subscribable } from \"./subscribable.js\";\nvar MutationCache = class extends Subscribable {\n  constructor(config = {}) {\n    super();\n    this.config = config;\n    this.#mutations = /* @__PURE__ */ new Set();\n    this.#scopes = /* @__PURE__ */ new Map();\n    this.#mutationId = 0;\n  }\n  #mutations;\n  #scopes;\n  #mutationId;\n  build(client, options, state) {\n    const mutation = new Mutation({\n      client,\n      mutationCache: this,\n      mutationId: ++this.#mutationId,\n      options: client.defaultMutationOptions(options),\n      state\n    });\n    this.add(mutation);\n    return mutation;\n  }\n  add(mutation) {\n    this.#mutations.add(mutation);\n    const scope = scopeFor(mutation);\n    if (typeof scope === \"string\") {\n      const scopedMutations = this.#scopes.get(scope);\n      if (scopedMutations) {\n        scopedMutations.push(mutation);\n      } else {\n        this.#scopes.set(scope, [mutation]);\n      }\n    }\n    this.notify({ type: \"added\", mutation });\n  }\n  remove(mutation) {\n    if (this.#mutations.delete(mutation)) {\n      const scope = scopeFor(mutation);\n      if (typeof scope === \"string\") {\n        const scopedMutations = this.#scopes.get(scope);\n        if (scopedMutations) {\n          if (scopedMutations.length > 1) {\n            const index = scopedMutations.indexOf(mutation);\n            if (index !== -1) {\n              scopedMutations.splice(index, 1);\n            }\n          } else if (scopedMutations[0] === mutation) {\n            this.#scopes.delete(scope);\n          }\n        }\n      }\n    }\n    this.notify({ type: \"removed\", mutation });\n  }\n  canRun(mutation) {\n    const scope = scopeFor(mutation);\n    if (typeof scope === \"string\") {\n      const mutationsWithSameScope = this.#scopes.get(scope);\n      const firstPendingMutation = mutationsWithSameScope?.find(\n        (m) => m.state.status === \"pending\"\n      );\n      return !firstPendingMutation || firstPendingMutation === mutation;\n    } else {\n      return true;\n    }\n  }\n  runNext(mutation) {\n    const scope = scopeFor(mutation);\n    if (typeof scope === \"string\") {\n      const foundMutation = this.#scopes.get(scope)?.find((m) => m !== mutation && m.state.isPaused);\n      return foundMutation?.continue() ?? Promise.resolve();\n    } else {\n      return Promise.resolve();\n    }\n  }\n  clear() {\n    notifyManager.batch(() => {\n      this.#mutations.forEach((mutation) => {\n        this.notify({ type: \"removed\", mutation });\n      });\n      this.#mutations.clear();\n      this.#scopes.clear();\n    });\n  }\n  getAll() {\n    return Array.from(this.#mutations);\n  }\n  find(filters) {\n    const defaultedFilters = { exact: true, ...filters };\n    return this.getAll().find(\n      (mutation) => matchMutation(defaultedFilters, mutation)\n    );\n  }\n  findAll(filters = {}) {\n    return this.getAll().filter((mutation) => matchMutation(filters, mutation));\n  }\n  notify(event) {\n    notifyManager.batch(() => {\n      this.listeners.forEach((listener) => {\n        listener(event);\n      });\n    });\n  }\n  resumePausedMutations() {\n    const pausedMutations = this.getAll().filter((x) => x.state.isPaused);\n    return notifyManager.batch(\n      () => Promise.all(\n        pausedMutations.map((mutation) => mutation.continue().catch(noop))\n      )\n    );\n  }\n};\nfunction scopeFor(mutation) {\n  return mutation.options.scope?.id;\n}\nexport {\n  MutationCache\n};\n//# sourceMappingURL=mutationCache.js.map","// src/queryCache.ts\nimport { hashQueryKeyByOptions, matchQuery } from \"./utils.js\";\nimport { Query } from \"./query.js\";\nimport { notifyManager } from \"./notifyManager.js\";\nimport { Subscribable } from \"./subscribable.js\";\nvar QueryCache = class extends Subscribable {\n  constructor(config = {}) {\n    super();\n    this.config = config;\n    this.#queries = /* @__PURE__ */ new Map();\n  }\n  #queries;\n  build(client, options, state) {\n    const queryKey = options.queryKey;\n    const queryHash = options.queryHash ?? hashQueryKeyByOptions(queryKey, options);\n    let query = this.get(queryHash);\n    if (!query) {\n      query = new Query({\n        client,\n        queryKey,\n        queryHash,\n        options: client.defaultQueryOptions(options),\n        state,\n        defaultOptions: client.getQueryDefaults(queryKey)\n      });\n      this.add(query);\n    }\n    return query;\n  }\n  add(query) {\n    if (!this.#queries.has(query.queryHash)) {\n      this.#queries.set(query.queryHash, query);\n      this.notify({\n        type: \"added\",\n        query\n      });\n    }\n  }\n  remove(query) {\n    const queryInMap = this.#queries.get(query.queryHash);\n    if (queryInMap) {\n      query.destroy();\n      if (queryInMap === query) {\n        this.#queries.delete(query.queryHash);\n      }\n      this.notify({ type: \"removed\", query });\n    }\n  }\n  clear() {\n    notifyManager.batch(() => {\n      this.getAll().forEach((query) => {\n        this.remove(query);\n      });\n    });\n  }\n  get(queryHash) {\n    return this.#queries.get(queryHash);\n  }\n  getAll() {\n    return [...this.#queries.values()];\n  }\n  find(filters) {\n    const defaultedFilters = { exact: true, ...filters };\n    return this.getAll().find(\n      (query) => matchQuery(defaultedFilters, query)\n    );\n  }\n  findAll(filters = {}) {\n    const queries = this.getAll();\n    return Object.keys(filters).length > 0 ? queries.filter((query) => matchQuery(filters, query)) : queries;\n  }\n  notify(event) {\n    notifyManager.batch(() => {\n      this.listeners.forEach((listener) => {\n        listener(event);\n      });\n    });\n  }\n  onFocus() {\n    notifyManager.batch(() => {\n      this.getAll().forEach((query) => {\n        query.onFocus();\n      });\n    });\n  }\n  onOnline() {\n    notifyManager.batch(() => {\n      this.getAll().forEach((query) => {\n        query.onOnline();\n      });\n    });\n  }\n};\nexport {\n  QueryCache\n};\n//# sourceMappingURL=queryCache.js.map","// src/queryClient.ts\nimport {\n  functionalUpdate,\n  hashKey,\n  hashQueryKeyByOptions,\n  noop,\n  partialMatchKey,\n  resolveStaleTime,\n  skipToken\n} from \"./utils.js\";\nimport { QueryCache } from \"./queryCache.js\";\nimport { MutationCache } from \"./mutationCache.js\";\nimport { focusManager } from \"./focusManager.js\";\nimport { onlineManager } from \"./onlineManager.js\";\nimport { notifyManager } from \"./notifyManager.js\";\nimport { infiniteQueryBehavior } from \"./infiniteQueryBehavior.js\";\nvar QueryClient = class {\n  #queryCache;\n  #mutationCache;\n  #defaultOptions;\n  #queryDefaults;\n  #mutationDefaults;\n  #mountCount;\n  #unsubscribeFocus;\n  #unsubscribeOnline;\n  constructor(config = {}) {\n    this.#queryCache = config.queryCache || new QueryCache();\n    this.#mutationCache = config.mutationCache || new MutationCache();\n    this.#defaultOptions = config.defaultOptions || {};\n    this.#queryDefaults = /* @__PURE__ */ new Map();\n    this.#mutationDefaults = /* @__PURE__ */ new Map();\n    this.#mountCount = 0;\n  }\n  mount() {\n    this.#mountCount++;\n    if (this.#mountCount !== 1) return;\n    this.#unsubscribeFocus = focusManager.subscribe(async (focused) => {\n      if (focused) {\n        await this.resumePausedMutations();\n        this.#queryCache.onFocus();\n      }\n    });\n    this.#unsubscribeOnline = onlineManager.subscribe(async (online) => {\n      if (online) {\n        await this.resumePausedMutations();\n        this.#queryCache.onOnline();\n      }\n    });\n  }\n  unmount() {\n    this.#mountCount--;\n    if (this.#mountCount !== 0) return;\n    this.#unsubscribeFocus?.();\n    this.#unsubscribeFocus = void 0;\n    this.#unsubscribeOnline?.();\n    this.#unsubscribeOnline = void 0;\n  }\n  isFetching(filters) {\n    return this.#queryCache.findAll({ ...filters, fetchStatus: \"fetching\" }).length;\n  }\n  isMutating(filters) {\n    return this.#mutationCache.findAll({ ...filters, status: \"pending\" }).length;\n  }\n  /**\n   * Imperative (non-reactive) way to retrieve data for a QueryKey.\n   * Should only be used in callbacks or functions where reading the latest data is necessary, e.g. for optimistic updates.\n   *\n   * Hint: Do not use this function inside a component, because it won't receive updates.\n   * Use `useQuery` to create a `QueryObserver` that subscribes to changes.\n   */\n  getQueryData(queryKey) {\n    const options = this.defaultQueryOptions({ queryKey });\n    return this.#queryCache.get(options.queryHash)?.state.data;\n  }\n  ensureQueryData(options) {\n    const defaultedOptions = this.defaultQueryOptions(options);\n    const query = this.#queryCache.build(this, defaultedOptions);\n    const cachedData = query.state.data;\n    if (cachedData === void 0) {\n      return this.fetchQuery(options);\n    }\n    if (options.revalidateIfStale && query.isStaleByTime(resolveStaleTime(defaultedOptions.staleTime, query))) {\n      void this.prefetchQuery(defaultedOptions);\n    }\n    return Promise.resolve(cachedData);\n  }\n  getQueriesData(filters) {\n    return this.#queryCache.findAll(filters).map(({ queryKey, state }) => {\n      const data = state.data;\n      return [queryKey, data];\n    });\n  }\n  setQueryData(queryKey, updater, options) {\n    const defaultedOptions = this.defaultQueryOptions({ queryKey });\n    const query = this.#queryCache.get(\n      defaultedOptions.queryHash\n    );\n    const prevData = query?.state.data;\n    const data = functionalUpdate(updater, prevData);\n    if (data === void 0) {\n      return void 0;\n    }\n    return this.#queryCache.build(this, defaultedOptions).setData(data, { ...options, manual: true });\n  }\n  setQueriesData(filters, updater, options) {\n    return notifyManager.batch(\n      () => this.#queryCache.findAll(filters).map(({ queryKey }) => [\n        queryKey,\n        this.setQueryData(queryKey, updater, options)\n      ])\n    );\n  }\n  getQueryState(queryKey) {\n    const options = this.defaultQueryOptions({ queryKey });\n    return this.#queryCache.get(\n      options.queryHash\n    )?.state;\n  }\n  removeQueries(filters) {\n    const queryCache = this.#queryCache;\n    notifyManager.batch(() => {\n      queryCache.findAll(filters).forEach((query) => {\n        queryCache.remove(query);\n      });\n    });\n  }\n  resetQueries(filters, options) {\n    const queryCache = this.#queryCache;\n    return notifyManager.batch(() => {\n      queryCache.findAll(filters).forEach((query) => {\n        query.reset();\n      });\n      return this.refetchQueries(\n        {\n          type: \"active\",\n          ...filters\n        },\n        options\n      );\n    });\n  }\n  cancelQueries(filters, cancelOptions = {}) {\n    const defaultedCancelOptions = { revert: true, ...cancelOptions };\n    const promises = notifyManager.batch(\n      () => this.#queryCache.findAll(filters).map((query) => query.cancel(defaultedCancelOptions))\n    );\n    return Promise.all(promises).then(noop).catch(noop);\n  }\n  invalidateQueries(filters, options = {}) {\n    return notifyManager.batch(() => {\n      this.#queryCache.findAll(filters).forEach((query) => {\n        query.invalidate();\n      });\n      if (filters?.refetchType === \"none\") {\n        return Promise.resolve();\n      }\n      return this.refetchQueries(\n        {\n          ...filters,\n          type: filters?.refetchType ?? filters?.type ?? \"active\"\n        },\n        options\n      );\n    });\n  }\n  refetchQueries(filters, options = {}) {\n    const fetchOptions = {\n      ...options,\n      cancelRefetch: options.cancelRefetch ?? true\n    };\n    const promises = notifyManager.batch(\n      () => this.#queryCache.findAll(filters).filter((query) => !query.isDisabled() && !query.isStatic()).map((query) => {\n        let promise = query.fetch(void 0, fetchOptions);\n        if (!fetchOptions.throwOnError) {\n          promise = promise.catch(noop);\n        }\n        return query.state.fetchStatus === \"paused\" ? Promise.resolve() : promise;\n      })\n    );\n    return Promise.all(promises).then(noop);\n  }\n  fetchQuery(options) {\n    const defaultedOptions = this.defaultQueryOptions(options);\n    if (defaultedOptions.retry === void 0) {\n      defaultedOptions.retry = false;\n    }\n    const query = this.#queryCache.build(this, defaultedOptions);\n    return query.isStaleByTime(\n      resolveStaleTime(defaultedOptions.staleTime, query)\n    ) ? query.fetch(defaultedOptions) : Promise.resolve(query.state.data);\n  }\n  prefetchQuery(options) {\n    return this.fetchQuery(options).then(noop).catch(noop);\n  }\n  fetchInfiniteQuery(options) {\n    options.behavior = infiniteQueryBehavior(options.pages);\n    return this.fetchQuery(options);\n  }\n  prefetchInfiniteQuery(options) {\n    return this.fetchInfiniteQuery(options).then(noop).catch(noop);\n  }\n  ensureInfiniteQueryData(options) {\n    options.behavior = infiniteQueryBehavior(options.pages);\n    return this.ensureQueryData(options);\n  }\n  resumePausedMutations() {\n    if (onlineManager.isOnline()) {\n      return this.#mutationCache.resumePausedMutations();\n    }\n    return Promise.resolve();\n  }\n  getQueryCache() {\n    return this.#queryCache;\n  }\n  getMutationCache() {\n    return this.#mutationCache;\n  }\n  getDefaultOptions() {\n    return this.#defaultOptions;\n  }\n  setDefaultOptions(options) {\n    this.#defaultOptions = options;\n  }\n  setQueryDefaults(queryKey, options) {\n    this.#queryDefaults.set(hashKey(queryKey), {\n      queryKey,\n      defaultOptions: options\n    });\n  }\n  getQueryDefaults(queryKey) {\n    const defaults = [...this.#queryDefaults.values()];\n    const result = {};\n    defaults.forEach((queryDefault) => {\n      if (partialMatchKey(queryKey, queryDefault.queryKey)) {\n        Object.assign(result, queryDefault.defaultOptions);\n      }\n    });\n    return result;\n  }\n  setMutationDefaults(mutationKey, options) {\n    this.#mutationDefaults.set(hashKey(mutationKey), {\n      mutationKey,\n      defaultOptions: options\n    });\n  }\n  getMutationDefaults(mutationKey) {\n    const defaults = [...this.#mutationDefaults.values()];\n    const result = {};\n    defaults.forEach((queryDefault) => {\n      if (partialMatchKey(mutationKey, queryDefault.mutationKey)) {\n        Object.assign(result, queryDefault.defaultOptions);\n      }\n    });\n    return result;\n  }\n  defaultQueryOptions(options) {\n    if (options._defaulted) {\n      return options;\n    }\n    const defaultedOptions = {\n      ...this.#defaultOptions.queries,\n      ...this.getQueryDefaults(options.queryKey),\n      ...options,\n      _defaulted: true\n    };\n    if (!defaultedOptions.queryHash) {\n      defaultedOptions.queryHash = hashQueryKeyByOptions(\n        defaultedOptions.queryKey,\n        defaultedOptions\n      );\n    }\n    if (defaultedOptions.refetchOnReconnect === void 0) {\n      defaultedOptions.refetchOnReconnect = defaultedOptions.networkMode !== \"always\";\n    }\n    if (defaultedOptions.throwOnError === void 0) {\n      defaultedOptions.throwOnError = !!defaultedOptions.suspense;\n    }\n    if (!defaultedOptions.networkMode && defaultedOptions.persister) {\n      defaultedOptions.networkMode = \"offlineFirst\";\n    }\n    if (defaultedOptions.queryFn === skipToken) {\n      defaultedOptions.enabled = false;\n    }\n    return defaultedOptions;\n  }\n  defaultMutationOptions(options) {\n    if (options?._defaulted) {\n      return options;\n    }\n    return {\n      ...this.#defaultOptions.mutations,\n      ...options?.mutationKey && this.getMutationDefaults(options.mutationKey),\n      ...options,\n      _defaulted: true\n    };\n  }\n  clear() {\n    this.#queryCache.clear();\n    this.#mutationCache.clear();\n  }\n};\nexport {\n  QueryClient\n};\n//# sourceMappingURL=queryClient.js.map","\"use client\";\n\n// src/QueryClientProvider.tsx\nimport * as React from \"react\";\nimport { jsx } from \"react/jsx-runtime\";\nvar QueryClientContext = React.createContext(\n  void 0\n);\nvar useQueryClient = (queryClient) => {\n  const client = React.useContext(QueryClientContext);\n  if (queryClient) {\n    return queryClient;\n  }\n  if (!client) {\n    throw new Error(\"No QueryClient set, use QueryClientProvider to set one\");\n  }\n  return client;\n};\nvar QueryClientProvider = ({\n  client,\n  children\n}) => {\n  React.useEffect(() => {\n    client.mount();\n    return () => {\n      client.unmount();\n    };\n  }, [client]);\n  return /* @__PURE__ */ jsx(QueryClientContext.Provider, { value: client, children });\n};\nexport {\n  QueryClientContext,\n  QueryClientProvider,\n  useQueryClient\n};\n//# sourceMappingURL=QueryClientProvider.js.map","// Core types for the inventory management system\n\nimport { CLIENT_OWES_COMPANY, COMPANY_OWES_CLIENT } from '@/constants/company'\n\n// Tax preset interface (imported from constants for consistency)\nexport interface TaxPreset {\n  id: string;\n  name: string;\n  rate: number; // percentage, e.g., 8.375\n}\n\nexport interface Account {\n  id: string;\n  name: string;\n  createdAt: Date;\n  createdBy: string;\n}\n\n\nexport interface BusinessProfile {\n  name: string;\n  logoUrl: string | null;\n  updatedAt: Date;\n  updatedBy: string;\n  accountId: string;\n}\n\nexport interface User {\n  id: string;\n  email: string;\n  fullName: string;\n  accountId: string; // Links user to account\n  role?: 'owner' | 'admin' | 'user' | null; // System owner, account admin, or account user\n  createdAt: Date;\n  lastLogin: Date;\n}\n\nexport enum UserRole {\n  OWNER = 'owner',    // System-level super admin\n  ADMIN = 'admin',    // Account-level admin\n  USER = 'user'       // Account-level user\n}\n\nexport interface Invitation {\n  id: string;\n  email: string;\n  accountId: string;\n  role: 'admin' | 'user';\n  invitedBy: string;\n  status: 'pending' | 'accepted' | 'expired';\n  createdAt: Date;\n  expiresAt: Date;\n  acceptedAt?: Date;\n}\n\nexport interface Project {\n  id: string;\n  name: string;\n  description: string;\n  clientName: string;\n  budget?: number;\n  designFee?: number;\n  budgetCategories?: ProjectBudgetCategories;\n  createdAt: Date;\n  updatedAt: Date;\n  createdBy: string;\n  settings?: ProjectSettings;\n  metadata?: ProjectMetadata;\n}\n\nexport interface ProjectBudgetCategories {\n  designFee: number;\n  furnishings: number;\n  propertyManagement: number;\n  kitchen: number;\n  install: number;\n  storageReceiving: number;\n  fuel: number;\n}\n\nexport interface ProjectSettings {\n  allowPublicAccess: boolean;\n  notificationsEnabled: boolean;\n}\n\nexport interface ProjectMetadata {\n  totalItems: number;\n  lastActivity: Date;\n  completionPercentage: number;\n}\n\nexport interface Item {\n  // Note: This interface uses camelCase for all fields (TypeScript/JavaScript convention)\n  // Field mapping to Supabase (snake_case) happens in the service layer conversion functions\n  itemId: string;\n  accountId?: string;\n  projectId?: string | null;   // null = business inventory, string = allocated to project\n  transactionId?: string | null;\n  previousProjectTransactionId?: string | null;\n  previousProjectId?: string | null;\n  name?: string;\n  description: string;\n  source: string;\n  sku: string;\n  price?: string;               // What we paid for the item (used in forms)\n  purchasePrice?: string;      // What we paid for the item\n  projectPrice?: string;       // What we sell it for (Design Business project price) - formerly resale_price\n  marketValue?: string;        // Current market value - direct mapping\n  paymentMethod: string;\n  disposition?: string;\n  notes?: string;\n  space?: string;               // Space/location where item is placed\n  qrKey: string;\n  bookmark: boolean;\n  dateCreated: string;\n  lastUpdated: string;\n  images?: ItemImage[];         // Images associated with this item\n  // Tax fields\n  taxRatePct?: number; // percentage, e.g., 8.25\n  taxAmount?: string; // Legacy single tax amount (kept for compatibility)\n  taxAmountPurchasePrice?: string; // Tax amount applied to `purchasePrice` (stored as four-decimal string; display as 2-decimal)\n  taxAmountProjectPrice?: string;  // Tax amount applied to `projectPrice` (stored as four-decimal string; display as 2-decimal)\n  createdBy?: string;\n  createdAt?: Date;\n\n  // Optional transaction selection for form UI\n  selectedTransactionId?: string; // UI field for selecting transaction\n\n  // Business Inventory fields (unified with Item)\n  inventoryStatus?: 'available' | 'allocated' | 'sold';\n  businessInventoryLocation?: string; // Warehouse location details\n\n  // Lineage tracking fields\n  originTransactionId?: string | null;  // Immutable: transaction id at creation/intake\n  latestTransactionId?: string | null;  // Denormalized: current transaction association; null = in inventory\n}\n\n// Note: ItemCategory and ItemStatus enums have been removed as they don't align\n// with the original Apps Script schema. The forms now use the correct field structure\n// that matches the original inventory system.\n\nexport interface ItemImage {\n  url: string;\n  alt: string;\n  isPrimary: boolean;\n  uploadedAt: Date;\n  fileName: string;\n  size: number; // in bytes\n  mimeType: string;\n  caption?: string; // Optional caption for the image\n}\n\nexport interface TransactionImage {\n  url: string;\n  fileName: string;\n  uploadedAt: Date;\n  size: number; // in bytes\n  mimeType: string;\n}\n\nexport interface Dimensions {\n  width: number;\n  height: number;\n  depth?: number;\n  unit: 'inches' | 'cm' | 'mm';\n}\n\nexport interface ItemLocation {\n  storage: string;\n  shelf: string;\n  position: string;\n}\n\nexport interface QRCodeData {\n  data: string;\n  generatedAt: Date;\n  lastScanned?: Date;\n}\n\nexport interface FilterOptions {\n  disposition?: string;\n  source?: string;\n  status?: string; // For filtering by item status\n  category?: string; // For filtering by category\n  tags?: string[];\n  priceRange?: {\n    min: number;\n    max: number;\n  };\n  searchQuery?: string;\n}\n\nexport interface PaginationOptions {\n  page: number;\n  limit: number;\n  total?: number;\n}\n\nexport interface ApiError {\n  type: ErrorType;\n  message: string;\n  code?: string;\n  details?: any;\n}\n\nexport interface Transaction {\n  transactionId: string;\n  projectId?: string | null;\n  projectName?: string | null;\n  transactionDate: string;\n  source: string;\n  transactionType: string;\n  paymentMethod: string;\n  amount: string;\n  budgetCategory?: string;\n  notes?: string;\n  transactionImages?: TransactionImage[]; // Legacy field for backward compatibility\n  receiptImages?: TransactionImage[]; // New field for receipt images\n  otherImages?: TransactionImage[]; // New field for other images\n  receiptEmailed: boolean;\n  createdAt: string;\n  createdBy: string;\n\n  // NEW: Pending Transaction fields for Enhanced Transaction System\n  status?: 'pending' | 'completed' | 'canceled';\n  reimbursementType?: typeof CLIENT_OWES_COMPANY | typeof COMPANY_OWES_CLIENT | '' | null | undefined;\n  triggerEvent?: 'Inventory allocation' | 'Inventory return' | 'Inventory sale' | 'Purchase from client' | 'Manual';\n\n  // NEW: Item linkage for unified inventory system\n  itemIds?: string[]; // Links to items in the top-level items collection\n  // Tax fields\n  taxRatePreset?: string; // ID of the selected preset (e.g., 'nv', 'ut', etc.) or 'Other' for custom\n  taxRatePct?: number; // percentage, e.g., 8.25 (calculated from preset or subtotal)\n  subtotal?: string; // pre-tax amount as string, e.g. '100.00' (used when tax_rate_preset is 'Other')\n  needsReview?: boolean; // Denormalized flag from DB: true if transaction needs audit review\n  sumItemPurchasePrices?: string; // Denormalized numeric string stored as two-decimal string, e.g. '123.45'\n}\n\nexport enum BudgetCategory {\n  DESIGN_FEE = 'Design Fee',\n  FURNISHINGS = 'Furnishings',\n  PROPERTY_MANAGEMENT = 'Property Management',\n  KITCHEN = 'Kitchen',\n  INSTALL = 'Install',\n  STORAGE_RECEIVING = 'Storage & Receiving',\n  FUEL = 'Fuel'\n}\n\nexport enum ErrorType {\n  AUTHENTICATION = 'authentication',\n  AUTHORIZATION = 'authorization',\n  VALIDATION = 'validation',\n  NETWORK = 'network',\n  SERVER = 'server',\n  CLIENT = 'client'\n}\n\n// Transaction form types and validation\nexport interface TransactionFormData {\n  transactionDate: string;\n  source: string;\n  transactionType: string;\n  paymentMethod: string;\n  amount: string;\n  budgetCategory?: string;\n  notes?: string;\n  status?: 'pending' | 'completed' | 'canceled';\n  reimbursementType?: typeof CLIENT_OWES_COMPANY | typeof COMPANY_OWES_CLIENT | '' | null | undefined;\n  triggerEvent?: 'Inventory allocation' | 'Inventory return' | 'Inventory sale' | 'Purchase from client' | 'Manual';\n  transactionImages?: File[]; // Legacy field for backward compatibility\n  receiptImages?: File[]; // New field for receipt image files\n  otherImages?: File[]; // New field for other image files\n  receiptEmailed?: boolean;\n  items?: TransactionItemFormData[];\n  // Tax form fields\n  taxRatePreset?: string; // ID of the selected preset (e.g., 'nv', 'ut', etc.) or 'Other' for custom\n  subtotal?: string; // pre-tax amount as string, e.g. '100.00' (used when tax_rate_preset is 'Other')\n}\n\nexport interface TransactionItemFormData {\n  id: string; // temporary id for form management\n  description: string;\n  sku?: string;\n  price?: string; // What we paid for the item (used in forms)\n  purchasePrice?: string; // What we paid for the item\n  projectPrice?: string; // What we sell it for (Design Business project price) - formerly resale_price\n  marketValue?: string;\n  space?: string;\n  notes?: string;\n  images?: ItemImage[]; // Images associated with this item\n  imageFiles?: File[]; // File objects for upload (not persisted)\n}\n\nexport interface TransactionValidationErrors {\n  transactionDate?: string;\n  source?: string;\n  transactionType?: string;\n  paymentMethod?: string;\n  amount?: string;\n  budgetCategory?: string;\n  notes?: string;\n  status?: string;\n  reimbursementType?: string;\n  triggerEvent?: string;\n  transactionImages?: string; // Legacy field for backward compatibility\n  receiptImages?: string; // New field for receipt image errors\n  otherImages?: string; // New field for other image errors\n  receiptEmailed?: string;\n  items?: string; // General error for items\n  general?: string; // General form error\n}\n\nexport interface TransactionItemValidationErrors {\n  description?: string;\n  sku?: string;\n  price?: string; // Used in form validation\n  purchasePrice?: string;\n  projectPrice?: string; // What we sell it for (Design Business project price) - formerly resale_price\n  marketValue?: string;\n  space?: string;\n  notes?: string;\n}\n\nexport interface TransactionFormProps {\n  projectId: string;\n  transactionId?: string;\n  onSubmit: (data: TransactionFormData) => Promise<void>;\n  onCancel: () => void;\n  initialData?: Partial<TransactionFormData>;\n  isEditing?: boolean;\n}\n\n// Business Inventory Types (REMOVED: Use Item interface instead)\n// All business inventory functionality now uses the unified Item interface\n\n// Business Inventory Summary Stats\nexport interface BusinessInventoryStats {\n  totalItems: number;\n  availableItems: number;\n  allocatedItems: number;\n  soldItems: number;\n}\n\n// Utility type for date values that might be Date, string, or number\nexport type DateValue = Date | string | number | { toDate?: () => Date; seconds?: number; nanoseconds?: number } | null | undefined\n\n// Common interface for items that can be bookmarked\nexport interface BookmarkableItem {\n  itemId: string;\n  bookmark: boolean;\n}\n\n// Transaction Completeness Types\nexport type CompletenessStatus = 'complete' | 'near' | 'incomplete' | 'over'\n\nexport interface TransactionCompleteness {\n  itemsNetTotal: number\n  itemsCount: number\n  itemsMissingPriceCount: number\n  transactionSubtotal: number\n  completenessRatio: number\n  completenessStatus: CompletenessStatus\n  missingTaxData: boolean\n  inferredTax?: number\n  taxAmount?: number\n  varianceDollars: number\n  variancePercent: number\n}\n\n// Item Lineage Edge - append-only record of item movement between transactions\nexport interface ItemLineageEdge {\n  id: string;\n  accountId: string;\n  itemId: string;\n  fromTransactionId: string | null;  // null == from inventory\n  toTransactionId: string | null;     // null == to inventory\n  createdAt: string;  // ISO timestamp\n  createdBy?: string | null;  // UUID of user who created the edge\n  note?: string | null;  // Optional note about the move\n}\n","import { PostgrestError } from '@supabase/supabase-js'\nimport { supabase } from './supabase'\n\n/**\n * Core database utilities for Supabase operations.\n * \n * This module provides utility functions for working with Supabase/Postgres,\n * including timestamp conversion and error handling. Services should use\n * Supabase's native query builder directly (supabase.from(table).select()...)\n * rather than abstracted wrapper methods.\n * \n * Key principles:\n * - Let Postgres handle timestamps via DEFAULT NOW() in schema\n * - RLS policies handle authentication/authorization automatically\n * - Use SQL joins, aggregations, and Postgres features directly\n * - Convert Postgres ISO timestamp strings to Date objects for app use\n */\n\n/**\n * Converts Postgres timestamps to JavaScript Date objects.\n * Postgres returns timestamps as ISO strings; this converts them to Date objects.\n * Handles various timestamp formats including ISO strings, date-only strings,\n * and numeric timestamps.\n */\nexport const timestampToDate = (timestamp: any): Date => {\n  if (timestamp instanceof Date) {\n    return timestamp\n  }\n  if (typeof timestamp === 'string') {\n    // Handle date-only strings (YYYY-MM-DD) by creating date at midnight local time\n    const dateStr = timestamp.trim()\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)) {\n      const [year, month, day] = dateStr.split('-').map(Number)\n      return new Date(year, month - 1, day)\n    }\n    return new Date(timestamp)\n  }\n  if (typeof timestamp === 'number') {\n    return new Date(timestamp)\n  }\n  if (!timestamp) {\n    return new Date()\n  }\n  try {\n    return new Date(timestamp)\n  } catch (error) {\n    console.warn('Failed to convert timestamp to date:', timestamp, error)\n    return new Date()\n  }\n}\n\n/**\n * Recursively converts Postgres timestamp fields to JavaScript Date objects.\n * Processes known timestamp fields in objects and arrays.\n * Use this after fetching data from Supabase to convert ISO strings to Date objects.\n */\nexport const convertTimestamps = (data: any): any => {\n  if (!data || typeof data !== 'object') {\n    return data\n  }\n\n  // Handle arrays first\n  if (Array.isArray(data)) {\n    return data.map((item: any) => convertTimestamps(item))\n  }\n\n  // Convert known timestamp fields\n  const timestampFields = [\n    'created_at', 'updated_at', 'last_activity', 'uploaded_at', \n    'generated_at', 'last_scanned', 'last_login', 'joined_at',\n    'accepted_at', 'expires_at', 'timestamp'\n  ]\n\n  const convertObject = (obj: any): any => {\n    if (!obj || typeof obj !== 'object') {\n      return obj\n    }\n\n    // Handle arrays\n    if (Array.isArray(obj)) {\n      return obj.map((item: any) => convertObject(item))\n    }\n\n    const result: any = { ...obj }\n\n    // Convert timestamp fields (only if they're strings, numbers, or Dates)\n    timestampFields.forEach(field => {\n      if (result[field] !== undefined && result[field] !== null) {\n        const value = result[field]\n        // Only convert if it's a string, number, or Date - skip objects/arrays\n        if (typeof value === 'string' || typeof value === 'number' || value instanceof Date) {\n          result[field] = timestampToDate(value)\n        }\n      }\n    })\n\n    // Handle nested objects and arrays (skip Date instances)\n    Object.keys(result).forEach(key => {\n      const value = result[key]\n      if (value !== undefined && value !== null && typeof value === 'object' && !(value instanceof Date)) {\n        if (Array.isArray(value)) {\n          result[key] = value.map((item: any) => convertObject(item))\n        } else {\n          result[key] = convertObject(value)\n        }\n      }\n    })\n\n    return result\n  }\n\n  return convertObject(data)\n}\n\n/**\n * Checks if a Supabase error is a \"not found\" error (PGRST116).\n * Useful for handling cases where a record doesn't exist.\n */\nexport const isNotFoundError = (error: PostgrestError | null): boolean => {\n  return error?.code === 'PGRST116'\n}\n\n/**\n * Checks if a Supabase error is a foreign key violation.\n * Useful for handling constraint violations.\n */\nexport const isForeignKeyError = (error: PostgrestError | null): boolean => {\n  return error?.code === '23503'\n}\n\n/**\n * Checks if a Supabase error is a unique constraint violation.\n * Useful for handling duplicate key errors.\n */\nexport const isUniqueConstraintError = (error: PostgrestError | null): boolean => {\n  return error?.code === '23505'\n}\n\n/**\n * Checks if a Supabase error is a permission/RLS policy violation.\n * Useful for handling authorization errors.\n */\nexport const isPermissionError = (error: PostgrestError | null): boolean => {\n  return error?.code === '42501' || error?.code === 'PGRST301'\n}\n\n/**\n * Handles Supabase Postgres errors with flexible error handling.\n * \n * @param error - The Supabase error to handle\n * @param options - Options for error handling\n * @param options.throwOnError - If true, throws an error (default: true)\n * @param options.returnNullOnNotFound - If true, returns null for not found errors instead of throwing\n * @returns null if returnNullOnNotFound is true and error is not found, otherwise throws or returns void\n */\nexport const handleSupabaseError = (\n  error: PostgrestError | null,\n  options: {\n    throwOnError?: boolean\n    returnNullOnNotFound?: boolean\n  } = {}\n): void | null => {\n  if (!error) {\n    return null\n  }\n\n  const { throwOnError = true, returnNullOnNotFound = false } = options\n\n  // Handle not found errors specially if requested\n  if (returnNullOnNotFound && isNotFoundError(error)) {\n    return null\n  }\n\n  // Log error for debugging\n  console.error('Supabase error:', {\n    code: error.code,\n    message: error.message,\n    details: error.details,\n    hint: error.hint\n  })\n\n  if (throwOnError) {\n    // Provide more context in error message\n    let errorMessage = error.message || 'Database error occurred'\n    \n    if (isPermissionError(error)) {\n      errorMessage = 'Permission denied. You may not have access to this resource.'\n    } else if (isForeignKeyError(error)) {\n      errorMessage = 'Cannot perform this operation due to related records.'\n    } else if (isUniqueConstraintError(error)) {\n      errorMessage = 'A record with this information already exists.'\n    }\n    \n    throw new Error(errorMessage)\n  }\n\n  return null\n}\n\n/**\n * Ensures the user is authenticated before performing database operations.\n * RLS policies will handle authorization, but this provides an early check.\n */\nexport const ensureAuthenticatedForDatabase = async (): Promise<void> => {\n  const { data: { session } } = await supabase.auth.getSession()\n  if (!session) {\n    throw new Error('User must be authenticated to perform this operation')\n  }\n}\n\n","import { supabase } from './supabase'\nimport { convertTimestamps } from './databaseService'\nimport { Account, User } from '@/types'\n\n/**\n * Account Service - Simplified account management\n * Users belong to one account via user.account_id\n * System owners (user.role = 'owner') can access all accounts\n */\nexport const accountService = {\n  /**\n   * Create a new account (owners only)\n   */\n  async createAccount(name: string, createdBy: string): Promise<string> {\n    const { data, error } = await supabase\n      .from('accounts')\n      .insert({\n        name,\n        created_by: createdBy,\n        created_at: new Date().toISOString()\n      })\n      .select('id')\n      .single()\n\n    if (error) throw error\n    return data.id\n  },\n\n  /**\n   * Get account details\n   */\n  async getAccount(accountId: string): Promise<Account | null> {\n    const { data, error } = await supabase\n      .from('accounts')\n      .select('*')\n      .eq('id', accountId)\n      .single()\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return null\n      }\n      throw error\n    }\n\n    const accountData = convertTimestamps(data)\n    return {\n      id: accountData.id,\n      name: accountData.name,\n      createdAt: accountData.created_at,\n      createdBy: accountData.created_by\n    } as Account\n  },\n\n  /**\n   * Get account for a user (from user.account_id)\n   */\n  async getUserAccount(userId: string): Promise<Account | null> {\n    const { data: userData, error: userError } = await supabase\n      .from('users')\n      .select('account_id')\n      .eq('id', userId)\n      .single()\n\n    if (userError || !userData?.account_id) {\n      return null\n    }\n\n    return await this.getAccount(userData.account_id)\n  },\n\n  /**\n   * Assign user to an account\n   */\n  async assignUserToAccount(userId: string, accountId: string): Promise<void> {\n    const { error } = await supabase\n      .from('users')\n      .update({ account_id: accountId })\n      .eq('id', userId)\n\n    if (error) throw error\n  },\n\n  /**\n   * Remove user from account (set account_id to null)\n   */\n  async removeUserFromAccount(userId: string): Promise<void> {\n    const { error } = await supabase\n      .from('users')\n      .update({ account_id: null })\n      .eq('id', userId)\n\n    if (error) throw error\n  },\n\n  /**\n   * Get all users in an account\n   */\n  async getAccountUsers(accountId: string): Promise<User[]> {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('account_id', accountId)\n\n    if (error) throw error\n\n    return (data || []).map(user => {\n      const converted = convertTimestamps(user)\n      return {\n        id: converted.id,\n        email: converted.email,\n        fullName: converted.full_name,\n        accountId: converted.account_id,\n        role: converted.role || null,\n        createdAt: converted.created_at ? new Date(converted.created_at) : new Date(),\n        lastLogin: converted.last_login ? new Date(converted.last_login) : new Date()\n      } as User\n    })\n  },\n\n  /**\n   * Check if user is member of account\n   */\n  async isAccountMember(userId: string, accountId: string): Promise<boolean> {\n    // System owners can access any account\n    const { data: userData, error: userError } = await supabase\n      .from('users')\n      .select('role, account_id')\n      .eq('id', userId)\n      .single()\n\n    if (userError) {\n      return false\n    }\n\n    // System owners can access all accounts\n    if (userData.role === 'owner') {\n      return true\n    }\n\n    // Regular users can only access their own account\n    return userData.account_id === accountId\n  },\n\n  /**\n   * Get all accounts (owners only)\n   */\n  async getAllAccounts(): Promise<Account[]> {\n    const { data, error } = await supabase\n      .from('accounts')\n      .select('*')\n      .order('created_at', { ascending: false })\n\n    if (error) throw error\n\n    return (data || []).map(account => {\n      const converted = convertTimestamps(account)\n      return {\n        id: converted.id,\n        name: converted.name,\n        createdAt: converted.created_at,\n        createdBy: converted.created_by\n      } as Account\n    })\n  }\n}\n\n","import { createClient } from '@supabase/supabase-js'\nimport type { User } from '@supabase/supabase-js'\nimport { User as AppUser, UserRole } from '../types'\nimport { accountService } from './accountService'\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables')\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    persistSession: true,\n    autoRefreshToken: true,\n    detectSessionInUrl: true,\n    storage: typeof window !== 'undefined' ? window.localStorage : undefined,\n    storageKey: 'supabase.auth.token'\n  }\n})\n\n// Dev-only: surface effective auth config (no secrets)\nif (import.meta.env.DEV) {\n  console.log('[SupabaseClient] Auth config', {\n    persistSession: true,\n    autoRefreshToken: true,\n    detectSessionInUrl: true,\n    storageKey: 'supabase.auth.token'\n  })\n}\n\n// Dev-only: fetch timing wrapper for auth endpoints to detect stalls\nif (import.meta.env.DEV && typeof window !== 'undefined' && !(window as any).__AUTH_FETCH_LOGGER_INSTALLED__) {\n  const originalFetch = window.fetch.bind(window)\n  ;(window as any).__AUTH_FETCH_LOGGER_INSTALLED__ = true\n  window.fetch = async (input: RequestInfo | URL, init?: RequestInit) => {\n    const method = (init?.method || (input as Request)?.method || 'GET').toUpperCase()\n    let urlStr = ''\n    try {\n      urlStr = typeof input === 'string' ? input : (input as Request).url\n    } catch {\n      urlStr = ''\n    }\n    const start = Date.now()\n    try {\n      const response = await originalFetch(input as any, init)\n      const elapsedMs = Date.now() - start\n      // Only log Supabase auth endpoints\n      if (urlStr.includes('/auth/v1/')) {\n        let path = urlStr\n        try {\n          path = new URL(urlStr, window.location.origin).pathname + new URL(urlStr, window.location.origin).search\n        } catch {\n          // keep original\n        }\n        console.log('[AuthFetch]', { method, path, status: response.status, elapsedMs })\n      }\n      return response\n    } catch (error) {\n      const elapsedMs = Date.now() - start\n      if (urlStr.includes('/auth/v1/')) {\n        console.warn('[AuthFetch ERROR]', { method, url: urlStr, elapsedMs, error: (error as Error)?.message })\n      }\n      throw error\n    }\n  }\n}\n\n// Helper to check if Supabase is ready\nexport const isSupabaseReady = (): boolean => {\n  return supabase !== null && typeof supabase === 'object'\n}\n\n// Initialize Supabase\nexport const initializeSupabase = async (): Promise<void> => {\n  if (typeof window !== 'undefined') {\n    // Supabase initializes automatically, but we can verify\n    if (!isSupabaseReady()) {\n      throw new Error('Supabase client is not properly initialized')\n    }\n    console.log(' Supabase initialized')\n  }\n}\n\n// Initialize auth persistence (replaces initializeAuthPersistence)\nexport const initializeAuthPersistence = async (): Promise<void> => {\n  if (typeof window !== 'undefined') {\n    // Supabase handles persistence automatically via localStorage\n    // Just verify session exists\n    const { data: { session } } = await supabase.auth.getSession()\n    if (session) {\n      console.log(' Auth session restored from localStorage')\n    }\n  }\n}\n\n// Get current user\nexport const getCurrentUser = async (): Promise<User | null> => {\n  const { data: { user } } = await supabase.auth.getUser()\n  return user\n}\n\n// Get current session\nexport const getCurrentSession = async () => {\n  const { data: { session } } = await supabase.auth.getSession()\n  return session\n}\n\n// Check if authenticated\nexport const isAuthenticated = async (): Promise<boolean> => {\n  const { data: { session } } = await supabase.auth.getSession()\n  return !!session\n}\n\n// Auth state change listener (replaces onAuthStateChanged)\nexport const onAuthStateChange = (callback: (user: User | null) => void) => {\n  return supabase.auth.onAuthStateChange((event, session) => {\n    callback(session?.user ?? null)\n  })\n}\n\n// Sign in with Google (replaces signInWithGoogle)\n// Note: OAuth redirects immediately to Google, then back to /auth/callback\n// The user will be available after the redirect completes in AuthCallback\nexport const signInWithGoogle = async (): Promise<void> => {\n  try {\n    const { error } = await supabase.auth.signInWithOAuth({\n      provider: 'google',\n      options: {\n        redirectTo: `${window.location.origin}/auth/callback`,\n        queryParams: {\n          prompt: 'select_account'\n        }\n      }\n    })\n    \n    if (error) throw error\n    \n    // OAuth redirect happens immediately - user will be available after redirect\n    // The AuthCallback component will handle user document creation\n  } catch (error) {\n    console.error('Google sign-in error:', error)\n    throw error\n  }\n}\n\n// Sign up with email and password\nexport const signUpWithEmailPassword = async (\n  email: string,\n  password: string\n): Promise<void> => {\n  try {\n    const { data, error } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        emailRedirectTo: `${window.location.origin}/auth/callback`\n      }\n    })\n    \n    if (error) throw error\n    \n    // If email confirmation is required, the user will need to verify their email\n    // The invitation token is already stored in localStorage, so it will be processed\n    // after email verification completes\n    if (data.user && !data.session) {\n      // Email confirmation required\n      console.log('Email confirmation required. Check your email.')\n    }\n  } catch (error) {\n    console.error('Email/password sign-up error:', error)\n    throw error\n  }\n}\n\n// Sign out (replaces signOutUser)\nexport const signOutUser = async (): Promise<void> => {\n  try {\n    const { error } = await supabase.auth.signOut()\n    if (error) throw error\n  } catch (error) {\n    console.error('Sign-out error:', error)\n    throw error\n  }\n}\n\n// Create or update user document in database (replaces createOrUpdateUserDocument)\nexport const createOrUpdateUserDocument = async (supabaseUser: User): Promise<void> => {\n  try {\n    const { data: userDoc, error: fetchError } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', supabaseUser.id)\n      .single()\n\n    const userData: Partial<AppUser> = {\n      id: supabaseUser.id,\n      email: supabaseUser.email || '',\n      fullName: supabaseUser.user_metadata?.full_name || \n                supabaseUser.user_metadata?.name ||\n                supabaseUser.email?.split('@')[0] || \n                'User',\n    }\n\n    if (userDoc && !fetchError) {\n      // Update existing user\n      const { error: updateError } = await supabase\n        .from('users')\n        .update({\n          full_name: userData.fullName,\n          email: userData.email,\n          last_login: new Date().toISOString()\n        })\n        .eq('id', supabaseUser.id)\n      \n      if (updateError) throw updateError\n    } else {\n      // New user: check if it's the first user\n      const { data: existingUsers, error: countError } = await supabase\n        .from('users')\n        .select('id')\n        .limit(1)\n\n      if (countError) {\n        console.error('Error checking existing users:', countError)\n        throw countError\n      }\n\n      if (!existingUsers || existingUsers.length === 0) {\n        // First user - grant owner permissions\n        console.log('First user signing up. Granting owner permissions.')\n        \n        // Create user with owner role\n        const { data: newUser, error: insertError } = await supabase\n          .from('users')\n          .insert({\n            id: supabaseUser.id,\n            email: userData.email,\n            full_name: userData.fullName,\n            role: 'owner',\n            created_at: new Date().toISOString(),\n            last_login: new Date().toISOString()\n          })\n          .select()\n          .single()\n\n        if (insertError) throw insertError\n\n        if (newUser) {\n          // Create default account\n          const accountId = await accountService.createAccount('Default Account', supabaseUser.id)\n          \n          // Assign owner to their default account\n          await accountService.assignUserToAccount(supabaseUser.id, accountId)\n          console.log('First user setup complete.')\n        }\n      } else {\n        // Subsequent new users\n        let accountId: string | null = null\n        let invitationId: string | null = null\n\n        // Check for token-based invitation first (from localStorage)\n        if (typeof window !== 'undefined') {\n          const storedInvitationData = localStorage.getItem('pendingInvitationData')\n          if (storedInvitationData) {\n            try {\n              const invData = JSON.parse(storedInvitationData)\n              invitationId = invData.invitationId\n              accountId = invData.accountId\n              console.log(`Found token-based invitation: account ${accountId}, invitationId ${invitationId}`)\n              // Clear the invitation data after consuming it\n              localStorage.removeItem('pendingInvitationData')\n            } catch (err) {\n              console.error('Error parsing stored invitation data:', err)\n              // Clear invalid data\n              localStorage.removeItem('pendingInvitationData')\n            }\n          }\n        }\n\n        // Fallback to email-based invitation check if no token-based invitation found\n        if (!invitationId && supabaseUser.email) {\n          const invitation = await checkUserInvitation(supabaseUser.email)\n          if (invitation) {\n            invitationId = invitation.invitationId\n            const { data: invitationData, error: invError } = await supabase\n              .from('invitations')\n              .select('account_id')\n              .eq('id', invitation.invitationId)\n              .single()\n\n            if (invError) {\n              console.error('Error fetching invitation:', invError)\n            } else if (invitationData) {\n              accountId = invitationData.account_id || null\n            }\n          }\n        }\n\n        // Create the user document\n        // Determine role: first user in account gets 'admin', others get 'user'\n        let userRole: 'admin' | 'user' = 'user'\n        if (accountId) {\n          // Check if this is the first user in this account\n          const { data: existingAccountUsers } = await supabase\n            .from('users')\n            .select('id')\n            .eq('account_id', accountId)\n            .limit(1)\n          \n          if (!existingAccountUsers || existingAccountUsers.length === 0) {\n            // First user in this account gets admin role\n            userRole = 'admin'\n          }\n        }\n\n        const { error: insertError } = await supabase\n          .from('users')\n          .insert({\n            id: supabaseUser.id,\n            email: userData.email,\n            full_name: userData.fullName,\n            role: userRole,\n            account_id: accountId || null,\n            created_at: new Date().toISOString(),\n            last_login: new Date().toISOString()\n          })\n\n        if (insertError) throw insertError\n\n        // If they were invited, accept the invitation\n        if (invitationId && accountId) {\n          // Only accept if not already accepted\n          try {\n            const { data: invCheck } = await supabase\n              .from('invitations')\n              .select('status')\n              .eq('id', invitationId)\n              .single()\n            \n            if (invCheck && invCheck.status === 'pending') {\n              await acceptUserInvitation(invitationId)\n            }\n          } catch (err) {\n            console.error('Error checking/accepting invitation:', err)\n          }\n        } else if (invitationId || accountId) {\n          // Partial invitation data - log warning but don't fail\n          console.warn('Incomplete invitation data:', { invitationId, accountId })\n        }\n      }\n    }\n  } catch (error) {\n    console.error('Error creating/updating user document:', error)\n    throw error\n  }\n}\n\n// Get user data from database (replaces getUserData)\nexport const getUserData = async (uid: string): Promise<AppUser | null> => {\n  try {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', uid)\n      .single()\n\n    if (error) {\n      console.log('No user document found for UID:', uid)\n      return null\n    }\n\n    // Get account_id from user.account_id\n    const accountId = data?.account_id || null\n\n    return {\n      id: data.id,\n      email: data.email,\n      fullName: data.full_name,\n      role: data.role as 'owner' | 'admin' | 'user' | null,\n      accountId: accountId || '',\n      createdAt: data.created_at ? new Date(data.created_at) : new Date(),\n      lastLogin: data.last_login ? new Date(data.last_login) : new Date()\n    } as AppUser\n  } catch (error) {\n    console.error('Error fetching user data:', error)\n    return null\n  }\n}\n\n// Get current user with app user data (replaces getCurrentUserWithData)\nexport const getCurrentUserWithData = async (): Promise<{ \n  supabaseUser: User | null; \n  appUser: AppUser | null \n}> => {\n  const { data: { user: supabaseUser } } = await supabase.auth.getUser()\n  \n  if (!supabaseUser) {\n    console.log('No Supabase user found')\n    return { supabaseUser: null, appUser: null }\n  }\n\n  console.log('Supabase user UID:', supabaseUser.id)\n  console.log('Supabase user email:', supabaseUser.email)\n\n  const appUser = await getUserData(supabaseUser.id)\n  console.log('App user data:', appUser)\n\n  return { supabaseUser, appUser }\n}\n\n// Generate a random token for invitations\nconst generateInvitationToken = (): string => {\n  const array = new Uint8Array(32)\n  crypto.getRandomValues(array)\n  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('')\n}\n\n// Invitation functions (Supabase-based)\nexport const createUserInvitation = async (\n  email: string,\n  role: UserRole,\n  invitedBy: string,\n  accountId?: string\n): Promise<string> => {\n  try {\n    const expiresAt = new Date()\n    expiresAt.setDate(expiresAt.getDate() + 7) // 7 days\n    const token = generateInvitationToken()\n\n    const { data, error } = await supabase\n      .from('invitations')\n      .insert({\n        email,\n        role: role === UserRole.ADMIN ? 'admin' : 'user',\n        account_id: accountId || null,\n        invited_by: invitedBy,\n        status: 'pending',\n        token,\n        created_at: new Date().toISOString(),\n        expires_at: expiresAt.toISOString()\n      })\n      .select('id')\n      .single()\n\n    if (error) throw error\n\n    const invitationLink = `${window.location.origin}/invite/${token}`\n    console.log('Invitation created for:', email, 'accountId:', accountId)\n    return invitationLink\n  } catch (error) {\n    console.error('Error creating invitation:', error)\n    throw error\n  }\n}\n\n// Get invitation by token\nexport const getInvitationByToken = async (\n  token: string\n): Promise<{ \n  id: string; \n  email: string; \n  role: UserRole; \n  accountId: string | null;\n  expiresAt: string;\n} | null> => {\n  try {\n    const { data, error } = await supabase\n      .from('invitations')\n      .select('*')\n      .eq('token', token)\n      .eq('status', 'pending')\n      .single()\n\n    if (error || !data) {\n      return null\n    }\n\n    // Check if invitation is expired\n    if (new Date(data.expires_at) < new Date()) {\n      // Mark as expired\n      await supabase\n        .from('invitations')\n        .update({ status: 'expired' })\n        .eq('id', data.id)\n      return null\n    }\n\n    return {\n      id: data.id,\n      email: data.email,\n      role: data.role === 'admin' ? UserRole.ADMIN : UserRole.USER,\n      accountId: data.account_id,\n      expiresAt: data.expires_at\n    }\n  } catch (error) {\n    console.error('Error getting invitation by token:', error)\n    return null\n  }\n}\n\n// Get pending invitations for an account\nexport const getPendingInvitations = async (\n  accountId: string\n): Promise<Array<{\n  id: string;\n  email: string;\n  role: 'admin' | 'user';\n  token: string;\n  createdAt: string;\n  expiresAt: string;\n}>> => {\n  try {\n    const { data, error } = await supabase\n      .from('invitations')\n      .select('*')\n      .eq('account_id', accountId)\n      .eq('status', 'pending')\n      .order('created_at', { ascending: false })\n\n    if (error) throw error\n\n    return (data || []).map(inv => ({\n      id: inv.id,\n      email: inv.email,\n      role: inv.role,\n      token: inv.token,\n      createdAt: inv.created_at,\n      expiresAt: inv.expires_at\n    }))\n  } catch (error) {\n    console.error('Error fetching pending invitations:', error)\n    return []\n  }\n}\n\n// Get all pending invitations for multiple accounts (for app owner)\nexport const getAllPendingInvitationsForAccounts = async (\n  accountIds: string[]\n): Promise<Record<string, Array<{\n  id: string;\n  email: string;\n  role: 'admin' | 'user';\n  token: string;\n  createdAt: string;\n  expiresAt: string;\n}>>> => {\n  try {\n    if (accountIds.length === 0) return {}\n\n    const { data, error } = await supabase\n      .from('invitations')\n      .select('*')\n      .in('account_id', accountIds)\n      .eq('status', 'pending')\n      .order('created_at', { ascending: false })\n\n    if (error) throw error\n\n    // Group invitations by account_id\n    const grouped: Record<string, Array<{\n      id: string;\n      email: string;\n      role: 'admin' | 'user';\n      token: string;\n      createdAt: string;\n      expiresAt: string;\n    }>> = {}\n\n    ;(data || []).forEach(inv => {\n      const accountId = inv.account_id\n      if (!grouped[accountId]) {\n        grouped[accountId] = []\n      }\n      grouped[accountId].push({\n        id: inv.id,\n        email: inv.email,\n        role: inv.role,\n        token: inv.token,\n        createdAt: inv.created_at,\n        expiresAt: inv.expires_at\n      })\n    })\n\n    return grouped\n  } catch (error) {\n    console.error('Error fetching all pending invitations:', error)\n    return {}\n  }\n}\n\nexport const checkUserInvitation = async (\n  email: string\n): Promise<{ role: UserRole; invitationId: string } | null> => {\n  try {\n    const { data, error } = await supabase\n      .from('invitations')\n      .select('*')\n      .eq('email', email)\n      .eq('status', 'pending')\n      .single()\n\n    if (error || !data) {\n      return null\n    }\n\n    // Check if invitation is expired\n    if (new Date(data.expires_at) < new Date()) {\n      // Mark as expired\n      await supabase\n        .from('invitations')\n        .update({ status: 'expired' })\n        .eq('id', data.id)\n      return null\n    }\n\n    return {\n      role: data.role === 'admin' ? UserRole.ADMIN : UserRole.USER,\n      invitationId: data.id\n    }\n  } catch (error) {\n    console.error('Error checking invitation:', error)\n    return null\n  }\n}\n\n// Check invitation by token (for link-based flow)\n// This allows checking both pending and accepted invitations\nexport const checkInvitationByToken = async (\n  token: string\n): Promise<{ role: UserRole; invitationId: string; email: string; accountId: string | null } | null> => {\n  try {\n    // First try to get pending invitation\n    let invitation = await getInvitationByToken(token)\n    \n    // If not found as pending, check if it was already accepted\n    if (!invitation) {\n      const { data, error } = await supabase\n        .from('invitations')\n        .select('*')\n        .eq('token', token)\n        .eq('status', 'accepted')\n        .single()\n\n      if (!error && data) {\n        invitation = {\n          id: data.id,\n          email: data.email,\n          role: data.role === 'admin' ? UserRole.ADMIN : UserRole.USER,\n          accountId: data.account_id,\n          expiresAt: data.expires_at\n        }\n      }\n    }\n\n    if (!invitation) {\n      return null\n    }\n\n    return {\n      role: invitation.role,\n      invitationId: invitation.id,\n      email: invitation.email,\n      accountId: invitation.accountId\n    }\n  } catch (error) {\n    console.error('Error checking invitation by token:', error)\n    return null\n  }\n}\n\nexport const acceptUserInvitation = async (invitationId: string): Promise<void> => {\n  try {\n    const { error } = await supabase\n      .from('invitations')\n      .update({\n        status: 'accepted',\n        accepted_at: new Date().toISOString()\n      })\n      .eq('id', invitationId)\n\n    if (error) throw error\n\n    console.log('Invitation accepted:', invitationId)\n  } catch (error) {\n    console.error('Error accepting invitation:', error)\n    throw error\n  }\n}\n\n","import { createContext, useContext, useEffect, useState, useCallback, ReactNode, useMemo, useRef } from 'react'\nimport { User as SupabaseUser } from '@supabase/supabase-js'\nimport {\n  signInWithGoogle,\n  signOutUser,\n  getCurrentUserWithData,\n  createOrUpdateUserDocument,\n  supabase\n} from '../services/supabase'\nimport { User, UserRole } from '../types'\n\ninterface AuthContextType {\n  supabaseUser: SupabaseUser | null\n  user: User | null\n  loading: boolean\n  userLoading: boolean\n  timedOutWithoutAuth: boolean\n  signIn: () => Promise<void>\n  signOut: () => Promise<void>\n  isAuthenticated: boolean\n  hasRole: (role: UserRole) => boolean\n  isOwner: () => boolean\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\n\nconst authLogPrefix = '[AuthContext]'\n\nfunction describeSupabaseUser(user: SupabaseUser | null) {\n  if (!user) return 'null'\n  const { id, email, last_sign_in_at: lastSignInAt } = user\n  return JSON.stringify({ id, email, lastSignInAt })\n}\n\nfunction describeAppUser(user: User | null) {\n  if (!user) return 'null'\n  const { id, email, role } = user\n  return JSON.stringify({ id, email, role })\n}\n\n// Helper to conditionally log debug/warn messages only in dev\nfunction debugLog(message: string, data?: any) {\n  if (import.meta.env.DEV) {\n    // Use console.log so logs are visible by default in dev (Chrome hides console.debug unless Verbose is enabled)\n    console.log(message, data)\n  }\n}\n\nfunction warnLog(message: string, data?: any) {\n  if (import.meta.env.DEV) {\n    console.warn(message, data)\n  } else {\n    // In production, only log warnings without PII\n    console.warn(message)\n  }\n}\n\ninterface AuthProviderProps {\n  children: ReactNode\n}\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const [supabaseUser, setSupabaseUser] = useState<SupabaseUser | null>(null)\n  const [user, setUser] = useState<User | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [userLoading, setUserLoading] = useState(false)\n  const [timedOutWithoutAuth, setTimedOutWithoutAuth] = useState(false)\n  \n  // Ref to track if auth has been resolved (prevents timeout if already resolved)\n  const hasResolvedAuthRef = useRef(false)\n  // Ref to track if this is the initial load\n  const isInitialLoadRef = useRef(true)\n  // Unique instance ID for this effect (helps track double-invoke in StrictMode)\n  const instanceIdRef = useRef(`auth-${Math.random().toString(36).slice(2, 9)}`)\n  // Listener ID counter\n  const listenerIdRef = useRef(0)\n  // Track when init started for timing metrics\n  const initStartTimeRef = useRef(0)\n  const supabaseUserLogRef = useRef<SupabaseUser | null>(null)\n  const userLogRef = useRef<User | null>(null)\n\n  useEffect(() => {\n    supabaseUserLogRef.current = supabaseUser\n  }, [supabaseUser])\n\n  useEffect(() => {\n    userLogRef.current = user\n  }, [user])\n\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible') {\n        debugLog(`${authLogPrefix} [VISIBILITY] Tab is visible, refreshing session...`);\n        supabase.auth.refreshSession();\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (timedOutWithoutAuth && (supabaseUser || user)) {\n      setTimedOutWithoutAuth(false)\n    }\n  }, [supabaseUser, user, timedOutWithoutAuth])\n\n  useEffect(() => {\n    const instanceId = instanceIdRef.current\n    const initStartTime = Date.now()\n    initStartTimeRef.current = initStartTime\n\n    let isMounted = true\n    let authStateUnsubscribe: { data: { subscription: any } } | null = null\n    let loadingTimeout: NodeJS.Timeout | null = null\n    let getSessionStartTime = 0\n\n    if (import.meta.env.DEV) {\n      debugLog(`${authLogPrefix} [EFFECT MOUNT] instanceId=${instanceId}, strictMode might cause double-invoke`)\n    }\n\n    // Environment preflight (dev only) - helps diagnose stalls before subscription/getSession\n    if (import.meta.env.DEV) {\n      const online = typeof navigator !== 'undefined' ? navigator.onLine : undefined\n      const swController = typeof navigator !== 'undefined' ? navigator.serviceWorker?.controller : undefined\n      const hasServiceWorker = !!swController\n      const swUrl = hasServiceWorker ? (swController as ServiceWorker).scriptURL : null\n      const urlSource = typeof window !== 'undefined' ? (window.location.hash || window.location.search || '') : ''\n      const urlHasAuthParams = /access_token|refresh_token/i.test(urlSource)\n      let localStorageTokenExists = false\n      try {\n        localStorageTokenExists = typeof window !== 'undefined' && !!window.localStorage.getItem('supabase.auth.token')\n      } catch {\n        // ignore storage access errors\n      }\n      debugLog(`${authLogPrefix} [BOOT PREFLIGHT]`, {\n        instanceId,\n        online,\n        hasServiceWorker,\n        swUrl,\n        urlHasAuthParams,\n        localStorageTokenExists\n      })\n    }\n\n    // Single place to resolve loading state\n    const resolveLoading = (source: string) => {\n      if (isMounted && !hasResolvedAuthRef.current) {\n        hasResolvedAuthRef.current = true\n        if (loadingTimeout) clearTimeout(loadingTimeout)\n        const elapsedMs = Date.now() - initStartTime\n        setLoading(false)\n        debugLog(`${authLogPrefix} [LOADING RESOLVED] source=${source} elapsedMs=${elapsedMs} instanceId=${instanceId} supabaseUser=${describeSupabaseUser(supabaseUserLogRef.current)} appUser=${describeAppUser(userLogRef.current)}`)\n      }\n    }\n\n    // Safety timeout to prevent infinite loading state\n    loadingTimeout = setTimeout(() => {\n      if (isMounted && !hasResolvedAuthRef.current) {\n        const elapsedMs = Date.now() - initStartTime\n        const nowTs = Date.now()\n        const getSessionElapsedMsSnapshot = getSessionStartTime ? nowTs - getSessionStartTime : null\n        const online = typeof navigator !== 'undefined' ? navigator.onLine : undefined\n        const swController = typeof navigator !== 'undefined' ? navigator.serviceWorker?.controller : undefined\n        const hasServiceWorker = !!swController\n        const swUrl = hasServiceWorker ? (swController as ServiceWorker).scriptURL : null\n        let localStorageTokenExists = false\n        try {\n          localStorageTokenExists = typeof window !== 'undefined' && !!window.localStorage.getItem('supabase.auth.token')\n        } catch {\n          // ignore\n        }\n        // Use refs to check actual current state (avoid stale closures)\n        const currentSupabaseUser = supabaseUserLogRef.current\n        const currentAppUser = userLogRef.current\n        warnLog(`${authLogPrefix} [TIMEOUT] Initialization timed out after ${elapsedMs}ms. Forcing loading to false.`, {\n          instanceId,\n          supabaseUser: describeSupabaseUser(currentSupabaseUser),\n          appUser: describeAppUser(currentAppUser),\n          hasResolvedAuthRef: hasResolvedAuthRef.current,\n          getSessionStarted: !!getSessionStartTime,\n          getSessionElapsedMs: getSessionElapsedMsSnapshot,\n          online,\n          hasServiceWorker,\n          swUrl,\n          localStorageTokenExists\n        })\n        resolveLoading('safety_timeout')\n        \n        // If timeout fires and we still have no auth, flag it for redirect\n        // Use refs to avoid stale closure\n        if (!currentSupabaseUser && !currentAppUser) {\n          setTimedOutWithoutAuth(true)\n        }\n      }\n    }, 7000) // 7-second timeout\n\n    debugLog(`${authLogPrefix} [INIT START] instanceId=${instanceId} timestamp=${new Date().toISOString()}`)\n\n    // FIRST: Subscribe to auth state changes (before getSession to avoid missing fast SIGNED_IN events)\n    const listenerId = ++listenerIdRef.current\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\n      if (!isMounted) return\n\n      const authUser = session?.user || null\n      debugLog(`${authLogPrefix} [LISTENER ${listenerId}] onAuthStateChange event`, {\n        instanceId,\n        event,\n        hasSession: !!session,\n        isInitialLoad: isInitialLoadRef.current,\n      })\n      \n      setSupabaseUser(authUser)\n      supabaseUserLogRef.current = authUser\n\n      // During initial load, this listener's ONLY job is to set the supabaseUser.\n      // The initializeAuth function will handle fetching the app user data AFTER getSession completes.\n      if (isInitialLoadRef.current) {\n        if (!authUser) {\n          // If there's no user, we can resolve loading early.\n          resolveLoading(`listener_${listenerId}_${event}_no_user`)\n        }\n        return\n      }\n\n      // The logic below only runs for auth events AFTER the initial load.\n      if (authUser) {\n        const currentUser = userLogRef.current;\n        // If we already have a matching app user, we don't need to do anything.\n        // This prevents re-fetching data on events like TOKEN_REFRESHED or the spurious SIGNED_IN that follows.\n        if (currentUser && currentUser.id === authUser.id) {\n          debugLog(`${authLogPrefix} [LISTENER ${listenerId}] Skipping data fetch for event '${event}' as user is already loaded.`);\n          return;\n        }\n\n        setTimedOutWithoutAuth(false)\n        if (event === 'SIGNED_IN') {\n          setUserLoading(true)\n          try {\n            // This is a fresh, user-initiated SIGNED_IN event.\n            const createUserDocStartTime = Date.now()\n            debugLog(`${authLogPrefix} [LISTENER ${listenerId}] Handling fresh SIGNED_IN event. Ensuring user document is up to date`, {\n              supabaseUser: describeSupabaseUser(authUser)\n            })\n            await createOrUpdateUserDocument(authUser)\n            const createUserDocElapsedMs = Date.now() - createUserDocStartTime\n            debugLog(`${authLogPrefix} [LISTENER ${listenerId}] createOrUpdateUserDocument completed in ${createUserDocElapsedMs}ms`)\n            \n            const { appUser } = await getCurrentUserWithData()\n            if (isMounted) {\n              setUser(appUser)\n              userLogRef.current = appUser\n              debugLog(`${authLogPrefix} [LISTENER ${listenerId}] Updated app user after fresh sign-in`, { appUser: describeAppUser(appUser) })\n            }\n          } catch (error) {\n            console.error(`${authLogPrefix} [LISTENER ${listenerId}] Error handling a fresh SIGNED_IN event`, error)\n            if (isMounted) setUser(null)\n          } finally {\n            if (isMounted) setUserLoading(false)\n          }\n        }\n      } else {\n        // User is signed out post-initial load\n        if (isMounted) {\n          setUser(null)\n          userLogRef.current = null\n          setUserLoading(false)\n        }\n      }\n    })\n\n    authStateUnsubscribe = { data: { subscription } }\n    debugLog(`${authLogPrefix} [SUBSCRIPTION] Created listener ${listenerId} for instanceId=${instanceId}`)\n\n    // THEN: Check for existing session (after subscription is set up)\n    const initializeAuth = async () => {\n      try {\n        getSessionStartTime = Date.now()\n        debugLog(`${authLogPrefix} [GET_SESSION] Starting getSession() call for instanceId=${instanceId}`)\n        \n        const { data: { session }, error: sessionError } = await supabase.auth.getSession()\n        const getSessionElapsedMs = Date.now() - getSessionStartTime\n        \n        if (sessionError) {\n          console.error(`${authLogPrefix} [GET_SESSION] Error retrieving initial session after ${getSessionElapsedMs}ms`, sessionError)\n        }\n        \n        debugLog(`${authLogPrefix} [GET_SESSION] Initial session response after ${getSessionElapsedMs}ms`, { hasSession: !!session })\n        \n        // After getSession completes, the client is initialized. Now we can fetch app data.\n        if (isMounted && session) {\n          setUserLoading(true)\n          try {\n            const { appUser } = await getCurrentUserWithData()\n            if (isMounted) {\n              setUser(appUser)\n              userLogRef.current = appUser\n              debugLog(`${authLogPrefix} [INIT] Loaded initial app user`, { appUser: describeAppUser(appUser) })\n            }\n          } catch (error) {\n            console.error(`${authLogPrefix} [INIT] Error loading initial user data`, error)\n            if (isMounted) setUser(null)\n          } finally {\n            if (isMounted) setUserLoading(false)\n          }\n        }\n        \n        // Always resolve loading after the entire initial auth flow is complete.\n        resolveLoading('initialization_complete')\n      } catch (error) {\n        console.error(`${authLogPrefix} [INIT_ERROR] Error during auth initialization`, error)\n        resolveLoading('init_error')\n      } finally {\n        isInitialLoadRef.current = false\n      }\n    }\n\n    initializeAuth()\n\n    return () => {\n      isMounted = false\n      if (loadingTimeout) clearTimeout(loadingTimeout)\n      if (authStateUnsubscribe?.data?.subscription) {\n        authStateUnsubscribe.data.subscription.unsubscribe()\n        debugLog(`${authLogPrefix} [EFFECT CLEANUP] Unsubscribed from auth listener instanceId=${instanceId}`)\n      }\n      if (import.meta.env.DEV) {\n        const cleanupElapsedMs = Date.now() - initStartTime\n        debugLog(`${authLogPrefix} [EFFECT CLEANUP] Cleanup after ${cleanupElapsedMs}ms hasResolvedAuthRef=${hasResolvedAuthRef.current} instanceId=${instanceId}`)\n      }\n    }\n  }, [])\n\n  const signIn = useCallback(async () => {\n    try {\n      debugLog(`${authLogPrefix} signIn invoked`)\n      // Don't set global loading - let the auth listener handle state changes\n      // Local UI components should show their own loading states during OAuth redirect\n      await signInWithGoogle()\n\n      // Note: OAuth redirect happens immediately - user will be available after redirect\n      // The auth listener will handle user document creation and state updates\n    } catch (error) {\n      console.error(`${authLogPrefix} Sign in error`, error)\n      throw error\n    }\n  }, [])\n\n  const signOut = useCallback(async () => {\n    try {\n      debugLog(`${authLogPrefix} signOut invoked`)\n      // Don't set global loading - let the auth listener handle state changes\n      await signOutUser()\n    } catch (error) {\n      console.error(`${authLogPrefix} Sign out error`, error)\n      throw error\n    }\n  }, [])\n\n  const hasRole = useCallback((role: UserRole): boolean => {\n    // Removed excessive logging - only log in development if needed for debugging\n    return user?.role === role || user?.role === UserRole.OWNER || user?.role === UserRole.ADMIN\n  }, [user?.role])\n\n  const isOwner = useCallback((): boolean => {\n    return user?.role === 'owner' || false\n  }, [user?.role])\n\n  const value: AuthContextType = useMemo(() => ({\n    supabaseUser,\n    user,\n    loading,\n    userLoading,\n    timedOutWithoutAuth,\n    signIn,\n    signOut,\n    isAuthenticated: !!supabaseUser,\n    hasRole,\n    isOwner\n  }), [supabaseUser, user, loading, userLoading, timedOutWithoutAuth, hasRole, isOwner, signIn, signOut])\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext)\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider')\n  }\n  return context\n}\n","import { createContext, useContext, useEffect, useState, ReactNode, useMemo } from 'react'\nimport { useAuth } from './AuthContext'\nimport { accountService } from '../services/accountService'\nimport { Account } from '../types'\n\ninterface AccountContextType {\n  currentAccountId: string | null\n  currentAccount: Account | null\n  isOwner: boolean // System-level owner\n  isAdmin: boolean // Account-level admin OR system owner\n  loading: boolean\n}\n\nconst AccountContext = createContext<AccountContextType | undefined>(undefined)\n\ninterface AccountProviderProps {\n  children: ReactNode\n}\n\nexport function AccountProvider({ children }: AccountProviderProps) {\n  const { user, loading: authLoading, userLoading } = useAuth()\n  const [currentAccountId, setCurrentAccountId] = useState<string | null>(null)\n  const [currentAccount, setCurrentAccount] = useState<Account | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  // Check if user is system owner\n  const isOwner = user?.role === 'owner' || false\n  \n  // Check if user is account admin (admin role OR system owner)\n  const isAdmin = isOwner || user?.role === 'admin' || false\n\n  useEffect(() => {\n    let isMounted = true\n\n    const loadAccount = async () => {\n      // Back off if auth is still loading or user is not ready\n      if (authLoading || userLoading) {\n        if (isMounted) {\n          setLoading(true)\n        }\n        return\n      }\n\n          if (!user) {\n        if (isMounted) {\n            setCurrentAccountId(null)\n            setCurrentAccount(null)\n            setLoading(false)\n        }\n        return\n      }\n\n      // If we have a user and auth is ready, we start the loading process.\n      if (isMounted) {\n        setLoading(true)\n      }\n\n      // Safety timeout to ensure loading is set to false even if account loading fails\n      const loadingTimeout = setTimeout(() => {\n        if (isMounted) {\n          console.warn(' Account loading timeout - setting loading to false')\n          setLoading(false)\n        }\n      }, 10000) // 10 second timeout\n\n      try {\n        let finalAccount: Account | null = null\n\n        // 1. Try getting account from user object's accountId\n        if (user.accountId) {\n          finalAccount = await accountService.getAccount(user.accountId)\n        }\n\n        // 2. If not found, try fetching from the users table (fallback)\n        if (!finalAccount) {\n          finalAccount = await accountService.getUserAccount(user.id)\n        }\n\n        // 3. If still not found and user is an owner, get the first account\n        if (!finalAccount && isOwner) {\n          const allAccounts = await accountService.getAllAccounts()\n          if (allAccounts.length > 0) {\n            finalAccount = allAccounts[0]\n          }\n        }\n        \n        // Now, update the state based on what was found.\n        if (isMounted) {\n          if (finalAccount) {\n            setCurrentAccountId(finalAccount.id)\n            setCurrentAccount(finalAccount)\n          } else {\n            setCurrentAccountId(null)\n            setCurrentAccount(null)\n          }\n        }\n      } catch (error) {\n        console.error('Error loading account:', error)\n        if (isMounted) {\n          setCurrentAccountId(null)\n          setCurrentAccount(null)\n        }\n      } finally {\n        clearTimeout(loadingTimeout)\n        if (isMounted) {\n          setLoading(false)\n        }\n      }\n    }\n\n    loadAccount()\n\n    return () => {\n      isMounted = false\n    }\n  }, [user, authLoading, userLoading, isOwner])\n\n  const value: AccountContextType = useMemo(() => ({\n    currentAccountId,\n    currentAccount,\n    isOwner,\n    isAdmin,\n    loading\n  }), [currentAccountId, currentAccount, isOwner, isAdmin, loading])\n\n  return (\n    <AccountContext.Provider value={value}>\n      {children}\n    </AccountContext.Provider>\n  )\n}\n\nexport function useAccount() {\n  const context = useContext(AccountContext)\n  if (context === undefined) {\n    throw new Error('useAccount must be used within an AccountProvider')\n  }\n  return context\n}\n\n","import { supabase } from './supabase'\nimport { convertTimestamps } from './databaseService'\nimport { BusinessProfile } from '@/types'\n\n/**\n * Business Profile Service - Manages business profile data for accounts\n */\nexport const businessProfileService = {\n  /**\n   * Get business profile for an account\n   */\n  async getBusinessProfile(accountId: string): Promise<BusinessProfile | null> {\n    try {\n      const { data, error } = await supabase\n        .from('business_profiles')\n        .select('*')\n        .eq('account_id', accountId)\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116') {\n          return null\n        }\n        throw error\n      }\n\n      const profileData = convertTimestamps(data)\n      return {\n        accountId: profileData.account_id,\n        name: profileData.name,\n        logoUrl: profileData.logo_url,\n        updatedAt: profileData.updated_at,\n        updatedBy: profileData.updated_by\n      } as BusinessProfile\n    } catch (error) {\n      console.error('Error fetching business profile:', error)\n      return null\n    }\n  },\n\n  /**\n   * Update business profile for an account\n   */\n  async updateBusinessProfile(\n    accountId: string,\n    name: string,\n    logoUrl: string | null,\n    updatedBy: string\n  ): Promise<void> {\n    try {\n      // Check if profile exists\n      const { data: existing, error: checkError } = await supabase\n        .from('business_profiles')\n        .select('account_id')\n        .eq('account_id', accountId)\n        .single()\n\n      // If there's an error checking and it's not \"not found\", throw it\n      if (checkError && checkError.code !== 'PGRST116') {\n        throw checkError\n      }\n      const profileData = {\n        account_id: accountId,\n        name,\n        logo_url: logoUrl,\n        updated_at: new Date().toISOString(),\n        updated_by: updatedBy\n      }\n\n      if (existing) {\n        // Update existing\n        const { error } = await supabase\n          .from('business_profiles')\n          .update(profileData)\n          .eq('account_id', accountId)\n\n        if (error) throw error\n      } else {\n        // Create new\n        const { error } = await supabase\n          .from('business_profiles')\n          .insert(profileData)\n\n        if (error) throw error\n      }\n\n      console.log('Business profile updated successfully')\n    } catch (error) {\n      console.error('Error updating business profile:', error)\n      throw error\n    }\n  }\n}\n\n","// Company name constants for genericization\nexport const COMPANY_NAME = 'Design Business'\nexport const COMPANY_NAME_SHORT = 'Design Business'\nexport const COMPANY_PAYMENT_METHOD = 'Design Business'\nexport const COMPANY_CARD = 'Design Business Card'\nexport const CLIENT_OWES_COMPANY = 'Client Owes Design Business'\nexport const COMPANY_OWES_CLIENT = 'Design Business Owes Client'\nexport const COMPANY_INVENTORY = 'Design Business Inventory'\nexport const COMPANY_INVENTORY_SALE = 'Design Business Inventory Sale'\nexport const COMPANY_INVENTORY_PURCHASE = 'Design Business Inventory Purchase'\nexport const COMPANY_DOMAIN_PLACEHOLDER = '<design-business-domain>'\nexport const COMPANY_INVENTORY_DOMAIN = `inventory.${COMPANY_DOMAIN_PLACEHOLDER}`\nexport const COMPANY_INVENTORY_URL = `https://inventory.${COMPANY_DOMAIN_PLACEHOLDER}`\nexport const COMPANY_INVENTORY_TITLE = 'Design Business Inventory & Transactions'\nexport const COMPANY_PROJECT_PORTAL_LOGO_ALT = 'Design Business Project Portal logo'\n\n","import { createContext, useContext, useEffect, useState, ReactNode } from 'react'\nimport { useAccount } from './AccountContext'\nimport { businessProfileService } from '../services/businessProfileService'\nimport { BusinessProfile } from '../types'\nimport { COMPANY_NAME } from '@/constants/company'\n\ninterface BusinessProfileContextType {\n  businessProfile: BusinessProfile | null\n  businessName: string\n  businessLogoUrl: string | null\n  loading: boolean\n  refreshProfile: () => Promise<void>\n}\n\nconst BusinessProfileContext = createContext<BusinessProfileContextType | undefined>(undefined)\n\ninterface BusinessProfileProviderProps {\n  children: ReactNode\n}\n\nexport function BusinessProfileProvider({ children }: BusinessProfileProviderProps) {\n  const { currentAccountId, loading: accountLoading } = useAccount()\n  const [businessProfile, setBusinessProfile] = useState<BusinessProfile | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  const loadProfile = async () => {\n    if (!currentAccountId) {\n      setBusinessProfile(null)\n      setLoading(false)\n      return\n    }\n\n    try {\n      setLoading(true)\n      const profile = await businessProfileService.getBusinessProfile(currentAccountId)\n      setBusinessProfile(profile)\n    } catch (error) {\n      console.error('Error loading business profile:', error)\n      setBusinessProfile(null)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    if (accountLoading) {\n      setLoading(true)\n      return\n    }\n    loadProfile()\n  }, [currentAccountId, accountLoading])\n\n  // Derived values with fallbacks\n  const businessName = businessProfile?.name || COMPANY_NAME\n  const businessLogoUrl = businessProfile?.logoUrl || null\n\n  const value: BusinessProfileContextType = {\n    businessProfile,\n    businessName,\n    businessLogoUrl,\n    loading,\n    refreshProfile: loadProfile\n  }\n\n  return (\n    <BusinessProfileContext.Provider value={value}>\n      {children}\n    </BusinessProfileContext.Provider>\n  )\n}\n\nexport function useBusinessProfile() {\n  const context = useContext(BusinessProfileContext)\n  if (context === undefined) {\n    throw new Error('useBusinessProfile must be used within a BusinessProfileProvider')\n  }\n  return context\n}\n\n","import React, { ButtonHTMLAttributes } from 'react'\nimport { clsx } from 'clsx'\n\ninterface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'secondary' | 'danger'\n  size?: 'sm' | 'md' | 'lg'\n  children: React.ReactNode\n}\n\nexport function Button({\n  variant = 'primary',\n  size = 'md',\n  className,\n  children,\n  ...props\n}: ButtonProps) {\n  const baseClasses = 'inline-flex items-center justify-center font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed'\n\n  const variantClasses = {\n    primary: 'text-white bg-primary-600 hover:bg-primary-700 focus:ring-primary-500 border border-transparent',\n    secondary: 'text-gray-700 bg-white hover:bg-gray-50 focus:ring-primary-500 border border-gray-300',\n    danger: 'text-white bg-red-600 hover:bg-red-700 focus:ring-red-500 border border-transparent'\n  }\n\n  const sizeClasses = {\n    sm: 'px-3 py-2 text-sm rounded-md',\n    md: 'px-4 py-2 text-sm rounded-md',\n    lg: 'px-6 py-3 text-base rounded-md'\n  }\n\n  const classes = clsx(\n    baseClasses,\n    variantClasses[variant],\n    sizeClasses[size],\n    className\n  )\n\n  return (\n    <button className={classes} {...props}>\n      {children}\n    </button>\n  )\n}\n","import { Link, useLocation } from 'react-router-dom'\nimport { useAuth } from '../../contexts/AuthContext'\nimport { useBusinessProfile } from '../../contexts/BusinessProfileContext'\nimport { Button } from '../ui/Button'\nimport { LogOut, Settings, Package, FolderOpen } from 'lucide-react'\n\nexport default function Header() {\n  const { user, signOut, loading } = useAuth()\n  const { businessName } = useBusinessProfile()\n  const location = useLocation()\n\n  const isProjectsActive = location.pathname.startsWith('/projects') || location.pathname.startsWith('/project') || location.pathname === '/'\n  const isBusinessInventoryActive = location.pathname.startsWith('/business-inventory')\n  const isSettingsActive = location.pathname.startsWith('/settings')\n\n  return (\n    <header className=\"bg-white shadow-sm border-b border-gray-200 print:hidden\">\n      <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex h-16 justify-between items-center gap-2\">\n          {/* Left side - Logo only */}\n          <div className=\"flex items-center\">\n            <Link to=\"/\" className=\"text-xl font-bold text-gray-900\">\n              {businessName}\n            </Link>\n          </div>\n\n          {/* Right side - All navigation and user controls */}\n          <div className=\"flex items-center\">\n            {user && (\n              <div className=\"flex items-center space-x-1\">\n                {/* Navigation Tabs */}\n                <nav className=\"flex space-x-0 sm:space-x-1\">\n                  <Link\n                    to=\"/\"\n                    className={`inline-flex items-center px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium transition-all duration-200 border-b-2 ${\n                      isProjectsActive\n                        ? 'border-primary-500 text-gray-700'\n                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n                    }`}\n                    title=\"Projects\"\n                  >\n                    <FolderOpen className=\"h-5 w-5 sm:h-4 sm:w-4 sm:mr-2\" />\n                    <span className=\"hidden sm:inline\">Projects</span>\n                  </Link>\n                  <Link\n                    to=\"/business-inventory\"\n                    className={`inline-flex items-center px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium transition-all duration-200 border-b-2 ${\n                      isBusinessInventoryActive\n                        ? 'border-primary-500 text-gray-700'\n                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n                    }`}\n                    title=\"Inventory\"\n                  >\n                    <Package className=\"h-5 w-5 sm:h-4 sm:w-4 sm:mr-2\" />\n                    <span className=\"hidden sm:inline\">Inventory</span>\n                  </Link>\n                </nav>\n\n                {/* Settings */}\n                <Link\n                  to=\"/settings\"\n                  className={`flex items-center px-2 sm:px-3 py-2 text-xs sm:text-sm font-medium transition-all duration-200 border-b-2 ${\n                    isSettingsActive\n                      ? 'border-primary-500 text-gray-700'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n                  }`}\n                  title=\"Settings\"\n                >\n                  <Settings className=\"h-5 w-5 sm:h-4 sm:w-4 sm:mr-2\" />\n                  <span className=\"hidden sm:inline\">Settings</span>\n                </Link>\n\n                {/* Sign Out */}\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  onClick={signOut}\n                  disabled={loading}\n                  className=\"flex items-center px-2 sm:px-3 ml-2 sm:ml-3\"\n                  title=\"Sign Out\"\n                >\n                  <LogOut className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n                </Button>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </header>\n  )\n}\n","import { Outlet } from 'react-router-dom'\nimport Header from './Header'\n\ninterface LayoutProps {\n  children?: React.ReactNode\n}\n\nexport default function Layout({ children }: LayoutProps) {\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Main content area */}\n      <div className=\"flex flex-col\">\n        <Header />\n\n        <main className=\"flex-1 py-6\">\n          <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n            {children || <Outlet />}\n          </div>\n        </main>\n      </div>\n    </div>\n  )\n}\n","import { Loader2 } from 'lucide-react'\nimport clsx from 'clsx'\n\ninterface LoadingSpinnerProps {\n  size?: 'sm' | 'md' | 'lg'\n  className?: string\n}\n\nexport default function LoadingSpinner({ size = 'md', className }: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: 'h-4 w-4',\n    md: 'h-8 w-8',\n    lg: 'h-12 w-12'\n  }\n\n  return (\n    <div className={clsx('flex items-center justify-center', className)}>\n      <Loader2 className={clsx('animate-spin text-primary-600', sizeClasses[size])} />\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { CheckCircle, XCircle, X, AlertCircle, Info } from 'lucide-react'\nimport { clsx } from 'clsx'\n\nexport interface Toast {\n  id: string\n  message: string\n  type: 'success' | 'error' | 'info' | 'warning'\n  duration?: number\n}\n\ninterface ToastProps {\n  toast: Toast\n  onClose: (id: string) => void\n}\n\nconst iconMap = {\n  success: CheckCircle,\n  error: XCircle,\n  warning: AlertCircle,\n  info: Info,\n}\n\nconst colorMap = {\n  success: {\n    container: 'bg-green-50 border-green-200',\n    icon: 'text-green-400',\n    text: 'text-green-800',\n    button: 'text-green-400 hover:bg-green-100',\n  },\n  error: {\n    container: 'bg-red-50 border-red-200',\n    icon: 'text-red-400',\n    text: 'text-red-800',\n    button: 'text-red-400 hover:bg-red-100',\n  },\n  warning: {\n    container: 'bg-yellow-50 border-yellow-200',\n    icon: 'text-yellow-400',\n    text: 'text-yellow-800',\n    button: 'text-yellow-400 hover:bg-yellow-100',\n  },\n  info: {\n    container: 'bg-blue-50 border-blue-200',\n    icon: 'text-blue-400',\n    text: 'text-blue-800',\n    button: 'text-blue-400 hover:bg-blue-100',\n  },\n}\n\nfunction ToastItem({ toast, onClose }: ToastProps) {\n  const [isVisible, setIsVisible] = useState(false)\n  const [isExiting, setIsExiting] = useState(false)\n\n  const Icon = iconMap[toast.type]\n  const colors = colorMap[toast.type]\n\n  useEffect(() => {\n    // Trigger entrance animation\n    setIsVisible(true)\n\n    // Auto-close after duration\n    const duration = toast.duration || (toast.type === 'error' ? 6000 : 4000)\n    const timer = setTimeout(() => {\n      handleClose()\n    }, duration)\n\n    return () => clearTimeout(timer)\n  }, [toast.duration, toast.type])\n\n  const handleClose = () => {\n    setIsExiting(true)\n    setTimeout(() => {\n      onClose(toast.id)\n    }, 300) // Match transition duration\n  }\n\n  return (\n    <div\n      className={clsx(\n        'flex items-center justify-between p-4 mb-3 border rounded-lg shadow-sm transition-all duration-300 transform',\n        colors.container,\n        isVisible && !isExiting\n          ? 'translate-x-0 opacity-100'\n          : '-translate-x-full opacity-0'\n      )}\n    >\n      <div className=\"flex items-center\">\n        <Icon className={clsx('h-5 w-5 mr-3 flex-shrink-0', colors.icon)} />\n        <p className={clsx('text-sm font-medium', colors.text)}>\n          {toast.message}\n        </p>\n      </div>\n      <button\n        onClick={handleClose}\n        className={clsx(\n          'ml-4 inline-flex rounded-md p-1.5 transition-colors duration-200',\n          colors.button\n        )}\n      >\n        <X className=\"h-4 w-4\" />\n      </button>\n    </div>\n  )\n}\n\nexport default ToastItem\n","import React, { createContext, useContext, useState, useCallback } from 'react'\nimport ToastItem, { Toast } from './Toast'\n\ninterface ToastContextType {\n  showToast: (message: string, type: Toast['type'], duration?: number) => string\n  showSuccess: (message: string, duration?: number) => string\n  showError: (message: string, duration?: number) => string\n  showWarning: (message: string, duration?: number) => string\n  showInfo: (message: string, duration?: number) => string\n  removeToast: (id: string) => void\n}\n\nconst ToastContext = createContext<ToastContextType | undefined>(undefined)\n\nexport function useToast() {\n  const context = useContext(ToastContext)\n  if (context === undefined) {\n    throw new Error('useToast must be used within a ToastProvider')\n  }\n  return context\n}\n\ninterface ToastProviderProps {\n  children: React.ReactNode\n}\n\nexport function ToastProvider({ children }: ToastProviderProps) {\n  const [toasts, setToasts] = useState<Toast[]>([])\n\n  const generateId = () => Math.random().toString(36).substr(2, 9)\n\n  const showToast = useCallback((message: string, type: Toast['type'], duration?: number): string => {\n    const id = generateId()\n    const toast: Toast = { id, message, type, duration }\n\n    setToasts(prev => [...prev, toast])\n\n    // Auto-remove toast after animation\n    setTimeout(() => {\n      removeToast(id)\n    }, (duration || (type === 'error' ? 6000 : 4000)) + 300)\n\n    return id\n  }, [])\n\n  const showSuccess = useCallback((message: string, duration?: number) => {\n    return showToast(message, 'success', duration)\n  }, [showToast])\n\n  const showError = useCallback((message: string, duration?: number) => {\n    return showToast(message, 'error', duration)\n  }, [showToast])\n\n  const showWarning = useCallback((message: string, duration?: number) => {\n    return showToast(message, 'warning', duration)\n  }, [showToast])\n\n  const showInfo = useCallback((message: string, duration?: number) => {\n    return showToast(message, 'info', duration)\n  }, [showToast])\n\n  const removeToast = useCallback((id: string) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id))\n  }, [])\n\n  const value: ToastContextType = {\n    showToast,\n    showSuccess,\n    showError,\n    showWarning,\n    showInfo,\n    removeToast,\n  }\n\n  return (\n    <ToastContext.Provider value={value}>\n      {children}\n      {/* Toast Container */}\n      <div className=\"fixed top-4 right-4 z-50 min-w-96 max-w-sm\">\n        {toasts.map(toast => (\n          <ToastItem\n            key={toast.id}\n            toast={toast}\n            onClose={removeToast}\n          />\n        ))}\n      </div>\n    </ToastContext.Provider>\n  )\n}\n","import { useState } from 'react'\nimport { useAuth } from '../../contexts/AuthContext'\nimport { Button } from '../ui/Button'\n\ninterface LoginProps {\n  onSuccess?: () => void\n}\n\nexport default function Login({ onSuccess }: LoginProps) {\n  const { signIn, loading } = useAuth()\n  const [error, setError] = useState<string>('')\n\n  const handleSignIn = async () => {\n    try {\n      setError('')\n      await signIn()\n      onSuccess?.()\n    } catch (err) {\n      console.error('Login error:', err)\n      setError('Failed to sign in. Please try again.')\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full\">\n        <div className=\"-mt-8\">\n          <div className=\"mx-auto h-56 w-56 flex items-center justify-center\">\n            <img src=\"/logo.png\" alt=\"Ledger logo\" className=\"h-full w-full object-contain\" />\n          </div>\n          <h2 className=\"text-center text-4xl font-extrabold text-gray-900\">\n            <span className=\"text-primary-600\">Ledger</span> Inventory\n          </h2>\n          <p className=\"mt-2 text-center text-lg text-gray-600\">\n          Inventory Management for <strong className=\"font-semibold text-primary-600\">Interior Designers</strong>\n          </p>\n        </div>\n\n        <div className=\"mt-8 space-y-6\">\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n              <div className=\"text-sm text-red-600\">{error}</div>\n            </div>\n          )}\n\n          <div>\n            <Button\n              onClick={handleSignIn}\n              disabled={loading}\n              className=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <svg className=\"w-5 h-5 mr-3\" viewBox=\"0 0 24 24\">\n                <path\n                  fill=\"currentColor\"\n                  d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n                />\n                <path\n                  fill=\"currentColor\"\n                  d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n                />\n                <path\n                  fill=\"currentColor\"\n                  d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n                />\n                <path\n                  fill=\"currentColor\"\n                  d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n                />\n              </svg>\n              {loading ? 'Signing in...' : 'Continue with Google'}\n            </Button>\n          </div>\n\n        </div>\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { useAuth } from '../../contexts/AuthContext'\nimport Login from './Login'\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode\n}\n\nexport default function ProtectedRoute({ children }: ProtectedRouteProps) {\n  const { isAuthenticated, loading, userLoading, user, timedOutWithoutAuth } = useAuth()\n\n  if (loading || userLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"></div>\n      </div>\n    )\n  }\n\n  // If auth timed out without establishing authentication, show login\n  if (timedOutWithoutAuth || !isAuthenticated || !user) {\n    if (import.meta.env.DEV) {\n      // Minimal gating telemetry (no PII)\n      console.log('[ProtectedRoute] Redirecting to <Login />', {\n        timedOutWithoutAuth,\n        isAuthenticated,\n        hasUser: !!user\n      })\n    }\n    return <Login />\n  }\n\n  return <>{children}</>\n}\n","import { Routes, Route } from 'react-router-dom'\nimport { lazy, Suspense } from 'react'\nimport Layout from './components/layout/Layout'\nimport LoadingSpinner from './components/ui/LoadingSpinner'\nimport { ToastProvider } from './components/ui/ToastContext'\nimport { AccountProvider } from './contexts/AccountContext'\nimport { BusinessProfileProvider } from './contexts/BusinessProfileContext'\nimport ProtectedRoute from './components/auth/ProtectedRoute'\n\nfunction App() {\n  // No longer initializing anonymous authentication\n  // Users must explicitly sign in with Google for security\n\n  return (\n      <AccountProvider>\n        <BusinessProfileProvider>\n          <ToastProvider>\n            <Suspense fallback={<LoadingSpinner />}>\n              <Routes>\n                {/* Public routes */}\n                <Route path=\"/auth/callback\" element={<AuthCallback />} />\n                <Route path=\"/invite/:token\" element={<InviteAccept />} />\n                \n                {/* Protected routes */}\n                <Route path=\"*\" element={\n                  <ProtectedRoute>\n                    <Layout>\n                      <Routes>\n                        <Route path=\"/\" element={<Projects />} />\n                        <Route path=\"/projects\" element={<Projects />} />\n                        <Route path=\"/settings\" element={<Settings />} />\n                        <Route path=\"/item/:id\" element={<ItemDetail />} />\n                        <Route path=\"/project/:id\" element={<ProjectDetail />} />\n                        <Route path=\"/project/:id/invoice\" element={<ProjectInvoice />} />\n                        <Route path=\"/project/:id/property-management-summary\" element={<PropertyManagementSummary />} />\n                        <Route path=\"/project/:id/client-summary\" element={<ClientSummary />} />\n                        <Route path=\"/project/:id/item/:itemId\" element={<ItemDetail />} />\n                        <Route path=\"/project/:id/item/add\" element={<AddItem />} />\n                        <Route path=\"/project/:id/edit-item/:itemId\" element={<EditItem />} />\n                        <Route path=\"/project/:id/transaction/add\" element={<AddTransaction />} />\n                        <Route path=\"/project/:id/transaction/:transactionId/edit\" element={<EditTransaction />} />\n                        <Route path=\"/project/:id/transaction/:transactionId\" element={<TransactionDetail />} />\n\n                        {/* Business Inventory Routes */}\n                        <Route path=\"/business-inventory\" element={<BusinessInventory />} />\n                        <Route path=\"/business-inventory/add\" element={<AddBusinessInventoryItem />} />\n                        <Route path=\"/business-inventory/:id\" element={<BusinessInventoryItemDetail />} />\n                        <Route path=\"/business-inventory/:id/edit\" element={<EditBusinessInventoryItem />} />\n                        <Route path=\"/business-inventory/transaction/add\" element={<AddBusinessInventoryTransaction />} />\n                        <Route path=\"/business-inventory/transaction/:transactionId\" element={<TransactionDetail />} />\n                        <Route path=\"/business-inventory/transaction/:projectId/:transactionId/edit\" element={<EditBusinessInventoryTransaction />} />\n                      </Routes>\n                    </Layout>\n                  </ProtectedRoute>\n                } />\n              </Routes>\n            </Suspense>\n          </ToastProvider>\n        </BusinessProfileProvider>\n      </AccountProvider>\n  )\n}\n\n// Lazy load pages for better performance\nconst AuthCallback = lazy(() => import('./pages/AuthCallback'))\nconst InviteAccept = lazy(() => import('./pages/InviteAccept'))\nconst Projects = lazy(() => import('./pages/Projects'))\nconst ItemDetail = lazy(() => import('./pages/ItemDetail'))\nconst ProjectDetail = lazy(() => import('./pages/ProjectDetail'))\nconst ProjectInvoice = lazy(() => import('./pages/ProjectInvoice'))\nconst PropertyManagementSummary = lazy(() => import('./pages/PropertyManagementSummary'))\nconst ClientSummary = lazy(() => import('./pages/ClientSummary'))\nconst AddItem = lazy(() => import('./pages/AddItem'))\nconst EditItem = lazy(() => import('./pages/EditItem'))\nconst AddTransaction = lazy(() => import('./pages/AddTransaction'))\nconst EditTransaction = lazy(() => import('./pages/EditTransaction'))\nconst TransactionDetail = lazy(() => import('./pages/TransactionDetail'))\nconst Settings = lazy(() => import('./pages/Settings'))\nconst BusinessInventory = lazy(() => import('./pages/BusinessInventory'))\nconst BusinessInventoryItemDetail = lazy(() => import('./pages/BusinessInventoryItemDetail'))\nconst AddBusinessInventoryItem = lazy(() => import('./pages/AddBusinessInventoryItem'))\nconst EditBusinessInventoryItem = lazy(() => import('./pages/EditBusinessInventoryItem'))\nconst AddBusinessInventoryTransaction = lazy(() => import('./pages/AddBusinessInventoryTransaction'))\nconst EditBusinessInventoryTransaction = lazy(() => import('./pages/EditBusinessInventoryTransaction'))\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter } from 'react-router-dom'\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query'\nimport App from './App.tsx'\nimport './index.css'\nimport { AuthProvider } from './contexts/AuthContext'\n\n// Create a client\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 5 * 60 * 1000, // 5 minutes\n      gcTime: 10 * 60 * 1000, // 10 minutes (was cacheTime)\n      refetchOnWindowFocus: false,\n    },\n  },\n})\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <AuthProvider>\n    <QueryClientProvider client={queryClient}>\n      <BrowserRouter>\n        <App />\n      </BrowserRouter>\n    </QueryClientProvider>\n    </AuthProvider>\n  </React.StrictMode>,\n)\n"],"file":"assets/index.js"}