import{a as te,j as e}from"./index.js";import{r as l}from"./vendor.js";import{L as _,b as se,c as le,u as ce,d as de}from"./router.js";import{unifiedItemsService as L,integrationService as me,transactionService as R,projectService as M}from"./inventoryService.js";import{I as Z}from"./imageService.js";import{u as ue}from"./useBookmark.js";import{u as xe}from"./useDuplication.js";import{u as ge}from"./useNavigationContext.js";import{d as re,k as ae,l as ne,Q as he,T as oe,R as pe,B as ye,f as ie,g as fe,h as be,m as je,e as X,j as ee,D as we,P as ve}from"./ui.js";import{a as Ne,f as ke}from"./dateUtils.js";import{B as Ce,P as Se}from"./BudgetProgress.js";import"./firebase.js";function Te({projectId:c,projectName:f}){const[m,w]=l.useState(""),[h,i]=l.useState(new Set),[p,y]=l.useState([]),[C,P]=l.useState(!0),[b,x]=l.useState(null),[S,T]=l.useState(new Set),[a,d]=l.useState(null),[g,v]=l.useState("all"),[k,N]=l.useState(!1),{showSuccess:D,showError:F}=te();l.useEffect(()=>{(async()=>{try{P(!0),x(null),console.log("Fetching items for project:",c);const r=await L.getItemsByProject(c);console.log("Fetched items:",r.length,r),y(r)}catch(r){console.error("Failed to fetch items:",r),x("Failed to load inventory items. Please try again.")}finally{P(!1)}})();const s=L.subscribeToItemsByProject(c,r=>{console.log("Real-time items update:",r.length,r),y(r)});return()=>{s()}},[c]),l.useEffect(()=>()=>{T(new Set)},[]),l.useEffect(()=>{const t=s=>{if(a&&!s.target)return;const r=s.target;!r.closest(".disposition-menu")&&!r.closest(".disposition-badge")&&d(null),k&&!r.closest(".filter-menu")&&!r.closest(".filter-button")&&N(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[a,k]);const U=t=>{i(t?new Set(p.map(s=>s.item_id)):new Set)},E=(t,s)=>{const r=new Set(h);s?r.add(t):r.delete(t),i(r)},{toggleBookmark:O}=ue({items:p,setItems:y,updateItemService:(t,s)=>L.updateItem(t,s),projectId:c}),{duplicateItem:$}=xe({items:p,setItems:y,projectId:c}),{buildContextUrl:W}=ge(),Q=async(t,s)=>{console.log("üéØ InventoryList updateDisposition called:",t,s);try{const r=p.find(u=>u.item_id===t);if(!r){console.error("‚ùå Item not found for disposition update:",t);return}if(console.log("üìù Updating disposition from",r.disposition,"to",s),await L.updateItem(t,{disposition:s}),console.log("üíæ Database updated successfully"),s==="inventory"){console.log("üöÄ Starting deallocation process for item:",t);try{await me.handleItemDeallocation(t,r.project_id||"",s),console.log("‚úÖ Deallocation completed successfully"),d(null)}catch(u){console.error("‚ùå Failed to handle deallocation:",u),await L.updateItem(t,{disposition:r.disposition}),x("Failed to move item to inventory. Please try again.");return}}else y(p.map(u=>u.item_id===t?{...u,disposition:s}:u)),d(null)}catch(r){console.error("‚ùå Failed to update disposition:",r),x("Failed to update item disposition. Please try again.")}},q=t=>{d(a===t?null:t)},V=t=>{const s="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium cursor-pointer transition-colors hover:opacity-80";switch(t){case"keep":return`${s} bg-green-100 text-green-800`;case"to return":case"return":return`${s} bg-red-100 text-red-700`;case"returned":return`${s} bg-red-800 text-red-100`;case"inventory":return`${s} bg-primary-100 text-primary-600`;default:return`${s} bg-gray-100 text-gray-800`}},B=async t=>{var s,r;try{T(j=>new Set(j).add(t));const u=await Z.selectFromGallery();if(u.length>0)for(let j=0;j<u.length;j++){const A=u[j];await G(t,A,u)}}catch(u){if(console.error("Error adding image:",u),(s=u.message)!=null&&s.includes("timeout")||(r=u.message)!=null&&r.includes("canceled")){console.log("User canceled image selection or selection timed out");return}F("Failed to add image. Please try again.")}finally{T(u=>{const j=new Set(u);return j.delete(t),j})}},G=async(t,s,r)=>{const j={url:(await Z.uploadItemImage(s,f,t)).url,alt:s.name,isPrimary:!0,uploadedAt:new Date,fileName:s.name,size:s.size,mimeType:s.type};if(await L.updateItem(t,{images:[j]}),r&&r.indexOf(s)===r.length-1){const A=r.length>1?`${r.length} images uploaded successfully!`:"Image uploaded successfully!";D(A)}},H=async()=>{if(h.size===0)return;const t=`Are you sure you want to delete ${h.size} item(s)? This action cannot be undone.`;if(confirm(t))try{const s=Array.from(h).map(r=>L.deleteItem(r));await Promise.all(s),i(new Set),x(null)}catch(s){console.error("Failed to delete items:",s),x("Failed to delete some items. Please try again.")}},z=p.filter(t=>{const s=t.description.toLowerCase().includes(m.toLowerCase())||t.source.toLowerCase().includes(m.toLowerCase())||t.sku.toLowerCase().includes(m.toLowerCase())||t.payment_method.toLowerCase().includes(m.toLowerCase())||t.space&&t.space.toLowerCase().includes(m.toLowerCase());let r=!1;switch(g){case"all":r=!0;break;case"bookmarked":r=t.bookmark;break;case"to-inventory":r=t.disposition==="inventory";break;case"from-inventory":r=t.source==="Inventory";break;default:r=!0}return s&&r});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-2",children:e.jsxs(_,{to:`/project/${c}/item/add`,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ae,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search items...",value:m,onChange:t=>w(t.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 rounded-lg",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4",onChange:t=>U(t.target.checked),checked:h.size===p.length&&p.length>0}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"Select all"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[h.size>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[h.size," of ",p.length," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>N(!k),className:`filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${g==="all"?"border-gray-300 text-gray-700 bg-white hover:bg-gray-50":"border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100"}`,title:"Filter items",children:e.jsx(ne,{className:"h-4 w-4"})}),k&&e.jsx("div",{className:"filter-menu absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{v("all"),N(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${g==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Items"}),e.jsx("button",{onClick:()=>{v("bookmarked"),N(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${g==="bookmarked"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Bookmarked"}),e.jsx("button",{onClick:()=>{v("to-inventory"),N(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${g==="to-inventory"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"To Inventory"}),e.jsx("button",{onClick:()=>{v("from-inventory"),N(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${g==="from-inventory"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"From Inventory"})]})})]}),e.jsx("button",{className:"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 transition-colors duration-200",disabled:h.size===0,title:"Generate QR Codes",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:H,className:"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",disabled:h.size===0,title:"Delete All",children:e.jsx(oe,{className:"h-4 w-4"})})]})]})]})]})}),C&&e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 animate-spin mb-4",children:e.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading inventory..."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Fetching your project items."})]}),b&&e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-red-400 mb-4",children:"‚ö†Ô∏è"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error loading inventory"}),e.jsx("p",{className:"text-sm text-red-500 mb-6 max-w-sm mx-auto",children:b}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 transition-colors duration-200 w-full sm:w-auto max-w-xs",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Retry"]})]}),!C&&!b&&z.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"üì¶"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No items yet"})]}):!C&&!b&&e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:z.map(t=>e.jsxs("li",{className:"relative bg-gray-50 transition-colors duration-200 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0 px-4 py-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4 flex-shrink-0",checked:h.has(t.item_id),onChange:s=>E(t.item_id,s.target.checked)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),O(t.item_id)},className:`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md transition-colors ${t.bookmark?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`,title:t.bookmark?"Remove Bookmark":"Add Bookmark",children:e.jsx(ye,{className:"h-4 w-4",fill:t.bookmark?"currentColor":"none"})}),e.jsx(_,{to:`/project/${c}/edit-item/${t.item_id}?project=${c}&returnTo=${encodeURIComponent(window.location.pathname+window.location.search)}`,onClick:s=>s.stopPropagation(),className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"Edit item",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),$(t.item_id)},className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"Duplicate item",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs("span",{onClick:s=>{s.preventDefault(),s.stopPropagation(),q(t.item_id)},className:`disposition-badge ${V(t.disposition)}`,children:[t.disposition==="to return"?"To Return":t.disposition?t.disposition.charAt(0).toUpperCase()+t.disposition.slice(1):"Not Set",e.jsx(be,{className:"h-3 w-3 ml-1"})]}),a===t.item_id&&e.jsx("div",{className:"disposition-menu absolute top-full left-0 mt-1 w-32 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsx("div",{className:"py-1",children:["keep","to return","returned","inventory"].map(s=>e.jsx("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),Q(t.item_id,s)},className:`block w-full text-left px-3 py-2 text-xs hover:bg-gray-50 ${t.disposition===s||s==="to return"&&t.disposition==="return"?"bg-gray-100 text-gray-900":"text-gray-700"}`,disabled:!t.disposition,children:s==="to return"?"To Return":s.charAt(0).toUpperCase()+s.slice(1)},s))})})]})]})]}),e.jsx(_,{to:W(`/item/${t.item_id}`,{project:c}),children:e.jsx("div",{className:"block bg-transparent",children:e.jsxs("div",{className:"px-4 pb-3 sm:px-6",children:[e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[e.jsx("div",{className:"flex-shrink-0",children:t.images&&t.images.length>0?(()=>{const s=t.images.find(r=>r.isPrimary)||t.images[0];return e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:s.url,alt:s.alt||"Item image",className:"w-full h-full object-cover"})})})():e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),B(t.item_id)},disabled:S.has(t.item_id),className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors disabled:opacity-50",title:"Add image (camera or gallery)",children:e.jsx(je,{className:"h-6 w-6"})})}),e.jsx("div",{className:"flex-1 min-w-0 flex items-center",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900 line-clamp-2 break-words",children:t.description}),t.space&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.space})]})})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500",children:[(t.project_price||t.purchase_price)&&e.jsxs("span",{className:"font-medium text-gray-700",children:["$",t.project_price||t.purchase_price]}),t.source&&e.jsxs(e.Fragment,{children:[(t.project_price||t.purchase_price)&&e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.source})]}),t.sku&&e.jsxs(e.Fragment,{children:[(t.project_price||t.purchase_price||t.source)&&e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.sku})]})]})})]})})})]},t.item_id))})})]})}const _e=c=>{var f,m;return(f=c.transaction_id)!=null&&f.startsWith("INV_SALE_")?"1584 Inventory Sale":(m=c.transaction_id)!=null&&m.startsWith("INV_PURCHASE_")?"1584 Inventory Purchase":c.source},J=()=>{document.querySelectorAll(".no-icon").forEach(f=>{Array.from(f.childNodes).forEach(w=>{w.nodeType!==Node.TEXT_NODE&&f.removeChild(w)})})};function Pe({projectId:c}){const{id:f}=se(),m=c||f,[w,h]=l.useState([]),[i,p]=l.useState(!0),[y,C]=l.useState(""),[P,b]=l.useState(!1),[x,S]=l.useState("all");l.useEffect(()=>{(async()=>{if(!m){p(!1);return}try{const d=await R.getTransactions(m);h(d)}catch(d){console.error("Error loading transactions:",d),h([])}finally{p(!1)}})()},[m]),l.useEffect(()=>m?R.subscribeToTransactions(m,d=>{h(d)}):void 0,[m]);const T=l.useMemo(()=>{let a=w;if(x!=="all"&&(x==="we-owe"?a=a.filter(d=>d.reimbursement_type==="We Owe"):x==="client-owes"&&(a=a.filter(d=>d.reimbursement_type==="Client Owes"))),y){const d=y.toLowerCase();a=a.filter(g=>{var v,k,N;return((v=g.source)==null?void 0:v.toLowerCase().includes(d))||((k=g.transaction_type)==null?void 0:k.toLowerCase().includes(d))||((N=g.notes)==null?void 0:N.toLowerCase().includes(d))})}return a},[w,x,y]);return l.useEffect(()=>{const a=d=>{if(!d.target)return;const g=d.target;!g.closest(".filter-menu")&&!g.closest(".filter-button")&&b(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),l.useEffect(()=>{J();const a=setTimeout(J,100),d=setTimeout(J,500);return()=>{clearTimeout(a),clearTimeout(d)}},[w]),i?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2",children:e.jsxs(_,{to:`/project/${m}/transaction/add`,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ae,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search transactions by source, type, or notes...",value:y||"",onChange:a=>C(a.target.value)})]}),e.jsx("div",{className:"flex items-center justify-end gap-4 p-3 rounded-lg",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>b(!P),className:`filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${x==="all"?"border-gray-300 text-gray-700 bg-white hover:bg-gray-50":"border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100"}`,title:"Filter transactions",children:e.jsx(ne,{className:"h-4 w-4"})}),P&&e.jsx("div",{className:"filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{S("all"),b(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${x==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Transactions"}),e.jsx("button",{onClick:()=>{S("we-owe"),b(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${x==="we-owe"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"We Owe"}),e.jsx("button",{onClick:()=>{S("client-owes"),b(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${x==="client-owes"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Client Owes"})]})})]})})]})}),T.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"üßæ"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No transactions found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:y||x!=="all"?"Try adjusting your search or filter criteria.":"No transactions found."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:T.map(a=>e.jsx("li",{className:"relative",children:e.jsx(_,{to:`/project/${m}/transaction/${a.transaction_id}`,className:"block bg-gray-50 transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"px-4 py-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h3",{className:"text-base font-medium text-gray-900",children:_e(a)})}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[a.budget_category&&e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${a.budget_category==="Design Fee"?"bg-amber-100 text-amber-800":a.budget_category==="Furnishings"?"bg-yellow-100 text-yellow-800":a.budget_category==="Property Management"?"bg-orange-100 text-orange-800":a.budget_category==="Kitchen"?"bg-amber-200 text-amber-900":a.budget_category==="Install"?"bg-yellow-200 text-yellow-900":a.budget_category==="Storage & Receiving"?"bg-orange-200 text-orange-900":a.budget_category==="Fuel"?"bg-amber-300 text-amber-900":"bg-gray-100 text-gray-800"}`,children:a.budget_category}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${a.transaction_type==="Purchase"?"bg-green-100 text-green-800":a.transaction_type==="Return"?"bg-red-100 text-red-800":a.transaction_type==="To Inventory"?"bg-primary-100 text-primary-800":"bg-gray-100 text-gray-800"}`,children:a.transaction_type==="To Inventory"?"Inventory":a.transaction_type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-700",children:Ne(a.amount)}),e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:a.payment_method}),e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:ke(a.transaction_date)})]}),a.notes&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:a.notes})]})]})})},a.transaction_id))})})]})}function Ue(){var Y;const{id:c}=se(),f=le(),m=ce(),[w,h]=de(),[i,p]=l.useState(null),[y,C]=l.useState([]),[P,b]=l.useState(!0),[x,S]=l.useState(null),[T,a]=l.useState(!1),[d,g]=l.useState(!1),[v,k]=l.useState(!1),{showError:N}=te(),D=w.get("tab")||"transactions",[F,U]=l.useState("budget"),E=new URLSearchParams(m.search),O=E.get("from")==="business-inventory-item",$=l.useMemo(()=>{const o=E.get("returnTo");if(o)return o;if(O){const n=E.get("returnTo");return n&&n.includes("/business-inventory/")?n:"/business-inventory"}return"/projects"},[O,E]),W=o=>{const n=new URLSearchParams(w);n.set("tab",o),h(n)},Q=o=>{U(o)},q=()=>{const o=y.filter(n=>{const I=n.status==="pending"&&n.reimbursement_type==="Client Owes",K=(!n.status||n.status==="pending")&&n.payment_method==="1584 Card";return I||K});return console.log("Owed to 1584 - Client Owes transactions:",o.length),o.reduce((n,I)=>n+parseFloat(I.amount||"0"),0)},V=()=>{const o=y.filter(n=>{const I=n.status==="pending"&&n.reimbursement_type==="We Owe",K=(!n.status||n.status==="pending")&&n.payment_method==="Client Card";return I||K});return console.log("Owed to Client - We Owe transactions:",o.length),o.reduce((n,I)=>n+parseFloat(I.amount||"0"),0)},B=async()=>{if(!c){console.warn("No project ID provided, redirecting to projects"),f("/projects");return}b(!0);try{console.log("Loading project data for ID:",c);const o=await M.getProject(c);if(o){console.log("Project loaded successfully:",o.name),p(o);const n=await R.getTransactions(c);console.log("Transactions loaded:",n.length),C(n)}else console.warn("Project not found:",c),f("/projects")}catch(o){console.error("Error loading project:",o),S("Failed to load project. Please try again."),b(!1)}finally{b(!1)}};l.useEffect(()=>{B()},[c,f]);const G=()=>{S(null),B()};l.useEffect(()=>c?R.subscribeToTransactions(c,n=>{C(n)}):void 0,[c]);const H=async o=>{if(!(!i||!c))try{await M.updateProject(c,o);const n=await M.getProject(c);p(n),a(!1)}catch(n){throw console.error("Error updating project:",n),n}},z=()=>{a(!0)},t=()=>{a(!1)},s=()=>{g(!0)},r=()=>{g(!1)},u=async()=>{if(c){k(!0);try{await M.deleteProject(c),f("/projects")}catch(o){console.error("Error deleting project:",o),k(!1),g(!1),N("Failed to delete project. Please try again.")}}},j=[{id:"inventory",name:"Items",icon:ve},{id:"transactions",name:"Transactions",icon:ee}],A=[{id:"budget",name:"Budget",icon:ee},{id:"accounting",name:"Accounting",icon:we}];return P?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading project..."})]})}):x?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-red-400",children:"‚ö†Ô∏è"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Error Loading Project"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:x}),e.jsxs("div",{className:"mt-6 flex justify-center space-x-3",children:[e.jsx("button",{onClick:G,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Try Again"}),e.jsxs(_,{to:$,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})]})]}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{to:$,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:z,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs("button",{onClick:s,className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:i.name}),i.clientName&&e.jsx("p",{className:"text-lg text-gray-600 mb-6",children:i.clientName})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:A.map(o=>{const n=o.icon;return e.jsxs("button",{onClick:()=>Q(o.id),className:`py-4 px-1 border-b-2 font-medium text-base flex items-center ${F===o.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),o.name]},o.id)})})}),e.jsxs("div",{className:"pt-6",children:[F==="budget"&&i&&e.jsx(Ce,{budget:i.budget,designFee:i.designFee,budgetCategories:i.budgetCategories,transactions:y}),F==="accounting"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-0.5",children:"Owed to 1584"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["$",q().toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-0.5",children:"Owed to Client"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["$",V().toFixed(2)]})]})]})})]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:j.map(o=>{const n=o.icon;return e.jsxs("button",{onClick:()=>W(o.id),className:`py-4 px-1 border-b-2 font-medium text-base flex items-center ${D===o.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),o.name]},o.id)})})}),e.jsxs("div",{className:"px-6 py-6",children:[D==="inventory"&&e.jsx(Te,{projectId:i.id,projectName:i.name}),D==="transactions"&&e.jsx(Pe,{projectId:i.id})]})]}),T&&i&&e.jsx(Se,{initialData:{name:i.name,description:i.description,clientName:i.clientName,budget:i.budget,designFee:i.designFee,budgetCategories:i.budgetCategories},onSubmit:H,onCancel:t}),d&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Are you sure you want to delete the project ",e.jsxs("strong",{children:['"',i==null?void 0:i.name,'"']}),"? This action cannot be undone and will permanently delete the project and all associated data."]}),i&&((Y=i.metadata)==null?void 0:Y.totalItems)&&i.metadata.totalItems>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Warning"}),e.jsx("div",{className:"mt-1 text-sm text-yellow-700",children:e.jsxs("p",{children:["This project contains ",i.metadata.totalItems," item(s). Deleting the project will permanently remove all associated data."]})})]})})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:r,disabled:v,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:v,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:v?"Deleting...":"Delete"})]})]})]})})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"üìÅ"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Project not found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"The project you're looking for doesn't exist."}),e.jsx("div",{className:"mt-6",children:e.jsxs(_,{to:$,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})})]})}export{Ue as default};
//# sourceMappingURL=ProjectDetail.js.map
