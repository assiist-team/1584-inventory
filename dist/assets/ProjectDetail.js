import{d as ae,e as ie,j as e,C as le,f as ce,h as ye,i as be,B as te}from"./index.js";import{r as l}from"./vendor.js";import{L as E,c as de,b as je,u as Ne,d as we}from"./router.js";import{u as F,i as ve,a as Ce,f as ke,t as Q,p as W}from"./inventoryService.js";import{I as ne}from"./imageService.js";import{u as Se}from"./useBookmark.js";import{u as Pe}from"./useDuplication.js";import{u as Ie}from"./useNavigationContext.js";import{f as me,m as ue,n as xe,Q as Te,T as ge,R as De,B as Le,h as he,i as Ee,j as Ae,o as $e,g as se,l as oe,D as Fe,p as Me,q as Be,r as Re,P as Ue}from"./ui.js";import{B as ze,P as Oe}from"./BudgetProgress.js";import"./supabase.js";import"./taxPresetsService.js";function _e({projectId:c,projectName:u,items:h}){const{currentAccountId:i,loading:f}=ae(),[w,D]=l.useState(""),[a,S]=l.useState(new Set),[x,P]=l.useState(h||[]),[M,I]=l.useState(!1),[p,v]=l.useState(null),C=f,[r,g]=l.useState(new Set),[y,b]=l.useState(null),[j,k]=l.useState("all"),[A,L]=l.useState(!1),{showSuccess:U,showError:z}=ie();l.useEffect(()=>{console.log("üîç InventoryList - accountLoading:",f,"propItems length:",(h==null?void 0:h.length)||0,"isLoading:",C)},[f,h,C]),l.useEffect(()=>{console.log("üîç InventoryList - propItems changed:",(h==null?void 0:h.length)||0),P(h||[])},[h]),l.useEffect(()=>()=>{g(new Set)},[]),l.useEffect(()=>{const t=s=>{if(y&&!s.target)return;const n=s.target;!n.closest(".disposition-menu")&&!n.closest(".disposition-badge")&&b(null),A&&!n.closest(".filter-menu")&&!n.closest(".filter-button")&&L(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[y,A]);const Y=t=>{S(t?new Set(x.map(s=>s.itemId)):new Set)},B=(t,s)=>{const n=new Set(a);s?n.add(t):n.delete(t),S(n)},{toggleBookmark:_}=Se({items:x,setItems:P,updateItemService:(t,s)=>{if(!i)throw new Error("Account ID is required");return F.updateItem(i,t,s)},projectId:c}),{duplicateItem:O}=Pe({items:x,setItems:P,projectId:c}),{buildContextUrl:G}=Ie(),V=async(t,s)=>{console.log("üéØ InventoryList updateDisposition called:",t,s);try{const n=x.find(m=>m.itemId===t);if(!n){console.error("‚ùå Item not found for disposition update:",t);return}if(console.log("üìù Updating disposition from",n.disposition,"to",s),!i)throw new Error("Account ID is required");if(await F.updateItem(i,t,{disposition:s}),console.log("üíæ Database updated successfully"),s==="inventory"){console.log("üöÄ Starting deallocation process for item:",t);try{await ve.handleItemDeallocation(i,t,n.projectId||"",s),console.log("‚úÖ Deallocation completed successfully"),b(null)}catch(m){console.error("‚ùå Failed to handle deallocation:",m),await F.updateItem(i,t,{disposition:n.disposition}),v("Failed to move item to inventory. Please try again.");return}}else P(x.map(m=>m.itemId===t?{...m,disposition:s}:m)),b(null)}catch(n){console.error("‚ùå Failed to update disposition:",n),v("Failed to update item disposition. Please try again.")}},H=t=>{b(y===t?null:t)},K=t=>{const s="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium cursor-pointer transition-colors hover:opacity-80";switch(t){case"keep":return`${s} bg-green-100 text-green-800`;case"to return":case"return":return`${s} bg-red-100 text-red-700`;case"returned":return`${s} bg-red-800 text-red-100`;case"inventory":return`${s} bg-primary-100 text-primary-600`;default:return`${s} bg-gray-100 text-gray-800`}},X=async t=>{var s,n;try{g(N=>new Set(N).add(t));const m=await ne.selectFromGallery();if(m.length>0)for(let N=0;N<m.length;N++){const R=m[N];await J(t,R,m)}}catch(m){if(console.error("Error adding image:",m),(s=m.message)!=null&&s.includes("timeout")||(n=m.message)!=null&&n.includes("canceled")){console.log("User canceled image selection or selection timed out");return}z("Failed to add image. Please try again.")}finally{g(m=>{const N=new Set(m);return N.delete(t),N})}},J=async(t,s,n)=>{const N={url:(await ne.uploadItemImage(s,u,t)).url,alt:s.name,isPrimary:!0,uploadedAt:new Date,fileName:s.name,size:s.size,mimeType:s.type};if(!i)throw new Error("Account ID is required");if(await F.updateItem(i,t,{images:[N]}),n&&n.indexOf(s)===n.length-1){const R=n.length>1?`${n.length} images uploaded successfully!`:"Image uploaded successfully!";U(R)}},Z=async()=>{if(a.size===0)return;const t=`Are you sure you want to delete ${a.size} item(s)? This action cannot be undone.`;if(confirm(t)){if(!i){v("Account ID is required");return}try{const s=Array.from(a).map(n=>F.deleteItem(i,n));await Promise.all(s),S(new Set),v(null)}catch(s){console.error("Failed to delete items:",s),v("Failed to delete some items. Please try again.")}}},q=x.filter(t=>{var m,N;const s=t.description.toLowerCase().includes(w.toLowerCase())||t.source.toLowerCase().includes(w.toLowerCase())||((m=t.sku)==null?void 0:m.toLowerCase().includes(w.toLowerCase()))||((N=t.paymentMethod)==null?void 0:N.toLowerCase().includes(w.toLowerCase()))||t.space&&t.space.toLowerCase().includes(w.toLowerCase());let n=!1;switch(j){case"all":n=!0;break;case"bookmarked":n=t.bookmark;break;case"to-inventory":n=t.disposition==="inventory";break;case"from-inventory":n=t.source==="Inventory";break;default:n=!0}return s&&n});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-2",children:e.jsxs(E,{to:`/project/${c}/item/add`,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ue,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search items...",value:w,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 rounded-lg",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4",onChange:t=>Y(t.target.checked),checked:a.size===x.length&&x.length>0}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"Select all"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.size>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[a.size," of ",x.length," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>L(!A),className:`filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${j==="all"?"border-gray-300 text-gray-700 bg-white hover:bg-gray-50":"border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100"}`,title:"Filter items",children:e.jsx(xe,{className:"h-4 w-4"})}),A&&e.jsx("div",{className:"filter-menu absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{k("all"),L(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${j==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Items"}),e.jsx("button",{onClick:()=>{k("bookmarked"),L(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${j==="bookmarked"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Bookmarked"}),e.jsx("button",{onClick:()=>{k("to-inventory"),L(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${j==="to-inventory"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"To Inventory"}),e.jsx("button",{onClick:()=>{k("from-inventory"),L(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${j==="from-inventory"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"From Inventory"})]})})]}),e.jsx("button",{className:"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 transition-colors duration-200",disabled:a.size===0,title:"Generate QR Codes",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:Z,className:"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",disabled:a.size===0,title:"Delete All",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})]})]})}),C&&e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 animate-spin mb-4",children:e.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading inventory..."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Fetching your project items."})]}),p&&e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-red-400 mb-4",children:"‚ö†Ô∏è"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error loading inventory"}),e.jsx("p",{className:"text-sm text-red-500 mb-6 max-w-sm mx-auto",children:p}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 transition-colors duration-200 w-full sm:w-auto max-w-xs",children:[e.jsx(De,{className:"h-5 w-5 mr-2"}),"Retry"]})]}),!C&&!p&&q.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"üì¶"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No items yet"})]}):!C&&!p&&e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:q.map(t=>e.jsxs("li",{className:"relative bg-gray-50 transition-colors duration-200 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0 px-4 py-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4 flex-shrink-0",checked:a.has(t.itemId),onChange:s=>B(t.itemId,s.target.checked)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),_(t.itemId)},className:`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md transition-colors ${t.bookmark?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`,title:t.bookmark?"Remove Bookmark":"Add Bookmark",children:e.jsx(Le,{className:"h-4 w-4",fill:t.bookmark?"currentColor":"none"})}),e.jsx(E,{to:`/project/${c}/edit-item/${t.itemId}?project=${c}&returnTo=${encodeURIComponent(window.location.pathname+window.location.search)}`,onClick:s=>s.stopPropagation(),className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"Edit item",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),O(t.itemId)},className:"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",title:"Duplicate item",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs("span",{onClick:s=>{s.preventDefault(),s.stopPropagation(),H(t.itemId)},className:`disposition-badge ${K(t.disposition)}`,children:[t.disposition==="to return"?"To Return":t.disposition?t.disposition.charAt(0).toUpperCase()+t.disposition.slice(1):"Not Set",e.jsx(Ae,{className:"h-3 w-3 ml-1"})]}),y===t.itemId&&e.jsx("div",{className:"disposition-menu absolute top-full left-0 mt-1 w-32 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsx("div",{className:"py-1",children:["keep","to return","returned","inventory"].map(s=>e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),V(t.itemId,s)},className:`block w-full text-left px-3 py-2 text-xs hover:bg-gray-50 ${t.disposition===s||s==="to return"&&t.disposition==="return"?"bg-gray-100 text-gray-900":"text-gray-700"}`,disabled:!t.disposition,children:s==="to return"?"To Return":s.charAt(0).toUpperCase()+s.slice(1)},s))})})]})]})]}),e.jsx(E,{to:G(`/item/${t.itemId}`,{project:c}),children:e.jsx("div",{className:"block bg-transparent",children:e.jsxs("div",{className:"px-4 pb-3 sm:px-6",children:[e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[e.jsx("div",{className:"flex-shrink-0",children:t.images&&t.images.length>0?(()=>{const s=t.images.find(n=>n.isPrimary)||t.images[0];return e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:s.url,alt:s.alt||"Item image",className:"w-full h-full object-cover"})})})():e.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),X(t.itemId)},disabled:r.has(t.itemId),className:"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors disabled:opacity-50",title:"Add image (camera or gallery)",children:e.jsx($e,{className:"h-6 w-6"})})}),e.jsx("div",{className:"flex-1 min-w-0 flex items-center",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900 line-clamp-2 break-words",children:t.description}),t.space&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.space})]})})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500",children:[(t.projectPrice||t.purchasePrice)&&e.jsxs("span",{className:"font-medium text-gray-700",children:["$",t.projectPrice||t.purchasePrice]}),t.source&&e.jsxs(e.Fragment,{children:[(t.projectPrice||t.purchasePrice)&&e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.source})]}),t.sku&&e.jsxs(e.Fragment,{children:[(t.projectPrice||t.purchasePrice||t.source)&&e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.sku})]})]})})]})})})]},t.itemId))})})]})}const qe=c=>{var u,h;return(u=c.transactionId)!=null&&u.startsWith("INV_SALE_")?ye:(h=c.transactionId)!=null&&h.startsWith("INV_PURCHASE_")?be:c.source},re=()=>{document.querySelectorAll(".no-icon").forEach(u=>{Array.from(u.childNodes).forEach(i=>{i.nodeType!==Node.TEXT_NODE&&u.removeChild(i)})})};function We({projectId:c,transactions:u}){const{id:h}=de(),{currentAccountId:i}=ae(),f=c||h,[w,D]=l.useState(u||[]),[a,S]=l.useState(!u),[x,P]=l.useState(""),[M,I]=l.useState(!1),[p,v]=l.useState("all");l.useEffect(()=>{if(u){D(u);return}let r;const g=b=>{!f||!i||(r=Q.subscribeToTransactions(i,f,j=>{D(j)},b))};return(async()=>{if(!f||!i){S(!1);return}if(!u)try{const b=await Q.getTransactions(i,f);D(b),g(b)}catch(b){console.error("Error loading transactions:",b),D([])}finally{S(!1)}})(),()=>{r&&r()}},[f,i,u]);const C=l.useMemo(()=>{let r=w;if(p!=="all"&&(p==="we-owe"?r=r.filter(g=>g.reimbursementType===le):p==="client-owes"&&(r=r.filter(g=>g.reimbursementType===ce))),x){const g=x.toLowerCase();r=r.filter(y=>{var b,j,k;return((b=y.source)==null?void 0:b.toLowerCase().includes(g))||((j=y.transactionType)==null?void 0:j.toLowerCase().includes(g))||((k=y.notes)==null?void 0:k.toLowerCase().includes(g))})}return r},[w,p,x]);return l.useEffect(()=>{const r=g=>{if(!g.target)return;const y=g.target;!y.closest(".filter-menu")&&!y.closest(".filter-button")&&I(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),l.useEffect(()=>{re();const r=setTimeout(re,100),g=setTimeout(re,500);return()=>{clearTimeout(r),clearTimeout(g)}},[w]),a?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2",children:e.jsxs(E,{to:`/project/${f}/transaction/add`,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})}),e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2",children:e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ue,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base",placeholder:"Search transactions by source, type, or notes...",value:x||"",onChange:r=>P(r.target.value)})]}),e.jsx("div",{className:"flex items-center justify-end gap-4 p-3 rounded-lg",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>I(!M),className:`filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${p==="all"?"border-gray-300 text-gray-700 bg-white hover:bg-gray-50":"border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100"}`,title:"Filter transactions",children:e.jsx(xe,{className:"h-4 w-4"})}),M&&e.jsx("div",{className:"filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{v("all"),I(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${p==="all"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"All Transactions"}),e.jsx("button",{onClick:()=>{v("we-owe"),I(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${p==="we-owe"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"We Owe"}),e.jsx("button",{onClick:()=>{v("client-owes"),I(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${p==="client-owes"?"bg-primary-50 text-primary-600":"text-gray-700"}`,children:"Client Owes"})]})})]})})]})}),C.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mx-auto h-16 w-16 text-gray-400 -mb-1",children:"üßæ"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No transactions found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:x||p!=="all"?"Try adjusting your search or filter criteria.":"No transactions found."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:C.map(r=>e.jsx("li",{className:"relative",children:e.jsx(E,{to:`/project/${f}/transaction/${r.transactionId}`,className:"block bg-gray-50 transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"px-4 py-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h3",{className:"text-base font-medium text-gray-900",children:qe(r)})}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[r.budgetCategory&&e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${r.budgetCategory==="Design Fee"?"bg-amber-100 text-amber-800":r.budgetCategory==="Furnishings"?"bg-yellow-100 text-yellow-800":r.budgetCategory==="Property Management"?"bg-orange-100 text-orange-800":r.budgetCategory==="Kitchen"?"bg-amber-200 text-amber-900":r.budgetCategory==="Install"?"bg-yellow-200 text-yellow-900":r.budgetCategory==="Storage & Receiving"?"bg-orange-200 text-orange-900":r.budgetCategory==="Fuel"?"bg-amber-300 text-amber-900":"bg-gray-100 text-gray-800"}`,children:r.budgetCategory}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${r.transactionType==="Purchase"?"bg-green-100 text-green-800":r.transactionType==="Return"?"bg-red-100 text-red-800":r.transactionType==="To Inventory"?"bg-primary-100 text-primary-800":"bg-gray-100 text-gray-800"}`,children:r.transactionType})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-700",children:Ce(r.amount)}),e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:r.paymentMethod}),e.jsx("span",{className:"hidden sm:inline",children:"‚Ä¢"}),e.jsx("span",{className:"font-medium text-gray-700",children:ke(r.transactionDate)})]}),r.notes&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:r.notes})]})]})})},r.transactionId))})})]})}function at(){var R;const{id:c}=de(),u=je(),h=Ne(),{currentAccountId:i}=ae(),[f,w]=we(),D=f.get("budgetTab"),[a,S]=l.useState(null),[x,P]=l.useState([]),[M,I]=l.useState([]),[p,v]=l.useState(!0),[C,r]=l.useState(null),[g,y]=l.useState(!1),[b,j]=l.useState(!1),[k,A]=l.useState(!1),{showError:L}=ie(),U=f.get("tab")||"transactions",[z,Y]=l.useState(()=>D==="accounting"?"accounting":"budget"),B=new URLSearchParams(h.search),_=B.get("from")==="business-inventory-item",O=l.useMemo(()=>{const o=B.get("returnTo");if(o)return o;if(_){const d=B.get("returnTo");return d&&d.includes("/business-inventory/")?d:"/business-inventory"}return"/projects"},[_,B]),G=o=>{const d=new URLSearchParams(f);d.set("tab",o),w(d)},V=o=>{Y(o);const d=new URLSearchParams(f);d.set("budgetTab",o),w(d)},H=l.useMemo(()=>x.filter(o=>o.status!=="canceled").filter(o=>o.reimbursementType===ce).reduce((o,d)=>o+parseFloat(d.amount||"0"),0),[x]),K=l.useMemo(()=>x.filter(o=>o.status!=="canceled").filter(o=>o.reimbursementType===le).reduce((o,d)=>o+parseFloat(d.amount||"0"),0),[x]);l.useEffect(()=>{console.log("üîç ProjectDetail - useEffect triggered. id:",c,"currentAccountId:",i,"isLoading:",p);let o,d;const pe=T=>{!c||!i||(o=Q.subscribeToTransactions(i,c,$=>{P($)},T))},fe=T=>{!c||!i||(d=F.subscribeToProjectItems(i,c,$=>{I($)},T))};return(async()=>{if(console.log("üîç ProjectDetail - loadData called. id:",c,"currentAccountId:",i),!c){console.warn("No project ID provided, redirecting to projects"),u("/projects");return}if(!i){console.log("üîç ProjectDetail - No account ID yet, waiting...");return}v(!0);try{console.log("üîç ProjectDetail - Loading project data for ID:",c);const T=await W.getProject(i,c);if(T){console.log("üîç ProjectDetail - Project loaded successfully:",T.name),S(T);const[$,ee]=await Promise.all([Q.getTransactions(i,c),F.getItemsByProject(i,c)]);console.log("üîç ProjectDetail - Loaded",$.length,"transactions and",ee.length,"items"),P($),I(ee),pe($),fe(ee)}else console.warn("Project not found:",c),u("/projects")}catch(T){console.error("Error loading project:",T),r("Failed to load project. Please try again.")}finally{v(!1)}})(),()=>{o&&o(),d&&d()}},[c,i,u]);const X=()=>{r(null),c&&i&&u(0)},J=async o=>{if(!(!a||!c||!i))try{await W.updateProject(i,c,o);const d=await W.getProject(i,c);S(d),y(!1)}catch(d){throw console.error("Error updating project:",d),d}},Z=()=>{y(!0)},q=()=>{y(!1)},t=()=>{j(!0)},s=()=>{j(!1)},n=async()=>{if(!(!c||!i)){A(!0);try{await W.deleteProject(i,c),u("/projects")}catch(o){console.error("Error deleting project:",o),A(!1),j(!1),L("Failed to delete project. Please try again.")}}},m=[{id:"inventory",name:"Items",icon:Ue},{id:"transactions",name:"Transactions",icon:oe}],N=[{id:"budget",name:"Budget",icon:oe},{id:"accounting",name:"Accounting",icon:Fe}];return p?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading project..."})]})}):C?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-red-400",children:"‚ö†Ô∏è"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Error Loading Project"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:C}),e.jsxs("div",{className:"mt-6 flex justify-center space-x-3",children:[e.jsx("button",{onClick:X,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Try Again"}),e.jsxs(E,{to:O,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})]})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{to:O,className:"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:Z,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs("button",{onClick:t,className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:a.name}),a.clientName&&e.jsx("p",{className:"text-lg text-gray-600 mb-6",children:a.clientName})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:N.map(o=>{const d=o.icon;return e.jsxs("button",{onClick:()=>V(o.id),className:`py-4 px-1 border-b-2 font-medium text-base flex items-center ${z===o.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),o.name]},o.id)})})}),e.jsxs("div",{className:"pt-6",children:[z==="budget"&&a&&e.jsx(ze,{budget:a.budget,designFee:a.designFee,budgetCategories:a.budgetCategories,transactions:x}),z==="accounting"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("section",{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-0.5",children:"Owed to Design Business"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["$",H.toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-0.5",children:"Owed to Client"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["$",K.toFixed(2)]})]})]})}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Reports"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(te,{variant:"secondary",onClick:()=>u(`/project/${a.id}/property-management-summary`),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Generate Property Management Summary"]}),e.jsxs(te,{variant:"secondary",onClick:()=>u(`/project/${a.id}/client-summary`),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Generate Client Summary"]}),e.jsxs(te,{variant:"secondary",onClick:()=>u(`/project/${a.id}/invoice`),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Generate Invoice"]})]})]})]})]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:m.map(o=>{const d=o.icon;return e.jsxs("button",{onClick:()=>G(o.id),className:`py-4 px-1 border-b-2 font-medium text-base flex items-center ${U===o.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),o.name]},o.id)})})}),e.jsxs("div",{className:"px-6 py-6",children:[U==="inventory"&&a&&e.jsxs(e.Fragment,{children:[console.log("üîç ProjectDetail - Rendering InventoryList with",M.length,"items"),e.jsx(_e,{projectId:a.id,projectName:a.name,items:M})]}),U==="transactions"&&a&&e.jsx(We,{projectId:a.id,transactions:x})]})]}),g&&a&&e.jsx(Oe,{initialData:{name:a.name,description:a.description,clientName:a.clientName,budget:a.budget,designFee:a.designFee,budgetCategories:a.budgetCategories},onSubmit:J,onCancel:q}),b&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Are you sure you want to delete the project ",e.jsxs("strong",{children:['"',a==null?void 0:a.name,'"']}),"? This action cannot be undone and will permanently delete the project and all associated data."]}),a&&((R=a.metadata)==null?void 0:R.totalItems)&&a.metadata.totalItems>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Warning"}),e.jsx("div",{className:"mt-1 text-sm text-yellow-700",children:e.jsxs("p",{children:["This project contains ",a.metadata.totalItems," item(s). Deleting the project will permanently remove all associated data."]})})]})})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:s,disabled:k,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:n,disabled:k,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:k?"Deleting...":"Delete"})]})]})]})})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"üìÅ"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Project not found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"The project you're looking for doesn't exist."}),e.jsx("div",{className:"mt-6",children:e.jsxs(E,{to:O,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})})]})}export{at as default};
//# sourceMappingURL=ProjectDetail.js.map
