import{d as v,j as l}from"./index.js";import{r as h}from"./vendor.js";import{L as w}from"./router.js";import{l as I,t as j}from"./inventoryService.js";function $({itemId:m,compact:b=!0}){const{currentAccountId:o}=v(),[u,g]=h.useState([]),[f,y]=h.useState({});if(h.useEffect(()=>{if(!o||!m)return;let t=!1;(async()=>{try{const e=await I.getItemLineageHistory(m,o);if(t)return;g(e);const r=Array.from(new Set(e.flatMap(s=>[s.fromTransactionId,s.toTransactionId]).filter(Boolean))).filter(s=>!f[s]);if(r.length>0){const s=await Promise.all(r.map(async i=>{try{const x=await j.getTransactionById(o,i);return{txId:i,projectId:x.projectId||null}}catch{return{txId:i,projectId:null}}})),a={...f};s.forEach(i=>{a[i.txId]=i.projectId}),t||y(a)}}catch(e){console.debug("ItemLineageBreadcrumb - failed to load history",e)}})();let c=null;try{c=I.subscribeToItemLineageForItem(o,m,e=>{g(r=>r.find(s=>s.id===e.id)?r:[...r,e].sort((s,a)=>new Date(s.createdAt).getTime()-new Date(a.createdAt).getTime())),[e.fromTransactionId,e.toTransactionId].filter(Boolean).forEach(async r=>{if(!f[r])try{const s=await j.getTransactionById(o,r);y(a=>({...a,[r]:s.projectId||null}))}catch{y(a=>({...a,[r]:null}))}})})}catch(e){console.debug("ItemLineageBreadcrumb - failed to subscribe to lineage events",e)}return()=>{t=!0,c&&c()}},[o,m]),!u||u.length===0)return null;const d=[];if(u.length>0){const t=u[0];d.push(t.fromTransactionId??null),u.forEach(n=>d.push(n.toTransactionId??null))}const T=d.filter((t,n)=>n===0||t!==d[n-1]);return l.jsx("nav",{"aria-label":"Item lineage",className:b?"text-xs text-gray-600":"text-sm text-gray-700",children:l.jsx("ol",{className:"flex items-center gap-2",children:T.map((t,n)=>{const c=!t,e=c?"Inventory":t.length>12?`${t.slice(0,12)}…`:t,p=t?f[t]:null,r=c?"/business-inventory":p?`/project/${p}/transaction/${t}`:`/project/unknown/transaction/${t}`;return l.jsxs("li",{className:"flex items-center",children:[n>0&&l.jsx("span",{className:"text-gray-300 mx-1",children:"→"}),c?l.jsx("span",{className:"text-gray-500",children:e}):l.jsx(w,{to:r,className:"text-primary-600 hover:underline",children:e})]},`${t??"inventory"}-${n}`)})})})}export{$ as I};
//# sourceMappingURL=ItemLineageBreadcrumb.js.map
