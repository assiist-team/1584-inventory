import{d as w,j as l}from"./index.js";import{r as h}from"./vendor.js";import{C as B}from"./ContextLink.js";import{l as j,t as b}from"./inventoryService.js";import{u as E}from"./useNavigationContext.js";function C({itemId:f,compact:T=!0}){const{currentAccountId:c}=w(),{buildContextUrl:y}=E(),[u,x]=h.useState([]),[p,g]=h.useState({});if(h.useEffect(()=>{if(!c||!f)return;let t=!1;(async()=>{try{const e=await j.getItemLineageHistory(f,c);if(t)return;x(e);const r=Array.from(new Set(e.flatMap(n=>[n.fromTransactionId,n.toTransactionId]).filter(Boolean))).filter(n=>!p[n]);if(r.length>0){const n=await Promise.all(r.map(async i=>{try{const I=await b.getTransactionById(c,i);return{txId:i,projectId:I.projectId||null}}catch{return{txId:i,projectId:null}}})),a={...p};n.forEach(i=>{a[i.txId]=i.projectId}),t||g(a)}}catch(e){console.debug("ItemLineageBreadcrumb - failed to load history",e)}})();let o=null;try{o=j.subscribeToItemLineageForItem(c,f,e=>{x(r=>r.find(n=>n.id===e.id)?r:[...r,e].sort((n,a)=>new Date(n.createdAt).getTime()-new Date(a.createdAt).getTime())),[e.fromTransactionId,e.toTransactionId].filter(Boolean).forEach(async r=>{if(!p[r])try{const n=await b.getTransactionById(c,r);g(a=>({...a,[r]:n.projectId||null}))}catch{g(a=>({...a,[r]:null}))}})})}catch(e){console.debug("ItemLineageBreadcrumb - failed to subscribe to lineage events",e)}return()=>{t=!0,o&&o()}},[c,f]),!u||u.length===0)return null;const d=[];if(u.length>0){const t=u[0];d.push(t.fromTransactionId??null),u.forEach(s=>d.push(s.toTransactionId??null))}const v=d.filter((t,s)=>s===0||t!==d[s-1]);return l.jsx("nav",{"aria-label":"Item lineage",className:T?"text-xs text-gray-600":"text-sm text-gray-700",children:l.jsx("ol",{className:"flex items-center gap-2",children:v.map((t,s)=>{const o=!t,e=o?"Inventory":t.length>12?`${t.slice(0,12)}…`:t,m=t?p[t]:null,r=o?y("/business-inventory"):m?y(`/project/${m}/transaction/${t}`,{project:m}):y(`/project/unknown/transaction/${t}`);return l.jsxs("li",{className:"flex items-center",children:[s>0&&l.jsx("span",{className:"text-gray-300 mx-1",children:"→"}),o?l.jsx("span",{className:"text-gray-500",children:e}):l.jsx(B,{to:r,className:"text-primary-600 hover:underline",children:e})]},`${t??"inventory"}-${s}`)})})})}export{C as I};
//# sourceMappingURL=ItemLineageBreadcrumb.js.map
