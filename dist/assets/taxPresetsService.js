import{s as o,x as u,v as d}from"./index.js";const s=[{id:"nv",name:"NV",rate:8.375},{id:"ut",name:"UT",rate:7.1},{id:"ca",name:"CA",rate:7.25},{id:"tx",name:"TX",rate:6.25},{id:"az",name:"AZ",rate:8.6}];async function c(a){if(!a)return null;try{const{data:e,error:t}=await o.from("account_presets").select("*").eq("account_id",a).single();if(t){if(t.code==="PGRST116")return null;throw t}const r=u(e);return{defaultCategoryId:r.default_category_id||null,presets:r.presets||{}}}catch(e){return console.error("Error fetching account presets:",e),null}}async function n(a,e){await d();const t={account_id:a,updated_at:new Date().toISOString()};e.defaultCategoryId!==void 0&&(t.default_category_id=e.defaultCategoryId),e.presets!==void 0&&(t.presets=e.presets);const{error:r}=await o.from("account_presets").upsert(t,{onConflict:"account_id"});if(r)throw r}async function y(a){const e=await c(a);return(e==null?void 0:e.defaultCategoryId)??null}async function p(a,e){await n(a,{defaultCategoryId:e})}async function f(a){var e;try{const t=await c(a),r=(e=t==null?void 0:t.presets)==null?void 0:e.tax_presets;if(Array.isArray(r)&&r.length>0)return r;try{await n(a,{presets:{tax_presets:s}})}catch(i){console.warn("Failed to initialize tax_presets in account_presets:",i)}return s}catch(t){return console.error("Error fetching tax presets from Postgres:",t),s}}async function g(a,e){try{if(!Array.isArray(e)||e.length===0)throw new Error("Presets must be a non-empty array");if(e.length>5)throw new Error("Cannot have more than 5 tax presets");for(const r of e){if(!r.id||!r.name||typeof r.rate!="number")throw new Error("Each preset must have id, name, and rate fields");if(r.rate<0||r.rate>100)throw new Error("Tax rate must be between 0 and 100")}const t=e.map(r=>r.id);if(new Set(t).size!==t.length)throw new Error("Preset IDs must be unique");await n(a,{presets:{tax_presets:e}}),console.log("Tax presets updated successfully (account_presets)")}catch(t){throw console.error("Error updating tax presets:",t),t}}async function w(a,e){return(await f(a)).find(r=>r.id===e)||null}export{f as a,c as b,n as c,w as d,y as g,p as s,g as u};
//# sourceMappingURL=taxPresetsService.js.map
