{"version":3,"file":"BusinessInventory.js","sources":["../../src/pages/BusinessInventory.tsx"],"sourcesContent":["import { Plus, Search, Package, Receipt, Filter, QrCode, Trash2, Camera, Edit, Bookmark, Copy, DollarSign, ChevronDown } from 'lucide-react'\nimport { useMemo } from 'react'\nimport { useState, useEffect } from 'react'\nimport { Link } from 'react-router-dom'\nimport ContextLink from '@/components/ContextLink'\nimport { Item, Transaction, ItemImage, Project } from '@/types'\nimport type { Transaction as TransactionType } from '@/types'\nimport { unifiedItemsService, transactionService, projectService, integrationService } from '@/services/inventoryService'\nimport { normalizeDisposition, dispositionsEqual, displayDispositionLabel } from '@/utils/dispositionUtils'\nimport { useToast } from '@/components/ui/ToastContext'\nimport { lineageService } from '@/services/lineageService'\nimport { ImageUploadService } from '@/services/imageService'\nimport { formatCurrency, formatDate } from '@/utils/dateUtils'\nimport { COMPANY_INVENTORY, COMPANY_INVENTORY_SALE, COMPANY_INVENTORY_PURCHASE } from '@/constants/company'\nimport { useBookmark } from '@/hooks/useBookmark'\nimport { useDuplication } from '@/hooks/useDuplication'\nimport { useAccount } from '@/contexts/AccountContext'\nimport { useNavigationContext } from '@/hooks/useNavigationContext'\n\ninterface FilterOptions {\n  status?: string\n  searchQuery?: string\n}\n\nexport default function BusinessInventory() {\n  const { currentAccountId, loading: accountLoading } = useAccount()\n  const ENABLE_QR = import.meta.env.VITE_ENABLE_QR === 'true'\n  const { buildContextUrl } = useNavigationContext()\n  const [activeTab, setActiveTab] = useState<'inventory' | 'transactions'>('inventory')\n  const [items, setItems] = useState<Item[]>([])\n  const [transactions, setTransactions] = useState<Transaction[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [filters] = useState<FilterOptions>({\n    status: '',\n    searchQuery: ''\n  })\n  const [inventorySearchQuery, setInventorySearchQuery] = useState<string>('')\n  const [transactionSearchQuery, setTransactionSearchQuery] = useState<string>('')\n\n  // Filter state for transactions tab\n  const [showTransactionFilterMenu, setShowTransactionFilterMenu] = useState(false)\n  const [transactionFilterMode, setTransactionFilterMode] = useState<'all' | 'pending' | 'completed' | 'canceled' | 'inventory-only'>('all')\n\n  // Image upload state\n  const [uploadingImages, setUploadingImages] = useState<Set<string>>(new Set())\n\n  // Filter and selection state for inventory items (matching InventoryList.tsx)\n  const [filterMode, setFilterMode] = useState<'all' | 'bookmarked'>('all')\n  const [showFilterMenu, setShowFilterMenu] = useState(false)\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set())\n  const [openDispositionMenu, setOpenDispositionMenu] = useState<string | null>(null)\n  const { showSuccess, showError } = useToast()\n\n  // Batch allocation state\n  const [projects, setProjects] = useState<Project[]>([])\n  const [showBatchAllocationModal, setShowBatchAllocationModal] = useState(false)\n  const [showProjectDropdown, setShowProjectDropdown] = useState(false)\n  const [batchAllocationForm, setBatchAllocationForm] = useState({\n    projectId: '',\n    space: ''\n  })\n  const [isAllocating, setIsAllocating] = useState(false)\n\n  // Close filter menus when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if ((showFilterMenu || showTransactionFilterMenu) && !event.target) return\n\n      const target = event.target as Element\n      if (!target.closest('.filter-menu') && !target.closest('.filter-button') && !target.closest('.transaction-filter-menu') && !target.closest('.transaction-filter-button')) {\n        setShowFilterMenu(false)\n        setShowTransactionFilterMenu(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [showFilterMenu, showTransactionFilterMenu])\n\n  // Close disposition menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (openDispositionMenu && !event.target) return\n\n      const target = event.target as Element\n      if (!target.closest('.disposition-menu') && !target.closest('.disposition-badge')) {\n        setOpenDispositionMenu(null)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [openDispositionMenu])\n\n  const toggleDispositionMenu = (itemId: string) => {\n    setOpenDispositionMenu(openDispositionMenu === itemId ? null : itemId)\n  }\n\n  const getDispositionBadgeClasses = (disposition?: string) => {\n    const baseClasses = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium cursor-pointer transition-colors hover:opacity-80'\n    const d = normalizeDisposition(disposition)\n\n    switch (d) {\n      case 'keep':\n        return `${baseClasses} bg-green-100 text-green-800`\n      case 'to return':\n        return `${baseClasses} bg-red-100 text-red-700`\n      case 'returned':\n        return `${baseClasses} bg-red-800 text-red-100`\n      case 'inventory':\n        return `${baseClasses} bg-primary-100 text-primary-600`\n      default:\n        return `${baseClasses} bg-gray-100 text-gray-800`\n    }\n  }\n\n  const updateDisposition = async (itemId: string, newDisposition: string) => {\n    try {\n      const item = items.find((it: Item) => it.itemId === itemId)\n      if (!item) {\n        console.error('Item not found for disposition update:', itemId)\n        return\n      }\n\n      if (!currentAccountId) throw new Error('Account ID is required')\n      await unifiedItemsService.updateItem(currentAccountId, itemId, { disposition: newDisposition })\n\n      if (newDisposition === 'inventory') {\n        try {\n          await integrationService.handleItemDeallocation(currentAccountId, itemId, item.projectId || '', newDisposition)\n          setOpenDispositionMenu(null)\n          showSuccess && showSuccess('Item moved to inventory')\n        } catch (deallocationError) {\n          console.error('Failed to handle deallocation:', deallocationError)\n          await unifiedItemsService.updateItem(currentAccountId, itemId, { disposition: item.disposition })\n          showError && showError('Failed to move item to inventory. Please try again.')\n          return\n        }\n      } else {\n        setItems(prev => prev.map(i => i.itemId === itemId ? { ...i, disposition: newDisposition } : i))\n        setOpenDispositionMenu(null)\n      }\n    } catch (error) {\n      console.error('Failed to update disposition:', error)\n      showError && showError('Failed to update disposition. Please try again.')\n    }\n  }\n\n  // Compute filtered items (matching InventoryList.tsx)\n  const filteredItems = useMemo(() => {\n    return items.filter(item => {\n      // Apply search filter\n      const matchesSearch = !inventorySearchQuery ||\n        item.description?.toLowerCase().includes(inventorySearchQuery.toLowerCase()) ||\n        item.sku?.toLowerCase().includes(inventorySearchQuery.toLowerCase()) ||\n        item.businessInventoryLocation?.toLowerCase().includes(inventorySearchQuery.toLowerCase())\n\n      // Apply status filter\n      const matchesStatus = !filters.status || item.inventoryStatus === filters.status\n\n      // Apply bookmark filter\n      const matchesFilter = filterMode === 'all' || (filterMode === 'bookmarked' && item.bookmark)\n\n      return matchesSearch && matchesStatus && matchesFilter\n    })\n  }, [items, inventorySearchQuery, filters.status, filterMode])\n\n  // Compute filtered transactions\n  const filteredTransactions = useMemo(() => {\n    let filtered = transactions\n\n    // Apply status filter based on filter mode\n    if (transactionFilterMode !== 'all') {\n      if (transactionFilterMode === 'inventory-only') {\n        // Show only business inventory transactions (projectId == null)\n        filtered = filtered.filter(t => t.projectId === null)\n      } else {\n        // Apply status filter for other modes\n        filtered = filtered.filter(t => t.status === transactionFilterMode)\n      }\n    }\n\n    // Apply search filter\n    if (transactionSearchQuery) {\n      const query = transactionSearchQuery.toLowerCase()\n      filtered = filtered.filter(t =>\n        t.source?.toLowerCase().includes(query) ||\n        t.transactionType?.toLowerCase().includes(query) ||\n        t.projectName?.toLowerCase().includes(query) ||\n        t.notes?.toLowerCase().includes(query)\n      )\n    }\n\n    return filtered\n  }, [transactions, transactionFilterMode, transactionSearchQuery])\n\n  // Canonical transaction title for display only\n  const getCanonicalTransactionTitle = (transaction: TransactionType): string => {\n    if (transaction.transactionId?.startsWith('INV_SALE_')) return COMPANY_INVENTORY_SALE\n    if (transaction.transactionId?.startsWith('INV_PURCHASE_')) return COMPANY_INVENTORY_PURCHASE\n    return transaction.source\n  }\n\n  const tabs = [\n    { id: 'inventory' as const, name: 'Items', icon: Package },\n    { id: 'transactions' as const, name: 'Transactions', icon: Receipt }\n  ]\n\n  // Unified useEffect for data loading and real-time subscriptions\n  useEffect(() => {\n    let itemsUnsubscribe: (() => void) | null = null\n    let transactionsUnsubscribe: (() => void) | null = null\n\n    const loadInitialData = async () => {\n    if (!currentAccountId) {\n      setIsLoading(false)\n      return\n    }\n\n        setIsLoading(true)\n      try {\n        const [inventoryData, businessInventoryTransactions, inventoryRelatedTransactions, projectsData] = await Promise.all([\n          unifiedItemsService.getBusinessInventoryItems(currentAccountId, filters),\n          transactionService.getBusinessInventoryTransactions(currentAccountId),\n          transactionService.getInventoryRelatedTransactions(currentAccountId),\n          projectService.getProjects(currentAccountId)\n        ])\n\n        const allTransactions = [...businessInventoryTransactions, ...inventoryRelatedTransactions]\n        const uniqueTransactions = allTransactions.filter((transaction, index, self) =>\n          index === self.findIndex(t => t.transactionId === transaction.transactionId)\n        )\n        uniqueTransactions.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n\n        setItems(inventoryData)\n        setTransactions(uniqueTransactions)\n        setProjects(projectsData)\n\n        // Setup subscriptions after initial data load\n        itemsUnsubscribe = unifiedItemsService.subscribeToBusinessInventory(\n          currentAccountId,\n          (updatedItems) => setItems(updatedItems),\n          filters,\n          inventoryData\n        )\n        \n        // We need a new subscription service for transactions\n        transactionsUnsubscribe = transactionService.subscribeToAllTransactions(\n          currentAccountId,\n          (updatedTransactions) => {\n            const allTrans = [...updatedTransactions];\n            const uniqueTrans = allTrans.filter((transaction, index, self) =>\n              index === self.findIndex(t => t.transactionId === transaction.transactionId)\n            );\n            uniqueTrans.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n            setTransactions(uniqueTrans);\n          },\n          uniqueTransactions\n        )\n\n      } catch (error) {\n        console.error('Error loading business inventory data:', error)\n          setItems([])\n          setTransactions([])\n          setProjects([])\n      } finally {\n          setIsLoading(false)\n        }\n    }\n\n    loadInitialData()\n\n    return () => {\n      if (itemsUnsubscribe) itemsUnsubscribe()\n      if (transactionsUnsubscribe) transactionsUnsubscribe()\n    }\n  }, [currentAccountId, filters])\n\n  // Per-visible-item lineage subscriptions: refetch single item on new edges to keep list in sync\n  useEffect(() => {\n    if (!currentAccountId || items.length === 0) return\n\n    const unsubMap = new Map<string, () => void>()\n    try {\n      items.forEach(item => {\n        if (!item?.itemId) return\n        const unsub = lineageService.subscribeToItemLineageForItem(currentAccountId, item.itemId, async () => {\n          try {\n            const updatedItem = await unifiedItemsService.getItemById(currentAccountId, item.itemId)\n            if (updatedItem) {\n              // If it is still a business inventory item, update it; otherwise remove it from the list\n              if (!updatedItem.projectId) {\n                setItems(prev => prev.map(i => i.itemId === updatedItem.itemId ? updatedItem : i))\n              } else {\n                setItems(prev => prev.filter(i => i.itemId !== updatedItem.itemId))\n              }\n              // Also refresh transactions to ensure deletions/creations are reflected\n              try {\n                await loadBusinessTransactions()\n              } catch (tErr) {\n                console.debug('BusinessInventory - failed to reload transactions after lineage event', tErr)\n              }\n            }\n          } catch (err) {\n            console.debug('BusinessInventory - failed to refetch item on lineage event', err)\n          }\n        })\n        unsubMap.set(item.itemId, unsub)\n      })\n    } catch (err) {\n      console.debug('BusinessInventory - failed to setup per-item lineage subscriptions', err)\n    }\n\n    return () => {\n      unsubMap.forEach(u => {\n        try { u() } catch (e) { /* noop */ }\n      })\n    }\n  }, [items.map(i => i.itemId).join(','), currentAccountId])\n\n  // Reset uploading state on unmount to prevent hanging state\n  useEffect(() => {\n    return () => {\n      setUploadingImages(new Set())\n    }\n  }, [])\n\n  const loadBusinessInventory = async () => {\n    if (!currentAccountId) return\n    try {\n      const data = await unifiedItemsService.getBusinessInventoryItems(currentAccountId, filters)\n      setItems(data)\n    } catch (error) {\n      console.error('Error loading business inventory:', error)\n      setItems([])\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n\n  const loadBusinessTransactions = async () => {\n    if (!currentAccountId) return\n    try {\n      // Get inventory-related transactions from top-level collection\n      const allTransactions: Transaction[] = []\n\n      // Get business inventory transactions (project_id == null)\n      const businessInventoryTransactions = await transactionService.getBusinessInventoryTransactions(currentAccountId)\n      allTransactions.push(...businessInventoryTransactions)\n\n      // Get inventory-related transactions (reimbursement_type in ['Client Owes', 'We Owe'])\n      const inventoryRelatedTransactions = await transactionService.getInventoryRelatedTransactions(currentAccountId)\n      allTransactions.push(...inventoryRelatedTransactions)\n\n      // Remove duplicates (same transaction might appear in both queries)\n      const uniqueTransactions = allTransactions.filter((transaction, index, self) =>\n        index === self.findIndex(t => t.transactionId === transaction.transactionId)\n      )\n\n      // Sort by creation date, newest first\n      uniqueTransactions.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n      setTransactions(uniqueTransactions)\n    } catch (error) {\n      console.error('Error loading business transactions:', error)\n      setTransactions([])\n    }\n  }\n\n  const loadProjects = async () => {\n    if (!currentAccountId) return\n    try {\n      const projectsData = await projectService.getProjects(currentAccountId)\n      setProjects(projectsData)\n    } catch (error) {\n      console.error('Error loading projects:', error)\n    }\n  }\n\n  const handleInventorySearchChange = (searchQuery: string) => {\n    setInventorySearchQuery(searchQuery)\n  }\n\n  // Use centralized bookmark hook\n  const { toggleBookmark } = useBookmark<Item>({\n    items,\n    setItems,\n    updateItemService: (itemId: string, updates: Partial<Item>) => {\n      if (!currentAccountId) throw new Error('Account ID is required')\n      return unifiedItemsService.updateItem(currentAccountId, itemId, updates)\n    }\n  })\n\n  // Use duplication hook for business inventory items\n  const { duplicateItem } = useDuplication({\n    items,\n    setItems,\n    duplicationService: async (itemId: string) => {\n      if (!currentAccountId) throw new Error('Account ID is required')\n      // Since we're using the unified service, we need to create a duplicate item\n      const originalItem = await unifiedItemsService.getItemById(currentAccountId, itemId)\n      if (!originalItem) throw new Error('Item not found')\n\n      // Create a new item with similar data but new ID\n      // Rename destructured `itemId` to `originalItemId` to avoid redeclaring the `itemId` parameter\n      const { itemId: originalItemId, dateCreated, lastUpdated, ...itemData } = originalItem\n      return await unifiedItemsService.createItem(currentAccountId, {\n        ...itemData,\n        inventoryStatus: 'available',\n        projectId: null,\n        disposition: itemData.disposition || 'keep' // Preserve existing disposition or default to 'keep'\n      })\n    }\n  })\n\n  // Batch allocation functions\n  const openBatchAllocationModal = () => {\n    setShowBatchAllocationModal(true)\n  }\n\n  const closeBatchAllocationModal = () => {\n    setShowBatchAllocationModal(false)\n    setShowProjectDropdown(false)\n    setBatchAllocationForm({\n      projectId: '',\n      space: ''\n    })\n  }\n\n  const getSelectedProjectName = () => {\n    const selectedProject = projects.find(p => p.id === batchAllocationForm.projectId)\n    return selectedProject ? `${selectedProject.name} - ${selectedProject.clientName}` : 'Select a project...'\n  }\n\n  const handleBatchAllocationSubmit = async () => {\n    if (!batchAllocationForm.projectId || selectedItems.size === 0 || !currentAccountId) return\n\n    setIsAllocating(true)\n    try {\n      const itemIds = Array.from(selectedItems)\n      await unifiedItemsService.batchAllocateItemsToProject(\n        currentAccountId,\n        itemIds,\n        batchAllocationForm.projectId,\n        {\n          space: batchAllocationForm.space\n        }\n      )\n\n      // Clear selections and close modal\n      setSelectedItems(new Set())\n      closeBatchAllocationModal()\n\n      // Show success message\n      alert(`Successfully allocated ${itemIds.length} items to project!`)\n\n      // Items will be updated via real-time subscription\n    } catch (error) {\n      console.error('Error batch allocating items:', error)\n      alert('Error allocating items. Please try again.')\n    } finally {\n      setIsAllocating(false)\n    }\n  }\n\n  const handleDeleteSelectedItems = async () => {\n    if (selectedItems.size === 0 || !currentAccountId) return\n\n    const itemCount = selectedItems.size\n    const confirmMessage = itemCount === 1\n      ? 'Are you sure you want to delete this item? This action cannot be undone.'\n      : `Are you sure you want to delete ${itemCount} items? This action cannot be undone.`\n\n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const itemIds = Array.from(selectedItems)\n    \n    // Optimistically update UI immediately by removing deleted items from state\n    setItems(prevItems => prevItems.filter(item => !itemIds.includes(item.itemId)))\n    \n    // Clear selections immediately\n    setSelectedItems(new Set())\n\n    try {\n      let successCount = 0\n      let errorCount = 0\n\n      // Delete items one by one\n      for (const itemId of itemIds) {\n        try {\n          await unifiedItemsService.deleteItem(currentAccountId, itemId)\n          successCount++\n        } catch (error) {\n          console.error(`Error deleting item ${itemId}:`, error)\n          errorCount++\n        }\n      }\n\n      // Show result message\n      if (errorCount === 0) {\n        alert(`Successfully deleted ${successCount} item${successCount !== 1 ? 's' : ''}.`)\n      } else {\n        // If there were errors, reload the items to restore the failed deletions\n        await loadBusinessInventory()\n        alert(`Deleted ${successCount} item${successCount !== 1 ? 's' : ''}, but ${errorCount} item${errorCount !== 1 ? 's' : ''} failed to delete.`)\n      }\n\n      // Real-time subscription will keep the UI in sync\n    } catch (error) {\n      console.error('Error deleting items:', error)\n      // Reload items on error to restore state\n      await loadBusinessInventory()\n      alert('Error deleting items. Please try again.')\n    }\n  }\n\n  // Image handling functions\n  const handleAddImage = async (itemId: string) => {\n    try {\n      setUploadingImages(prev => new Set(prev).add(itemId))\n\n      const files = await ImageUploadService.selectFromGallery()\n\n      if (files.length > 0) {\n        // Process all selected files sequentially\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i]\n          await processImageUpload(itemId, file, files)\n        }\n      }\n    } catch (error: any) {\n      console.error('Error adding image:', error)\n\n      // Handle cancel/timeout gracefully - don't show error for user cancellation\n      if (error.message?.includes('timeout') || error.message?.includes('canceled')) {\n        console.log('User canceled image selection or selection timed out')\n        return\n      }\n\n      // Show error for actual failures\n      alert('Failed to add image. Please try again.')\n    } finally {\n      setUploadingImages(prev => {\n        const newSet = new Set(prev)\n        newSet.delete(itemId)\n        return newSet\n      })\n    }\n  }\n\n  const processImageUpload = async (itemId: string, file: File, allFiles?: File[]) => {\n    const uploadResult = await ImageUploadService.uploadItemImage(\n      file,\n      'Business Inventory',\n      itemId\n    )\n\n    const newImage: ItemImage = {\n      url: uploadResult.url,\n      alt: file.name,\n      isPrimary: true, // First image is always primary when added from list\n      uploadedAt: new Date(),\n      fileName: file.name,\n      size: file.size,\n      mimeType: file.type\n    }\n\n    // Update the item with the new image\n    if (!currentAccountId) throw new Error('Account ID is required')\n    await unifiedItemsService.updateItem(currentAccountId, itemId, { images: [newImage] })\n\n    // Show success notification on the last file\n    if (allFiles && allFiles.indexOf(file) === allFiles.length - 1) {\n      const message = allFiles.length > 1 ? `${allFiles.length} images uploaded successfully!` : 'Image uploaded successfully!'\n      alert(message)\n    }\n  }\n\n\n  // Filter handlers (matching InventoryList.tsx)\n  const handleSelectAll = (checked: boolean) => {\n    if (checked) {\n      setSelectedItems(new Set(filteredItems.map(item => item.itemId)))\n    } else {\n      setSelectedItems(new Set())\n    }\n  }\n\n  const handleSelectItem = (itemId: string, checked: boolean) => {\n    const newSelected = new Set(selectedItems)\n    if (checked) {\n      newSelected.add(itemId)\n    } else {\n      newSelected.delete(itemId)\n    }\n    setSelectedItems(newSelected)\n  }\n\n  // Guard against no account when not loading\n  if (!isLoading && !accountLoading && !currentAccountId) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Business Inventory</h1>\n        </div>\n        <div className=\"bg-white shadow rounded-lg border border-yellow-200 bg-yellow-50\">\n          <div className=\"px-4 py-5 sm:p-6\">\n            <div className=\"text-center py-12\">\n              <Package className=\"mx-auto h-12 w-12 text-yellow-600\" />\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">\n                No Account Selected\n              </h3>\n              <p className=\"mt-1 text-sm text-gray-600\">\n                Please select or create an account to manage inventory.\n              </p>\n              <div className=\"mt-6\">\n                <Link\n                  to=\"/settings\"\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                >\n                  Go to Settings\n                </Link>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-32\">\n        <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900\">{COMPANY_INVENTORY}</h1>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"bg-white shadow rounded-lg\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"-mb-px flex space-x-8 px-6\">\n            {tabs.map((tab) => {\n              const Icon = tab.icon\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  className={`py-4 px-1 border-b-2 font-medium text-base flex items-center ${\n                    activeTab === tab.id\n                      ? 'border-primary-500 text-primary-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  <Icon className=\"h-4 w-4 mr-2\" />\n                  {tab.name}\n                </button>\n              )\n            })}\n          </nav>\n        </div>\n\n\n        {/* Tab Content */}\n        <div className=\"px-6 py-6\">\n          {activeTab === 'inventory' && (\n            <>\n              {/* Header - Just Add Item button */}\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-2\">\n                <ContextLink\n                  to={buildContextUrl('/business-inventory/add')}\n                  className=\"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Item\n                </ContextLink>\n              </div>\n\n              {/* Search and Controls - Sticky Container */}\n              <div className=\"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2\">\n                <div className=\"space-y-0\">\n                  {/* Search Bar */}\n                  <div className=\"relative pt-2\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <Search className=\"h-5 w-5 text-gray-400\" />\n                    </div>\n                    <input\n                      type=\"text\"\n                      className=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base\"\n                      placeholder=\"Search items by description, SKU, or location...\"\n                      value={inventorySearchQuery || ''}\n                      onChange={(e) => handleInventorySearchChange(e.target.value)}\n                    />\n                  </div>\n\n          {/* Select All and Bulk Actions */}\n          <div className=\"flex items-center justify-between gap-4 p-3 rounded-lg\">\n            {/* Select All */}\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                className=\"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4\"\n                onChange={(e) => handleSelectAll(e.target.checked)}\n                checked={selectedItems.size === filteredItems.length && filteredItems.length > 0}\n              />\n              <span className=\"ml-3 text-sm font-medium text-gray-700\">Select all</span>\n            </label>\n\n            {/* Right section - counter and buttons */}\n            <div className=\"flex items-center gap-3\">\n\n              {/* Bulk action buttons */}\n              <div className=\"flex items-center space-x-2\">\n                {/* Filter Button */}\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setShowFilterMenu(!showFilterMenu)}\n                    className=\"filter-button inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200\"\n                    title=\"Filter items\"\n                  >\n                    <Filter className=\"h-4 w-4\" />\n                  </button>\n\n                  {/* Filter Dropdown Menu */}\n                  {showFilterMenu && (\n                    <div className=\"filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                      <div className=\"py-1\">\n                        <button\n                          onClick={() => {\n                            setFilterMode('all')\n                            setShowFilterMenu(false)\n                          }}\n                          className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                            filterMode === 'all' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                          }`}\n                        >\n                          All Items\n                        </button>\n                        <button\n                          onClick={() => {\n                            setFilterMode('bookmarked')\n                            setShowFilterMenu(false)\n                          }}\n                          className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                            filterMode === 'bookmarked' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                          }`}\n                        >\n                          Bookmarked Only\n                        </button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Allocate to Project Button */}\n                <button\n                  onClick={openBatchAllocationModal}\n                  className=\"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200\"\n                  disabled={selectedItems.size === 0}\n                  title=\"Allocate selected items to project\"\n                >\n                  <DollarSign className=\"h-4 w-4\" />\n                </button>\n\n                {ENABLE_QR && (\n                  <button\n                    className=\"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 transition-colors duration-200\"\n                    disabled={selectedItems.size === 0}\n                    title=\"Generate QR Codes\"\n                  >\n                    <QrCode className=\"h-4 w-4\" />\n                  </button>\n                )}\n\n                <button\n                  onClick={handleDeleteSelectedItems}\n                  className=\"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200\"\n                  disabled={selectedItems.size === 0}\n                  title=\"Delete Selected Items\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n              {/* Items List */}\n              {filteredItems.length === 0 ? (\n                <div className=\"text-center py-12 px-4\">\n                  <div className=\"mx-auto h-16 w-16 text-gray-400 -mb-1\">ðŸ“¦</div>\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n                    No items found\n                  </h3>\n                  <p className=\"text-sm text-gray-500 mb-4\">\n                    {inventorySearchQuery || filters.status || filterMode === 'bookmarked'\n                      ? 'Try adjusting your search or filter criteria.'\n                      : 'No items found.'\n                    }\n                  </p>\n                </div>\n              ) : (\n                <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n                  <ul className=\"divide-y divide-gray-200\">\n                    {filteredItems.map((item) => (\n                      <li key={item.itemId} className=\"relative bg-gray-50 transition-colors duration-200 hover:bg-gray-100\">\n                        {/* Top row: Controls - stays outside Link */}\n                        <div className=\"flex items-center justify-between mb-0 px-4 py-3\">\n                          <div className=\"flex items-center\">\n                            <input\n                              type=\"checkbox\"\n                              className=\"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4 flex-shrink-0\"\n                              checked={selectedItems.has(item.itemId)}\n                              onChange={(e) => handleSelectItem(item.itemId, e.target.checked)}\n                            />\n                          </div>\n\n                          {/* Action buttons */}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className={`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md transition-colors ${\n                                item.bookmark\n                                  ? 'border-red-300 text-red-700 bg-red-50 hover:bg-red-100'\n                                  : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                              } focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`}\n                              title={item.bookmark ? 'Remove Bookmark' : 'Add Bookmark'}\n                              onClick={(e) => {\n                                e.preventDefault()\n                                e.stopPropagation()\n                                toggleBookmark(item.itemId)\n                              }}\n                            >\n                              <Bookmark className=\"h-4 w-4\" fill={item.bookmark ? 'currentColor' : 'none'} />\n                            </button>\n                            <ContextLink\n                              to={buildContextUrl(`/business-inventory/${item.itemId}/edit`)}\n                              onClick={(e) => e.stopPropagation()}\n                              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors\"\n                              title=\"Edit item\"\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </ContextLink>\n                            <button\n                              onClick={(e) => {\n                                e.preventDefault()\n                                e.stopPropagation()\n                                duplicateItem(item.itemId)\n                              }}\n                              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors\"\n                              title=\"Duplicate item\"\n                            >\n                              <Copy className=\"h-4 w-4\" />\n                            </button>\n                            {/* Disposition badge (replaces inventory status badge) */}\n                            <div className=\"relative ml-1\">\n                              <span\n                                onClick={(e) => {\n                                  e.preventDefault()\n                                  e.stopPropagation()\n                                  toggleDispositionMenu(item.itemId)\n                                }}\n                                className={`disposition-badge ${getDispositionBadgeClasses(item.disposition)}`}\n                              >\n                                {displayDispositionLabel(item.disposition) || 'Not Set'}\n                                <ChevronDown className=\"h-3 w-3 ml-1\" />\n                              </span>\n\n                              {/* Dropdown menu */}\n                              {openDispositionMenu === item.itemId && (\n                                <div className=\"disposition-menu absolute top-full left-0 mt-1 w-32 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                                  <div className=\"py-1\">\n                                    {['keep', 'to return', 'returned', 'inventory'].map((disposition) => (\n                                      <button\n                                        key={disposition}\n                                        onClick={(e) => {\n                                          e.preventDefault()\n                                          e.stopPropagation()\n                                          updateDisposition(item.itemId, disposition)\n                                        }}\n                                        className={`block w-full text-left px-3 py-2 text-xs hover:bg-gray-50 ${\n                                          dispositionsEqual(item.disposition, disposition) ? 'bg-gray-100 text-gray-900' : 'text-gray-700'\n                                        }`}\n                                        disabled={!item.disposition}\n                                      >\n                                        {disposition === 'to return' ? 'To Return' : disposition.charAt(0).toUpperCase() + disposition.slice(1)}\n                                      </button>\n                                    ))}\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Main tappable content - wrapped in Link */}\n                        <ContextLink to={buildContextUrl(`/business-inventory/${item.itemId}`)}>\n                          <div className=\"block bg-transparent\">\n                            <div className=\"px-4 pb-3 sm:px-6\">\n                              {/* Middle row: Thumbnail and Description - now tappable */}\n                              <div className=\"flex items-center gap-3 py-3\">\n                                <div className=\"flex-shrink-0\">\n                                  {item.images && item.images.length > 0 ? (\n                                    // Show primary image thumbnail or first image if no primary\n                                    (() => {\n                                      const primaryImage = item.images.find(img => img.isPrimary) || item.images[0]\n                                      return (\n                                        <div className=\"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200\">\n                                          <img\n                                            src={primaryImage.url}\n                                            alt={primaryImage.alt || 'Item image'}\n                                            className=\"w-full h-full object-cover\"\n                                          />\n                                        </div>\n                                      )\n                                    })()\n                                  ) : (\n                                    // Show camera placeholder when no images\n                                    <button\n                                      onClick={(e) => {\n                                        e.preventDefault()\n                                        e.stopPropagation()\n                                        handleAddImage(item.itemId)\n                                      }}\n                                      disabled={uploadingImages.has(item.itemId)}\n                                      className=\"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors disabled:opacity-50\"\n                                      title=\"Add image (camera or gallery)\"\n                                    >\n                                      <Camera className=\"h-6 w-6\" />\n                                    </button>\n                                  )}\n                                </div>\n\n                                {/* Item description - now tappable */}\n                                <div className=\"flex-1 min-w-0 flex items-center\">\n                                  <div>\n                                    <h3 className=\"text-base font-medium text-gray-900 line-clamp-2 break-words\">\n                                      {item.description}\n                                    </h3>\n                                    {/* Storage Location field */}\n                                    {item.businessInventoryLocation && (\n                                      <p className=\"text-sm text-gray-600 mt-1\">\n                                        {item.businessInventoryLocation}\n                                      </p>\n                                    )}\n                                  </div>\n                                </div>\n                              </div>\n\n                              {/* Bottom row: Content - now tappable */}\n                              <div className=\"space-y-2\">\n                                {/* Project Price (or Purchase Price if project price not set), Source, SKU on same row */}\n                                <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500\">\n                                  {(item.projectPrice || item.purchasePrice) && (\n                                    <span className=\"font-medium text-gray-700\">${item.projectPrice || item.purchasePrice}</span>\n                                  )}\n                                  {item.source && (\n                                    <>\n                                      {(item.projectPrice || item.purchasePrice) && <span className=\"hidden sm:inline\">â€¢</span>}\n                                      <span className=\"font-medium text-gray-700\">{item.source}</span>\n                                    </>\n                                  )}\n                                  {item.sku && (\n                                    <>\n                                      {(item.projectPrice || item.purchasePrice || item.source) && <span className=\"hidden sm:inline\">â€¢</span>}\n                                      <span className=\"font-medium text-gray-700\">{item.sku}</span>\n                                    </>\n                                  )}\n                                </div>\n\n                                {/* Notes */}\n                                {item.notes && (\n                                  <p className=\"text-sm text-gray-600 line-clamp-2\">\n                                    {item.notes}\n                                  </p>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </ContextLink>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </>\n          )}\n\n          {activeTab === 'transactions' && (\n            <>\n              {/* Header - Add Transaction button */}\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2\">\n                <ContextLink\n                  to={buildContextUrl('/business-inventory/transaction/add')}\n                  className=\"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Transaction\n                </ContextLink>\n              </div>\n\n              {/* Search and Controls - Sticky Container */}\n              <div className=\"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2\">\n                <div className=\"space-y-0\">\n                  {/* Search Bar */}\n                  <div className=\"relative pt-2\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <Search className=\"h-5 w-5 text-gray-400\" />\n                    </div>\n                    <input\n                      type=\"text\"\n                      className=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base\"\n                      placeholder=\"Search transactions by source, type, project, or notes...\"\n                      value={transactionSearchQuery || ''}\n                      onChange={(e) => setTransactionSearchQuery(e.target.value)}\n                    />\n                  </div>\n\n                  {/* Filter Controls */}\n                  <div className=\"flex items-center justify-end gap-4 p-3 rounded-lg\">\n                    {/* Filter Button */}\n                    <div className=\"relative\">\n                      <button\n                        onClick={() => setShowTransactionFilterMenu(!showTransactionFilterMenu)}\n                        className={`transaction-filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${\n                          transactionFilterMode === 'all'\n                            ? 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                            : 'border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100'\n                        }`}\n                        title=\"Filter transactions\"\n                      >\n                        <Filter className=\"h-4 w-4\" />\n                      </button>\n\n                      {/* Transaction Filter Dropdown Menu */}\n                      {showTransactionFilterMenu && (\n                        <div className=\"transaction-filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                          <div className=\"py-1\">\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('all')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'all' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              All Status\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('pending')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'pending' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Pending\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('completed')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'completed' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Completed\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('canceled')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'canceled' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Canceled\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('inventory-only')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'inventory-only' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Inventory Only\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Transactions List */}\n              {filteredTransactions.length === 0 ? (\n                <div className=\"text-center py-12 px-4\">\n                  <div className=\"mx-auto h-16 w-16 text-gray-400 -mb-1\">ðŸ§¾</div>\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n                    No transactions found\n                  </h3>\n                  <p className=\"text-sm text-gray-500 mb-4\">\n                    {transactionSearchQuery || transactionFilterMode !== 'all'\n                      ? 'Try adjusting your search or filter criteria.'\n                      : 'No inventory-related transactions found.'\n                    }\n                  </p>\n                </div>\n              ) : (\n                <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n                  <ul className=\"divide-y divide-gray-200\">\n                    {filteredTransactions.map((transaction) => (\n                      <li key={transaction.transactionId} className=\"relative\">\n                        <ContextLink to={buildContextUrl(`/business-inventory/transaction/${transaction.transactionId}`)}>\n                          <div className=\"block bg-gray-50 transition-colors duration-200 hover:bg-gray-100\">\n                            <div className=\"px-4 py-4 sm:px-6\">\n                            {/* Top row: Header with source and status */}\n                            <div className=\"flex items-center justify-between mb-3\">\n                              <div className=\"flex items-center\">\n                                <h3 className=\"text-base font-medium text-gray-900\">\n                                  {getCanonicalTransactionTitle(transaction)}\n                                </h3>\n                              </div>\n                              <div className=\"flex items-center flex-wrap gap-2\">\n                                <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${\n                                  transaction.status === 'completed'\n                                    ? 'bg-green-100 text-green-800'\n                                    : transaction.status === 'pending'\n                                    ? 'bg-yellow-100 text-yellow-800'\n                                    : 'bg-red-100 text-red-800'\n                                }`}>\n                                  {transaction.status === 'completed' ? 'Completed' :\n                                   transaction.status === 'pending' ? 'Pending' :\n                                   transaction.status === 'canceled' ? 'Canceled' :\n                                   transaction.status}\n                                </span>\n                              </div>\n                            </div>\n\n                            {/* Bottom row: Details */}\n                            <div className=\"space-y-2\">\n                              {/* Details row - Price, project, date */}\n                              <div className=\"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500\">\n                                <span className=\"font-medium text-gray-700\">{formatCurrency(transaction.amount)}</span>\n                                {transaction.projectName && (\n                                  <>\n                                    <span className=\"hidden sm:inline\">â€¢</span>\n                                    <span className=\"font-medium text-gray-700\">\n                                      {transaction.projectName}\n                                    </span>\n                                  </>\n                                )}\n                                <span className=\"hidden sm:inline\">â€¢</span>\n                                <span className=\"font-medium text-gray-700\">\n                                  {formatDate(transaction.transactionDate)}\n                                </span>\n                              </div>\n\n                              {/* Notes */}\n                              {transaction.notes && (\n                                <p className=\"text-sm text-gray-600 line-clamp-2\">\n                                  {transaction.notes}\n                                </p>\n                              )}\n\n                            </div>\n\n                            </div>\n                          </div>\n                        </ContextLink>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* Batch Allocation Modal */}\n      {showBatchAllocationModal && (\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n          <div className=\"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white\">\n            <div className=\"mt-3\">\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n                Allocate {selectedItems.size} Items to Project\n              </h3>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Select Project\n                  </label>\n                  <div className=\"relative mt-1\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowProjectDropdown(!showProjectDropdown)}\n                      className=\"project-dropdown-button relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    >\n                      <span className={`block truncate ${!batchAllocationForm.projectId ? 'text-gray-500' : 'text-gray-900'}`}>\n                        {getSelectedProjectName()}\n                      </span>\n                      <span className=\"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none\">\n                        <svg className=\"h-5 w-5 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                          <path fillRule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n                        </svg>\n                      </span>\n                    </button>\n\n                    {showProjectDropdown && (\n                      <div className=\"project-dropdown absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base border border-gray-200 overflow-auto focus:outline-none sm:text-sm\">\n                        {projects.map((project) => (\n                          <button\n                            key={project.id}\n                            type=\"button\"\n                            onClick={() => {\n                              setBatchAllocationForm(prev => ({ ...prev, projectId: project.id }))\n                              setShowProjectDropdown(false)\n                            }}\n                            className={`w-full text-left px-3 py-2 hover:bg-gray-50 ${\n                              batchAllocationForm.projectId === project.id ? 'bg-primary-50 text-primary-600' : 'text-gray-900'\n                            }`}\n                          >\n                            <div className=\"font-medium\">{project.name}</div>\n                            <div className=\"text-sm text-gray-500\">{project.clientName}</div>\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Space (Optional)\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={batchAllocationForm.space}\n                    onChange={(e) => setBatchAllocationForm(prev => ({ ...prev, space: e.target.value }))}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder=\"e.g. Living Room, Bedroom, etc.\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-3 mt-6\">\n                <button\n                  type=\"button\"\n                  onClick={closeBatchAllocationModal}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={handleBatchAllocationSubmit}\n                  disabled={!batchAllocationForm.projectId || isAllocating}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50\"\n                >\n                  {isAllocating ? 'Allocating...' : `Allocate ${selectedItems.size} Items`}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":["BusinessInventory","currentAccountId","accountLoading","useAccount","ENABLE_QR","buildContextUrl","useNavigationContext","activeTab","setActiveTab","useState","items","setItems","transactions","setTransactions","isLoading","setIsLoading","filters","inventorySearchQuery","setInventorySearchQuery","transactionSearchQuery","setTransactionSearchQuery","showTransactionFilterMenu","setShowTransactionFilterMenu","transactionFilterMode","setTransactionFilterMode","uploadingImages","setUploadingImages","filterMode","setFilterMode","showFilterMenu","setShowFilterMenu","selectedItems","setSelectedItems","openDispositionMenu","setOpenDispositionMenu","showSuccess","showError","useToast","projects","setProjects","showBatchAllocationModal","setShowBatchAllocationModal","showProjectDropdown","setShowProjectDropdown","batchAllocationForm","setBatchAllocationForm","isAllocating","setIsAllocating","useEffect","handleClickOutside","event","target","toggleDispositionMenu","itemId","getDispositionBadgeClasses","disposition","baseClasses","normalizeDisposition","updateDisposition","newDisposition","item","it","unifiedItemsService","integrationService","deallocationError","prev","i","error","filteredItems","useMemo","matchesSearch","_a","_b","_c","matchesStatus","matchesFilter","filteredTransactions","filtered","t","query","_d","getCanonicalTransactionTitle","transaction","COMPANY_INVENTORY_SALE","COMPANY_INVENTORY_PURCHASE","tabs","Package","Receipt","itemsUnsubscribe","transactionsUnsubscribe","inventoryData","businessInventoryTransactions","inventoryRelatedTransactions","projectsData","transactionService","projectService","uniqueTransactions","index","self","a","b","updatedItems","updatedTransactions","uniqueTrans","unsubMap","unsub","lineageService","updatedItem","loadBusinessTransactions","tErr","err","u","loadBusinessInventory","data","allTransactions","handleInventorySearchChange","searchQuery","toggleBookmark","useBookmark","updates","duplicateItem","useDuplication","originalItem","originalItemId","dateCreated","lastUpdated","itemData","openBatchAllocationModal","closeBatchAllocationModal","getSelectedProjectName","selectedProject","p","handleBatchAllocationSubmit","itemIds","handleDeleteSelectedItems","itemCount","confirmMessage","prevItems","successCount","errorCount","handleAddImage","files","ImageUploadService","file","processImageUpload","newSet","allFiles","newImage","message","handleSelectAll","checked","handleSelectItem","newSelected","jsxs","jsx","Link","tab","Icon","Fragment","ContextLink","Plus","Search","e","Filter","DollarSign","Trash2","Bookmark","Edit","Copy","displayDispositionLabel","ChevronDown","dispositionsEqual","primaryImage","img","Camera","formatCurrency","formatDate","project"],"mappings":"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"}