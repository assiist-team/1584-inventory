{"version":3,"file":"BusinessInventory.js","sources":["../../src/pages/BusinessInventory.tsx"],"sourcesContent":["import { Plus, Search, Package, Receipt, Filter, QrCode, Trash2, Camera, Edit, Bookmark, Copy, DollarSign } from 'lucide-react'\nimport { useMemo } from 'react'\nimport { useState, useEffect } from 'react'\nimport { Link } from 'react-router-dom'\nimport { Item, Transaction, ItemImage, Project } from '@/types'\nimport type { Transaction as TransactionType } from '@/types'\nimport { unifiedItemsService, transactionService, projectService } from '@/services/inventoryService'\nimport { ImageUploadService } from '@/services/imageService'\nimport { formatCurrency, formatDate } from '@/utils/dateUtils'\nimport { COMPANY_INVENTORY, COMPANY_INVENTORY_SALE, COMPANY_INVENTORY_PURCHASE } from '@/constants/company'\nimport { useBookmark } from '@/hooks/useBookmark'\nimport { useDuplication } from '@/hooks/useDuplication'\nimport { useAccount } from '@/contexts/AccountContext'\n\ninterface FilterOptions {\n  status?: string\n  searchQuery?: string\n}\n\nexport default function BusinessInventory() {\n  const { currentAccountId, loading: accountLoading } = useAccount()\n  const [activeTab, setActiveTab] = useState<'inventory' | 'transactions'>('inventory')\n  const [items, setItems] = useState<Item[]>([])\n  const [transactions, setTransactions] = useState<Transaction[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [filters] = useState<FilterOptions>({\n    status: '',\n    searchQuery: ''\n  })\n  const [inventorySearchQuery, setInventorySearchQuery] = useState<string>('')\n  const [transactionSearchQuery, setTransactionSearchQuery] = useState<string>('')\n\n  // Filter state for transactions tab\n  const [showTransactionFilterMenu, setShowTransactionFilterMenu] = useState(false)\n  const [transactionFilterMode, setTransactionFilterMode] = useState<'all' | 'pending' | 'completed' | 'canceled' | 'inventory-only'>('all')\n\n  // Image upload state\n  const [uploadingImages, setUploadingImages] = useState<Set<string>>(new Set())\n\n  // Filter and selection state for inventory items (matching InventoryList.tsx)\n  const [filterMode, setFilterMode] = useState<'all' | 'bookmarked'>('all')\n  const [showFilterMenu, setShowFilterMenu] = useState(false)\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set())\n\n  // Batch allocation state\n  const [projects, setProjects] = useState<Project[]>([])\n  const [showBatchAllocationModal, setShowBatchAllocationModal] = useState(false)\n  const [showProjectDropdown, setShowProjectDropdown] = useState(false)\n  const [batchAllocationForm, setBatchAllocationForm] = useState({\n    projectId: '',\n    space: ''\n  })\n  const [isAllocating, setIsAllocating] = useState(false)\n\n  // Close filter menus when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if ((showFilterMenu || showTransactionFilterMenu) && !event.target) return\n\n      const target = event.target as Element\n      if (!target.closest('.filter-menu') && !target.closest('.filter-button') && !target.closest('.transaction-filter-menu') && !target.closest('.transaction-filter-button')) {\n        setShowFilterMenu(false)\n        setShowTransactionFilterMenu(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [showFilterMenu, showTransactionFilterMenu])\n\n  // Compute filtered items (matching InventoryList.tsx)\n  const filteredItems = useMemo(() => {\n    return items.filter(item => {\n      // Apply search filter\n      const matchesSearch = !inventorySearchQuery ||\n        item.description?.toLowerCase().includes(inventorySearchQuery.toLowerCase()) ||\n        item.sku?.toLowerCase().includes(inventorySearchQuery.toLowerCase()) ||\n        item.businessInventoryLocation?.toLowerCase().includes(inventorySearchQuery.toLowerCase())\n\n      // Apply status filter\n      const matchesStatus = !filters.status || item.inventoryStatus === filters.status\n\n      // Apply bookmark filter\n      const matchesFilter = filterMode === 'all' || (filterMode === 'bookmarked' && item.bookmark)\n\n      return matchesSearch && matchesStatus && matchesFilter\n    })\n  }, [items, inventorySearchQuery, filters.status, filterMode])\n\n  // Compute filtered transactions\n  const filteredTransactions = useMemo(() => {\n    let filtered = transactions\n\n    // Apply status filter based on filter mode\n    if (transactionFilterMode !== 'all') {\n      if (transactionFilterMode === 'inventory-only') {\n        // Show only business inventory transactions (projectId == null)\n        filtered = filtered.filter(t => t.projectId === null)\n      } else {\n        // Apply status filter for other modes\n        filtered = filtered.filter(t => t.status === transactionFilterMode)\n      }\n    }\n\n    // Apply search filter\n    if (transactionSearchQuery) {\n      const query = transactionSearchQuery.toLowerCase()\n      filtered = filtered.filter(t =>\n        t.source?.toLowerCase().includes(query) ||\n        t.transactionType?.toLowerCase().includes(query) ||\n        t.projectName?.toLowerCase().includes(query) ||\n        t.notes?.toLowerCase().includes(query)\n      )\n    }\n\n    return filtered\n  }, [transactions, transactionFilterMode, transactionSearchQuery])\n\n  // Canonical transaction title for display only\n  const getCanonicalTransactionTitle = (transaction: TransactionType): string => {\n    if (transaction.transactionId?.startsWith('INV_SALE_')) return COMPANY_INVENTORY_SALE\n    if (transaction.transactionId?.startsWith('INV_PURCHASE_')) return COMPANY_INVENTORY_PURCHASE\n    return transaction.source\n  }\n\n  const tabs = [\n    { id: 'inventory' as const, name: 'Items', icon: Package },\n    { id: 'transactions' as const, name: 'Transactions', icon: Receipt }\n  ]\n\n  // Unified useEffect for data loading and real-time subscriptions\n  useEffect(() => {\n    let itemsUnsubscribe: (() => void) | null = null\n    let transactionsUnsubscribe: (() => void) | null = null\n\n    const loadInitialData = async () => {\n    if (!currentAccountId) {\n      setIsLoading(false)\n      return\n    }\n\n        setIsLoading(true)\n      try {\n        const [inventoryData, businessInventoryTransactions, inventoryRelatedTransactions, projectsData] = await Promise.all([\n          unifiedItemsService.getBusinessInventoryItems(currentAccountId, filters),\n          transactionService.getBusinessInventoryTransactions(currentAccountId),\n          transactionService.getInventoryRelatedTransactions(currentAccountId),\n          projectService.getProjects(currentAccountId)\n        ])\n\n        const allTransactions = [...businessInventoryTransactions, ...inventoryRelatedTransactions]\n        const uniqueTransactions = allTransactions.filter((transaction, index, self) =>\n          index === self.findIndex(t => t.transactionId === transaction.transactionId)\n        )\n        uniqueTransactions.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n\n        setItems(inventoryData)\n        setTransactions(uniqueTransactions)\n        setProjects(projectsData)\n\n        // Setup subscriptions after initial data load\n        itemsUnsubscribe = unifiedItemsService.subscribeToBusinessInventory(\n          currentAccountId,\n          (updatedItems) => setItems(updatedItems),\n          filters,\n          inventoryData\n        )\n        \n        // We need a new subscription service for transactions\n        transactionsUnsubscribe = transactionService.subscribeToAllTransactions(\n          currentAccountId,\n          (updatedTransactions) => {\n            const allTrans = [...updatedTransactions];\n            const uniqueTrans = allTrans.filter((transaction, index, self) =>\n              index === self.findIndex(t => t.transactionId === transaction.transactionId)\n            );\n            uniqueTrans.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n            setTransactions(uniqueTrans);\n          },\n          uniqueTransactions\n        )\n\n      } catch (error) {\n        console.error('Error loading business inventory data:', error)\n          setItems([])\n          setTransactions([])\n          setProjects([])\n      } finally {\n          setIsLoading(false)\n        }\n    }\n\n    loadInitialData()\n\n    return () => {\n      if (itemsUnsubscribe) itemsUnsubscribe()\n      if (transactionsUnsubscribe) transactionsUnsubscribe()\n    }\n  }, [currentAccountId, filters])\n\n  // Reset uploading state on unmount to prevent hanging state\n  useEffect(() => {\n    return () => {\n      setUploadingImages(new Set())\n    }\n  }, [])\n\n  const loadBusinessInventory = async () => {\n    if (!currentAccountId) return\n    try {\n      const data = await unifiedItemsService.getBusinessInventoryItems(currentAccountId, filters)\n      setItems(data)\n    } catch (error) {\n      console.error('Error loading business inventory:', error)\n      setItems([])\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n\n  const loadBusinessTransactions = async () => {\n    if (!currentAccountId) return\n    try {\n      // Get inventory-related transactions from top-level collection\n      const allTransactions: Transaction[] = []\n\n      // Get business inventory transactions (project_id == null)\n      const businessInventoryTransactions = await transactionService.getBusinessInventoryTransactions(currentAccountId)\n      allTransactions.push(...businessInventoryTransactions)\n\n      // Get inventory-related transactions (reimbursement_type in ['Client Owes', 'We Owe'])\n      const inventoryRelatedTransactions = await transactionService.getInventoryRelatedTransactions(currentAccountId)\n      allTransactions.push(...inventoryRelatedTransactions)\n\n      // Remove duplicates (same transaction might appear in both queries)\n      const uniqueTransactions = allTransactions.filter((transaction, index, self) =>\n        index === self.findIndex(t => t.transactionId === transaction.transactionId)\n      )\n\n      // Sort by creation date, newest first\n      uniqueTransactions.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n      setTransactions(uniqueTransactions)\n    } catch (error) {\n      console.error('Error loading business transactions:', error)\n      setTransactions([])\n    }\n  }\n\n  const loadProjects = async () => {\n    if (!currentAccountId) return\n    try {\n      const projectsData = await projectService.getProjects(currentAccountId)\n      setProjects(projectsData)\n    } catch (error) {\n      console.error('Error loading projects:', error)\n    }\n  }\n\n  const handleInventorySearchChange = (searchQuery: string) => {\n    setInventorySearchQuery(searchQuery)\n  }\n\n  // Use centralized bookmark hook\n  const { toggleBookmark } = useBookmark<Item>({\n    items,\n    setItems,\n    updateItemService: (itemId: string, updates: Partial<Item>) => {\n      if (!currentAccountId) throw new Error('Account ID is required')\n      return unifiedItemsService.updateItem(currentAccountId, itemId, updates)\n    }\n  })\n\n  // Use duplication hook for business inventory items\n  const { duplicateItem } = useDuplication({\n    items,\n    setItems,\n    duplicationService: async (itemId: string) => {\n      if (!currentAccountId) throw new Error('Account ID is required')\n      // Since we're using the unified service, we need to create a duplicate item\n      const originalItem = await unifiedItemsService.getItemById(currentAccountId, itemId)\n      if (!originalItem) throw new Error('Item not found')\n\n      // Create a new item with similar data but new ID\n      // Rename destructured `itemId` to `originalItemId` to avoid redeclaring the `itemId` parameter\n      const { itemId: originalItemId, dateCreated, lastUpdated, ...itemData } = originalItem\n      return await unifiedItemsService.createItem(currentAccountId, {\n        ...itemData,\n        inventoryStatus: 'available',\n        projectId: null,\n        disposition: itemData.disposition || 'keep' // Preserve existing disposition or default to 'keep'\n      })\n    }\n  })\n\n  // Batch allocation functions\n  const openBatchAllocationModal = () => {\n    setShowBatchAllocationModal(true)\n  }\n\n  const closeBatchAllocationModal = () => {\n    setShowBatchAllocationModal(false)\n    setShowProjectDropdown(false)\n    setBatchAllocationForm({\n      projectId: '',\n      space: ''\n    })\n  }\n\n  const getSelectedProjectName = () => {\n    const selectedProject = projects.find(p => p.id === batchAllocationForm.projectId)\n    return selectedProject ? `${selectedProject.name} - ${selectedProject.clientName}` : 'Select a project...'\n  }\n\n  const handleBatchAllocationSubmit = async () => {\n    if (!batchAllocationForm.projectId || selectedItems.size === 0 || !currentAccountId) return\n\n    setIsAllocating(true)\n    try {\n      const itemIds = Array.from(selectedItems)\n      await unifiedItemsService.batchAllocateItemsToProject(\n        currentAccountId,\n        itemIds,\n        batchAllocationForm.projectId,\n        {\n          space: batchAllocationForm.space\n        }\n      )\n\n      // Clear selections and close modal\n      setSelectedItems(new Set())\n      closeBatchAllocationModal()\n\n      // Show success message\n      alert(`Successfully allocated ${itemIds.length} items to project!`)\n\n      // Items will be updated via real-time subscription\n    } catch (error) {\n      console.error('Error batch allocating items:', error)\n      alert('Error allocating items. Please try again.')\n    } finally {\n      setIsAllocating(false)\n    }\n  }\n\n  const handleDeleteSelectedItems = async () => {\n    if (selectedItems.size === 0 || !currentAccountId) return\n\n    const itemCount = selectedItems.size\n    const confirmMessage = itemCount === 1\n      ? 'Are you sure you want to delete this item? This action cannot be undone.'\n      : `Are you sure you want to delete ${itemCount} items? This action cannot be undone.`\n\n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const itemIds = Array.from(selectedItems)\n    \n    // Optimistically update UI immediately by removing deleted items from state\n    setItems(prevItems => prevItems.filter(item => !itemIds.includes(item.itemId)))\n    \n    // Clear selections immediately\n    setSelectedItems(new Set())\n\n    try {\n      let successCount = 0\n      let errorCount = 0\n\n      // Delete items one by one\n      for (const itemId of itemIds) {\n        try {\n          await unifiedItemsService.deleteItem(currentAccountId, itemId)\n          successCount++\n        } catch (error) {\n          console.error(`Error deleting item ${itemId}:`, error)\n          errorCount++\n        }\n      }\n\n      // Show result message\n      if (errorCount === 0) {\n        alert(`Successfully deleted ${successCount} item${successCount !== 1 ? 's' : ''}.`)\n      } else {\n        // If there were errors, reload the items to restore the failed deletions\n        await loadBusinessInventory()\n        alert(`Deleted ${successCount} item${successCount !== 1 ? 's' : ''}, but ${errorCount} item${errorCount !== 1 ? 's' : ''} failed to delete.`)\n      }\n\n      // Real-time subscription will keep the UI in sync\n    } catch (error) {\n      console.error('Error deleting items:', error)\n      // Reload items on error to restore state\n      await loadBusinessInventory()\n      alert('Error deleting items. Please try again.')\n    }\n  }\n\n  // Image handling functions\n  const handleAddImage = async (itemId: string) => {\n    try {\n      setUploadingImages(prev => new Set(prev).add(itemId))\n\n      const files = await ImageUploadService.selectFromGallery()\n\n      if (files.length > 0) {\n        // Process all selected files sequentially\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i]\n          await processImageUpload(itemId, file, files)\n        }\n      }\n    } catch (error: any) {\n      console.error('Error adding image:', error)\n\n      // Handle cancel/timeout gracefully - don't show error for user cancellation\n      if (error.message?.includes('timeout') || error.message?.includes('canceled')) {\n        console.log('User canceled image selection or selection timed out')\n        return\n      }\n\n      // Show error for actual failures\n      alert('Failed to add image. Please try again.')\n    } finally {\n      setUploadingImages(prev => {\n        const newSet = new Set(prev)\n        newSet.delete(itemId)\n        return newSet\n      })\n    }\n  }\n\n  const processImageUpload = async (itemId: string, file: File, allFiles?: File[]) => {\n    const uploadResult = await ImageUploadService.uploadItemImage(\n      file,\n      'Business Inventory',\n      itemId\n    )\n\n    const newImage: ItemImage = {\n      url: uploadResult.url,\n      alt: file.name,\n      isPrimary: true, // First image is always primary when added from list\n      uploadedAt: new Date(),\n      fileName: file.name,\n      size: file.size,\n      mimeType: file.type\n    }\n\n    // Update the item with the new image\n    if (!currentAccountId) throw new Error('Account ID is required')\n    await unifiedItemsService.updateItem(currentAccountId, itemId, { images: [newImage] })\n\n    // Show success notification on the last file\n    if (allFiles && allFiles.indexOf(file) === allFiles.length - 1) {\n      const message = allFiles.length > 1 ? `${allFiles.length} images uploaded successfully!` : 'Image uploaded successfully!'\n      alert(message)\n    }\n  }\n\n\n  // Filter handlers (matching InventoryList.tsx)\n  const handleSelectAll = (checked: boolean) => {\n    if (checked) {\n      setSelectedItems(new Set(filteredItems.map(item => item.itemId)))\n    } else {\n      setSelectedItems(new Set())\n    }\n  }\n\n  const handleSelectItem = (itemId: string, checked: boolean) => {\n    const newSelected = new Set(selectedItems)\n    if (checked) {\n      newSelected.add(itemId)\n    } else {\n      newSelected.delete(itemId)\n    }\n    setSelectedItems(newSelected)\n  }\n\n  // Guard against no account when not loading\n  if (!isLoading && !accountLoading && !currentAccountId) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Business Inventory</h1>\n        </div>\n        <div className=\"bg-white shadow rounded-lg border border-yellow-200 bg-yellow-50\">\n          <div className=\"px-4 py-5 sm:p-6\">\n            <div className=\"text-center py-12\">\n              <Package className=\"mx-auto h-12 w-12 text-yellow-600\" />\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">\n                No Account Selected\n              </h3>\n              <p className=\"mt-1 text-sm text-gray-600\">\n                Please select or create an account to manage inventory.\n              </p>\n              <div className=\"mt-6\">\n                <Link\n                  to=\"/settings\"\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                >\n                  Go to Settings\n                </Link>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-32\">\n        <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900\">{COMPANY_INVENTORY}</h1>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"bg-white shadow rounded-lg\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"-mb-px flex space-x-8 px-6\">\n            {tabs.map((tab) => {\n              const Icon = tab.icon\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  className={`py-4 px-1 border-b-2 font-medium text-base flex items-center ${\n                    activeTab === tab.id\n                      ? 'border-primary-500 text-primary-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  <Icon className=\"h-4 w-4 mr-2\" />\n                  {tab.name}\n                </button>\n              )\n            })}\n          </nav>\n        </div>\n\n\n        {/* Tab Content */}\n        <div className=\"px-6 py-6\">\n          {activeTab === 'inventory' && (\n            <>\n              {/* Header - Just Add Item button */}\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-2\">\n                <Link\n                  to=\"/business-inventory/add?returnTo=/business-inventory\"\n                  className=\"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Item\n                </Link>\n              </div>\n\n              {/* Search and Controls - Sticky Container */}\n              <div className=\"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2\">\n                <div className=\"space-y-0\">\n                  {/* Search Bar */}\n                  <div className=\"relative pt-2\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <Search className=\"h-5 w-5 text-gray-400\" />\n                    </div>\n                    <input\n                      type=\"text\"\n                      className=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base\"\n                      placeholder=\"Search items by description, SKU, or location...\"\n                      value={inventorySearchQuery || ''}\n                      onChange={(e) => handleInventorySearchChange(e.target.value)}\n                    />\n                  </div>\n\n          {/* Select All and Bulk Actions */}\n          <div className=\"flex items-center justify-between gap-4 p-3 rounded-lg\">\n            {/* Select All */}\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                className=\"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4\"\n                onChange={(e) => handleSelectAll(e.target.checked)}\n                checked={selectedItems.size === filteredItems.length && filteredItems.length > 0}\n              />\n              <span className=\"ml-3 text-sm font-medium text-gray-700\">Select all</span>\n            </label>\n\n            {/* Right section - counter and buttons */}\n            <div className=\"flex items-center gap-3\">\n\n              {/* Bulk action buttons */}\n              <div className=\"flex items-center space-x-2\">\n                {/* Filter Button */}\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setShowFilterMenu(!showFilterMenu)}\n                    className=\"filter-button inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200\"\n                    title=\"Filter items\"\n                  >\n                    <Filter className=\"h-4 w-4\" />\n                  </button>\n\n                  {/* Filter Dropdown Menu */}\n                  {showFilterMenu && (\n                    <div className=\"filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                      <div className=\"py-1\">\n                        <button\n                          onClick={() => {\n                            setFilterMode('all')\n                            setShowFilterMenu(false)\n                          }}\n                          className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                            filterMode === 'all' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                          }`}\n                        >\n                          All Items\n                        </button>\n                        <button\n                          onClick={() => {\n                            setFilterMode('bookmarked')\n                            setShowFilterMenu(false)\n                          }}\n                          className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                            filterMode === 'bookmarked' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                          }`}\n                        >\n                          Bookmarked Only\n                        </button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Allocate to Project Button */}\n                <button\n                  onClick={openBatchAllocationModal}\n                  className=\"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200\"\n                  disabled={selectedItems.size === 0}\n                  title=\"Allocate selected items to project\"\n                >\n                  <DollarSign className=\"h-4 w-4\" />\n                </button>\n\n                <button\n                  className=\"inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 transition-colors duration-200\"\n                  disabled={selectedItems.size === 0}\n                  title=\"Generate QR Codes\"\n                >\n                  <QrCode className=\"h-4 w-4\" />\n                </button>\n\n                <button\n                  onClick={handleDeleteSelectedItems}\n                  className=\"inline-flex items-center justify-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200\"\n                  disabled={selectedItems.size === 0}\n                  title=\"Delete Selected Items\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n              {/* Items List */}\n              {filteredItems.length === 0 ? (\n                <div className=\"text-center py-12 px-4\">\n                  <div className=\"mx-auto h-16 w-16 text-gray-400 -mb-1\">ðŸ“¦</div>\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n                    No items found\n                  </h3>\n                  <p className=\"text-sm text-gray-500 mb-4\">\n                    {inventorySearchQuery || filters.status || filterMode === 'bookmarked'\n                      ? 'Try adjusting your search or filter criteria.'\n                      : 'No items found.'\n                    }\n                  </p>\n                </div>\n              ) : (\n                <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n                  <ul className=\"divide-y divide-gray-200\">\n                    {filteredItems.map((item) => (\n                      <li key={item.itemId} className=\"relative bg-gray-50 transition-colors duration-200 hover:bg-gray-100\">\n                        {/* Top row: Controls - stays outside Link */}\n                        <div className=\"flex items-center justify-between mb-0 px-4 py-3\">\n                          <div className=\"flex items-center\">\n                            <input\n                              type=\"checkbox\"\n                              className=\"rounded border-gray-300 text-primary-600 focus:ring-primary-500 h-4 w-4 flex-shrink-0\"\n                              checked={selectedItems.has(item.itemId)}\n                              onChange={(e) => handleSelectItem(item.itemId, e.target.checked)}\n                            />\n                          </div>\n\n                          {/* Action buttons */}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className={`inline-flex items-center justify-center p-2 border text-sm font-medium rounded-md transition-colors ${\n                                item.bookmark\n                                  ? 'border-red-300 text-red-700 bg-red-50 hover:bg-red-100'\n                                  : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                              } focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`}\n                              title={item.bookmark ? 'Remove Bookmark' : 'Add Bookmark'}\n                              onClick={(e) => {\n                                e.preventDefault()\n                                e.stopPropagation()\n                                toggleBookmark(item.itemId)\n                              }}\n                            >\n                              <Bookmark className=\"h-4 w-4\" fill={item.bookmark ? 'currentColor' : 'none'} />\n                            </button>\n                            <Link\n                              to={`/business-inventory/${item.itemId}/edit?returnTo=/business-inventory`}\n                              onClick={(e) => e.stopPropagation()}\n                              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors\"\n                              title=\"Edit item\"\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Link>\n                            <button\n                              onClick={(e) => {\n                                e.preventDefault()\n                                e.stopPropagation()\n                                duplicateItem(item.itemId)\n                              }}\n                              className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors\"\n                              title=\"Duplicate item\"\n                            >\n                              <Copy className=\"h-4 w-4\" />\n                            </button>\n                            {/* Status badge moved to top-right corner */}\n                            <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n                              item.inventoryStatus === 'available'\n                                ? 'bg-green-100 text-green-800'\n                                : item.inventoryStatus === 'allocated'\n                                ? 'bg-yellow-100 text-yellow-800'\n                                : 'bg-red-100 text-red-800'\n                            }`}>\n                              {item.inventoryStatus === 'available' ? 'Available' :\n                               item.inventoryStatus === 'allocated' ? 'Allocated' : 'Sold'}\n                            </span>\n                          </div>\n                        </div>\n\n                        {/* Main tappable content - wrapped in Link */}\n                        <Link to={`/business-inventory/${item.itemId}`}>\n                          <div className=\"block bg-transparent\">\n                            <div className=\"px-4 pb-3 sm:px-6\">\n                              {/* Middle row: Thumbnail and Description - now tappable */}\n                              <div className=\"flex items-center gap-3 py-3\">\n                                <div className=\"flex-shrink-0\">\n                                  {item.images && item.images.length > 0 ? (\n                                    // Show primary image thumbnail or first image if no primary\n                                    (() => {\n                                      const primaryImage = item.images.find(img => img.isPrimary) || item.images[0]\n                                      return (\n                                        <div className=\"w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200\">\n                                          <img\n                                            src={primaryImage.url}\n                                            alt={primaryImage.alt || 'Item image'}\n                                            className=\"w-full h-full object-cover\"\n                                          />\n                                        </div>\n                                      )\n                                    })()\n                                  ) : (\n                                    // Show camera placeholder when no images\n                                    <button\n                                      onClick={(e) => {\n                                        e.preventDefault()\n                                        e.stopPropagation()\n                                        handleAddImage(item.itemId)\n                                      }}\n                                      disabled={uploadingImages.has(item.itemId)}\n                                      className=\"w-16 h-16 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 transition-colors disabled:opacity-50\"\n                                      title=\"Add image (camera or gallery)\"\n                                    >\n                                      <Camera className=\"h-6 w-6\" />\n                                    </button>\n                                  )}\n                                </div>\n\n                                {/* Item description - now tappable */}\n                                <div className=\"flex-1 min-w-0 flex items-center\">\n                                  <div>\n                                    <h3 className=\"text-base font-medium text-gray-900 line-clamp-2 break-words\">\n                                      {item.description}\n                                    </h3>\n                                    {/* Storage Location field */}\n                                    {item.businessInventoryLocation && (\n                                      <p className=\"text-sm text-gray-600 mt-1\">\n                                        {item.businessInventoryLocation}\n                                      </p>\n                                    )}\n                                  </div>\n                                </div>\n                              </div>\n\n                              {/* Bottom row: Content - now tappable */}\n                              <div className=\"space-y-2\">\n                                {/* Project Price (or Purchase Price if project price not set), Source, SKU on same row */}\n                                <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500\">\n                                  {(item.projectPrice || item.purchasePrice) && (\n                                    <span className=\"font-medium text-gray-700\">${item.projectPrice || item.purchasePrice}</span>\n                                  )}\n                                  {item.source && (\n                                    <>\n                                      {(item.projectPrice || item.purchasePrice) && <span className=\"hidden sm:inline\">â€¢</span>}\n                                      <span className=\"font-medium text-gray-700\">{item.source}</span>\n                                    </>\n                                  )}\n                                  {item.sku && (\n                                    <>\n                                      {(item.projectPrice || item.purchasePrice || item.source) && <span className=\"hidden sm:inline\">â€¢</span>}\n                                      <span className=\"font-medium text-gray-700\">{item.sku}</span>\n                                    </>\n                                  )}\n                                </div>\n\n                                {/* Notes */}\n                                {item.notes && (\n                                  <p className=\"text-sm text-gray-600 line-clamp-2\">\n                                    {item.notes}\n                                  </p>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </Link>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </>\n          )}\n\n          {activeTab === 'transactions' && (\n            <>\n              {/* Header - Add Transaction button */}\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2\">\n                <Link\n                  to=\"/business-inventory/transaction/add\"\n                  className=\"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors duration-200 w-full sm:w-auto\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Transaction\n                </Link>\n              </div>\n\n              {/* Search and Controls - Sticky Container */}\n              <div className=\"sticky top-0 z-10 bg-white border-b border-gray-200 pb-0 mb-2\">\n                <div className=\"space-y-0\">\n                  {/* Search Bar */}\n                  <div className=\"relative pt-2\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <Search className=\"h-5 w-5 text-gray-400\" />\n                    </div>\n                    <input\n                      type=\"text\"\n                      className=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-base\"\n                      placeholder=\"Search transactions by source, type, project, or notes...\"\n                      value={transactionSearchQuery || ''}\n                      onChange={(e) => setTransactionSearchQuery(e.target.value)}\n                    />\n                  </div>\n\n                  {/* Filter Controls */}\n                  <div className=\"flex items-center justify-end gap-4 p-3 rounded-lg\">\n                    {/* Filter Button */}\n                    <div className=\"relative\">\n                      <button\n                        onClick={() => setShowTransactionFilterMenu(!showTransactionFilterMenu)}\n                        className={`transaction-filter-button inline-flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md transition-colors duration-200 ${\n                          transactionFilterMode === 'all'\n                            ? 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                            : 'border-primary-500 text-primary-600 bg-primary-50 hover:bg-primary-100'\n                        }`}\n                        title=\"Filter transactions\"\n                      >\n                        <Filter className=\"h-4 w-4\" />\n                      </button>\n\n                      {/* Transaction Filter Dropdown Menu */}\n                      {showTransactionFilterMenu && (\n                        <div className=\"transaction-filter-menu absolute top-full right-0 mt-1 w-40 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n                          <div className=\"py-1\">\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('all')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'all' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              All Status\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('pending')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'pending' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Pending\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('completed')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'completed' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Completed\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('canceled')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'canceled' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Canceled\n                            </button>\n                            <button\n                              onClick={() => {\n                                setTransactionFilterMode('inventory-only')\n                                setShowTransactionFilterMenu(false)\n                              }}\n                              className={`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${\n                                transactionFilterMode === 'inventory-only' ? 'bg-primary-50 text-primary-600' : 'text-gray-700'\n                              }`}\n                            >\n                              Inventory Only\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Transactions List */}\n              {filteredTransactions.length === 0 ? (\n                <div className=\"text-center py-12 px-4\">\n                  <div className=\"mx-auto h-16 w-16 text-gray-400 -mb-1\">ðŸ§¾</div>\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n                    No transactions found\n                  </h3>\n                  <p className=\"text-sm text-gray-500 mb-4\">\n                    {transactionSearchQuery || transactionFilterMode !== 'all'\n                      ? 'Try adjusting your search or filter criteria.'\n                      : 'No inventory-related transactions found.'\n                    }\n                  </p>\n                </div>\n              ) : (\n                <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n                  <ul className=\"divide-y divide-gray-200\">\n                    {filteredTransactions.map((transaction) => (\n                      <li key={transaction.transactionId} className=\"relative\">\n                        <Link to={`/business-inventory/transaction/${transaction.transactionId}`}>\n                          <div className=\"block bg-gray-50 transition-colors duration-200 hover:bg-gray-100\">\n                            <div className=\"px-4 py-4 sm:px-6\">\n                            {/* Top row: Header with source and status */}\n                            <div className=\"flex items-center justify-between mb-3\">\n                              <div className=\"flex items-center\">\n                                <h3 className=\"text-base font-medium text-gray-900\">\n                                  {getCanonicalTransactionTitle(transaction)}\n                                </h3>\n                              </div>\n                              <div className=\"flex items-center flex-wrap gap-2\">\n                                <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium no-icon ${\n                                  transaction.status === 'completed'\n                                    ? 'bg-green-100 text-green-800'\n                                    : transaction.status === 'pending'\n                                    ? 'bg-yellow-100 text-yellow-800'\n                                    : 'bg-red-100 text-red-800'\n                                }`}>\n                                  {transaction.status === 'completed' ? 'Completed' :\n                                   transaction.status === 'pending' ? 'Pending' :\n                                   transaction.status === 'canceled' ? 'Canceled' :\n                                   transaction.status}\n                                </span>\n                              </div>\n                            </div>\n\n                            {/* Bottom row: Details */}\n                            <div className=\"space-y-2\">\n                              {/* Details row - Price, project, date */}\n                              <div className=\"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500\">\n                                <span className=\"font-medium text-gray-700\">{formatCurrency(transaction.amount)}</span>\n                                {transaction.projectName && (\n                                  <>\n                                    <span className=\"hidden sm:inline\">â€¢</span>\n                                    <span className=\"font-medium text-gray-700\">\n                                      {transaction.projectName}\n                                    </span>\n                                  </>\n                                )}\n                                <span className=\"hidden sm:inline\">â€¢</span>\n                                <span className=\"font-medium text-gray-700\">\n                                  {formatDate(transaction.transactionDate)}\n                                </span>\n                              </div>\n\n                              {/* Notes */}\n                              {transaction.notes && (\n                                <p className=\"text-sm text-gray-600 line-clamp-2\">\n                                  {transaction.notes}\n                                </p>\n                              )}\n\n                            </div>\n\n                            </div>\n                          </div>\n                        </Link>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* Batch Allocation Modal */}\n      {showBatchAllocationModal && (\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n          <div className=\"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white\">\n            <div className=\"mt-3\">\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n                Allocate {selectedItems.size} Items to Project\n              </h3>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Select Project\n                  </label>\n                  <div className=\"relative mt-1\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowProjectDropdown(!showProjectDropdown)}\n                      className=\"project-dropdown-button relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    >\n                      <span className={`block truncate ${!batchAllocationForm.projectId ? 'text-gray-500' : 'text-gray-900'}`}>\n                        {getSelectedProjectName()}\n                      </span>\n                      <span className=\"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none\">\n                        <svg className=\"h-5 w-5 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                          <path fillRule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n                        </svg>\n                      </span>\n                    </button>\n\n                    {showProjectDropdown && (\n                      <div className=\"project-dropdown absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base border border-gray-200 overflow-auto focus:outline-none sm:text-sm\">\n                        {projects.map((project) => (\n                          <button\n                            key={project.id}\n                            type=\"button\"\n                            onClick={() => {\n                              setBatchAllocationForm(prev => ({ ...prev, projectId: project.id }))\n                              setShowProjectDropdown(false)\n                            }}\n                            className={`w-full text-left px-3 py-2 hover:bg-gray-50 ${\n                              batchAllocationForm.projectId === project.id ? 'bg-primary-50 text-primary-600' : 'text-gray-900'\n                            }`}\n                          >\n                            <div className=\"font-medium\">{project.name}</div>\n                            <div className=\"text-sm text-gray-500\">{project.clientName}</div>\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Space (Optional)\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={batchAllocationForm.space}\n                    onChange={(e) => setBatchAllocationForm(prev => ({ ...prev, space: e.target.value }))}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder=\"e.g. Living Room, Bedroom, etc.\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-3 mt-6\">\n                <button\n                  type=\"button\"\n                  onClick={closeBatchAllocationModal}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={handleBatchAllocationSubmit}\n                  disabled={!batchAllocationForm.projectId || isAllocating}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50\"\n                >\n                  {isAllocating ? 'Allocating...' : `Allocate ${selectedItems.size} Items`}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":["BusinessInventory","currentAccountId","accountLoading","useAccount","activeTab","setActiveTab","useState","items","setItems","transactions","setTransactions","isLoading","setIsLoading","filters","inventorySearchQuery","setInventorySearchQuery","transactionSearchQuery","setTransactionSearchQuery","showTransactionFilterMenu","setShowTransactionFilterMenu","transactionFilterMode","setTransactionFilterMode","uploadingImages","setUploadingImages","filterMode","setFilterMode","showFilterMenu","setShowFilterMenu","selectedItems","setSelectedItems","projects","setProjects","showBatchAllocationModal","setShowBatchAllocationModal","showProjectDropdown","setShowProjectDropdown","batchAllocationForm","setBatchAllocationForm","isAllocating","setIsAllocating","useEffect","handleClickOutside","event","target","filteredItems","useMemo","item","matchesSearch","_a","_b","_c","matchesStatus","matchesFilter","filteredTransactions","filtered","t","query","_d","getCanonicalTransactionTitle","transaction","COMPANY_INVENTORY_SALE","COMPANY_INVENTORY_PURCHASE","tabs","Package","Receipt","itemsUnsubscribe","transactionsUnsubscribe","inventoryData","businessInventoryTransactions","inventoryRelatedTransactions","projectsData","unifiedItemsService","transactionService","projectService","uniqueTransactions","index","self","a","b","updatedItems","updatedTransactions","uniqueTrans","error","loadBusinessInventory","data","handleInventorySearchChange","searchQuery","toggleBookmark","useBookmark","itemId","updates","duplicateItem","useDuplication","originalItem","originalItemId","dateCreated","lastUpdated","itemData","openBatchAllocationModal","closeBatchAllocationModal","getSelectedProjectName","selectedProject","p","handleBatchAllocationSubmit","itemIds","handleDeleteSelectedItems","itemCount","confirmMessage","prevItems","successCount","errorCount","handleAddImage","prev","files","ImageUploadService","i","file","processImageUpload","newSet","allFiles","newImage","message","handleSelectAll","checked","handleSelectItem","newSelected","jsxs","jsx","Link","tab","Icon","Fragment","Plus","Search","e","Filter","DollarSign","QrCode","Trash2","Bookmark","Edit","Copy","primaryImage","img","Camera","formatCurrency","formatDate","project"],"mappings":"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"}